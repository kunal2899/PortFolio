parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"gbIo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NakerWorker=void 0;var e=function(){function e(){var e=this;this.canvasRect={top:0,left:0,right:0,bottom:0,x:0,y:0,height:0,width:0},this.handlers=new Map,self.window={addEventListener:function(t,n,i){e.bindHandler("window",t,n,i)},setTimeout:self.setTimeout.bind(self),PointerEvent:!0,innerHeight:100,innerWidth:100},self.document={addEventListener:function(t,n,i){e.bindHandler("document",t,n,i)},createElement:function(){return{onwheel:!0}},defaultView:self.window,documentElement:{}};self.onmessage=function(t){e.onMainMessage(t)},self.canvas=null}return e.prototype.onMainMessage=function(e){var t=e.data.type,n=e.data;switch(t){case"event":this.handleEvent(n);break;case"visible":this.engine.system.setVisible(n.visible);break;case"resize":this.onResize(n);break;case"scroll":this.onScroll(n);break;case"init":this.prepareCanvas(n.canvas);break;case"build":n.container=this.canvas,this.engine=this.buildProject(n)}},e.prototype.buildProject=function(e){},e.prototype.prepareCanvas=function(e){var t=this;this.canvas=e,self.canvas=e,e.setAttribute=function(e,n){t.sendToScreen("canvasMethod",{method:"setAttribute",args:[e,n]})},e.addEventListener=function(e,n,i){t.bindHandler("canvas",e,n,i)},e.getBoundingClientRect=function(){return t.canvasRect},e.focus=function(){t.sendToScreen("canvasMethod",{method:"focus",args:[]})};var n={set touchAction(e){postMessage({type:"canvasStyle",name:"touchAction",value:e})}};Object.defineProperty(e,"style",{get:function(){return n}})},e.prototype.bindHandler=function(e,t,n,i){var a=e+t;this.handlers.set(a,n);var s={targetName:e,eventName:t,option:i};this.sendToScreen("event",s)},e.prototype.handleEvent=function(e){var t=e.targetName+e.eventName;if(e.eventClone.preventDefault=function(){},e.eventClone.target=self.canvas,!this.handlers.has(t))throw new Error("Unknown handlerId: "+t);this.handlers.get(t)(e.eventClone)},e.prototype.onResize=function(e){for(var t=0,n=Object.keys(this.canvasRect);t<n.length;t++){var i=n[t];this.canvasRect[i]=e.canvas[i]}self.canvas.clientWidth=this.canvasRect.width,self.canvas.clientHeight=this.canvasRect.height,self.canvas.width=this.canvasRect.width,self.canvas.height=this.canvasRect.height,self.window.innerWidth=e.window.innerWidth,self.window.innerHeight=e.window.innerHeight,self.window.devicePixelRatio=e.window.devicePixelRatio,self.window.orientation=e.window.orientation,self.document.documentElement.clientHeight=e.document.documentElement.clientHeight},e.prototype.onScroll=function(e){for(var t=0,n=Object.keys(this.canvasRect);t<n.length;t++){var i=n[t];this.canvasRect[i]!=e.canvas[i]&&(this.canvasRect[i]=e.canvas[i])}},e.prototype.sendToScreen=function(e,t){t.type=e,postMessage(t)},e}();exports.NakerWorker=e;
},{}],"90Cu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__extends=e,exports.__rest=n,exports.__decorate=o,exports.__param=a,exports.__metadata=i,exports.__awaiter=u,exports.__generator=c,exports.__exportStar=f,exports.__values=l,exports.__read=s,exports.__spread=p,exports.__spreadArrays=y,exports.__await=_,exports.__asyncGenerator=h,exports.__asyncDelegator=v,exports.__asyncValues=b,exports.__makeTemplateObject=d,exports.__importStar=w,exports.__importDefault=x,exports.__classPrivateFieldGet=m,exports.__classPrivateFieldSet=O,exports.__assign=void 0;var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return exports.__assign=r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};function n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}function o(t,e,r,n){var o,a=arguments.length,i=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(i=(a<3?o(i):a>3?o(e,r,i):o(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i}function a(t,e){return function(r,n){e(r,n,t)}}function i(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function u(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{c(n.next(t))}catch(e){a(e)}}function u(t){try{c(n.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,u)}c((n=n.apply(t,e||[])).next())})}function c(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(u){a=[6,u],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function f(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function l(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}function y(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var a=arguments[e],i=0,u=a.length;i<u;i++,o++)n[o]=a[i];return n}function _(t){return this instanceof _?(this.v=t,this):new _(t)}function h(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),a=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(t){o[t]&&(n[t]=function(e){return new Promise(function(r,n){a.push([t,e,r,n])>1||u(t,e)})})}function u(t,e){try{(r=o[t](e)).value instanceof _?Promise.resolve(r.value.v).then(c,f):l(a[0][2],r)}catch(n){l(a[0][3],n)}var r}function c(t){u("next",t)}function f(t){u("throw",t)}function l(t,e){t(e),a.shift(),a.length&&u(a[0][0],a[0][1])}}function v(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,o){e[n]=t[n]?function(e){return(r=!r)?{value:_(t[n](e)),done:"return"===n}:o?o(e):e}:o}}function b(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof l?l(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,o){(function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,o,(e=t[r](e)).done,e.value)})}}}function d(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function w(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function x(t){return t&&t.__esModule?t:{default:t}}function m(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function O(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}exports.__assign=r;
},{}],"vY1+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Observable=exports.MultiObserver=exports.Observer=exports.EventState=void 0;var e=function(){function e(e,r,t,s){void 0===r&&(r=!1),this.initalize(e,r,t,s)}return e.prototype.initalize=function(e,r,t,s){return void 0===r&&(r=!1),this.mask=e,this.skipNextObservers=r,this.target=t,this.currentTarget=s,this},e}();exports.EventState=e;var r=function(){return function(e,r,t){void 0===t&&(t=null),this.callback=e,this.mask=r,this.scope=t,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}}();exports.Observer=r;var t=function(){function e(){}return e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(r,t,s,n){void 0===s&&(s=-1),void 0===n&&(n=null);var i=new e;i._observers=new Array,i._observables=r;for(var o=0,v=r;o<v.length;o++){var a=v[o].add(t,s,!1,n);a&&i._observers.push(a)}return i},e}();exports.MultiObserver=t;var s=function(){function t(r){this._observers=new Array,this._eventState=new e(0),r&&(this._onObserverAdded=r)}return Object.defineProperty(t.prototype,"observers",{get:function(){return this._observers},enumerable:!0,configurable:!0}),t.prototype.add=function(e,t,s,n,i){if(void 0===t&&(t=-1),void 0===s&&(s=!1),void 0===n&&(n=null),void 0===i&&(i=!1),!e)return null;var o=new r(e,t,n);return o.unregisterOnNextCall=i,s?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},t.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},t.prototype.remove=function(e){return!!e&&(-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))},t.prototype.removeCallback=function(e,r){for(var t=0;t<this._observers.length;t++){var s=this._observers[t];if(!s._willBeUnregistered&&(s.callback===e&&(!r||r===s.scope)))return this._deferUnregister(s),!0}return!1},t.prototype._deferUnregister=function(e){var r=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){r._remove(e)},0)},t.prototype._remove=function(e){if(!e)return!1;var r=this._observers.indexOf(e);return-1!==r&&(this._observers.splice(r,1),!0)},t.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},t.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},t.prototype.notifyObservers=function(e,r,t,s){if(void 0===r&&(r=-1),!this._observers.length)return!0;var n=this._eventState;n.mask=r,n.target=t,n.currentTarget=s,n.skipNextObservers=!1,n.lastReturnValue=e;for(var i=0,o=this._observers;i<o.length;i++){var v=o[i];if(!v._willBeUnregistered&&(v.mask&r&&(v.scope?n.lastReturnValue=v.callback.apply(v.scope,[e,n]):n.lastReturnValue=v.callback(e,n),v.unregisterOnNextCall&&this._deferUnregister(v)),n.skipNextObservers))return!1}return!0},t.prototype.notifyObserversWithPromise=function(e,r,t,s){var n=this;void 0===r&&(r=-1);var i=Promise.resolve(e);if(!this._observers.length)return i;var o=this._eventState;return o.mask=r,o.target=t,o.currentTarget=s,o.skipNextObservers=!1,this._observers.forEach(function(t){o.skipNextObservers||t._willBeUnregistered||t.mask&r&&(i=t.scope?i.then(function(r){return o.lastReturnValue=r,t.callback.apply(t.scope,[e,o])}):i.then(function(r){return o.lastReturnValue=r,t.callback(e,o)}),t.unregisterOnNextCall&&n._deferUnregister(t))}),i.then(function(){return e})},t.prototype.notifyObserver=function(e,r,t){void 0===t&&(t=-1);var s=this._eventState;s.mask=t,s.skipNextObservers=!1,e.callback(r,s)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var e=new t;return e._observers=this._observers.slice(0),e},t.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var r=0,t=this._observers;r<t.length;r++){var s=t[r];if(s.mask&e||s.mask===e)return!0}return!1},t}();exports.Observable=s;
},{}],"GCrr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DomManagement=void 0;var e=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},e.GetDOMTextContent=function(e){for(var t="",n=e.firstChild;n;)3===n.nodeType&&(t+=n.textContent),n=n.nextSibling;return t},e}();exports.DomManagement=e;
},{}],"cq+N":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EngineStore=void 0;var e=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}();exports.EngineStore=e;
},{}],"S9x9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._DevTools=void 0;var e=function(){function e(){}return e.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},e}();exports._DevTools=e;
},{}],"Yh4i":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=void 0;var e=function(){function e(){}return e._AddLogEntry=function(r){e._LogCache=r+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(r)},e._FormatMessage=function(e){var r=function(e){return e<10?"0"+e:""+e},o=new Date;return"["+r(o.getHours())+":"+r(o.getMinutes())+":"+r(o.getSeconds())+"]: "+e},e._LogDisabled=function(e){},e._LogEnabled=function(r){var o=e._FormatMessage(r);console.log("BJS - "+o);var n="<div style='color:white'>"+o+"</div><br>";e._AddLogEntry(n)},e._WarnDisabled=function(e){},e._WarnEnabled=function(r){var o=e._FormatMessage(r);console.warn("BJS - "+o);var n="<div style='color:orange'>"+o+"</div><br>";e._AddLogEntry(n)},e._ErrorDisabled=function(e){},e._ErrorEnabled=function(r){e.errorsCount++;var o=e._FormatMessage(r);console.error("BJS - "+o);var n="<div style='color:red'>"+o+"</div><br>";e._AddLogEntry(n)},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(r){(r&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(r&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(r&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!0,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e._LogCache="",e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}();exports.Logger=e;
},{}],"VuqN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StringTools=void 0;var e=function(){function e(){}return e.EndsWith=function(e,r){return-1!==e.indexOf(r,e.length-r.length)},e.StartsWith=function(e,r){return 0===e.indexOf(r)},e.Decode=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var r="",t=0;t<e.byteLength;t++)r+=String.fromCharCode(e[t]);return r},e.EncodeArrayBufferToBase64=function(e){for(var r,t,n,o,i,f,u,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",d=0,s=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);d<s.length;)o=(r=s[d++])>>2,i=(3&r)<<4|(t=d<s.length?s[d++]:Number.NaN)>>4,f=(15&t)<<2|(n=d<s.length?s[d++]:Number.NaN)>>6,u=63&n,isNaN(t)?f=u=64:isNaN(n)&&(u=64),c+=a.charAt(o)+a.charAt(i)+a.charAt(f)+a.charAt(u);return c},e}();exports.StringTools=e;
},{}],"lkba":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderCodeNode=void 0;var r=require("../../Misc/stringTools"),e=function(){function e(){this.children=[]}return e.prototype.isValid=function(r){return!0},e.prototype.process=function(e,i){var o="";if(this.line){var s=this.line,t=i.processor;if(t){if(t.lineProcessor&&(s=t.lineProcessor(s,i.isFragment)),t.attributeProcessor&&r.StringTools.StartsWith(this.line,"attribute"))s=t.attributeProcessor(this.line);else if(t.varyingProcessor&&r.StringTools.StartsWith(this.line,"varying"))s=t.varyingProcessor(this.line,i.isFragment);else if((t.uniformProcessor||t.uniformBufferProcessor)&&r.StringTools.StartsWith(this.line,"uniform")){/uniform (.+) (.+)/.test(this.line)?t.uniformProcessor&&(s=t.uniformProcessor(this.line,i.isFragment)):t.uniformBufferProcessor&&(s=t.uniformBufferProcessor(this.line,i.isFragment),i.lookForClosingBracketForUniformBuffer=!0)}t.endOfUniformBufferProcessor&&i.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(i.lookForClosingBracketForUniformBuffer=!1,s=t.endOfUniformBufferProcessor(this.line,i.isFragment))}o+=s+"\r\n"}return this.children.forEach(function(r){o+=r.process(e,i)}),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),o},e}();exports.ShaderCodeNode=e;
},{"../../Misc/stringTools":"VuqN"}],"XzZW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderCodeCursor=void 0;var e=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,r=e;t<r.length;t++){var n=r[t];if("#"!==n[0])for(var i=n.split(";"),o=0;o<i.length;o++){var s=i[o];(s=s.trim())&&this._lines.push(s+(o!==i.length-1?";":""))}else this._lines.push(n)}},enumerable:!0,configurable:!0}),e}();exports.ShaderCodeCursor=e;
},{}],"o67I":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderCodeConditionNode=void 0;var e=require("tslib"),r=require("./shaderCodeNode"),o=function(r){function o(){return null!==r&&r.apply(this,arguments)||this}return(0,e.__extends)(o,r),o.prototype.process=function(e,r){for(var o=0;o<this.children.length;o++){var t=this.children[o];if(t.isValid(e))return t.process(e,r)}return""},o}(r.ShaderCodeNode);exports.ShaderCodeConditionNode=o;
},{"tslib":"90Cu","./shaderCodeNode":"lkba"}],"rJHk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderCodeTestNode=void 0;var e=require("tslib"),r=require("./shaderCodeNode"),t=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return(0,e.__extends)(t,r),t.prototype.isValid=function(e){return this.testExpression.isTrue(e)},t}(r.ShaderCodeNode);exports.ShaderCodeTestNode=t;
},{"tslib":"90Cu","./shaderCodeNode":"lkba"}],"BnQG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderDefineExpression=void 0;var e=function(){function e(){}return e.prototype.isTrue=function(e){return!0},e}();exports.ShaderDefineExpression=e;
},{}],"KOCV":[function(require,module,exports) {
var define;
var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderDefineIsDefinedOperator=void 0;var r=require("tslib"),i=require("../shaderDefineExpression"),n=function(e){function i(r,i){void 0===i&&(i=!1);var n=e.call(this)||this;return n.define=r,n.not=i,n}return(0,r.__extends)(i,e),i.prototype.isTrue=function(e){var r=void 0!==e[this.define];return this.not&&(r=!r),r},i}(i.ShaderDefineExpression);exports.ShaderDefineIsDefinedOperator=n;
},{"tslib":"90Cu","../shaderDefineExpression":"BnQG"}],"v/Tn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderDefineOrOperator=void 0;var e=require("tslib"),r=require("../shaderDefineExpression"),t=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return(0,e.__extends)(t,r),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},t}(r.ShaderDefineExpression);exports.ShaderDefineOrOperator=t;
},{"tslib":"90Cu","../shaderDefineExpression":"BnQG"}],"U8uR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderDefineAndOperator=void 0;var e=require("tslib"),r=require("../shaderDefineExpression"),t=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return(0,e.__extends)(t,r),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},t}(r.ShaderDefineExpression);exports.ShaderDefineAndOperator=t;
},{"tslib":"90Cu","../shaderDefineExpression":"BnQG"}],"zcFk":[function(require,module,exports) {
var define;
var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderDefineArithmeticOperator=void 0;var r=require("tslib"),t=require("../shaderDefineExpression"),i=function(e){function t(r,t,i){var a=e.call(this)||this;return a.define=r,a.operand=t,a.testValue=i,a}return(0,r.__extends)(t,e),t.prototype.isTrue=function(e){var r=e[this.define];void 0===r&&(r=this.define);var t=!1,i=parseInt(r),a=parseInt(this.testValue);switch(this.operand){case">":t=i>a;break;case"<":t=i<a;break;case"<=":t=i<=a;break;case">=":t=i>=a;break;case"==":t=i===a}return t},t}(t.ShaderDefineExpression);exports.ShaderDefineArithmeticOperator=i;
},{"tslib":"90Cu","../shaderDefineExpression":"BnQG"}],"j98r":[function(require,module,exports) {
var define;
var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderProcessor=void 0;var r=require("./shaderCodeNode"),i=require("./shaderCodeCursor"),s=require("./shaderCodeConditionNode"),n=require("./shaderCodeTestNode"),o=require("./Expressions/Operators/shaderDefineIsDefinedOperator"),t=require("./Expressions/Operators/shaderDefineOrOperator"),a=require("./Expressions/Operators/shaderDefineAndOperator"),d=require("./Expressions/Operators/shaderDefineArithmeticOperator"),u=require("../../Misc/devTools"),f=function(){function e(){}return e.Process=function(e,r,i){var s=this;this._ProcessIncludes(e,r,function(e){var n=s._ProcessShaderConversion(e,r);i(n)})},e._ProcessPrecision=function(e,r){var i=r.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e},e._ExtractOperation=function(e){var r=/defined\((.+)\)/.exec(e);if(r&&r.length)return new o.ShaderDefineIsDefinedOperator(r[1].trim(),"!"===e[0]);for(var i="",s=0,n=0,t=["==",">=","<=","<",">"];n<t.length&&(i=t[n],!((s=e.indexOf(i))>-1));n++);if(-1===s)return new o.ShaderDefineIsDefinedOperator(e);var a=e.substring(0,s).trim(),u=e.substring(s+i.length).trim();return new d.ShaderDefineArithmeticOperator(a,i,u)},e._BuildSubExpression=function(e){var r=e.indexOf("||");if(-1===r){var i=e.indexOf("&&");if(i>-1){var s=new a.ShaderDefineAndOperator,n=e.substring(0,i).trim(),o=e.substring(i+2).trim();return s.leftOperand=this._BuildSubExpression(n),s.rightOperand=this._BuildSubExpression(o),s}return this._ExtractOperation(e)}var d=new t.ShaderDefineOrOperator;n=e.substring(0,r).trim(),o=e.substring(r+2).trim();return d.leftOperand=this._BuildSubExpression(n),d.rightOperand=this._BuildSubExpression(o),d},e._BuildExpression=function(e,r){var i=new n.ShaderCodeTestNode,s=e.substring(0,r),t=e.substring(r).trim();return i.testExpression="#ifdef"===s?new o.ShaderDefineIsDefinedOperator(t):"#ifndef"===s?new o.ShaderDefineIsDefinedOperator(t,!0):this._BuildSubExpression(t),i},e._MoveCursorWithinIf=function(e,i,s){for(var n=e.currentLine;this._MoveCursor(e,s);){var o=(n=e.currentLine).substring(0,5).toLowerCase();if("#else"===o){var t=new r.ShaderCodeNode;return i.children.push(t),void this._MoveCursor(e,t)}if("#elif"===o){var a=this._BuildExpression(n,5);i.children.push(a),s=a}}},e._MoveCursor=function(e,i){for(;e.canRead;){e.lineIndex++;var n=e.currentLine,o=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(n);if(o&&o.length){switch(o[0]){case"#ifdef":var t=new s.ShaderCodeConditionNode;i.children.push(t);var a=this._BuildExpression(n,6);t.children.push(a),this._MoveCursorWithinIf(e,t,a);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":t=new s.ShaderCodeConditionNode;i.children.push(t);a=this._BuildExpression(n,7);t.children.push(a),this._MoveCursorWithinIf(e,t,a);break;case"#if":t=new s.ShaderCodeConditionNode,a=this._BuildExpression(n,3);i.children.push(t),t.children.push(a),this._MoveCursorWithinIf(e,t,a)}}else{var d=new r.ShaderCodeNode;if(d.line=n,i.children.push(d),"#"===n[0]&&"d"===n[1]){var u=n.replace(";","").split(" ");d.additionalDefineKey=u[1],3===u.length&&(d.additionalDefineValue=u[2])}}}return!1},e._EvaluatePreProcessors=function(e,s,n){var o=new r.ShaderCodeNode,t=new i.ShaderCodeCursor;return t.lineIndex=-1,t.lines=e.split("\n"),this._MoveCursor(t,o),o.process(s,n)},e._PreparePreProcessors=function(e){for(var r={},i=0,s=e.defines;i<s.length;i++){var n=s[i].replace("#define","").replace(";","").trim().split(" ");r[n[0]]=n.length>1?n[1]:""}return r.GL_ES="true",r.__VERSION__=e.version,r[e.platformName]="true",r},e._ProcessShaderConversion=function(e,r){var i=this._ProcessPrecision(e,r);if(!r.processor)return i;if(-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var s=r.defines,n=this._PreparePreProcessors(r);return r.processor.preProcessor&&(i=r.processor.preProcessor(i,s,r.isFragment)),i=this._EvaluatePreProcessors(i,n,r),r.processor.postProcessor&&(i=r.processor.postProcessor(i,s,r.isFragment)),i},e._ProcessIncludes=function(r,i,s){for(var n=this,o=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,t=o.exec(r),a=new String(r);null!=t;){var d=t[1];if(-1!==d.indexOf("__decl__")&&(d=d.replace(/__decl__/,""),i.supportsUniformBuffers&&(d=(d=d.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),d+="Declaration"),!i.includesShadersStore[d]){var u=i.shadersRepository+"ShadersInclude/"+d+".fx";return void e._FileToolsLoadFile(u,function(e){i.includesShadersStore[d]=e,n._ProcessIncludes(a,i,s)})}var f=i.includesShadersStore[d];if(t[2])for(var c=t[3].split(","),p=0;p<c.length;p+=2){var h=new RegExp(c[p],"g"),l=c[p+1];f=f.replace(h,l)}if(t[4]){var v=t[5];if(-1!==v.indexOf("..")){var _=v.split(".."),x=parseInt(_[0]),g=parseInt(_[1]),S=f.slice(0);f="",isNaN(g)&&(g=i.indexParameters[_[1]]);for(var O=x;O<g;O++)i.supportsUniformBuffers||(S=S.replace(/light\{X\}.(\w*)/g,function(e,r){return r+"{X}"})),f+=S.replace(/\{X\}/g,O.toString())+"\n"}else i.supportsUniformBuffers||(f=f.replace(/light\{X\}.(\w*)/g,function(e,r){return r+"{X}"})),f=f.replace(/\{X\}/g,v)}a=a.replace(t[0],f),t=o.exec(r)}s(a)},e._FileToolsLoadFile=function(e,r,i,s,n,o){throw u._DevTools.WarnImport("FileTools")},e}();exports.ShaderProcessor=f;
},{"./shaderCodeNode":"lkba","./shaderCodeCursor":"XzZW","./shaderCodeConditionNode":"o67I","./shaderCodeTestNode":"rJHk","./Expressions/Operators/shaderDefineIsDefinedOperator":"KOCV","./Expressions/Operators/shaderDefineOrOperator":"v/Tn","./Expressions/Operators/shaderDefineAndOperator":"U8uR","./Expressions/Operators/shaderDefineArithmeticOperator":"zcFk","../../Misc/devTools":"S9x9"}],"P0sJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Effect=void 0;var e=require("../Misc/observable"),t=require("../Misc/domManagement"),r=require("../Misc/logger"),i=require("../Engines/Processors/shaderProcessor"),s=function(){function s(r,n,o,a,h,u,l,c,_,f){var p,m,d=this;if(void 0===a&&(a=null),void 0===u&&(u=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===_&&(_=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new e.Observable,this.onErrorObservable=new e.Observable,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=r,n.attributes){var y=n;if(this._engine=o,this._attributesNames=y.attributes,this._uniformsNames=y.uniformsNames.concat(y.samplers),this._samplerList=y.samplers.slice(),this.defines=y.defines,this.onError=y.onError,this.onCompiled=y.onCompiled,this._fallbacks=y.fallbacks,this._indexParameters=y.indexParameters,this._transformFeedbackVaryings=y.transformFeedbackVaryings||null,y.uniformBuffersNames)for(var g=0;g<y.uniformBuffersNames.length;g++)this._uniformBuffersNames[y.uniformBuffersNames[g]]=g}else this._engine=h,this.defines=null==u?"":u,this._uniformsNames=o.concat(a),this._samplerList=a?a.slice():[],this._attributesNames=n,this.onError=_,this.onCompiled=c,this._indexParameters=f,this._fallbacks=l;this._attributeLocationByName={},this.uniqueId=s._uniqueIdSeed++;var v=t.DomManagement.IsWindowObjectExist()?this._engine.getHostDocument():null;r.vertexSource?p="source:"+r.vertexSource:r.vertexElement?(p=v?v.getElementById(r.vertexElement):null)||(p=r.vertexElement):p=r.vertex||r,r.fragmentSource?m="source:"+r.fragmentSource:r.fragmentElement?(m=v?v.getElementById(r.fragmentElement):null)||(m=r.fragmentElement):m=r.fragment||r;var b={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:s.ShadersRepository,includesShadersStore:s.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader(p,"Vertex","",function(e){d._loadShader(m,"Fragment","Pixel",function(t){i.ShaderProcessor.Process(e,b,function(e){b.isFragment=!0,i.ShaderProcessor.Process(t,b,function(t){d._useFinalCode(e,t,r)})})})})}return Object.defineProperty(s.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new e.Observable),this._onBindObservable},enumerable:!0,configurable:!0}),s.prototype._useFinalCode=function(e,t,r){if(r){var i=r.vertexElement||r.vertex||r.spectorName||r,s=r.fragmentElement||r.fragment||r.spectorName||r;this._vertexSourceCode="#define SHADER_NAME vertex:"+i+"\n"+e,this._fragmentSourceCode="#define SHADER_NAME fragment:"+s+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(s.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),s.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},s.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},s.prototype.getEngine=function(){return this._engine},s.prototype.getPipelineContext=function(){return this._pipelineContext},s.prototype.getAttributesNames=function(){return this._attributesNames},s.prototype.getAttributeLocation=function(e){return this._attributes[e]},s.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},s.prototype.getAttributesCount=function(){return this._attributes.length},s.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},s.prototype.getUniform=function(e){return this._uniforms[e]},s.prototype.getSamplers=function(){return this._samplerList},s.prototype.getCompilationError=function(){return this._compilationError},s.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},s.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add(function(t){e(t)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){t._checkIsReady(null)},16))},s.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(r){return void this._processCompilationErrors(r,e)}setTimeout(function(){t._checkIsReady(e)},16)},s.prototype._loadShader=function(e,r,i,n){var o;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return void n(t.DomManagement.GetDOMTextContent(e));"source:"!==e.substr(0,7)?"base64:"!==e.substr(0,7)?s.ShadersStore[e+r+"Shader"]?n(s.ShadersStore[e+r+"Shader"]):i&&s.ShadersStore[e+i+"Shader"]?n(s.ShadersStore[e+i+"Shader"]):(o="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:s.ShadersRepository+e,this._engine._loadFile(o+"."+r.toLowerCase()+".fx",n)):n(window.atob(e.substr(7))):n(e.substr(7))},s.prototype._rebuildProgram=function(e,t,r,i){var s=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){i&&i(t)},this.onCompiled=function(){var e=s.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(31);s._pipelineContext._handlesSpectorRebuildCallback(r)},this._fallbacks=null,this._prepareEffect()},s.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines;this._valueCache={};var i=this._pipelineContext;try{var s=this._engine;this._pipelineContext=s.createPipelineContext();var n=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?s._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,n,null,this._transformFeedbackVaryings):s._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,n,r,this._transformFeedbackVaryings),s._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(s.supportsUniformBuffers)for(var r in e._uniformBuffersNames)e.bindUniformBlock(r,e._uniformBuffersNames[r]);var n;if(s.getUniforms(e._pipelineContext,e._uniformsNames).forEach(function(t,r){e._uniforms[e._uniformsNames[r]]=t}),e._attributes=s.getAttributes(e._pipelineContext,t),t)for(var o=0;o<t.length;o++){var a=t[o];e._attributeLocationByName[a]=e._attributes[o]}for(n=0;n<e._samplerList.length;n++){null==e.getUniform(e._samplerList[n])&&(e._samplerList.splice(n,1),n--)}e._samplerList.forEach(function(t,r){e._samplers[t]=r}),s.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)}),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(o){this._processCompilationErrors(o,i)}},s.prototype._processCompilationErrors=function(e,t){void 0===t&&(t=null),this._compilationError=e.message;var i=this._attributesNames,s=this._fallbacks;r.Logger.Error("Unable to compile effect:"),r.Logger.Error("Uniforms: "+this._uniformsNames.map(function(e){return" "+e})),r.Logger.Error("Attributes: "+i.map(function(e){return" "+e})),r.Logger.Error("Defines:\r\n"+this.defines),r.Logger.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),s?(this._pipelineContext=null,s.hasMoreFallbacks?(this._allFallbacksProcessed=!1,r.Logger.Error("Trying next fallback."),this.defines=s.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(s.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),s.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},s.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},s.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},s.prototype.setTextureArray=function(e,t){var r=e+"Ex";if(-1===this._samplerList.indexOf(r+"0")){for(var i=this._samplerList.indexOf(e),s=1;s<t.length;s++){var n=r+(s-1).toString();this._samplerList.splice(i+s,0,n)}for(var o=0,a=0,h=this._samplerList;a<h.length;a++){var u=h[a];this._samplers[u]=o,o+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},s.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},s.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},s.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},s.prototype._cacheFloat2=function(e,t,r){var i=this._valueCache[e];if(!i||2!==i.length)return i=[t,r],this._valueCache[e]=i,!0;var s=!1;return i[0]!==t&&(i[0]=t,s=!0),i[1]!==r&&(i[1]=r,s=!0),s},s.prototype._cacheFloat3=function(e,t,r,i){var s=this._valueCache[e];if(!s||3!==s.length)return s=[t,r,i],this._valueCache[e]=s,!0;var n=!1;return s[0]!==t&&(s[0]=t,n=!0),s[1]!==r&&(s[1]=r,n=!0),s[2]!==i&&(s[2]=i,n=!0),n},s.prototype._cacheFloat4=function(e,t,r,i,s){var n=this._valueCache[e];if(!n||4!==n.length)return n=[t,r,i,s],this._valueCache[e]=n,!0;var o=!1;return n[0]!==t&&(n[0]=t,o=!0),n[1]!==r&&(n[1]=r,o=!0),n[2]!==i&&(n[2]=i,o=!0),n[3]!==s&&(n[3]=s,o=!0),o},s.prototype.bindUniformBuffer=function(e,t){var r=this._uniformBuffersNames[t];void 0!==r&&s._baseCache[r]!==e&&(s._baseCache[r]=e,this._engine.bindUniformBufferBase(e,r))},s.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},s.prototype.setInt=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t),this)},s.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},s.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},s.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},s.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},s.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},s.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},s.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},s.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},s.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},s.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},s.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},s.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},s.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t),this):this},s.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrices(this._uniforms[e],t.toArray()),this},s.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},s.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},s.prototype.setFloat=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setFloat(this._uniforms[e],t),this)},s.prototype.setBool=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t?1:0),this)},s.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this._uniforms[e],t.x,t.y),this},s.prototype.setFloat2=function(e,t,r){return this._cacheFloat2(e,t,r)&&this._engine.setFloat2(this._uniforms[e],t,r),this},s.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z),this},s.prototype.setFloat3=function(e,t,r,i){return this._cacheFloat3(e,t,r,i)&&this._engine.setFloat3(this._uniforms[e],t,r,i),this},s.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w),this},s.prototype.setFloat4=function(e,t,r,i,s){return this._cacheFloat4(e,t,r,i,s)&&this._engine.setFloat4(this._uniforms[e],t,r,i,s),this},s.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setFloat3(this._uniforms[e],t.r,t.g,t.b),this},s.prototype.setColor4=function(e,t,r){return this._cacheFloat4(e,t.r,t.g,t.b,r)&&this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,r),this},s.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a),this},s.prototype.dispose=function(){this._engine._releaseEffect(this)},s.RegisterShader=function(e,t,r){t&&(s.ShadersStore[e+"PixelShader"]=t),r&&(s.ShadersStore[e+"VertexShader"]=r)},s.ResetCache=function(){s._baseCache={}},s.ShadersRepository="src/Shaders/",s._uniqueIdSeed=0,s._baseCache={},s.ShadersStore={},s.IncludesShadersStore={},s}();exports.Effect=s;
},{"../Misc/observable":"vY1+","../Misc/domManagement":"GCrr","../Misc/logger":"Yh4i","../Engines/Processors/shaderProcessor":"j98r"}],"mCqw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DepthCullingState=void 0;var t=function(){function t(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zOffset",{get:function(){return this._zOffset},set:function(t){this._zOffset!==t&&(this._zOffset=t,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cullFace",{get:function(){return this._cullFace},set:function(t){this._cullFace!==t&&(this._cullFace=t,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cull",{get:function(){return this._cull},set:function(t){this._cull!==t&&(this._cull=t,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(t){this._depthFunc!==t&&(this._depthFunc=t,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return this._depthMask},set:function(t){this._depthMask!==t&&(this._depthMask=t,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return this._depthTest},set:function(t){this._depthTest!==t&&(this._depthTest=t,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frontFace",{get:function(){return this._frontFace},set:function(t){this._frontFace!==t&&(this._frontFace=t,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},t.prototype.apply=function(t){this.isDirty&&(this._isCullDirty&&(this.cull?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(t.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(t.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(t.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(this.zOffset,0)):t.disable(t.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(t.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},t}();exports.DepthCullingState=t;
},{}],"OdpG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StencilState=void 0;var t=function(){function t(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(t){this._stencilFunc!==t&&(this._stencilFunc=t,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(t){this._stencilFuncRef!==t&&(this._stencilFuncRef=t,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(t){this._stencilFuncMask!==t&&(this._stencilFuncMask=t,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(t){this._stencilOpStencilFail!==t&&(this._stencilOpStencilFail=t,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(t){this._stencilOpDepthFail!==t&&(this._stencilOpDepthFail=t,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(t){this._stencilOpStencilDepthPass!==t&&(this._stencilOpStencilDepthPass=t,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(t){this._stencilMask!==t&&(this._stencilMask=t,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(t){this._stencilTest!==t&&(this._stencilTest=t,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=t.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=t.KEEP,this._stencilOpDepthFail=t.KEEP,this._stencilOpStencilDepthPass=t.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},t.prototype.apply=function(t){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(t.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(t.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(t.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},t.ALWAYS=519,t.KEEP=7680,t.REPLACE=7681,t}();exports.StencilState=t;
},{}],"IGzE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AlphaState=void 0;var t=function(){function t(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(t){this._alphaBlend!==t&&(this._alphaBlend=t,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.setAlphaBlendConstants=function(t,n,e,s){this._blendConstants[0]===t&&this._blendConstants[1]===n&&this._blendConstants[2]===e&&this._blendConstants[3]===s||(this._blendConstants[0]=t,this._blendConstants[1]=n,this._blendConstants[2]=e,this._blendConstants[3]=s,this._isBlendConstantsDirty=!0)},t.prototype.setAlphaBlendFunctionParameters=function(t,n,e,s){this._blendFunctionParameters[0]===t&&this._blendFunctionParameters[1]===n&&this._blendFunctionParameters[2]===e&&this._blendFunctionParameters[3]===s||(this._blendFunctionParameters[0]=t,this._blendFunctionParameters[1]=n,this._blendFunctionParameters[2]=e,this._blendFunctionParameters[3]=s,this._isBlendFunctionParametersDirty=!0)},t.prototype.setAlphaEquationParameters=function(t,n){this._blendEquationParameters[0]===t&&this._blendEquationParameters[1]===n||(this._blendEquationParameters[0]=t,this._blendEquationParameters[1]=n,this._isBlendEquationParametersDirty=!0)},t.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},t.prototype.apply=function(t){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?t.enable(t.BLEND):t.disable(t.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(t.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(t.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(t.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},t}();exports.AlphaState=t;
},{}],"PriA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTargetCreationOptions=void 0;var e=function(){return function(){}}();exports.RenderTargetCreationOptions=e;
},{}],"afLG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InternalTexture=exports.InternalTextureSource=void 0;var e,t=require("../../Misc/observable"),i=require("../../Materials/Textures/renderTargetCreationOptions"),s=require("../../Misc/devTools");exports.InternalTextureSource=e,function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.Depth=12]="Depth",e[e.CubeRawRGBD=13]="CubeRawRGBD"}(e||(exports.InternalTextureSource=e={}));var r=function(){function r(i,s,r){void 0===r&&(r=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new t.Observable,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=e.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._engine=i,this._source=s,r||(this._webGLTexture=i._createTexture())}return r.prototype.getEngine=function(){return this._engine},Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),r.prototype.incrementReferences=function(){this._references++},r.prototype.updateSize=function(e,t,i){void 0===i&&(i=1),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i},r.prototype._rebuild=function(){var t,s=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case e.Temp:return;case e.Url:return void(t=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){t._swapAndDie(s),s.isReady=!0},null,this._buffer,void 0,this.format));case e.Raw:return(t=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.Raw3D:return(t=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.Raw2DArray:return(t=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.Dynamic:return(t=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case e.RenderTarget:var n=new i.RenderTargetCreationOptions;if(n.generateDepthBuffer=this._generateDepthBuffer,n.generateMipMaps=this.generateMipMaps,n.generateStencilBuffer=this._generateStencilBuffer,n.samplingMode=this.samplingMode,n.type=this.type,this.isCube)t=this._engine.createRenderTargetCubeTexture(this.width,n);else{var h={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};t=this._engine.createRenderTargetTexture(h,n)}return t._swapAndDie(this),void(this.isReady=!0);case e.Depth:var a={bilinearFiltering:2!==this.samplingMode,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},u={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(t=this._engine.createDepthStencilTexture(u,a))._swapAndDie(this),void(this.isReady=!0);case e.Cube:return void(t=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){t._swapAndDie(s),s.isReady=!0},null,this.format,this._extension));case e.CubeRaw:return(t=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.CubeRawRGBD:return t=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void r._UpdateRGBDAsync(t,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){t._swapAndDie(s),s.isReady=!0});case e.CubePrefiltered:return void((t=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(e){e&&e._swapAndDie(s),s.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},r.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),e._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var t,i=this._engine.getLoadedTexturesCache();-1!==(t=i.indexOf(this))&&i.splice(t,1),-1===(t=i.indexOf(e))&&i.push(e)},r.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},r._UpdateRGBDAsync=function(e,t,i,r,n){throw s._DevTools.WarnImport("environmentTextureTools")},r}();exports.InternalTexture=r;
},{"../../Misc/observable":"vY1+","../../Materials/Textures/renderTargetCreationOptions":"PriA","../../Misc/devTools":"S9x9"}],"DzeB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGL2ShaderProcessor=void 0;var e=function(){function e(){}return e.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},e.prototype.varyingProcessor=function(e,r){return e.replace("varying",r?"in":"out")},e.prototype.postProcessor=function(e,r,t){var o=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),t)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(o?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==r.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},e}();exports.WebGL2ShaderProcessor=e;
},{}],"/NR3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DataBuffer=void 0;var e=function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),e}();exports.DataBuffer=e;
},{}],"7vCK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGLDataBuffer=void 0;var e=require("tslib"),r=require("../dataBuffer"),t=function(r){function t(e){var t=r.call(this)||this;return t._buffer=e,t}return(0,e.__extends)(t,r),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t}(r.DataBuffer);exports.WebGLDataBuffer=t;
},{"tslib":"90Cu","../dataBuffer":"/NR3"}],"o4tv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGLPipelineContext=void 0;var e=function(){function e(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e}();exports.WebGLPipelineContext=e;
},{}],"mx8L":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CanvasGenerator=void 0;var e=function(){function e(){}return e.CreateCanvas=function(e,n){if("undefined"==typeof document)return new OffscreenCanvas(e,n);var t=document.createElement("canvas");return t.width=e,t.height=n,t},e}();exports.CanvasGenerator=e;
},{}],"aDNm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ThinEngine=void 0;var e=require("./engineStore"),t=require("../Materials/effect"),r=require("../Misc/devTools"),i=require("../Misc/observable"),n=require("../States/depthCullingState"),s=require("../States/stencilState"),a=require("../States/alphaCullingState"),o=require("../Materials/Textures/internalTexture"),_=require("../Misc/logger"),u=require("../Misc/domManagement"),h=require("./WebGL/webGL2ShaderProcessors"),l=require("../Meshes/WebGL/webGLDataBuffer"),c=require("./WebGL/webGLPipelineContext"),f=require("../Misc/canvasGenerator"),d=function(){return function(){}}(),p=function(){function p(e,t,r,o){var l=this;void 0===o&&(o=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new i.Observable,this.onContextRestoredObservable=new i.Observable,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new n.DepthCullingState,this._stencilState=new s.StencilState,this._alphaState=new a.AlphaState,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new i.Observable,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(e,t,r,i,n,s){var a=l._gl,o=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,o),r>1&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(a.RENDERBUFFER,r,n,e,t):a.renderbufferStorage(a.RENDERBUFFER,i,e,t),a.framebufferRenderbuffer(a.FRAMEBUFFER,s,a.RENDERBUFFER,o),a.bindRenderbuffer(a.RENDERBUFFER,null),o},this._boundUniforms={};var c=null;if(e){if(r=r||{},e.getContext){if(c=e,this._renderingCanvas=c,null!=t&&(r.antialias=t),void 0===r.deterministicLockstep&&(r.deterministicLockstep=!1),void 0===r.lockstepMaxSteps&&(r.lockstepMaxSteps=4),void 0===r.timeStep&&(r.timeStep=1/60),void 0===r.preserveDrawingBuffer&&(r.preserveDrawingBuffer=!1),void 0===r.audioEngine&&(r.audioEngine=!0),void 0===r.stencil&&(r.stencil=!0),!1===r.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._doNotHandleContextLost=!!r.doNotHandleContextLost,navigator&&navigator.userAgent)for(var f=navigator.userAgent,g=0,E=p.ExceptionList;g<E.length;g++){var T=E[g],b=T.key,x=T.targets;if(new RegExp(b).test(f)){if(T.capture&&T.captureConstraint){var m=T.capture,A=T.captureConstraint,R=new RegExp(m).exec(f);if(R&&R.length>0)if(parseInt(R[R.length-1])>=A)continue}for(var v=0,y=x;v<y.length;v++){switch(y[v]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),l._contextWasLost=!0,_.Logger.Warn("WebGL context lost."),l.onContextLostObservable.notifyObservers(l)},this._onContextRestored=function(){setTimeout(function(){l._initGLContext(),l._rebuildEffects(),l._rebuildInternalTextures(),l._rebuildBuffers(),l.wipeCaches(!0),_.Logger.Warn("WebGL context successfully restored."),l.onContextRestoredObservable.notifyObservers(l),l._contextWasLost=!1},0)},c.addEventListener("webglcontextlost",this._onContextLost,!1),c.addEventListener("webglcontextrestored",this._onContextRestored,!1),r.powerPreference="high-performance"),!r.disableWebGL2Support)try{this._gl=c.getContext("webgl2",r)||c.getContext("experimental-webgl2",r),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(L){}if(!this._gl){if(!c)throw new Error("The provided canvas is null or undefined.");try{this._gl=c.getContext("webgl",r)||c.getContext("experimental-webgl",r)}catch(L){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var S=this._gl.getContextAttributes();S&&(r.stencil=S.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==r.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=r.useHighPrecisionFloats);var C=u.DomManagement.IsWindowObjectExist()&&window.devicePixelRatio||1,w=r.limitDeviceRatio||C;this._hardwareScalingLevel=o?1/Math.min(w,C):1,this.resize(),this._isStencilEnable=!!r.stencil,this._initGLContext();for(var I=0;I<this._caps.maxVertexAttribs;I++)this._currentBufferPointers[I]=new d;this.webGLVersion>1&&(this._shaderProcessor=new h.WebGL2ShaderProcessor),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=r,console.log("Babylon.js v"+p.Version+" - "+this.description)}}return Object.defineProperty(p,"NpmPackage",{get:function(){return"babylonjs@4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(p,"Version",{get:function(){return"4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!0,configurable:!0}),Object.defineProperty(p,"ShadersRepository",{get:function(){return t.Effect.ShadersRepository},set:function(e){t.Effect.ShadersRepository=e},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),p.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++){t[e]._rebuild()}},p.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){this._compiledEffects[e]._prepareEffect()}t.Effect.ResetCache()},p.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0},p.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++){t[e]._rebuild()}},p.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var i=this._gl.getExtension("WEBGL_depth_texture");null!=i&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=i.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var n=this._gl.getExtension("OES_vertex_array_object");null!=n&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=n.createVertexArrayOES.bind(n),this._gl.bindVertexArray=n.bindVertexArrayOES.bind(n),this._gl.deleteVertexArray=n.deleteVertexArrayOES.bind(n))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var s=this._gl.getExtension("ANGLE_instanced_arrays");null!=s?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=s.drawArraysInstancedANGLE.bind(s),this._gl.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s),this._gl.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var a=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),o=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);a&&o&&(this._caps.highPrecisionShaderSupported=0!==a.precision&&0!==o.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var _=this._gl.getExtension("EXT_blend_minmax");null!=_&&(this._caps.blendMinMax=!0,this._gl.MAX=_.MAX_EXT,this._gl.MIN=_.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var u=0;u<this._maxSimultaneousTextures;u++)this._nextFreeTextureSlots.push(u)},Object.defineProperty(p.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),p.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(p.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),p.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=f.CanvasGenerator.CreateCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},p.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},p.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},p.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},p.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},p.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},p.prototype.getCaps=function(){return this._caps},p.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},p.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},p.prototype.getRenderingCanvas=function(){return this._renderingCanvas},p.prototype.getHostWindow=function(){return u.DomManagement.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},p.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},p.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},p.prototype._queueNewFrame=function(e,t){return p.QueueNewFrame(e,t)},p.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},p.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},p.prototype._viewport=function(e,t,r,i){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i,this._gl.viewport(e,t,r,i))},p.prototype.setViewport=function(e,t,r){var i=t||this.getRenderWidth(),n=r||this.getRenderHeight(),s=e.x||0,a=e.y||0;this._cachedViewport=e,this._viewport(s*i,a*n,i*e.width,n*e.height)},p.prototype.beginFrame=function(){},p.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},p.prototype.resize=function(){var e,t;u.DomManagement.IsWindowObjectExist()?(e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight):(e=this._renderingCanvas?this._renderingCanvas.width:100,t=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},p.prototype.setSize=function(e,t){this._renderingCanvas&&(e|=0,t|=0,this._renderingCanvas.width===e&&this._renderingCanvas.height===t||(this._renderingCanvas.width=e,this._renderingCanvas.height=t))},p.prototype.bindFramebuffer=function(e,t,r,i,n,s,a){void 0===t&&(t=0),void 0===s&&(s=0),void 0===a&&(a=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var o=this._gl;e.is2DArray?o.framebufferTextureLayer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,e._webGLTexture,s,a):e.isCube&&o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,s);var _=e._depthStencilTexture;if(_){var u=_._generateStencilBuffer?o.DEPTH_STENCIL_ATTACHMENT:o.DEPTH_ATTACHMENT;e.is2DArray?o.framebufferTextureLayer(o.FRAMEBUFFER,u,_._webGLTexture,s,a):e.isCube?o.framebufferTexture2D(o.FRAMEBUFFER,u,o.TEXTURE_CUBE_MAP_POSITIVE_X+t,_._webGLTexture,s):o.framebufferTexture2D(o.FRAMEBUFFER,u,o.TEXTURE_2D,_._webGLTexture,s)}this._cachedViewport&&!n?this.setViewport(this._cachedViewport,r,i):(r||(r=e.width,s&&(r/=Math.pow(2,s))),i||(i=e.height,s&&(i/=Math.pow(2,s))),this._viewport(0,0,r,i)),this.wipeCaches()},p.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},p.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;e._MSAAFramebuffer&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,e._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,e,!0),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null)),r&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),r()),this._bindUnboundFramebuffer(null)},p.prototype.flushFramebuffer=function(){this._gl.flush()},p.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},p.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},p.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},p.prototype._createVertexBuffer=function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var i=new l.WebGLDataBuffer(r);return this.bindArrayBuffer(i),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),i.references=1,i},p.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},p.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},p.prototype.createIndexBuffer=function(e,t){var r=this._gl.createBuffer(),i=new l.WebGLDataBuffer(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=4===n.BYTES_PER_ELEMENT,i},p.prototype._normalizeIndexData=function(e){if(e instanceof Uint16Array)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},p.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},p.prototype.bindUniformBlock=function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,n,r)},p.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},p.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},p.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},p.prototype._vertexAttribPointer=function(e,t,r,i,n,s,a){var o=this._currentBufferPointers[t],_=!1;o.active?(o.buffer!==e&&(o.buffer=e,_=!0),o.size!==r&&(o.size=r,_=!0),o.type!==i&&(o.type=i,_=!0),o.normalized!==n&&(o.normalized=n,_=!0),o.stride!==s&&(o.stride=s,_=!0),o.offset!==a&&(o.offset=a,_=!0)):(_=!0,o.active=!0,o.index=t,o.size=r,o.type=i,o.normalized=n,o.stride=s,o.offset=a,o.buffer=e),(_||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,i,n,s,a))},p.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},p.prototype._bindVertexBuffersAttributes=function(e,t){var r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var i=0;i<r.length;i++){var n=t.getAttributeLocation(i);if(n>=0){var s=e[r[i]];if(!s)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);var a=s.getBuffer();a&&(this._vertexAttribPointer(a,n,s.getSize(),s.type,s.normalized,s.byteStride,s.byteOffset),s.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,s.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(a))))}}},p.prototype.recordVertexArrayObject=function(e,t,r){var i=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i},p.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},p.prototype.bindBuffersDirectly=function(e,t,r,i,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var s=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var a=0,o=0;o<s;o++)if(o<r.length){var _=n.getAttributeLocation(o);_>=0&&(this._gl.enableVertexAttribArray(_),this._vertexAttribArraysEnabled[_]=!0,this._vertexAttribPointer(e,_,r[o],this._gl.FLOAT,!1,i,a)),a+=4*r[o]}}this._bindIndexBufferWithCache(t)},p.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},p.prototype.bindBuffers=function(e,t,r){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r)),this._bindIndexBufferWithCache(t)},p.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},p.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},p.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},p.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},p.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index)this.bindInstancesBuffer(e,r,!0);else for(var i=0;i<4;i++){var n=r[i];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*i),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}},p.prototype.bindInstancesBuffer=function(e,t,r){void 0===r&&(r=!0),this.bindArrayBuffer(e);var i=0;if(r)for(var n=0;n<t.length;n++){i+=4*(s=t[n]).attributeSize}for(n=0;n<t.length;n++){var s;void 0===(s=t[n]).index&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,i,s.offset),this._gl.vertexAttribDivisor(s.index,void 0===s.divisor?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e)}},p.prototype.disableInstanceAttributeByName=function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},p.prototype.disableInstanceAttribute=function(e){for(var t,r=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),r=!0,t=this._currentInstanceLocations.indexOf(e);r&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},p.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},p.prototype.draw=function(e,t,r,i){this.drawElementsType(e?0:1,t,r,i)},p.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(2,e,t,r)},p.prototype.drawUnIndexed=function(e,t,r,i){this.drawArraysType(e?0:1,t,r,i)},p.prototype.drawElementsType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(n,r,s,t*a,i):this._gl.drawElements(n,r,s,t*a)},p.prototype.drawArraysType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);i?this._gl.drawArraysInstanced(n,t,r,i):this._gl.drawArrays(n,t,r)},p.prototype._drawMode=function(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},p.prototype._reportDrawCall=function(){},p.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},p.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},p.prototype.createEffect=function(e,r,i,n,s,a,o,_,u){var h=(e.vertexElement||e.vertex||e)+"+"+(e.fragmentElement||e.fragment||e)+"@"+(s||r.defines);if(this._compiledEffects[h]){var l=this._compiledEffects[h];return o&&l.isReady()&&o(l),l}var c=new t.Effect(e,r,i,n,this,s,a,o,_,u);return c._key=h,this._compiledEffects[h]=c,c},p._ConcatenateShader=function(e,t,r){return void 0===r&&(r=""),r+(t?t+"\n":"")+e},p.prototype._compileShader=function(e,t,r,i){return this._compileRawShader(p._ConcatenateShader(e,r,i),t)},p.prototype._compileRawShader=function(e,t){var r=this._gl,i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i)throw new Error("Something went wrong while compile the shader.");return r.shaderSource(i,e),r.compileShader(i),i},p.prototype.createRawShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null),i=i||this._gl;var s=this._compileRawShader(t,"vertex"),a=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,s,a,i,n)},p.prototype.createShaderProgram=function(e,t,r,i,n,s){void 0===s&&(s=null),n=n||this._gl;var a=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",o=this._compileShader(t,"vertex",i,a),_=this._compileShader(r,"fragment",i,a);return this._createShaderProgram(e,o,_,n,s)},p.prototype.createPipelineContext=function(){var e=new c.WebGLPipelineContext;return e.engine=this,this._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},p.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var s=i.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");return i.attachShader(s,t),i.attachShader(s,r),i.linkProgram(s),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},p.prototype._finalizePipelineContext=function(e){var t=e.context,r=e.vertexShader,i=e.fragmentShader,n=e.program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var s,a;if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS))if(s=this._gl.getShaderInfoLog(r))throw e.vertexCompilationError=s,new Error("VERTEX SHADER "+s);if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS))if(s=this._gl.getShaderInfoLog(i))throw e.fragmentCompilationError=s,new Error("FRAGMENT SHADER "+s);if(a=t.getProgramInfoLog(n))throw e.programLinkError=a,new Error(a)}if(this.validateShaderPrograms&&(t.validateProgram(n),!t.getProgramParameter(n,t.VALIDATE_STATUS)&&(a=t.getProgramInfoLog(n))))throw e.programValidationError=a,new Error(a);t.deleteShader(r),t.deleteShader(i),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},p.prototype._preparePipelineContext=function(e,t,r,i,n,s,a){var o=e;o.program=i?this.createRawShaderProgram(o,t,r,void 0,a):this.createShaderProgram(o,t,r,s,void 0,a),o.program.__SPECTOR_rebuildProgram=n},p.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},p.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var r=e;if(r.isParallelCompiled){var i=r.onCompiled;r.onCompiled=i?function(){i(),t()}:t}else t()},p.prototype.getUniforms=function(e,t){for(var r=new Array,i=e,n=0;n<t.length;n++)r.push(this._gl.getUniformLocation(i.program,t[n]));return r},p.prototype.getAttributes=function(e,t){for(var r=[],i=e,n=0;n<t.length;n++)try{r.push(this._gl.getAttribLocation(i.program,t[n]))}catch(s){r.push(-1)}return r},p.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},p.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},p.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},p.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},p.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},p.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},p.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},p.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},p.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},p.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},p.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},p.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},p.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},p.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},p.prototype.setFloat2=function(e,t,r){e&&this._gl.uniform2f(e,t,r)},p.prototype.setFloat3=function(e,t,r,i){e&&this._gl.uniform3f(e,t,r,i)},p.prototype.setFloat4=function(e,t,r,i,n){e&&this._gl.uniform4f(e,t,r,i,n)},p.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},p.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},p.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(p.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!0,configurable:!0}),p.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},p.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},p.prototype._getSamplingParameters=function(e,t){var r=this._gl,i=r.NEAREST,n=r.NEAREST;switch(e){case 11:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 3:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 8:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 4:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 5:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 6:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 7:i=r.NEAREST,n=r.LINEAR;break;case 1:i=r.NEAREST,n=r.NEAREST;break;case 9:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 10:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 2:i=r.LINEAR,n=r.LINEAR;break;case 12:i=r.LINEAR,n=r.NEAREST}return{min:n,mag:i}},p.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},p.prototype.createTexture=function(t,r,i,n,s,a,_,u,h,l,c,f){var d=this;void 0===s&&(s=3),void 0===a&&(a=null),void 0===_&&(_=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=null);for(var g=String(t),E="data:"===g.substr(0,5),T="blob:"===g.substr(0,5),b=E&&-1!==g.indexOf(";base64,"),x=h||new o.InternalTexture(this,o.InternalTextureSource.Url),m=g.lastIndexOf("."),A=c||(m>-1?g.substring(m).toLowerCase():""),R=null,v=0,y=p._TextureLoaders;v<y.length;v++){var S=y[v];if(S.canLoad(A)){R=S;break}}n&&n._addPendingData(x),x.url=g,x.generateMipMaps=!r,x.samplingMode=s,x.invertY=i,this._doNotHandleContextLost||(x._buffer=u);var C=null;a&&!h&&(C=x.onLoadedObservable.add(a)),h||this._internalTexturesCache.push(x);var w=function(t,i){n&&n._removePendingData(x),C&&x.onLoadedObservable.remove(C),e.EngineStore.UseFallbackTexture?d.createTexture(e.EngineStore.FallbackTexture,r,x.invertY,n,s,null,_,u,x):_&&_(t||"Unknown error",i)};if(R){var I=function(e){R.loadData(e,x,function(e,t,r,i,a,o){o?w("TextureLoader failed to load data"):d._prepareWebGLTexture(x,n,e,t,x.invertY,!r,i,function(){return a(),!1},s)})};u?u instanceof ArrayBuffer?I(new Uint8Array(u)):ArrayBuffer.isView(u)?I(u):_&&_("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(g,function(e){return I(new Uint8Array(e))},void 0,n?n.offlineProvider:void 0,!0,function(e,t){w("Unable to load "+(e&&e.responseURL,t))})}else{var L=function(e){T&&!d._doNotHandleContextLost&&(x._buffer=e),d._prepareWebGLTexture(x,n,e.width,e.height,x.invertY,r,!1,function(t,r,i){var s=d._gl,a=e.width===t&&e.height===r,_=l?d._getInternalFormat(l):".jpg"===A?s.RGB:s.RGBA;if(a)return s.texImage2D(s.TEXTURE_2D,0,_,_,s.UNSIGNED_BYTE,e),!1;var u=d._caps.maxTextureSize;if(e.width>u||e.height>u||!d._supportsHardwareTextureRescaling)return d._prepareWorkingCanvas(),!(!d._workingCanvas||!d._workingContext)&&(d._workingCanvas.width=t,d._workingCanvas.height=r,d._workingContext.drawImage(e,0,0,e.width,e.height,0,0,t,r),s.texImage2D(s.TEXTURE_2D,0,_,_,s.UNSIGNED_BYTE,d._workingCanvas),x.width=t,x.height=r,!1);var h=new o.InternalTexture(d,o.InternalTextureSource.Temp);return d._bindTextureDirectly(s.TEXTURE_2D,h,!0),s.texImage2D(s.TEXTURE_2D,0,_,_,s.UNSIGNED_BYTE,e),d._rescaleTexture(h,x,n,_,function(){d._releaseTexture(h),d._bindTextureDirectly(s.TEXTURE_2D,x,!0),i()}),!0},s)};!E||b?u&&(u.decoding||u.close)?L(u):p._FileToolsLoadImage(g,L,w,n?n.offlineProvider:null,f):"string"==typeof u||u instanceof ArrayBuffer||ArrayBuffer.isView(u)||u instanceof Blob?p._FileToolsLoadImage(u,L,w,n?n.offlineProvider:null,f):u&&L(u)}return x},p._FileToolsLoadImage=function(e,t,i,n,s){throw r._DevTools.WarnImport("FileTools")},p.prototype._rescaleTexture=function(e,t,r,i,n){},p.prototype.createRawTexture=function(e,t,i,n,s,a,o,_,u){throw void 0===_&&(_=null),void 0===u&&(u=0),r._DevTools.WarnImport("Engine.RawTexture")},p.prototype.createRawCubeTexture=function(e,t,i,n,s,a,o,_){throw void 0===_&&(_=null),r._DevTools.WarnImport("Engine.RawTexture")},p.prototype.createRawTexture3D=function(e,t,i,n,s,a,o,_,u,h){throw void 0===u&&(u=null),void 0===h&&(h=0),r._DevTools.WarnImport("Engine.RawTexture")},p.prototype.createRawTexture2DArray=function(e,t,i,n,s,a,o,_,u,h){throw void 0===u&&(u=null),void 0===h&&(h=0),r._DevTools.WarnImport("Engine.RawTexture")},p.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},p.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},p.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},p.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1);var i=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||r);this._setTextureParameterInteger(i,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(i,this._gl.TEXTURE_MIN_FILTER,n.min),r&&(t.generateMipMaps=!0,this._gl.generateMipmap(i)),this._bindTextureDirectly(i,null),t.samplingMode=e},p.prototype.updateTextureWrappingMode=function(e,t,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==r&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),e),e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(i),e),e._cachedWrapR=i),this._bindTextureDirectly(n,null)},p.prototype._setupDepthStencilTexture=function(e,t,r,i,n){var s=t.width||t,a=t.height||t,o=t.layers||0;e.baseWidth=s,e.baseHeight=a,e.width=s,e.height=a,e.is2DArray=o>0,e.depth=o,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=r,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=n;var _=this._gl,u=this._getTextureTarget(e),h=this._getSamplingParameters(e.samplingMode,!1);_.texParameteri(u,_.TEXTURE_MAG_FILTER,h.mag),_.texParameteri(u,_.TEXTURE_MIN_FILTER,h.min),_.texParameteri(u,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(u,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),0===n?(_.texParameteri(u,_.TEXTURE_COMPARE_FUNC,515),_.texParameteri(u,_.TEXTURE_COMPARE_MODE,_.NONE)):(_.texParameteri(u,_.TEXTURE_COMPARE_FUNC,n),_.texParameteri(u,_.TEXTURE_COMPARE_MODE,_.COMPARE_REF_TO_TEXTURE))},p.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,s,a){void 0===s&&(s=0),void 0===a&&(a=0);var o=this._gl,_=o.TEXTURE_2D;e.isCube&&(_=o.TEXTURE_CUBE_MAP_POSITIVE_X+s),this._gl.compressedTexImage2D(_,a,t,r,i,0,n)},p.prototype._uploadDataToTextureDirectly=function(e,t,r,i,n,s){void 0===r&&(r=0),void 0===i&&(i=0),void 0===s&&(s=!1);var a=this._gl,o=this._getWebGLTextureType(e.type),_=this._getInternalFormat(e.format),u=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format):this._getInternalFormat(n);this._unpackFlipY(e.invertY);var h=a.TEXTURE_2D;e.isCube&&(h=a.TEXTURE_CUBE_MAP_POSITIVE_X+r);var l=Math.round(Math.log(e.width)*Math.LOG2E),c=Math.round(Math.log(e.height)*Math.LOG2E),f=s?e.width:Math.pow(2,Math.max(l-i,0)),d=s?e.height:Math.pow(2,Math.max(c-i,0));a.texImage2D(h,i,u,f,d,0,_,o,t)},p.prototype.updateTextureData=function(e,t,r,i,n,s,a,o){void 0===a&&(a=0),void 0===o&&(o=0);var _=this._gl,u=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var l=_.TEXTURE_2D;e.isCube&&(l=_.TEXTURE_CUBE_MAP_POSITIVE_X+a),_.texSubImage2D(l,o,r,i,n,s,h,u,t)},p.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,r,i),this._bindTextureDirectly(s,null,!0)},p.prototype._prepareWebGLTextureContinuation=function(e,t,r,i,n){var s=this._gl;if(s){var a=this._getSamplingParameters(n,!r);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,a.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,a.min),r||i||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},p.prototype._prepareWebGLTexture=function(e,t,r,i,n,s,a,o,_){var u=this;void 0===_&&(_=3);var h=this.getCaps().maxTextureSize,l=Math.min(h,this.needPOTTextures?p.GetExponentOfTwo(r,h):r),c=Math.min(h,this.needPOTTextures?p.GetExponentOfTwo(i,h):i),f=this._gl;f&&(e._webGLTexture?(this._bindTextureDirectly(f.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===n||!!n),e.baseWidth=r,e.baseHeight=i,e.width=l,e.height=c,e.isReady=!0,o(l,c,function(){u._prepareWebGLTextureContinuation(e,t,s,a,_)})||this._prepareWebGLTextureContinuation(e,t,s,a,_)):t&&t._removePendingData(e))},p.prototype._setupFramebufferDepthAttachments=function(e,t,r,i,n){void 0===n&&(n=1);var s=this._gl;if(e&&t)return this._getDepthStencilBuffer(r,i,n,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT);if(t){var a=s.DEPTH_COMPONENT16;return this._webGLVersion>1&&(a=s.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(r,i,n,a,a,s.DEPTH_ATTACHMENT)}return e?this._getDepthStencilBuffer(r,i,n,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null},p.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},p.prototype._releaseTexture=function(e){this._releaseFramebufferObjects(e),this._deleteTexture(e._webGLTexture),this.unbindAllTextures();var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},p.prototype._deleteTexture=function(e){this._gl.deleteTexture(e)},p.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},p.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),i=0;i<r.length;i++){var n=e.getUniform(r[i]);n&&(this._boundUniforms[i]=n)}this._currentEffect=null},p.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},p.prototype._bindTextureDirectly=function(e,t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);var n=!1,s=t&&t._associatedChannel>-1;return r&&s&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||i?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)):r&&(n=!0,this._activateCurrentTexture()),s&&!r&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n},p.prototype._bindTexture=function(e,t){void 0!==e&&(t&&(t._associatedChannel=e),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},p.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},p.prototype.setTexture=function(e,t,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},p.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},p.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},p.prototype._setTexture=function(e,t,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var n;n=i?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&n&&(n._associatedChannel=e);var s=!0;this._boundTexturesCache[e]===n&&(r||this._bindSamplerUniformToChannel(n._associatedChannel,e),s=!1),this._activeChannel=e;var a=this._getTextureTarget(n);if(s&&this._bindTextureDirectly(a,n,r),n&&!n.isMultiview){if(n.isCube&&n._cachedCoordinatesMode!==t.coordinatesMode){n._cachedCoordinatesMode=t.coordinatesMode;var o=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=o,t.wrapV=o}n._cachedWrapU!==t.wrapU&&(n._cachedWrapU=t.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),n)),n._cachedWrapV!==t.wrapV&&(n._cachedWrapV=t.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),n)),n.is3D&&n._cachedWrapR!==t.wrapR&&(n._cachedWrapR=t.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),n)),this._setAnisotropicLevel(a,n,t.anisotropicFilteringLevel)}return!0},p.prototype.setTextureArray=function(e,t,r){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var i=0;i<r.length;i++){var n=r[i].getInternalTexture();n?(this._textureUnits[i]=e+i,n._associatedChannel=e+i):this._textureUnits[i]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var s=0;s<r.length;s++)this._setTexture(this._textureUnits[s],r[s],!0)}},p.prototype._setAnisotropicLevel=function(e,t,r){var i=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(r=1),i&&t._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=r)},p.prototype._setTextureParameterFloat=function(e,t,r,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,r)},p.prototype._setTextureParameterInteger=function(e,t,r,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,r)},p.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},p.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},p.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],u.DomManagement.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,t.Effect.ResetCache();for(var e=0,r=this._activeRequests;e<r.length;e++){r[e].abort()}},p.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},p.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},p.prototype.getError=function(){return this._gl.getError()},p.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},p.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},p.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var s=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&s===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var a=t.RGBA,o=t.UNSIGNED_BYTE,_=new Uint8Array(4);t.readPixels(0,0,1,1,a,o,_),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},p.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},p.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case 0:t=this._gl.ALPHA;break;case 1:t=this._gl.LUMINANCE;break;case 2:t=this._gl.LUMINANCE_ALPHA;break;case 6:t=this._gl.RED;break;case 7:t=this._gl.RG;break;case 4:t=this._gl.RGB;break;case 5:t=this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:t=this._gl.RED_INTEGER;break;case 9:t=this._gl.RG_INTEGER;break;case 10:t=this._gl.RGB_INTEGER;break;case 11:t=this._gl.RGBA_INTEGER}return t},p.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return this._gl.RGB8;case 5:return this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},p.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},p.prototype._loadFile=function(e,t,r,i,n,s){var a=this,o=p._FileToolsLoadFile(e,t,r,i,n,s);return this._activeRequests.push(o),o.onCompleteObservable.add(function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)}),o},p._FileToolsLoadFile=function(e,t,i,n,s,a){throw r._DevTools.WarnImport("FileTools")},p.prototype.readPixels=function(e,t,r,i,n){void 0===n&&(n=!0);var s=n?4:3,a=n?this._gl.RGBA:this._gl.RGB,o=new Uint8Array(i*r*s);return this._gl.readPixels(e,t,r,i,a,this._gl.UNSIGNED_BYTE,o),o},p.isSupported=function(){if(null===this._isSupported)try{var e=f.CanvasGenerator.CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._isSupported=null!=t&&!!window.WebGLRenderingContext}catch(r){this._isSupported=!1}return this._isSupported},p.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},p.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},p.NearestPOT=function(e){var t=p.CeilingPOT(e),r=p.FloorPOT(e);return t-e>e-r?r:t},p.GetExponentOfTwo=function(e,t,r){var i;switch(void 0===r&&(r=2),r){case 1:i=p.FloorPOT(e);break;case 2:i=p.NearestPOT(e);break;case 3:default:i=p.CeilingPOT(e)}return Math.min(i,t)},p.QueueNewFrame=function(e,t){return u.DomManagement.IsWindowObjectExist()?(t||(t=window),t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},p.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},p.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],p._TextureLoaders=[],p.CollisionsEpsilon=.001,p._isSupported=null,p}();exports.ThinEngine=p;
},{"./engineStore":"cq+N","../Materials/effect":"P0sJ","../Misc/devTools":"S9x9","../Misc/observable":"vY1+","../States/depthCullingState":"mCqw","../States/stencilState":"OdpG","../States/alphaCullingState":"IGzE","../Materials/Textures/internalTexture":"afLG","../Misc/logger":"Yh4i","../Misc/domManagement":"GCrr","./WebGL/webGL2ShaderProcessors":"DzeB","../Meshes/WebGL/webGLDataBuffer":"7vCK","./WebGL/webGLPipelineContext":"o4tv","../Misc/canvasGenerator":"mx8L"}],"G7Te":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PrecisionDate=void 0;var e=require("./domManagement"),n=function(){function n(){}return Object.defineProperty(n,"Now",{get:function(){return e.DomManagement.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),n}();exports.PrecisionDate=n;
},{"./domManagement":"GCrr"}],"xVez":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RollingAverage=exports.PerformanceMonitor=void 0;var e=require("./precisionDate"),t=function(){function t(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new r(e)}return t.prototype.sampleFrame=function(t){if(void 0===t&&(t=e.PrecisionDate.Now),this._enabled){if(null!=this._lastFrameTimeMs){var r=t-this._lastFrameTimeMs;this._rollingFrameTime.add(r)}this._lastFrameTimeMs=t}},Object.defineProperty(t.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),t.prototype.enable=function(){this._enabled=!0},t.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},t}();exports.PerformanceMonitor=t;var r=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t;if(this.isSaturated()){var r=this._samples[this._pos];t=r-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(r-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}();exports.RollingAverage=r;
},{"./precisionDate":"G7Te"}],"177K":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PerfCounter=void 0;var t=require("./precisionDate"),e=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(t,i){e.Enabled&&(this._current+=t,i&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=t.PrecisionDate.Now)},e.prototype.endMonitoring=function(i){if(void 0===i&&(i=!0),e.Enabled){i&&this.fetchNewFrame();var r=t.PrecisionDate.Now;this._current=r-this._startMonitoringTime,i&&this._fetchResult()}},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=t.PrecisionDate.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}();exports.PerfCounter=e;
},{"./precisionDate":"G7Te"}],"qzlc":[function(require,module,exports) {
"use strict";var t=require("../../Engines/thinEngine");t.ThinEngine.prototype.setAlphaConstants=function(t,a,h,e){this._alphaState.setAlphaBlendConstants(t,a,h,e)},t.ThinEngine.prototype.setAlphaMode=function(t,a){if(void 0===a&&(a=!1),this._alphaMode!==t){switch(t){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}a||(this.depthCullingState.depthMask=0===t),this._alphaMode=t}},t.ThinEngine.prototype.getAlphaMode=function(){return this._alphaMode},t.ThinEngine.prototype.setAlphaEquation=function(t){if(this._alphaEquation!==t){switch(t){case 0:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case 1:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case 2:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case 3:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case 4:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case 5:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=t}},t.ThinEngine.prototype.getAlphaEquation=function(){return this._alphaEquation};
},{"../../Engines/thinEngine":"aDNm"}],"L3af":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Engine=void 0;var e=require("tslib"),t=require("../Misc/observable"),n=require("../Misc/domManagement"),r=require("./engineStore"),i=require("../Misc/devTools"),o=require("./thinEngine"),s=require("../Misc/performanceMonitor"),a=require("../Misc/perfCounter"),c=require("../Meshes/WebGL/webGLDataBuffer"),l=require("../Misc/logger");require("./Extensions/engine.alpha");var u=function(u){function _(e,r,i,o){void 0===o&&(o=!1);var c=u.call(this,e,r,i,o)||this;if(c.enableOfflineSupport=!1,c.disableManifestCheck=!1,c.scenes=new Array,c.onNewSceneAddedObservable=new t.Observable,c.postProcesses=new Array,c.isPointerLock=!1,c.onResizeObservable=new t.Observable,c.onCanvasBlurObservable=new t.Observable,c.onCanvasFocusObservable=new t.Observable,c.onCanvasPointerOutObservable=new t.Observable,c.onBeginFrameObservable=new t.Observable,c.customAnimationFrameRequester=null,c.onEndFrameObservable=new t.Observable,c.onBeforeShaderCompilationObservable=new t.Observable,c.onAfterShaderCompilationObservable=new t.Observable,c._deterministicLockstep=!1,c._lockstepMaxSteps=4,c._timeStep=1/60,c._fps=60,c._deltaTime=0,c._drawCalls=new a.PerfCounter,c.canvasTabIndex=1,c.disablePerformanceMonitorInBackground=!1,c._performanceMonitor=new s.PerformanceMonitor,!e)return c;if(i=c._creationOptions,_.Instances.push(c),e.getContext){var l=e;if(c._onCanvasFocus=function(){c.onCanvasFocusObservable.notifyObservers(c)},c._onCanvasBlur=function(){c.onCanvasBlurObservable.notifyObservers(c)},l.addEventListener("focus",c._onCanvasFocus),l.addEventListener("blur",c._onCanvasBlur),c._onBlur=function(){c.disablePerformanceMonitorInBackground&&c._performanceMonitor.disable(),c._windowIsBackground=!0},c._onFocus=function(){c.disablePerformanceMonitorInBackground&&c._performanceMonitor.enable(),c._windowIsBackground=!1},c._onCanvasPointerOut=function(e){c.onCanvasPointerOutObservable.notifyObservers(e)},l.addEventListener("pointerout",c._onCanvasPointerOut),n.DomManagement.IsWindowObjectExist()){var E=c.getHostWindow();E.addEventListener("blur",c._onBlur),E.addEventListener("focus",c._onFocus);var h=document;c._onFullscreenChange=function(){void 0!==h.fullscreen?c.isFullscreen=h.fullscreen:void 0!==h.mozFullScreen?c.isFullscreen=h.mozFullScreen:void 0!==h.webkitIsFullScreen?c.isFullscreen=h.webkitIsFullScreen:void 0!==h.msIsFullScreen&&(c.isFullscreen=h.msIsFullScreen),c.isFullscreen&&c._pointerLockRequested&&l&&_._RequestPointerlock(l)},document.addEventListener("fullscreenchange",c._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",c._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",c._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",c._onFullscreenChange,!1),c._onPointerLockChange=function(){c.isPointerLock=h.mozPointerLockElement===l||h.webkitPointerLockElement===l||h.msPointerLockElement===l||h.pointerLockElement===l},document.addEventListener("pointerlockchange",c._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",c._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",c._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",c._onPointerLockChange,!1),!_.audioEngine&&i.audioEngine&&_.AudioEngineFactory&&(_.audioEngine=_.AudioEngineFactory(c.getRenderingCanvas()))}c._connectVREvents(),c.enableOfflineSupport=void 0!==_.OfflineProviderFactory,i.doNotHandleTouchAction||c._disableTouchAction(),c._deterministicLockstep=!!i.deterministicLockstep,c._lockstepMaxSteps=i.lockstepMaxSteps||0,c._timeStep=i.timeStep||1/60}return c._prepareVRComponent(),i.autoEnableWebVR&&c.initWebVR(),c}return(0,e.__extends)(_,u),Object.defineProperty(_,"NpmPackage",{get:function(){return o.ThinEngine.NpmPackage},enumerable:!0,configurable:!0}),Object.defineProperty(_,"Version",{get:function(){return o.ThinEngine.Version},enumerable:!0,configurable:!0}),Object.defineProperty(_,"Instances",{get:function(){return r.EngineStore.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(_,"LastCreatedEngine",{get:function(){return r.EngineStore.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(_,"LastCreatedScene",{get:function(){return r.EngineStore.LastCreatedScene},enumerable:!0,configurable:!0}),_.MarkAllMaterialsAsDirty=function(e,t){for(var n=0;n<_.Instances.length;n++)for(var r=_.Instances[n],i=0;i<r.scenes.length;i++)r.scenes[i].markAllMaterialsAsDirty(e,t)},_.DefaultLoadingScreenFactory=function(e){throw i._DevTools.WarnImport("LoadingScreen")},Object.defineProperty(_.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!_._RescalePostProcessFactory},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),_.prototype.getInputElement=function(){return this._renderingCanvas},_.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var n=e.viewport;return this.getRenderWidth(t)*n.width/(this.getRenderHeight(t)*n.height)},_.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},_.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},_.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},_.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},_.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},_.prototype.getTimeStep=function(){return 1e3*this._timeStep},_.prototype.generateMipMapsForCubemap=function(e,t){if(void 0===t&&(t=!0),e.generateMipMaps){var n=this._gl;this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,e,!0),n.generateMipmap(n.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null)}},_.prototype.setState=function(e,t,n,r){void 0===t&&(t=0),void 0===r&&(r=!1),(this._depthCullingState.cull!==e||n)&&(this._depthCullingState.cull=e);var i=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==i||n)&&(this._depthCullingState.cullFace=i),this.setZOffset(t);var o=r?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==o||n)&&(this._depthCullingState.frontFace=o)},_.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},_.prototype.getZOffset=function(){return this._depthCullingState.zOffset},_.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},_.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},_.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},_.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},_.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},_.prototype.getStencilMask=function(){return this._stencilState.stencilMask},_.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},_.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},_.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},_.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},_.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},_.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},_.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},_.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},_.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},_.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},_.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},_.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},_.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},_.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},_.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},_.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},_.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},_.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},_.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},_.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},_.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},_.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},_.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},_.prototype.setDirectViewport=function(e,t,n,r){var i=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,n,r),i},_.prototype.scissorClear=function(e,t,n,r,i){this.enableScissor(e,t,n,r),this.clear(i,!0,!0,!0),this.disableScissor()},_.prototype.enableScissor=function(e,t,n,r){var i=this._gl;i.enable(i.SCISSOR_TEST),i.scissor(e,t,n,r)},_.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},_.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},_.prototype.initWebVR=function(){throw i._DevTools.WarnImport("WebVRCamera")},_.prototype._prepareVRComponent=function(){},_.prototype._connectVREvents=function(e,t){},_.prototype._submitVRFrame=function(){},_.prototype.disableVR=function(){},_.prototype.isVRPresenting=function(){return!1},_.prototype._requestVRFrame=function(){},_.prototype._loadFileAsync=function(e,t,n){var r=this;return new Promise(function(i,o){r._loadFile(e,function(e){i(e)},void 0,t,n,function(e,t){o(t)})})},_.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},_.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},_.prototype.setDepthStencilTexture=function(e,t,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),n&&n.depthStencilTexture?this._setTexture(e,n,!1,!0):this._setTexture(e,null))},_.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[t._currentRenderTextureInd]:null)},_.prototype.setTextureFromPostProcessOutput=function(e,t){this._bindTexture(e,t?t._outputTexture:null)},_.prototype._convertRGBtoRGBATextureData=function(e,t,n,r){var i;i=1===r?new Float32Array(t*n*4):new Uint32Array(t*n*4);for(var o=0;o<t;o++)for(var s=0;s<n;s++){var a=3*(s*t+o),c=4*(s*t+o);i[c+0]=e[a+0],i[c+1]=e[a+1],i[c+2]=e[a+2],i[c+3]=1}return i},_.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){var n=t[e];n.resetCachedMaterial(),n._rebuildGeometries(),n._rebuildTextures()}u.prototype._rebuildBuffers.call(this)},_.prototype._renderFrame=function(){for(var e=0;e<this._activeRenderLoops.length;e++){(0,this._activeRenderLoops[e])()}},_.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},_.prototype._renderViews=function(){return!1},_.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},_.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&_._RequestFullscreen(this._renderingCanvas))},_.prototype.exitFullscreen=function(){this.isFullscreen&&_._ExitFullscreen()},_.prototype.enterPointerlock=function(){this._renderingCanvas&&_._RequestPointerlock(this._renderingCanvas)},_.prototype.exitPointerlock=function(){_._ExitPointerlock()},_.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),u.prototype.beginFrame.call(this)},_.prototype.endFrame=function(){u.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},_.prototype.resize=function(){this.isVRPresenting()||u.prototype.resize.call(this)},_.prototype.setSize=function(e,t){if(this._renderingCanvas&&(u.prototype.setSize.call(this,e,t),this.scenes)){for(var n=0;n<this.scenes.length;n++)for(var r=this.scenes[n],i=0;i<r.cameras.length;i++){r.cameras[i]._currentRenderId=0}this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},_.prototype.updateDynamicVertexBuffer=function(e,t,n,r){this.bindArrayBuffer(e),void 0===n&&(n=0);var i=t.length||t.byteLength;void 0===r||r>=i&&0===n?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(n,n+r)):(t=t instanceof ArrayBuffer?new Uint8Array(t,n,r):new Uint8Array(t.buffer,t.byteOffset+n,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},_.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),u.prototype._deletePipelineContext.call(this,e)},_.prototype.createShaderProgram=function(e,t,n,r,i,o){void 0===o&&(o=null),i=i||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var s=u.prototype.createShaderProgram.call(this,e,t,n,r,i,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),s},_.prototype._createShaderProgram=function(e,t,n,r,i){void 0===i&&(i=null);var o=r.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");if(r.attachShader(o,t),r.attachShader(o,n),this.webGLVersion>1&&i){var s=this.createTransformFeedback();this.bindTransformFeedback(s),this.setTranformFeedbackVaryings(o,i),e.transformFeedback=s}return r.linkProgram(o),this.webGLVersion>1&&i&&this.bindTransformFeedback(null),e.context=r,e.vertexShader=t,e.fragmentShader=n,e.isParallelCompiled||this._finalizePipelineContext(e),o},_.prototype._releaseTexture=function(e){u.prototype._releaseTexture.call(this,e),this.scenes.forEach(function(t){t.postProcesses.forEach(function(t){t._outputTexture==e&&(t._outputTexture=null)}),t.cameras.forEach(function(t){t._postProcesses.forEach(function(t){t&&t._outputTexture==e&&(t._outputTexture=null)})})})},_.prototype._rescaleTexture=function(e,t,n,r,i){var o=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var s=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&_._RescalePostProcessFactory&&(this._rescalePostProcess=_._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){o._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};var a=n;a||(a=o.scenes[o.scenes.length-1]),a.postProcessManager.directRender([o._rescalePostProcess],s,!0),o._bindTextureDirectly(o._gl.TEXTURE_2D,t,!0),o._gl.copyTexImage2D(o._gl.TEXTURE_2D,0,r,0,0,t.width,t.height,0),o.unBindFramebuffer(s),o._releaseTexture(s),i&&i()})},_.prototype.getFps=function(){return this._fps},_.prototype.getDeltaTime=function(){return this._deltaTime},_.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},_.prototype._uploadImageToTexture=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this._gl,o=this._getWebGLTextureType(e.type),s=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,s),c=e.isCube?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D;this._bindTextureDirectly(c,e,!0),this._unpackFlipY(e.invertY);var l=i.TEXTURE_2D;e.isCube&&(l=i.TEXTURE_CUBE_MAP_POSITIVE_X+n),i.texImage2D(l,r,a,s,o,t),this._bindTextureDirectly(c,null,!0)},_.prototype.updateDynamicIndexBuffer=function(e,t,n){var r;void 0===n&&(n=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),r=t instanceof Uint16Array||t instanceof Uint32Array?t:e.is32Bits?new Uint32Array(t):new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},_.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var n=this._gl;if(t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(n.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(n.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(n.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),t>1&&n.renderbufferStorageMultisample){var r=n.createFramebuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=r,this._bindUnboundFramebuffer(e._MSAAFramebuffer);var i=n.createRenderbuffer();if(!i)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,i),n.renderbufferStorageMultisample(n.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,i),e._MSAARenderBuffer=i}else this._bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),this._bindUnboundFramebuffer(null),t},_.prototype.updateTextureComparisonFunction=function(e,t){if(1!==this.webGLVersion){var n=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,t),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else l.Logger.Error("WebGL 1 does not support texture comparison.")},_.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var n=new c.WebGLDataBuffer(t);return n.capacity=e,this.bindArrayBuffer(n),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),n},_.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},_.prototype._clientWaitAsync=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=10);var r=this._gl;return new Promise(function(i,o){var s=function(){var a=r.clientWaitSync(e,t,0);a!=r.WAIT_FAILED?a!=r.TIMEOUT_EXPIRED?i():setTimeout(s,n):o()};s()})},_.prototype._readPixelsAsync=function(e,t,n,r,i,o,s){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var a=this._gl,c=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,c),a.bufferData(a.PIXEL_PACK_BUFFER,s.byteLength,a.STREAM_READ),a.readPixels(e,t,n,r,i,o,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var l=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return l?(a.flush(),this._clientWaitAsync(l,0,10).then(function(){return a.deleteSync(l),a.bindBuffer(a.PIXEL_PACK_BUFFER,c),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,s),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(c),s})):null},_.prototype._readTexturePixels=function(e,t,n,r,i,o){void 0===r&&(r=-1),void 0===i&&(i=0),void 0===o&&(o=null);var s=this._gl;if(!this._dummyFramebuffer){var a=s.createFramebuffer();if(!a)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=a}s.bindFramebuffer(s.FRAMEBUFFER,this._dummyFramebuffer),r>-1?s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+r,e._webGLTexture,i):s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e._webGLTexture,i);var c=void 0!==e.type?this._getWebGLTextureType(e.type):s.UNSIGNED_BYTE;switch(c){case s.UNSIGNED_BYTE:o||(o=new Uint8Array(4*t*n)),c=s.UNSIGNED_BYTE;break;default:o||(o=new Float32Array(4*t*n)),c=s.FLOAT}return s.readPixels(0,0,t,n,s.RGBA,c,o),s.bindFramebuffer(s.FRAMEBUFFER,this._currentFramebuffer),o},_.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===_.Instances.length&&_.audioEngine&&_.audioEngine.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),n.DomManagement.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)),u.prototype.dispose.call(this);var e=_.Instances.indexOf(this);e>=0&&_.Instances.splice(e,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},_.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},_.prototype.displayLoadingUI=function(){if(n.DomManagement.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},_.prototype.hideLoadingUI=function(){if(n.DomManagement.IsWindowObjectExist()){var e=this._loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(_.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=_.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),_._RequestPointerlock=function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&e.requestPointerLock()},_._ExitPointerlock=function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},_._RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},_._ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},_.ALPHA_DISABLE=0,_.ALPHA_ADD=1,_.ALPHA_COMBINE=2,_.ALPHA_SUBTRACT=3,_.ALPHA_MULTIPLY=4,_.ALPHA_MAXIMIZED=5,_.ALPHA_ONEONE=6,_.ALPHA_PREMULTIPLIED=7,_.ALPHA_PREMULTIPLIED_PORTERDUFF=8,_.ALPHA_INTERPOLATE=9,_.ALPHA_SCREENMODE=10,_.DELAYLOADSTATE_NONE=0,_.DELAYLOADSTATE_LOADED=1,_.DELAYLOADSTATE_LOADING=2,_.DELAYLOADSTATE_NOTLOADED=4,_.NEVER=512,_.ALWAYS=519,_.LESS=513,_.EQUAL=514,_.LEQUAL=515,_.GREATER=516,_.GEQUAL=518,_.NOTEQUAL=517,_.KEEP=7680,_.REPLACE=7681,_.INCR=7682,_.DECR=7683,_.INVERT=5386,_.INCR_WRAP=34055,_.DECR_WRAP=34056,_.TEXTURE_CLAMP_ADDRESSMODE=0,_.TEXTURE_WRAP_ADDRESSMODE=1,_.TEXTURE_MIRROR_ADDRESSMODE=2,_.TEXTUREFORMAT_ALPHA=0,_.TEXTUREFORMAT_LUMINANCE=1,_.TEXTUREFORMAT_LUMINANCE_ALPHA=2,_.TEXTUREFORMAT_RGB=4,_.TEXTUREFORMAT_RGBA=5,_.TEXTUREFORMAT_RED=6,_.TEXTUREFORMAT_R=6,_.TEXTUREFORMAT_RG=7,_.TEXTUREFORMAT_RED_INTEGER=8,_.TEXTUREFORMAT_R_INTEGER=8,_.TEXTUREFORMAT_RG_INTEGER=9,_.TEXTUREFORMAT_RGB_INTEGER=10,_.TEXTUREFORMAT_RGBA_INTEGER=11,_.TEXTURETYPE_UNSIGNED_BYTE=0,_.TEXTURETYPE_UNSIGNED_INT=0,_.TEXTURETYPE_FLOAT=1,_.TEXTURETYPE_HALF_FLOAT=2,_.TEXTURETYPE_BYTE=3,_.TEXTURETYPE_SHORT=4,_.TEXTURETYPE_UNSIGNED_SHORT=5,_.TEXTURETYPE_INT=6,_.TEXTURETYPE_UNSIGNED_INTEGER=7,_.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,_.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,_.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,_.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,_.TEXTURETYPE_UNSIGNED_INT_24_8=12,_.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,_.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,_.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,_.TEXTURE_NEAREST_SAMPLINGMODE=1,_.TEXTURE_BILINEAR_SAMPLINGMODE=2,_.TEXTURE_TRILINEAR_SAMPLINGMODE=3,_.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,_.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,_.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,_.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,_.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,_.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,_.TEXTURE_NEAREST_LINEAR=7,_.TEXTURE_NEAREST_NEAREST=1,_.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,_.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,_.TEXTURE_LINEAR_LINEAR=2,_.TEXTURE_LINEAR_NEAREST=12,_.TEXTURE_EXPLICIT_MODE=0,_.TEXTURE_SPHERICAL_MODE=1,_.TEXTURE_PLANAR_MODE=2,_.TEXTURE_CUBIC_MODE=3,_.TEXTURE_PROJECTION_MODE=4,_.TEXTURE_SKYBOX_MODE=5,_.TEXTURE_INVCUBIC_MODE=6,_.TEXTURE_EQUIRECTANGULAR_MODE=7,_.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,_.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,_.SCALEMODE_FLOOR=1,_.SCALEMODE_NEAREST=2,_.SCALEMODE_CEILING=3,_._RescalePostProcessFactory=null,_}(o.ThinEngine);exports.Engine=u;
},{"tslib":"90Cu","../Misc/observable":"vY1+","../Misc/domManagement":"GCrr","./engineStore":"cq+N","../Misc/devTools":"S9x9","./thinEngine":"aDNm","../Misc/performanceMonitor":"xVez","../Misc/perfCounter":"177K","../Meshes/WebGL/webGLDataBuffer":"7vCK","../Misc/logger":"Yh4i","./Extensions/engine.alpha":"qzlc"}],"qvOT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DeepCopier=void 0;var e=require("./stringTools"),n=function(e,n){return e?e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(n):e.clone?e.clone():null:null},t=function(){function t(){}return t.DeepCopy=function(t,o,r,s){for(var i in t)if(("_"!==i[0]||s&&-1!==s.indexOf(i))&&!(e.StringTools.EndsWith(i,"Observable")||r&&-1!==r.indexOf(i))){var l=t[i],f=typeof l;if("function"!==f)try{if("object"===f)if(l instanceof Array){if(o[i]=[],l.length>0)if("object"==typeof l[0])for(var a=0;a<l.length;a++){var c=n(l[a],o);-1===o[i].indexOf(c)&&o[i].push(c)}else o[i]=l.slice(0)}else o[i]=n(l,o);else o[i]=l}catch(u){}}},t}();exports.DeepCopier=t;
},{"./stringTools":"VuqN"}],"5myL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebRequest=void 0;var e=function(){function e(){this._xhr=new XMLHttpRequest}return e.prototype._injectCustomRequestHeaders=function(){for(var t in e.CustomRequestHeaders){var r=e.CustomRequestHeaders[t];r&&this._xhr.setRequestHeader(t,r)}},Object.defineProperty(e.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._xhr.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr.response},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(e,t,r){this._xhr.addEventListener(e,t,r)},e.prototype.removeEventListener=function(e,t,r){this._xhr.removeEventListener(e,t,r)},e.prototype.abort=function(){this._xhr.abort()},e.prototype.send=function(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)},e.prototype.open=function(t,r){for(var o=0,n=e.CustomRequestModifiers;o<n.length;o++){(0,n[o])(this._xhr,r)}return r=(r=r.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(t,r,!0)},e.prototype.setRequestHeader=function(e,t){this._xhr.setRequestHeader(e,t)},e.prototype.getResponseHeader=function(e){return this._xhr.getResponseHeader(e)},e.CustomRequestHeaders={},e.CustomRequestModifiers=new Array,e}();exports.WebRequest=e;
},{}],"cg3e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FilesInputStore=void 0;var e=function(){function e(){}return e.FilesToLoad={},e}();exports.FilesInputStore=e;
},{}],"3JrV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RetryStrategy=void 0;var t=function(){function t(){}return t.ExponentialBackoff=function(t,e){return void 0===t&&(t=3),void 0===e&&(e=500),function(r,n,o){return 0!==n.status||o>=t||-1!==r.indexOf("file:")?-1:Math.pow(2,o)*e}},t}();exports.RetryStrategy=t;
},{}],"cRN2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseError=void 0;var r=require("tslib"),e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t._setPrototypeOf=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},t}(Error);exports.BaseError=e;
},{"tslib":"90Cu"}],"qMSH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FileTools=exports.ReadFileError=exports.RequestFileError=exports.LoadFileError=void 0;var e=require("tslib"),r=require("./webRequest"),t=require("./domManagement"),o=require("./observable"),n=require("./filesInputStore"),i=require("./retryStrategy"),a=require("./baseError"),s=require("./stringTools"),l=require("../Engines/thinEngine"),u=require("../Engines/Processors/shaderProcessor"),f=function(t){function o(e,n){var i=t.call(this,e)||this;return i.name="LoadFileError",a.BaseError._setPrototypeOf(i,o.prototype),n instanceof r.WebRequest?i.request=n:i.file=n,i}return(0,e.__extends)(o,t),o}(a.BaseError);exports.LoadFileError=f;var c=function(r){function t(e,o){var n=r.call(this,e)||this;return n.request=o,n.name="RequestFileError",a.BaseError._setPrototypeOf(n,t.prototype),n}return(0,e.__extends)(t,r),t}(a.BaseError);exports.RequestFileError=c;var d=function(r){function t(e,o){var n=r.call(this,e)||this;return n.file=o,n.name="ReadFileError",a.BaseError._setPrototypeOf(n,t.prototype),n}return(0,e.__extends)(t,r),t}(a.BaseError);exports.ReadFileError=d;var v=function(){function e(){}return e._CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},e.SetCorsBehavior=function(r,t){if((!r||0!==r.indexOf("data:"))&&e.CorsBehavior)if("string"==typeof e.CorsBehavior||this.CorsBehavior instanceof String)t.crossOrigin=e.CorsBehavior;else{var o=e.CorsBehavior(r);o&&(t.crossOrigin=o)}},e.LoadImage=function(r,t,o,i,a){var l;void 0===a&&(a="");var u=!1;if(r instanceof ArrayBuffer||ArrayBuffer.isView(r)?"undefined"!=typeof Blob?(l=URL.createObjectURL(new Blob([r],{type:a})),u=!0):l="data:"+a+";base64,"+s.StringTools.EncodeArrayBufferToBase64(r):r instanceof Blob?(l=URL.createObjectURL(r),u=!0):(l=e._CleanUrl(r),l=e.PreprocessUrl(r)),"undefined"==typeof Image)return e.LoadFile(l,function(e){createImageBitmap(new Blob([e],{type:a})).then(function(e){t(e),u&&URL.revokeObjectURL(l)}).catch(function(e){o&&o("Error while trying to load image: "+r,e)})},void 0,i||void 0,!0,function(e,t){o&&o("Error while trying to load image: "+r,t)}),null;var f=new Image;e.SetCorsBehavior(l,f);var c=function(){f.removeEventListener("load",c),f.removeEventListener("error",d),t(f),u&&f.src&&URL.revokeObjectURL(f.src)},d=function(e){f.removeEventListener("load",c),f.removeEventListener("error",d),o&&o("Error while trying to load image: "+r,e),u&&f.src&&URL.revokeObjectURL(f.src)};f.addEventListener("load",c),f.addEventListener("error",d);var v=function(){f.src=l};if("data:"!==l.substr(0,5)&&i&&i.enableTexturesOffline)i.open(function(){i&&i.loadImage(l,f)},v);else{if(-1!==l.indexOf("file:")){var b=decodeURIComponent(l.substring(5).toLowerCase());if(n.FilesInputStore.FilesToLoad[b]){try{var p;try{p=URL.createObjectURL(n.FilesInputStore.FilesToLoad[b])}catch(L){p=URL.createObjectURL(n.FilesInputStore.FilesToLoad[b])}f.src=p,u=!0}catch(E){f.src=""}return f}}v()}return f},e.ReadFile=function(e,r,t,n,i){var a=new FileReader,s={onCompleteObservable:new o.Observable,abort:function(){return a.abort()}};return a.onloadend=function(e){return s.onCompleteObservable.notifyObservers(s)},i&&(a.onerror=function(r){i(new d("Unable to read "+e.name,e))}),a.onload=function(e){r(e.target.result)},t&&(a.onprogress=t),n?a.readAsArrayBuffer(e):a.readAsText(e),s},e.LoadFile=function(r,t,o,i,a,s){if(-1!==r.indexOf("file:")){var l=decodeURIComponent(r.substring(5).toLowerCase());0===l.indexOf("./")&&(l=l.substring(2));var u=n.FilesInputStore.FilesToLoad[l];if(u)return e.ReadFile(u,t,o,a,s?function(e){return s(void 0,new f(e.message,e.file))}:void 0)}return e.RequestFile(r,function(e,r){t(e,r?r.responseURL:void 0)},o,i,a,s?function(e){s(e.request,new f(e.message,e.request))}:void 0)},e.RequestFile=function(n,i,a,s,l,u,f){n=e._CleanUrl(n),n=e.PreprocessUrl(n);var d=e.BaseUrl+n,v=!1,b={onCompleteObservable:new o.Observable,abort:function(){return v=!0}},p=function(){var o=new r.WebRequest,n=null;b.abort=function(){v=!0,o.readyState!==(XMLHttpRequest.DONE||4)&&o.abort(),null!==n&&(clearTimeout(n),n=null)};var s=function(p){o.open("GET",d),f&&f(o),l&&(o.responseType="arraybuffer"),a&&o.addEventListener("progress",a);var L=function(){o.removeEventListener("loadend",L),b.onCompleteObservable.notifyObservers(b),b.onCompleteObservable.clear()};o.addEventListener("loadend",L);var E=function(){if(!v&&o.readyState===(XMLHttpRequest.DONE||4)){if(o.removeEventListener("readystatechange",E),o.status>=200&&o.status<300||0===o.status&&(!t.DomManagement.IsWindowObjectExist()||e.IsFileURL()))return void i(l?o.response:o.responseText,o);var a=e.DefaultRetryStrategy;if(a){var f=a(d,o,p);if(-1!==f)return o.removeEventListener("loadend",L),o=new r.WebRequest,void(n=setTimeout(function(){return s(p+1)},f))}var b=new c("Error status: "+o.status+" "+o.statusText+" - Unable to load "+d,o);u&&u(b)}};o.addEventListener("readystatechange",E),o.send()};s(0)};if(s&&s.enableSceneOffline){var L=function(e){e&&e.status>400?u&&u(e):p()};s.open(function(){s&&s.loadFile(e.BaseUrl+n,function(e){v||i(e),b.onCompleteObservable.notifyObservers(b)},a?function(e){v||a(e)}:void 0,L,l)},L)}else p();return b},e.IsFileURL=function(){return"file:"===location.protocol},e.DefaultRetryStrategy=i.RetryStrategy.ExponentialBackoff(),e.BaseUrl="",e.CorsBehavior="anonymous",e.PreprocessUrl=function(e){return e},e}();exports.FileTools=v,l.ThinEngine._FileToolsLoadImage=v.LoadImage.bind(v),l.ThinEngine._FileToolsLoadFile=v.LoadFile.bind(v),u.ShaderProcessor._FileToolsLoadFile=v.LoadFile.bind(v);
},{"tslib":"90Cu","./webRequest":"5myL","./domManagement":"GCrr","./observable":"vY1+","./filesInputStore":"cg3e","./retryStrategy":"3JrV","./baseError":"cRN2","./stringTools":"VuqN","../Engines/thinEngine":"aDNm","../Engines/Processors/shaderProcessor":"j98r"}],"z08j":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.PromisePolyfill=void 0,function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(e||(e={}));var t=function(){return function(){this.count=0,this.target=0,this.results=[]}}(),n=function(){function n(t){var n=this;if(this._state=e.Pending,this._children=new Array,this._rejectWasConsumed=!1,t)try{t(function(e){n._resolve(e)},function(e){n._reject(e)})}catch(r){this._reject(r)}}return Object.defineProperty(n.prototype,"_result",{get:function(){return this._resultValue},set:function(e){this._resultValue=e,this._parent&&void 0===this._parent._result&&(this._parent._result=e)},enumerable:!0,configurable:!0}),n.prototype.catch=function(e){return this.then(void 0,e)},n.prototype.then=function(t,r){var i=this,l=new n;return l._onFulfilled=t,l._onRejected=r,this._children.push(l),l._parent=this,this._state!==e.Pending&&setTimeout(function(){if(i._state===e.Fulfilled||i._rejectWasConsumed){var t=l._resolve(i._result);if(null!=t)if(void 0!==t._state){var n=t;l._children.push(n),n._parent=l,l=n}else l._result=t}else l._reject(i._reason)}),l},n.prototype._moveChildren=function(t){var n,r=this;if((n=this._children).push.apply(n,t.splice(0,t.length)),this._children.forEach(function(e){e._parent=r}),this._state===e.Fulfilled)for(var i=0,l=this._children;i<l.length;i++){l[i]._resolve(this._result)}else if(this._state===e.Rejected)for(var s=0,o=this._children;s<o.length;s++){o[s]._reject(this._reason)}},n.prototype._resolve=function(t){try{this._state=e.Fulfilled;var n=null;if(this._onFulfilled&&(n=this._onFulfilled(t)),null!=n)if(void 0!==n._state){var r=n;r._parent=this,r._moveChildren(this._children),t=r._result}else t=n;this._result=t;for(var i=0,l=this._children;i<l.length;i++){l[i]._resolve(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(s){this._reject(s,!0)}},n.prototype._reject=function(t,n){if(void 0===n&&(n=!1),this._state=e.Rejected,this._reason=t,this._onRejected&&!n)try{this._onRejected(t),this._rejectWasConsumed=!0}catch(s){t=s}for(var r=0,i=this._children;r<i.length;r++){var l=i[r];this._rejectWasConsumed?l._resolve(null):l._reject(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},n.resolve=function(e){var t=new n;return t._resolve(e),t},n._RegisterForFulfillment=function(t,n,r){t.then(function(e){return n.results[r]=e,n.count++,n.count===n.target&&n.rootPromise._resolve(n.results),null},function(t){n.rootPromise._state!==e.Rejected&&n.rootPromise._reject(t)})},n.all=function(e){var r=new n,i=new t;if(i.target=e.length,i.rootPromise=r,e.length)for(var l=0;l<e.length;l++)n._RegisterForFulfillment(e[l],i,l);else r._resolve([]);return r},n.race=function(e){var t=new n;if(e.length)for(var r=0,i=e;r<i.length;r++){i[r].then(function(e){return t&&(t._resolve(e),t=null),null},function(e){t&&(t._reject(e),t=null)})}return t},n}(),r=function(){function e(){}return e.Apply=function(e){(void 0===e&&(e=!1),e||"undefined"==typeof Promise)&&(window.Promise=n)},e}();exports.PromisePolyfill=r;
},{}],"MgSd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TimingTools=void 0;var e=require("./domManagement"),t=function(){function t(){}return t.SetImmediate=function(t){e.DomManagement.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(t):setTimeout(t,1)},t}();exports.TimingTools=t;
},{"./domManagement":"GCrr"}],"sm8f":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._TypeStore=void 0;var e=function(){function e(){}return e.GetClass=function(e){return this.RegisteredTypes&&this.RegisteredTypes[e]?this.RegisteredTypes[e]:null},e.RegisteredTypes={},e}();exports._TypeStore=e;
},{}],"6kA1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstantiationTools=void 0;var e=require("./logger"),t=require("./typeStore"),r=function(){function r(){}return r.Instantiate=function(r){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[r])return this.RegisteredExternalClasses[r];var s=t._TypeStore.GetClass(r);if(s)return s;e.Logger.Warn(r+" not found, you may have missed an import.");for(var n=r.split("."),i=window||this,o=0,a=n.length;o<a;o++)i=i[n[o]];return"function"!=typeof i?null:i},r.RegisteredExternalClasses={},r}();exports.InstantiationTools=r;
},{"./logger":"Yh4i","./typeStore":"sm8f"}],"/kz4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GUID=void 0;var x=function(){function x(){}return x.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(x){var r=16*Math.random()|0;return("x"===x?r:3&r|8).toString(16)})},x}();exports.GUID=x;
},{}],"8xSa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.className=v,exports.AsyncLoop=exports.Tools=void 0;var o=require("./observable"),e=require("./domManagement"),r=require("./logger"),n=require("./deepCopier"),i=require("./precisionDate"),t=require("./devTools"),a=require("./webRequest"),u=require("../Engines/engineStore"),l=require("./fileTools"),s=require("./promise"),K=require("./timingTools"),c=require("./instantiationTools"),g=require("./guid"),f=function(){function s(){}return Object.defineProperty(s,"BaseUrl",{get:function(){return l.FileTools.BaseUrl},set:function(o){l.FileTools.BaseUrl=o},enumerable:!0,configurable:!0}),Object.defineProperty(s,"DefaultRetryStrategy",{get:function(){return l.FileTools.DefaultRetryStrategy},set:function(o){l.FileTools.DefaultRetryStrategy=o},enumerable:!0,configurable:!0}),Object.defineProperty(s,"UseFallbackTexture",{get:function(){return u.EngineStore.UseFallbackTexture},set:function(o){u.EngineStore.UseFallbackTexture=o},enumerable:!0,configurable:!0}),Object.defineProperty(s,"RegisteredExternalClasses",{get:function(){return c.InstantiationTools.RegisteredExternalClasses},set:function(o){c.InstantiationTools.RegisteredExternalClasses=o},enumerable:!0,configurable:!0}),Object.defineProperty(s,"fallbackTexture",{get:function(){return u.EngineStore.FallbackTexture},set:function(o){u.EngineStore.FallbackTexture=o},enumerable:!0,configurable:!0}),s.FetchToRef=function(o,e,r,n,i,t){var a=4*((Math.abs(o)*r%r|0)+(Math.abs(e)*n%n|0)*r);t.r=i[a]/255,t.g=i[a+1]/255,t.b=i[a+2]/255,t.a=i[a+3]/255},s.Mix=function(o,e,r){return o*(1-r)+e*r},s.Instantiate=function(o){return c.InstantiationTools.Instantiate(o)},s.Slice=function(o,e,r){return o.slice?o.slice(e,r):Array.prototype.slice.call(o,e,r)},s.SetImmediate=function(o){K.TimingTools.SetImmediate(o)},s.IsExponentOfTwo=function(o){var e=1;do{e*=2}while(e<o);return e===o},s.FloatRound=function(o){return Math.fround?Math.fround(o):s._tmpFloatArray[0]=o},s.GetFilename=function(o){var e=o.lastIndexOf("/");return e<0?o:o.substring(e+1)},s.GetFolderPath=function(o,e){void 0===e&&(e=!1);var r=o.lastIndexOf("/");return r<0?e?o:"":o.substring(0,r+1)},s.ToDegrees=function(o){return 180*o/Math.PI},s.ToRadians=function(o){return o*Math.PI/180},s.MakeArray=function(o,e){return!0===e||void 0!==o&&null!=o?Array.isArray(o)?o:[o]:null},s.GetPointerPrefix=function(){var o="pointer";return e.DomManagement.IsWindowObjectExist()&&!window.PointerEvent&&e.DomManagement.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(o="mouse"),o},s.SetCorsBehavior=function(o,e){l.FileTools.SetCorsBehavior(o,e)},s.CleanUrl=function(o){return o=o.replace(/#/gm,"%23")},Object.defineProperty(s,"PreprocessUrl",{get:function(){return l.FileTools.PreprocessUrl},set:function(o){l.FileTools.PreprocessUrl=o},enumerable:!0,configurable:!0}),s.LoadImage=function(o,e,r,n,i){return l.FileTools.LoadImage(o,e,r,n,i)},s.LoadFile=function(o,e,r,n,i,t){return l.FileTools.LoadFile(o,e,r,n,i,t)},s.LoadFileAsync=function(o,e){return void 0===e&&(e=!0),new Promise(function(r,n){l.FileTools.LoadFile(o,function(o){r(o)},void 0,void 0,e,function(o,e){n(e)})})},s.LoadScript=function(o,r,n,i){if(e.DomManagement.IsWindowObjectExist()){var t=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",o),i&&(a.id=i),a.onload=function(){r&&r()},a.onerror=function(e){n&&n("Unable to load script '"+o+"'",e)},t.appendChild(a)}},s.LoadScriptAsync=function(o,e){var r=this;return new Promise(function(e,n){r.LoadScript(o,function(){e()},function(o,e){n(e)})})},s.ReadFileAsDataURL=function(e,r,n){var i=new FileReader,t={onCompleteObservable:new o.Observable,abort:function(){return i.abort()}};return i.onloadend=function(o){t.onCompleteObservable.notifyObservers(t)},i.onload=function(o){r(o.target.result)},i.onprogress=n,i.readAsDataURL(e),t},s.ReadFile=function(o,e,r,n,i){return l.FileTools.ReadFile(o,e,r,n,i)},s.FileAsURL=function(o){var e=new Blob([o]);return(window.URL||window.webkitURL).createObjectURL(e)},s.Format=function(o,e){return void 0===e&&(e=2),o.toFixed(e)},s.DeepCopy=function(o,e,r,i){n.DeepCopier.DeepCopy(o,e,r,i)},s.IsEmpty=function(o){for(var e in o)if(o.hasOwnProperty(e))return!1;return!0},s.RegisterTopRootEvents=function(o,e){for(var r=0;r<e.length;r++){var n=e[r];o.addEventListener(n.name,n.handler,!1);try{window.parent&&window.parent.addEventListener(n.name,n.handler,!1)}catch(i){}}},s.UnregisterTopRootEvents=function(o,e){for(var r=0;r<e.length;r++){var n=e[r];o.removeEventListener(n.name,n.handler);try{o.parent&&o.parent.removeEventListener(n.name,n.handler)}catch(i){}}},s.DumpFramebuffer=function(o,e,r,n,i,t){void 0===i&&(i="image/png");for(var a=4*o,u=e/2,l=r.readPixels(0,0,o,e),K=0;K<u;K++)for(var c=0;c<a;c++){var g=c+K*a,f=c+(e-K-1)*a,v=l[g];l[g]=l[f],l[f]=v}s._ScreenshotCanvas||(s._ScreenshotCanvas=document.createElement("canvas")),s._ScreenshotCanvas.width=o,s._ScreenshotCanvas.height=e;var P=s._ScreenshotCanvas.getContext("2d");if(P){var A=P.createImageData(o,e);A.data.set(l),P.putImageData(A,0,0),s.EncodeScreenshotCanvasData(n,i,t)}},s.ToBlob=function(o,e,r){void 0===r&&(r="image/png"),o.toBlob||(o.toBlob=function(o,e,r){var n=this;setTimeout(function(){for(var i=atob(n.toDataURL(e,r).split(",")[1]),t=i.length,a=new Uint8Array(t),u=0;u<t;u++)a[u]=i.charCodeAt(u);o(new Blob([a]))})}),o.toBlob(function(o){e(o)},r)},s.EncodeScreenshotCanvasData=function(o,e,r){(void 0===e&&(e="image/png"),o)?o(s._ScreenshotCanvas.toDataURL(e)):this.ToBlob(s._ScreenshotCanvas,function(o){if("download"in document.createElement("a")){if(!r){var e=new Date,n=(e.getFullYear()+"-"+(e.getMonth()+1)).slice(2)+"-"+e.getDate()+"_"+e.getHours()+"-"+("0"+e.getMinutes()).slice(-2);r="screenshot_"+n+".png"}s.Download(o,r)}else{var i=URL.createObjectURL(o),t=window.open("");if(!t)return;var a=t.document.createElement("img");a.onload=function(){URL.revokeObjectURL(i)},a.src=i,t.document.body.appendChild(a)}},e)},s.Download=function(o,e){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(o,e);else{var r=window.URL.createObjectURL(o),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=r,n.download=e,n.addEventListener("click",function(){n.parentElement&&n.parentElement.removeChild(n)}),n.click(),window.URL.revokeObjectURL(r)}},s.CreateScreenshot=function(o,e,r,n,i){throw void 0===i&&(i="image/png"),t._DevTools.WarnImport("ScreenshotTools")},s.CreateScreenshotAsync=function(o,e,r,n){throw void 0===n&&(n="image/png"),t._DevTools.WarnImport("ScreenshotTools")},s.CreateScreenshotUsingRenderTarget=function(o,e,r,n,i,a,u,l){throw void 0===i&&(i="image/png"),void 0===a&&(a=1),void 0===u&&(u=!1),t._DevTools.WarnImport("ScreenshotTools")},s.CreateScreenshotUsingRenderTargetAsync=function(o,e,r,n,i,a,u){throw void 0===n&&(n="image/png"),void 0===i&&(i=1),void 0===a&&(a=!1),t._DevTools.WarnImport("ScreenshotTools")},s.RandomId=function(){return g.GUID.RandomId()},s.IsBase64=function(o){return!(o.length<5)&&"data:"===o.substr(0,5)},s.DecodeBase64=function(o){for(var e=atob(o.split(",")[1]),r=e.length,n=new Uint8Array(new ArrayBuffer(r)),i=0;i<r;i++)n[i]=e.charCodeAt(i);return n.buffer},s.GetAbsoluteUrl=function(o){var e=document.createElement("a");return e.href=o,e.href},Object.defineProperty(s,"errorsCount",{get:function(){return r.Logger.errorsCount},enumerable:!0,configurable:!0}),s.Log=function(o){r.Logger.Log(o)},s.Warn=function(o){r.Logger.Warn(o)},s.Error=function(o){r.Logger.Error(o)},Object.defineProperty(s,"LogCache",{get:function(){return r.Logger.LogCache},enumerable:!0,configurable:!0}),s.ClearLogCache=function(){r.Logger.ClearLogCache()},Object.defineProperty(s,"LogLevels",{set:function(o){r.Logger.LogLevels=o},enumerable:!0,configurable:!0}),Object.defineProperty(s,"PerformanceLogLevel",{set:function(o){return(o&s.PerformanceUserMarkLogLevel)===s.PerformanceUserMarkLogLevel?(s.StartPerformanceCounter=s._StartUserMark,void(s.EndPerformanceCounter=s._EndUserMark)):(o&s.PerformanceConsoleLogLevel)===s.PerformanceConsoleLogLevel?(s.StartPerformanceCounter=s._StartPerformanceConsole,void(s.EndPerformanceCounter=s._EndPerformanceConsole)):(s.StartPerformanceCounter=s._StartPerformanceCounterDisabled,void(s.EndPerformanceCounter=s._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),s._StartPerformanceCounterDisabled=function(o,e){},s._EndPerformanceCounterDisabled=function(o,e){},s._StartUserMark=function(o,r){if(void 0===r&&(r=!0),!s._performance){if(!e.DomManagement.IsWindowObjectExist())return;s._performance=window.performance}r&&s._performance.mark&&s._performance.mark(o+"-Begin")},s._EndUserMark=function(o,e){void 0===e&&(e=!0),e&&s._performance.mark&&(s._performance.mark(o+"-End"),s._performance.measure(o,o+"-Begin",o+"-End"))},s._StartPerformanceConsole=function(o,e){void 0===e&&(e=!0),e&&(s._StartUserMark(o,e),console.time&&console.time(o))},s._EndPerformanceConsole=function(o,e){void 0===e&&(e=!0),e&&(s._EndUserMark(o,e),console.timeEnd(o))},Object.defineProperty(s,"Now",{get:function(){return i.PrecisionDate.Now},enumerable:!0,configurable:!0}),s.GetClassName=function(o,e){void 0===e&&(e=!1);var r=null;if(!e&&o.getClassName)r=o.getClassName();else{if(o instanceof Object)r=(e?o:Object.getPrototypeOf(o)).constructor.__bjsclassName__;r||(r=typeof o)}return r},s.First=function(o,e){for(var r=0,n=o;r<n.length;r++){var i=n[r];if(e(i))return i}return null},s.getFullClassName=function(o,e){void 0===e&&(e=!1);var r=null,n=null;if(!e&&o.getClassName)r=o.getClassName();else{if(o instanceof Object){var i=e?o:Object.getPrototypeOf(o);r=i.constructor.__bjsclassName__,n=i.constructor.__bjsmoduleName__}r||(r=typeof o)}return r?(null!=n?n+".":"")+r:null},s.DelayAsync=function(o){return new Promise(function(e){setTimeout(function(){e()},o)})},s.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},s.UseCustomRequestHeaders=!1,s.CustomRequestHeaders=a.WebRequest.CustomRequestHeaders,s.CorsBehavior="anonymous",s._tmpFloatArray=new Float32Array(1),s.GetDOMTextContent=e.DomManagement.GetDOMTextContent,s.NoneLogLevel=r.Logger.NoneLogLevel,s.MessageLogLevel=r.Logger.MessageLogLevel,s.WarningLogLevel=r.Logger.WarningLogLevel,s.ErrorLogLevel=r.Logger.ErrorLogLevel,s.AllLogLevel=r.Logger.AllLogLevel,s.IsWindowObjectExist=e.DomManagement.IsWindowObjectExist,s.PerformanceNoneLogLevel=0,s.PerformanceUserMarkLogLevel=1,s.PerformanceConsoleLogLevel=2,s.StartPerformanceCounter=s._StartPerformanceCounterDisabled,s.EndPerformanceCounter=s._EndPerformanceCounterDisabled,s}();function v(o,e){return function(r){r.__bjsclassName__=o,r.__bjsmoduleName__=null!=e?e:null}}exports.Tools=f;var P=function(){function o(o,e,r,n){void 0===n&&(n=0),this.iterations=o,this.index=n-1,this._done=!1,this._fn=e,this._successCallback=r}return o.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},o.prototype.breakLoop=function(){this._done=!0,this._successCallback()},o.Run=function(e,r,n,i){void 0===i&&(i=0);var t=new o(e,r,n,i);return t.executeNext(),t},o.SyncAsyncForLoop=function(e,r,n,i,t,a){return void 0===a&&(a=0),o.Run(Math.ceil(e/r),function(o){t&&t()?o.breakLoop():setTimeout(function(){for(var i=0;i<r;++i){var a=o.index*r+i;if(a>=e)break;if(n(a),t&&t()){o.breakLoop();break}}o.executeNext()},a)},i)},o}();exports.AsyncLoop=P,u.EngineStore.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",s.PromisePolyfill.Apply();
},{"./observable":"vY1+","./domManagement":"GCrr","./logger":"Yh4i","./deepCopier":"qvOT","./precisionDate":"G7Te","./devTools":"S9x9","./webRequest":"5myL","../Engines/engineStore":"cq+N","./fileTools":"qMSH","./promise":"z08j","./timingTools":"MgSd","./instantiationTools":"6kA1","./guid":"/kz4"}],"Hnz9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SmartArrayNoDuplicate=exports.SmartArray=void 0;var t=require("tslib"),a=function(){function t(a){this.length=0,this.data=new Array(a),this._id=t._GlobalId++}return t.prototype.push=function(t){this.data[this.length++]=t,this.length>this.data.length&&(this.data.length*=2)},t.prototype.forEach=function(t){for(var a=0;a<this.length;a++)t(this.data[a])},t.prototype.sort=function(t){this.data.sort(t)},t.prototype.reset=function(){this.length=0},t.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},t.prototype.concat=function(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(var a=0;a<t.length;a++)this.data[this.length++]=(t.data||t)[a]}},t.prototype.indexOf=function(t){var a=this.data.indexOf(t);return a>=this.length?-1:a},t.prototype.contains=function(t){return-1!==this.indexOf(t)},t._GlobalId=0,t}();exports.SmartArray=a;var e=function(a){function e(){var t=null!==a&&a.apply(this,arguments)||this;return t._duplicateId=0,t}return(0,t.__extends)(e,a),e.prototype.push=function(t){a.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(t){return(!t.__smartArrayFlags||t.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(t),!0)},e.prototype.reset=function(){a.prototype.reset.call(this),this._duplicateId++},e.prototype.concatWithNoDuplicate=function(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(var a=0;a<t.length;a++){var e=(t.data||t)[a];this.pushNoDuplicate(e)}}},e}(a);exports.SmartArrayNoDuplicate=e;
},{"tslib":"90Cu"}],"JXIB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StringDictionary=void 0;var t=function(){function t(){this._count=0,this._data={}}return t.prototype.copyFrom=function(t){var o=this;this.clear(),t.forEach(function(t,r){return o.add(t,r)})},t.prototype.get=function(t){var o=this._data[t];if(void 0!==o)return o},t.prototype.getOrAddWithFactory=function(t,o){var r=this.get(t);return void 0!==r?r:((r=o(t))&&this.add(t,r),r)},t.prototype.getOrAdd=function(t,o){var r=this.get(t);return void 0!==r?r:(this.add(t,o),o)},t.prototype.contains=function(t){return void 0!==this._data[t]},t.prototype.add=function(t,o){return void 0===this._data[t]&&(this._data[t]=o,++this._count,!0)},t.prototype.set=function(t,o){return void 0!==this._data[t]&&(this._data[t]=o,!0)},t.prototype.getAndRemove=function(t){var o=this.get(t);return void 0!==o?(delete this._data[t],--this._count,o):null},t.prototype.remove=function(t){return!!this.contains(t)&&(delete this._data[t],--this._count,!0)},t.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){for(var o in this._data){t(o,this._data[o])}},t.prototype.first=function(t){for(var o in this._data){var r=t(o,this._data[o]);if(r)return r}return null},t}();exports.StringDictionary=t;
},{}],"6FXc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AndOrNotEvaluator=void 0;var e=function(){function e(){}return e.Eval=function(t,r){return"true"===(t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,r)}):e._HandleParenthesisContent(t,r))||"false"!==t&&e.Eval(t,r)},e._HandleParenthesisContent=function(t,r){var n;r=r||function(e){return"true"===e};var a=t.split("||");for(var i in a)if(a.hasOwnProperty(i)){var u=e._SimplifyNegation(a[i].trim()),l=u.split("&&");if(l.length>1)for(var s=0;s<l.length;++s){var o=e._SimplifyNegation(l[s].trim());if(!(n="true"!==o&&"false"!==o?"!"===o[0]?!r(o.substring(1)):r(o):"true"===o)){u="false";break}}if(n||"true"===u){n=!0;break}n="true"!==u&&"false"!==u?"!"===u[0]?!r(u.substring(1)):r(u):"true"===u}return n?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,function(e){return(e=e.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?e="false":"!false"===e&&(e="true"),e},e}();exports.AndOrNotEvaluator=e;
},{}],"4qpk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tags=void 0;var t=require("./andOrNotEvaluator"),a=function(){function a(){}return a.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return a.HasTags(t)},t.addTags=function(e){return a.AddTagsTo(t,e)},t.removeTags=function(e){return a.RemoveTagsFrom(t,e)},t.matchesTagsQuery=function(e){return a.MatchesQuery(t,e)}},a.DisableFor=function(t){delete t._tags,delete t.hasTags,delete t.addTags,delete t.removeTags,delete t.matchesTagsQuery},a.HasTags=function(t){if(!t._tags)return!1;var a=t._tags;for(var e in a)if(a.hasOwnProperty(e))return!0;return!1},a.GetTags=function(t,a){if(void 0===a&&(a=!0),!t._tags)return null;if(a){var e=[];for(var r in t._tags)t._tags.hasOwnProperty(r)&&!0===t._tags[r]&&e.push(r);return e.join(" ")}return t._tags},a.AddTagsTo=function(t,e){e&&("string"==typeof e&&e.split(" ").forEach(function(e,r,n){a._AddTagTo(t,e)}))},a._AddTagTo=function(t,e){""!==(e=e.trim())&&"true"!==e&&"false"!==e&&(e.match(/[\s]/)||e.match(/^([!]|([|]|[&]){2})/)||(a.EnableFor(t),t._tags[e]=!0))},a.RemoveTagsFrom=function(t,e){if(a.HasTags(t)){var r=e.split(" ");for(var n in r)a._RemoveTagFrom(t,r[n])}},a._RemoveTagFrom=function(t,a){delete t._tags[a]},a.MatchesQuery=function(e,r){return void 0===r||(""===r?a.HasTags(e):t.AndOrNotEvaluator.Eval(r,function(t){return a.HasTags(e)&&e._tags[t]}))},a}();exports.Tags=a;
},{"./andOrNotEvaluator":"6FXc"}],"TAUa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scalar=void 0;var n=function(){function n(){}return n.WithinEpsilon=function(n,r,t){void 0===t&&(t=1.401298e-45);var e=n-r;return-t<=e&&e<=t},n.ToHex=function(n){var r=n.toString(16);return n<=15?("0"+r).toUpperCase():r.toUpperCase()},n.Sign=function(n){return 0===(n=+n)||isNaN(n)?n:n>0?1:-1},n.Clamp=function(n,r,t){return void 0===r&&(r=0),void 0===t&&(t=1),Math.min(t,Math.max(r,n))},n.Log2=function(n){return Math.log(n)*Math.LOG2E},n.Repeat=function(n,r){return n-Math.floor(n/r)*r},n.Normalize=function(n,r,t){return(n-r)/(t-r)},n.Denormalize=function(n,r,t){return n*(t-r)+r},n.DeltaAngle=function(r,t){var e=n.Repeat(t-r,360);return e>180&&(e-=360),e},n.PingPong=function(r,t){var e=n.Repeat(r,2*t);return t-Math.abs(e-t)},n.SmoothStep=function(r,t,e){var o=n.Clamp(e);return t*(o=-2*o*o*o+3*o*o)+r*(1-o)},n.MoveTowards=function(r,t,e){return Math.abs(t-r)<=e?t:r+n.Sign(t-r)*e},n.MoveTowardsAngle=function(r,t,e){var o=n.DeltaAngle(r,t),a=0;return-e<o&&o<e?a=t:(t=r+o,a=n.MoveTowards(r,t,e)),a},n.Lerp=function(n,r,t){return n+(r-n)*t},n.LerpAngle=function(r,t,e){var o=n.Repeat(t-r,360);return o>180&&(o-=360),r+o*n.Clamp(e)},n.InverseLerp=function(r,t,e){return r!=t?n.Clamp((e-r)/(t-r)):0},n.Hermite=function(n,r,t,e,o){var a=o*o,u=o*a;return n*(2*u-3*a+1)+t*(-2*u+3*a)+r*(u-2*a+o)+e*(u-a)},n.RandomRange=function(n,r){return n===r?n:Math.random()*(r-n)+n},n.RangeToPercent=function(n,r,t){return(n-r)/(t-r)},n.PercentToRange=function(n,r,t){return(t-r)*n+r},n.NormalizeRadians=function(r){return r-=n.TwoPi*Math.floor((r+Math.PI)/n.TwoPi)},n.TwoPi=2*Math.PI,n}();exports.Scalar=n;
},{}],"tvfX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Epsilon=exports.ToLinearSpace=exports.ToGammaSpace=void 0;var e=1/2.2;exports.ToGammaSpace=e;var o=2.2;exports.ToLinearSpace=o;var r=.001;exports.Epsilon=r;
},{}],"6dOy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArrayTools=void 0;var r=function(){function r(){}return r.BuildArray=function(r,o){for(var e=[],t=0;t<r;++t)e.push(o());return e},r}();exports.ArrayTools=r;
},{}],"61Nx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TmpVectors=exports.Matrix=exports.Quaternion=exports.Vector4=exports.Vector3=exports.Vector2=void 0;var t=require("./math.scalar"),o=require("./math.constants"),r=require("../Misc/arrayTools"),i=require("../Misc/typeStore"),n=function(){function r(t,o){void 0===t&&(t=0),void 0===o&&(o=0),this.x=t,this.y=o}return r.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},r.prototype.getClassName=function(){return"Vector2"},r.prototype.getHashCode=function(){var t=0|this.x;return t=397*t^(0|this.y)},r.prototype.toArray=function(t,o){return void 0===o&&(o=0),t[o]=this.x,t[o+1]=this.y,this},r.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},r.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},r.prototype.copyFromFloats=function(t,o){return this.x=t,this.y=o,this},r.prototype.set=function(t,o){return this.copyFromFloats(t,o)},r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y)},r.prototype.addToRef=function(t,o){return o.x=this.x+t.x,o.y=this.y+t.y,this},r.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this},r.prototype.addVector3=function(t){return new r(this.x+t.x,this.y+t.y)},r.prototype.subtract=function(t){return new r(this.x-t.x,this.y-t.y)},r.prototype.subtractToRef=function(t,o){return o.x=this.x-t.x,o.y=this.y-t.y,this},r.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},r.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},r.prototype.multiply=function(t){return new r(this.x*t.x,this.y*t.y)},r.prototype.multiplyToRef=function(t,o){return o.x=this.x*t.x,o.y=this.y*t.y,this},r.prototype.multiplyByFloats=function(t,o){return new r(this.x*t,this.y*o)},r.prototype.divide=function(t){return new r(this.x/t.x,this.y/t.y)},r.prototype.divideToRef=function(t,o){return o.x=this.x/t.x,o.y=this.y/t.y,this},r.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},r.prototype.negate=function(){return new r(-this.x,-this.y)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},r.prototype.negateToRef=function(t){return t.copyFromFloats(-1*this.x,-1*this.y)},r.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},r.prototype.scale=function(t){var o=new r(0,0);return this.scaleToRef(t,o),o},r.prototype.scaleToRef=function(t,o){return o.x=this.x*t,o.y=this.y*t,this},r.prototype.scaleAndAddToRef=function(t,o){return o.x+=this.x*t,o.y+=this.y*t,this},r.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},r.prototype.equalsWithEpsilon=function(r,i){return void 0===i&&(i=o.Epsilon),r&&t.Scalar.WithinEpsilon(this.x,r.x,i)&&t.Scalar.WithinEpsilon(this.y,r.y,i)},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r.prototype.fract=function(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},r.prototype.normalize=function(){var t=this.length();return 0===t?this:(this.x/=t,this.y/=t,this)},r.prototype.clone=function(){return new r(this.x,this.y)},r.Zero=function(){return new r(0,0)},r.One=function(){return new r(1,1)},r.FromArray=function(t,o){return void 0===o&&(o=0),new r(t[o],t[o+1])},r.FromArrayToRef=function(t,o,r){r.x=t[o],r.y=t[o+1]},r.CatmullRom=function(t,o,i,n,e){var s=e*e,a=e*s;return new r(.5*(2*o.x+(-t.x+i.x)*e+(2*t.x-5*o.x+4*i.x-n.x)*s+(-t.x+3*o.x-3*i.x+n.x)*a),.5*(2*o.y+(-t.y+i.y)*e+(2*t.y-5*o.y+4*i.y-n.y)*s+(-t.y+3*o.y-3*i.y+n.y)*a))},r.Clamp=function(t,o,i){var n=t.x;n=(n=n>i.x?i.x:n)<o.x?o.x:n;var e=t.y;return new r(n,e=(e=e>i.y?i.y:e)<o.y?o.y:e)},r.Hermite=function(t,o,i,n,e){var s=e*e,a=e*s,u=2*a-3*s+1,h=-2*a+3*s,y=a-2*s+e,f=a-s;return new r(t.x*u+i.x*h+o.x*y+n.x*f,t.y*u+i.y*h+o.y*y+n.y*f)},r.Lerp=function(t,o,i){return new r(t.x+(o.x-t.x)*i,t.y+(o.y-t.y)*i)},r.Dot=function(t,o){return t.x*o.x+t.y*o.y},r.Normalize=function(t){var o=t.clone();return o.normalize(),o},r.Minimize=function(t,o){return new r(t.x<o.x?t.x:o.x,t.y<o.y?t.y:o.y)},r.Maximize=function(t,o){return new r(t.x>o.x?t.x:o.x,t.y>o.y?t.y:o.y)},r.Transform=function(t,o){var i=r.Zero();return r.TransformToRef(t,o,i),i},r.TransformToRef=function(t,o,r){var i=o.m,n=t.x*i[0]+t.y*i[4]+i[12],e=t.x*i[1]+t.y*i[5]+i[13];r.x=n,r.y=e},r.PointInTriangle=function(t,o,r,i){var n=.5*(-r.y*i.x+o.y*(-r.x+i.x)+o.x*(r.y-i.y)+r.x*i.y),e=n<0?-1:1,s=(o.y*i.x-o.x*i.y+(i.y-o.y)*t.x+(o.x-i.x)*t.y)*e,a=(o.x*r.y-o.y*r.x+(o.y-r.y)*t.x+(r.x-o.x)*t.y)*e;return s>0&&a>0&&s+a<2*n*e},r.Distance=function(t,o){return Math.sqrt(r.DistanceSquared(t,o))},r.DistanceSquared=function(t,o){var r=t.x-o.x,i=t.y-o.y;return r*r+i*i},r.Center=function(t,o){var r=t.add(o);return r.scaleInPlace(.5),r},r.DistanceOfPointFromSegment=function(t,o,i){var n=r.DistanceSquared(o,i);if(0===n)return r.Distance(t,o);var e=i.subtract(o),s=Math.max(0,Math.min(1,r.Dot(t.subtract(o),e)/n)),a=o.add(e.multiplyByFloats(s,s));return r.Distance(t,a)},r}();exports.Vector2=n;var e=function(){function r(t,o,r){void 0===t&&(t=0),void 0===o&&(o=0),void 0===r&&(r=0),this.x=t,this.y=o,this.z=r}return r.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},r.prototype.getClassName=function(){return"Vector3"},r.prototype.getHashCode=function(){var t=0|this.x;return t=397*(t=397*t^(0|this.y))^(0|this.z)},r.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},r.prototype.toArray=function(t,o){return void 0===o&&(o=0),t[o]=this.x,t[o+1]=this.y,t[o+2]=this.z,this},r.prototype.toQuaternion=function(){return a.RotationYawPitchRoll(this.y,this.x,this.z)},r.prototype.addInPlace=function(t){return this.addInPlaceFromFloats(t.x,t.y,t.z)},r.prototype.addInPlaceFromFloats=function(t,o,r){return this.x+=t,this.y+=o,this.z+=r,this},r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)},r.prototype.addToRef=function(t,o){return o.copyFromFloats(this.x+t.x,this.y+t.y,this.z+t.z)},r.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},r.prototype.subtract=function(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)},r.prototype.subtractToRef=function(t,o){return this.subtractFromFloatsToRef(t.x,t.y,t.z,o)},r.prototype.subtractFromFloats=function(t,o,i){return new r(this.x-t,this.y-o,this.z-i)},r.prototype.subtractFromFloatsToRef=function(t,o,r,i){return i.copyFromFloats(this.x-t,this.y-o,this.z-r)},r.prototype.negate=function(){return new r(-this.x,-this.y,-this.z)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},r.prototype.negateToRef=function(t){return t.copyFromFloats(-1*this.x,-1*this.y,-1*this.z)},r.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},r.prototype.scale=function(t){return new r(this.x*t,this.y*t,this.z*t)},r.prototype.scaleToRef=function(t,o){return o.copyFromFloats(this.x*t,this.y*t,this.z*t)},r.prototype.scaleAndAddToRef=function(t,o){return o.addInPlaceFromFloats(this.x*t,this.y*t,this.z*t)},r.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},r.prototype.equalsWithEpsilon=function(r,i){return void 0===i&&(i=o.Epsilon),r&&t.Scalar.WithinEpsilon(this.x,r.x,i)&&t.Scalar.WithinEpsilon(this.y,r.y,i)&&t.Scalar.WithinEpsilon(this.z,r.z,i)},r.prototype.equalsToFloats=function(t,o,r){return this.x===t&&this.y===o&&this.z===r},r.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},r.prototype.multiply=function(t){return this.multiplyByFloats(t.x,t.y,t.z)},r.prototype.multiplyToRef=function(t,o){return o.copyFromFloats(this.x*t.x,this.y*t.y,this.z*t.z)},r.prototype.multiplyByFloats=function(t,o,i){return new r(this.x*t,this.y*o,this.z*i)},r.prototype.divide=function(t){return new r(this.x/t.x,this.y/t.y,this.z/t.z)},r.prototype.divideToRef=function(t,o){return o.copyFromFloats(this.x/t.x,this.y/t.y,this.z/t.z)},r.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},r.prototype.minimizeInPlace=function(t){return this.minimizeInPlaceFromFloats(t.x,t.y,t.z)},r.prototype.maximizeInPlace=function(t){return this.maximizeInPlaceFromFloats(t.x,t.y,t.z)},r.prototype.minimizeInPlaceFromFloats=function(t,o,r){return t<this.x&&(this.x=t),o<this.y&&(this.y=o),r<this.z&&(this.z=r),this},r.prototype.maximizeInPlaceFromFloats=function(t,o,r){return t>this.x&&(this.x=t),o>this.y&&(this.y=o),r>this.z&&(this.z=r),this},r.prototype.isNonUniformWithinEpsilon=function(o){var r=Math.abs(this.x),i=Math.abs(this.y);if(!t.Scalar.WithinEpsilon(r,i,o))return!0;var n=Math.abs(this.z);return!t.Scalar.WithinEpsilon(r,n,o)||!t.Scalar.WithinEpsilon(i,n,o)},Object.defineProperty(r.prototype,"isNonUniform",{get:function(){var t=Math.abs(this.x),o=Math.abs(this.y);if(t!==o)return!0;var r=Math.abs(this.z);return t!==r||o!==r},enumerable:!0,configurable:!0}),r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},r.prototype.fract=function(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},r.prototype.normalize=function(){return this.normalizeFromLength(this.length())},r.prototype.reorderInPlace=function(t){var o=this;return"xyz"===(t=t.toLowerCase())?this:(h.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(r,i){o[r]=h.Vector3[0][t[i]]}),this)},r.prototype.rotateByQuaternionToRef=function(t,o){return t.toRotationMatrix(h.Matrix[0]),r.TransformCoordinatesToRef(this,h.Matrix[0],o),o},r.prototype.rotateByQuaternionAroundPointToRef=function(t,o,r){return this.subtractToRef(o,h.Vector3[0]),h.Vector3[0].rotateByQuaternionToRef(t,h.Vector3[0]),o.addToRef(h.Vector3[0],r),r},r.prototype.cross=function(t){return r.Cross(this,t)},r.prototype.normalizeFromLength=function(t){return 0===t||1===t?this:this.scaleInPlace(1/t)},r.prototype.normalizeToNew=function(){var t=new r(0,0,0);return this.normalizeToRef(t),t},r.prototype.normalizeToRef=function(t){var o=this.length();return 0===o||1===o?t.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/o,t)},r.prototype.clone=function(){return new r(this.x,this.y,this.z)},r.prototype.copyFrom=function(t){return this.copyFromFloats(t.x,t.y,t.z)},r.prototype.copyFromFloats=function(t,o,r){return this.x=t,this.y=o,this.z=r,this},r.prototype.set=function(t,o,r){return this.copyFromFloats(t,o,r)},r.prototype.setAll=function(t){return this.x=this.y=this.z=t,this},r.GetClipFactor=function(t,o,i,n){var e=r.Dot(t,i)-n;return e/(e-(r.Dot(o,i)-n))},r.GetAngleBetweenVectors=function(t,o,i){var n=t.normalizeToRef(h.Vector3[1]),e=o.normalizeToRef(h.Vector3[2]),s=r.Dot(n,e),a=h.Vector3[3];return r.CrossToRef(n,e,a),r.Dot(a,i)>0?Math.acos(s):-Math.acos(s)},r.FromArray=function(t,o){return void 0===o&&(o=0),new r(t[o],t[o+1],t[o+2])},r.FromFloatArray=function(t,o){return r.FromArray(t,o)},r.FromArrayToRef=function(t,o,r){r.x=t[o],r.y=t[o+1],r.z=t[o+2]},r.FromFloatArrayToRef=function(t,o,i){return r.FromArrayToRef(t,o,i)},r.FromFloatsToRef=function(t,o,r,i){i.copyFromFloats(t,o,r)},r.Zero=function(){return new r(0,0,0)},r.One=function(){return new r(1,1,1)},r.Up=function(){return new r(0,1,0)},Object.defineProperty(r,"UpReadOnly",{get:function(){return r._UpReadOnly},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ZeroReadOnly",{get:function(){return r._ZeroReadOnly},enumerable:!0,configurable:!0}),r.Down=function(){return new r(0,-1,0)},r.Forward=function(){return new r(0,0,1)},r.Backward=function(){return new r(0,0,-1)},r.Right=function(){return new r(1,0,0)},r.Left=function(){return new r(-1,0,0)},r.TransformCoordinates=function(t,o){var i=r.Zero();return r.TransformCoordinatesToRef(t,o,i),i},r.TransformCoordinatesToRef=function(t,o,i){r.TransformCoordinatesFromFloatsToRef(t.x,t.y,t.z,o,i)},r.TransformCoordinatesFromFloatsToRef=function(t,o,r,i,n){var e=i.m,s=t*e[0]+o*e[4]+r*e[8]+e[12],a=t*e[1]+o*e[5]+r*e[9]+e[13],u=t*e[2]+o*e[6]+r*e[10]+e[14],h=1/(t*e[3]+o*e[7]+r*e[11]+e[15]);n.x=s*h,n.y=a*h,n.z=u*h},r.TransformNormal=function(t,o){var i=r.Zero();return r.TransformNormalToRef(t,o,i),i},r.TransformNormalToRef=function(t,o,r){this.TransformNormalFromFloatsToRef(t.x,t.y,t.z,o,r)},r.TransformNormalFromFloatsToRef=function(t,o,r,i,n){var e=i.m;n.x=t*e[0]+o*e[4]+r*e[8],n.y=t*e[1]+o*e[5]+r*e[9],n.z=t*e[2]+o*e[6]+r*e[10]},r.CatmullRom=function(t,o,i,n,e){var s=e*e,a=e*s;return new r(.5*(2*o.x+(-t.x+i.x)*e+(2*t.x-5*o.x+4*i.x-n.x)*s+(-t.x+3*o.x-3*i.x+n.x)*a),.5*(2*o.y+(-t.y+i.y)*e+(2*t.y-5*o.y+4*i.y-n.y)*s+(-t.y+3*o.y-3*i.y+n.y)*a),.5*(2*o.z+(-t.z+i.z)*e+(2*t.z-5*o.z+4*i.z-n.z)*s+(-t.z+3*o.z-3*i.z+n.z)*a))},r.Clamp=function(t,o,i){var n=new r;return r.ClampToRef(t,o,i,n),n},r.ClampToRef=function(t,o,r,i){var n=t.x;n=(n=n>r.x?r.x:n)<o.x?o.x:n;var e=t.y;e=(e=e>r.y?r.y:e)<o.y?o.y:e;var s=t.z;s=(s=s>r.z?r.z:s)<o.z?o.z:s,i.copyFromFloats(n,e,s)},r.CheckExtends=function(t,o,r){o.minimizeInPlace(t),r.maximizeInPlace(t)},r.Hermite=function(t,o,i,n,e){var s=e*e,a=e*s,u=2*a-3*s+1,h=-2*a+3*s,y=a-2*s+e,f=a-s;return new r(t.x*u+i.x*h+o.x*y+n.x*f,t.y*u+i.y*h+o.y*y+n.y*f,t.z*u+i.z*h+o.z*y+n.z*f)},r.Lerp=function(t,o,i){var n=new r(0,0,0);return r.LerpToRef(t,o,i,n),n},r.LerpToRef=function(t,o,r,i){i.x=t.x+(o.x-t.x)*r,i.y=t.y+(o.y-t.y)*r,i.z=t.z+(o.z-t.z)*r},r.Dot=function(t,o){return t.x*o.x+t.y*o.y+t.z*o.z},r.Cross=function(t,o){var i=r.Zero();return r.CrossToRef(t,o,i),i},r.CrossToRef=function(t,o,r){var i=t.y*o.z-t.z*o.y,n=t.z*o.x-t.x*o.z,e=t.x*o.y-t.y*o.x;r.copyFromFloats(i,n,e)},r.Normalize=function(t){var o=r.Zero();return r.NormalizeToRef(t,o),o},r.NormalizeToRef=function(t,o){t.normalizeToRef(o)},r.Project=function(t,o,i,n){var e=n.width,s=n.height,a=n.x,y=n.y,f=h.Matrix[1];u.FromValuesToRef(e/2,0,0,0,0,-s/2,0,0,0,0,.5,0,a+e/2,s/2+y,.5,1,f);var c=h.Matrix[0];return o.multiplyToRef(i,c),c.multiplyToRef(f,c),r.TransformCoordinates(t,c)},r._UnprojectFromInvertedMatrixToRef=function(o,i,n){r.TransformCoordinatesToRef(o,i,n);var e=i.m,s=o.x*e[3]+o.y*e[7]+o.z*e[11]+e[15];t.Scalar.WithinEpsilon(s,1)&&n.scaleInPlace(1/s)},r.UnprojectFromTransform=function(t,o,i,n,e){var s=h.Matrix[0];n.multiplyToRef(e,s),s.invert(),t.x=t.x/o*2-1,t.y=-(t.y/i*2-1);var a=new r;return r._UnprojectFromInvertedMatrixToRef(t,s,a),a},r.Unproject=function(t,o,i,n,e,s){var a=r.Zero();return r.UnprojectToRef(t,o,i,n,e,s,a),a},r.UnprojectToRef=function(t,o,i,n,e,s,a){r.UnprojectFloatsToRef(t.x,t.y,t.z,o,i,n,e,s,a)},r.UnprojectFloatsToRef=function(t,o,i,n,e,s,a,u,y){var f=h.Matrix[0];s.multiplyToRef(a,f),f.multiplyToRef(u,f),f.invert();var c=h.Vector3[0];c.x=t/n*2-1,c.y=-(o/e*2-1),c.z=2*i-1,r._UnprojectFromInvertedMatrixToRef(c,f,y)},r.Minimize=function(t,o){var r=t.clone();return r.minimizeInPlace(o),r},r.Maximize=function(t,o){var r=t.clone();return r.maximizeInPlace(o),r},r.Distance=function(t,o){return Math.sqrt(r.DistanceSquared(t,o))},r.DistanceSquared=function(t,o){var r=t.x-o.x,i=t.y-o.y,n=t.z-o.z;return r*r+i*i+n*n},r.Center=function(t,o){var r=t.add(o);return r.scaleInPlace(.5),r},r.RotationFromAxis=function(t,o,i){var n=r.Zero();return r.RotationFromAxisToRef(t,o,i,n),n},r.RotationFromAxisToRef=function(t,o,r,i){var n=h.Quaternion[0];a.RotationQuaternionFromAxisToRef(t,o,r,n),n.toEulerAnglesToRef(i)},r._UpReadOnly=r.Up(),r._ZeroReadOnly=r.Zero(),r}();exports.Vector3=e;var s=function(){function r(t,o,r,i){this.x=t,this.y=o,this.z=r,this.w=i}return r.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},r.prototype.getClassName=function(){return"Vector4"},r.prototype.getHashCode=function(){var t=0|this.x;return t=397*(t=397*(t=397*t^(0|this.y))^(0|this.z))^(0|this.w)},r.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},r.prototype.toArray=function(t,o){return void 0===o&&(o=0),t[o]=this.x,t[o+1]=this.y,t[o+2]=this.z,t[o+3]=this.w,this},r.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},r.prototype.addToRef=function(t,o){return o.x=this.x+t.x,o.y=this.y+t.y,o.z=this.z+t.z,o.w=this.w+t.w,this},r.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},r.prototype.subtract=function(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},r.prototype.subtractToRef=function(t,o){return o.x=this.x-t.x,o.y=this.y-t.y,o.z=this.z-t.z,o.w=this.w-t.w,this},r.prototype.subtractFromFloats=function(t,o,i,n){return new r(this.x-t,this.y-o,this.z-i,this.w-n)},r.prototype.subtractFromFloatsToRef=function(t,o,r,i,n){return n.x=this.x-t,n.y=this.y-o,n.z=this.z-r,n.w=this.w-i,this},r.prototype.negate=function(){return new r(-this.x,-this.y,-this.z,-this.w)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},r.prototype.negateToRef=function(t){return t.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},r.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},r.prototype.scale=function(t){return new r(this.x*t,this.y*t,this.z*t,this.w*t)},r.prototype.scaleToRef=function(t,o){return o.x=this.x*t,o.y=this.y*t,o.z=this.z*t,o.w=this.w*t,this},r.prototype.scaleAndAddToRef=function(t,o){return o.x+=this.x*t,o.y+=this.y*t,o.z+=this.z*t,o.w+=this.w*t,this},r.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},r.prototype.equalsWithEpsilon=function(r,i){return void 0===i&&(i=o.Epsilon),r&&t.Scalar.WithinEpsilon(this.x,r.x,i)&&t.Scalar.WithinEpsilon(this.y,r.y,i)&&t.Scalar.WithinEpsilon(this.z,r.z,i)&&t.Scalar.WithinEpsilon(this.w,r.w,i)},r.prototype.equalsToFloats=function(t,o,r,i){return this.x===t&&this.y===o&&this.z===r&&this.w===i},r.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},r.prototype.multiply=function(t){return new r(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},r.prototype.multiplyToRef=function(t,o){return o.x=this.x*t.x,o.y=this.y*t.y,o.z=this.z*t.z,o.w=this.w*t.w,this},r.prototype.multiplyByFloats=function(t,o,i,n){return new r(this.x*t,this.y*o,this.z*i,this.w*n)},r.prototype.divide=function(t){return new r(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},r.prototype.divideToRef=function(t,o){return o.x=this.x/t.x,o.y=this.y/t.y,o.z=this.z/t.z,o.w=this.w/t.w,this},r.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},r.prototype.minimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},r.prototype.maximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},r.prototype.fract=function(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},r.prototype.normalize=function(){var t=this.length();return 0===t?this:this.scaleInPlace(1/t)},r.prototype.toVector3=function(){return new e(this.x,this.y,this.z)},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)},r.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},r.prototype.copyFromFloats=function(t,o,r,i){return this.x=t,this.y=o,this.z=r,this.w=i,this},r.prototype.set=function(t,o,r,i){return this.copyFromFloats(t,o,r,i)},r.prototype.setAll=function(t){return this.x=this.y=this.z=this.w=t,this},r.FromArray=function(t,o){return o||(o=0),new r(t[o],t[o+1],t[o+2],t[o+3])},r.FromArrayToRef=function(t,o,r){r.x=t[o],r.y=t[o+1],r.z=t[o+2],r.w=t[o+3]},r.FromFloatArrayToRef=function(t,o,i){r.FromArrayToRef(t,o,i)},r.FromFloatsToRef=function(t,o,r,i,n){n.x=t,n.y=o,n.z=r,n.w=i},r.Zero=function(){return new r(0,0,0,0)},r.One=function(){return new r(1,1,1,1)},r.Normalize=function(t){var o=r.Zero();return r.NormalizeToRef(t,o),o},r.NormalizeToRef=function(t,o){o.copyFrom(t),o.normalize()},r.Minimize=function(t,o){var r=t.clone();return r.minimizeInPlace(o),r},r.Maximize=function(t,o){var r=t.clone();return r.maximizeInPlace(o),r},r.Distance=function(t,o){return Math.sqrt(r.DistanceSquared(t,o))},r.DistanceSquared=function(t,o){var r=t.x-o.x,i=t.y-o.y,n=t.z-o.z,e=t.w-o.w;return r*r+i*i+n*n+e*e},r.Center=function(t,o){var r=t.add(o);return r.scaleInPlace(.5),r},r.TransformNormal=function(t,o){var i=r.Zero();return r.TransformNormalToRef(t,o,i),i},r.TransformNormalToRef=function(t,o,r){var i=o.m,n=t.x*i[0]+t.y*i[4]+t.z*i[8],e=t.x*i[1]+t.y*i[5]+t.z*i[9],s=t.x*i[2]+t.y*i[6]+t.z*i[10];r.x=n,r.y=e,r.z=s,r.w=t.w},r.TransformNormalFromFloatsToRef=function(t,o,r,i,n,e){var s=n.m;e.x=t*s[0]+o*s[4]+r*s[8],e.y=t*s[1]+o*s[5]+r*s[9],e.z=t*s[2]+o*s[6]+r*s[10],e.w=i},r.FromVector3=function(t,o){return void 0===o&&(o=0),new r(t.x,t.y,t.z,o)},r}();exports.Vector4=s;var a=function(){function r(t,o,r,i){void 0===t&&(t=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===i&&(i=1),this.x=t,this.y=o,this.z=r,this.w=i}return r.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},r.prototype.getClassName=function(){return"Quaternion"},r.prototype.getHashCode=function(){var t=0|this.x;return t=397*(t=397*(t=397*t^(0|this.y))^(0|this.z))^(0|this.w)},r.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},r.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},r.prototype.equalsWithEpsilon=function(r,i){return void 0===i&&(i=o.Epsilon),r&&t.Scalar.WithinEpsilon(this.x,r.x,i)&&t.Scalar.WithinEpsilon(this.y,r.y,i)&&t.Scalar.WithinEpsilon(this.z,r.z,i)&&t.Scalar.WithinEpsilon(this.w,r.w,i)},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)},r.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},r.prototype.copyFromFloats=function(t,o,r,i){return this.x=t,this.y=o,this.z=r,this.w=i,this},r.prototype.set=function(t,o,r,i){return this.copyFromFloats(t,o,r,i)},r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},r.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},r.prototype.subtract=function(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},r.prototype.scale=function(t){return new r(this.x*t,this.y*t,this.z*t,this.w*t)},r.prototype.scaleToRef=function(t,o){return o.x=this.x*t,o.y=this.y*t,o.z=this.z*t,o.w=this.w*t,this},r.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},r.prototype.scaleAndAddToRef=function(t,o){return o.x+=this.x*t,o.y+=this.y*t,o.z+=this.z*t,o.w+=this.w*t,this},r.prototype.multiply=function(t){var o=new r(0,0,0,1);return this.multiplyToRef(t,o),o},r.prototype.multiplyToRef=function(t,o){var r=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,i=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,n=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,e=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return o.copyFromFloats(r,i,n,e),this},r.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},r.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},r.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},r.prototype.conjugate=function(){return new r(-this.x,-this.y,-this.z,this.w)},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},r.prototype.normalize=function(){var t=this.length();if(0===t)return this;var o=1/t;return this.x*=o,this.y*=o,this.z*=o,this.w*=o,this},r.prototype.toEulerAngles=function(t){void 0===t&&(t="YZX");var o=e.Zero();return this.toEulerAnglesToRef(o),o},r.prototype.toEulerAnglesToRef=function(t){var o=this.z,r=this.x,i=this.y,n=this.w,e=n*n,s=o*o,a=r*r,u=i*i,h=i*o-r*n;return h<-.4999999?(t.y=2*Math.atan2(i,n),t.x=Math.PI/2,t.z=0):h>.4999999?(t.y=2*Math.atan2(i,n),t.x=-Math.PI/2,t.z=0):(t.z=Math.atan2(2*(r*i+o*n),-s-a+u+e),t.x=Math.asin(-2*(o*i-r*n)),t.y=Math.atan2(2*(o*r+i*n),s-a-u+e)),this},r.prototype.toRotationMatrix=function(t){return u.FromQuaternionToRef(this,t),this},r.prototype.fromRotationMatrix=function(t){return r.FromRotationMatrixToRef(t,this),this},r.FromRotationMatrix=function(t){var o=new r;return r.FromRotationMatrixToRef(t,o),o},r.FromRotationMatrixToRef=function(t,o){var r,i=t.m,n=i[0],e=i[4],s=i[8],a=i[1],u=i[5],h=i[9],y=i[2],f=i[6],c=i[10],p=n+u+c;p>0?(r=.5/Math.sqrt(p+1),o.w=.25/r,o.x=(f-h)*r,o.y=(s-y)*r,o.z=(a-e)*r):n>u&&n>c?(r=2*Math.sqrt(1+n-u-c),o.w=(f-h)/r,o.x=.25*r,o.y=(e+a)/r,o.z=(s+y)/r):u>c?(r=2*Math.sqrt(1+u-n-c),o.w=(s-y)/r,o.x=(e+a)/r,o.y=.25*r,o.z=(h+f)/r):(r=2*Math.sqrt(1+c-n-u),o.w=(a-e)/r,o.x=(s+y)/r,o.y=(h+f)/r,o.z=.25*r)},r.Dot=function(t,o){return t.x*o.x+t.y*o.y+t.z*o.z+t.w*o.w},r.AreClose=function(t,o){return r.Dot(t,o)>=0},r.Zero=function(){return new r(0,0,0,0)},r.Inverse=function(t){return new r(-t.x,-t.y,-t.z,t.w)},r.InverseToRef=function(t,o){return o.set(-t.x,-t.y,-t.z,t.w),o},r.Identity=function(){return new r(0,0,0,1)},r.IsIdentity=function(t){return t&&0===t.x&&0===t.y&&0===t.z&&1===t.w},r.RotationAxis=function(t,o){return r.RotationAxisToRef(t,o,new r)},r.RotationAxisToRef=function(t,o,r){var i=Math.sin(o/2);return t.normalize(),r.w=Math.cos(o/2),r.x=t.x*i,r.y=t.y*i,r.z=t.z*i,r},r.FromArray=function(t,o){return o||(o=0),new r(t[o],t[o+1],t[o+2],t[o+3])},r.FromEulerAngles=function(t,o,i){var n=new r;return r.RotationYawPitchRollToRef(o,t,i,n),n},r.FromEulerAnglesToRef=function(t,o,i,n){return r.RotationYawPitchRollToRef(o,t,i,n),n},r.FromEulerVector=function(t){var o=new r;return r.RotationYawPitchRollToRef(t.y,t.x,t.z,o),o},r.FromEulerVectorToRef=function(t,o){return r.RotationYawPitchRollToRef(t.y,t.x,t.z,o),o},r.RotationYawPitchRoll=function(t,o,i){var n=new r;return r.RotationYawPitchRollToRef(t,o,i,n),n},r.RotationYawPitchRollToRef=function(t,o,r,i){var n=.5*r,e=.5*o,s=.5*t,a=Math.sin(n),u=Math.cos(n),h=Math.sin(e),y=Math.cos(e),f=Math.sin(s),c=Math.cos(s);i.x=c*h*u+f*y*a,i.y=f*y*u-c*h*a,i.z=c*y*a-f*h*u,i.w=c*y*u+f*h*a},r.RotationAlphaBetaGamma=function(t,o,i){var n=new r;return r.RotationAlphaBetaGammaToRef(t,o,i,n),n},r.RotationAlphaBetaGammaToRef=function(t,o,r,i){var n=.5*(r+t),e=.5*(r-t),s=.5*o;i.x=Math.cos(e)*Math.sin(s),i.y=Math.sin(e)*Math.sin(s),i.z=Math.sin(n)*Math.cos(s),i.w=Math.cos(n)*Math.cos(s)},r.RotationQuaternionFromAxis=function(t,o,i){var n=new r(0,0,0,0);return r.RotationQuaternionFromAxisToRef(t,o,i,n),n},r.RotationQuaternionFromAxisToRef=function(t,o,i,n){var e=h.Matrix[0];u.FromXYZAxesToRef(t.normalize(),o.normalize(),i.normalize(),e),r.FromRotationMatrixToRef(e,n)},r.Slerp=function(t,o,i){var n=r.Identity();return r.SlerpToRef(t,o,i,n),n},r.SlerpToRef=function(t,o,r,i){var n,e,s=t.x*o.x+t.y*o.y+t.z*o.z+t.w*o.w,a=!1;if(s<0&&(a=!0,s=-s),s>.999999)e=1-r,n=a?-r:r;else{var u=Math.acos(s),h=1/Math.sin(u);e=Math.sin((1-r)*u)*h,n=a?-Math.sin(r*u)*h:Math.sin(r*u)*h}i.x=e*t.x+n*o.x,i.y=e*t.y+n*o.y,i.z=e*t.z+n*o.z,i.w=e*t.w+n*o.w},r.Hermite=function(t,o,i,n,e){var s=e*e,a=e*s,u=2*a-3*s+1,h=-2*a+3*s,y=a-2*s+e,f=a-s;return new r(t.x*u+i.x*h+o.x*y+n.x*f,t.y*u+i.y*h+o.y*y+n.y*f,t.z*u+i.z*h+o.z*y+n.z*f,t.w*u+i.w*h+o.w*y+n.w*f)},r}();exports.Quaternion=a;var u=function(){function t(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}return Object.defineProperty(t.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),t.prototype._markAsUpdated=function(){this.updateFlag=t._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},t.prototype._updateIdentityStatus=function(o,r,i,n){void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===n&&(n=!0),this.updateFlag=t._updateFlagSeed++,this._isIdentity=o,this._isIdentity3x2=o||i,this._isIdentityDirty=!this._isIdentity&&r,this._isIdentity3x2Dirty=!this._isIdentity3x2&&n},t.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var t=this._m;this._isIdentity=1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}return this._isIdentity},t.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]?this._isIdentity3x2=!1:0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},t.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var t=this._m,o=t[0],r=t[1],i=t[2],n=t[3],e=t[4],s=t[5],a=t[6],u=t[7],h=t[8],y=t[9],f=t[10],c=t[11],p=t[12],l=t[13],x=t[14],m=t[15],d=f*m-x*c,z=y*m-l*c,R=y*x-l*f,T=h*m-p*c,w=h*x-f*p,v=h*l-p*y;return o*+(s*d-a*z+u*R)+r*-(e*d-a*T+u*w)+i*+(e*z-s*T+u*v)+n*-(e*R-s*w+a*v)},t.prototype.toArray=function(){return this._m},t.prototype.asArray=function(){return this._m},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){return t.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},t.prototype.add=function(o){var r=new t;return this.addToRef(o,r),r},t.prototype.addToRef=function(t,o){for(var r=this._m,i=o._m,n=t.m,e=0;e<16;e++)i[e]=r[e]+n[e];return o._markAsUpdated(),this},t.prototype.addToSelf=function(t){for(var o=this._m,r=t.m,i=0;i<16;i++)o[i]+=r[i];return this._markAsUpdated(),this},t.prototype.invertToRef=function(o){if(!0===this._isIdentity)return t.IdentityToRef(o),this;var r=this._m,i=r[0],n=r[1],e=r[2],s=r[3],a=r[4],u=r[5],h=r[6],y=r[7],f=r[8],c=r[9],p=r[10],l=r[11],x=r[12],m=r[13],d=r[14],z=r[15],R=p*z-d*l,T=c*z-m*l,w=c*d-m*p,v=f*z-x*l,F=f*d-p*x,_=f*m-x*c,M=+(u*R-h*T+y*w),I=-(a*R-h*v+y*F),A=+(a*T-u*v+y*_),g=-(a*w-u*F+h*_),P=i*M+n*I+e*A+s*g;if(0===P)return o.copyFrom(this),this;var V=1/P,S=h*z-d*y,C=u*z-m*y,D=u*d-m*h,b=a*z-x*y,q=a*d-x*h,L=a*m-x*u,O=h*l-p*y,U=u*l-c*y,E=u*p-c*h,H=a*l-f*y,Z=a*p-f*h,k=a*c-f*u,B=-(n*R-e*T+s*w),N=+(i*R-e*v+s*F),Y=-(i*T-n*v+s*_),W=+(i*w-n*F+e*_),Q=+(n*S-e*C+s*D),j=-(i*S-e*b+s*q),X=+(i*C-n*b+s*L),G=-(i*D-n*q+e*L),J=-(n*O-e*U+s*E),K=+(i*O-e*H+s*Z),$=-(i*U-n*H+s*k),tt=+(i*E-n*Z+e*k);return t.FromValuesToRef(M*V,B*V,Q*V,J*V,I*V,N*V,j*V,K*V,A*V,Y*V,X*V,$*V,g*V,W*V,G*V,tt*V,o),this},t.prototype.addAtIndex=function(t,o){return this._m[t]+=o,this._markAsUpdated(),this},t.prototype.multiplyAtIndex=function(t,o){return this._m[t]*=o,this._markAsUpdated(),this},t.prototype.setTranslationFromFloats=function(t,o,r){return this._m[12]=t,this._m[13]=o,this._m[14]=r,this._markAsUpdated(),this},t.prototype.addTranslationFromFloats=function(t,o,r){return this._m[12]+=t,this._m[13]+=o,this._m[14]+=r,this._markAsUpdated(),this},t.prototype.setTranslation=function(t){return this.setTranslationFromFloats(t.x,t.y,t.z)},t.prototype.getTranslation=function(){return new e(this._m[12],this._m[13],this._m[14])},t.prototype.getTranslationToRef=function(t){return t.x=this._m[12],t.y=this._m[13],t.z=this._m[14],this},t.prototype.removeRotationAndScaling=function(){var o=this.m;return t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,o[12],o[13],o[14],o[15],this),this._updateIdentityStatus(0===o[12]&&0===o[13]&&0===o[14]&&1===o[15]),this},t.prototype.multiply=function(o){var r=new t;return this.multiplyToRef(o,r),r},t.prototype.copyFrom=function(t){t.copyToArray(this._m);var o=t;return this._updateIdentityStatus(o._isIdentity,o._isIdentityDirty,o._isIdentity3x2,o._isIdentity3x2Dirty),this},t.prototype.copyToArray=function(t,o){void 0===o&&(o=0);var r=this._m;return t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2],t[o+3]=r[3],t[o+4]=r[4],t[o+5]=r[5],t[o+6]=r[6],t[o+7]=r[7],t[o+8]=r[8],t[o+9]=r[9],t[o+10]=r[10],t[o+11]=r[11],t[o+12]=r[12],t[o+13]=r[13],t[o+14]=r[14],t[o+15]=r[15],this},t.prototype.multiplyToRef=function(t,o){return this._isIdentity?(o.copyFrom(t),this):t._isIdentity?(o.copyFrom(this),this):(this.multiplyToArray(t,o._m,0),o._markAsUpdated(),this)},t.prototype.multiplyToArray=function(t,o,r){var i=this._m,n=t.m,e=i[0],s=i[1],a=i[2],u=i[3],h=i[4],y=i[5],f=i[6],c=i[7],p=i[8],l=i[9],x=i[10],m=i[11],d=i[12],z=i[13],R=i[14],T=i[15],w=n[0],v=n[1],F=n[2],_=n[3],M=n[4],I=n[5],A=n[6],g=n[7],P=n[8],V=n[9],S=n[10],C=n[11],D=n[12],b=n[13],q=n[14],L=n[15];return o[r]=e*w+s*M+a*P+u*D,o[r+1]=e*v+s*I+a*V+u*b,o[r+2]=e*F+s*A+a*S+u*q,o[r+3]=e*_+s*g+a*C+u*L,o[r+4]=h*w+y*M+f*P+c*D,o[r+5]=h*v+y*I+f*V+c*b,o[r+6]=h*F+y*A+f*S+c*q,o[r+7]=h*_+y*g+f*C+c*L,o[r+8]=p*w+l*M+x*P+m*D,o[r+9]=p*v+l*I+x*V+m*b,o[r+10]=p*F+l*A+x*S+m*q,o[r+11]=p*_+l*g+x*C+m*L,o[r+12]=d*w+z*M+R*P+T*D,o[r+13]=d*v+z*I+R*V+T*b,o[r+14]=d*F+z*A+R*S+T*q,o[r+15]=d*_+z*g+R*C+T*L,this},t.prototype.equals=function(t){var o=t;if(!o)return!1;if((this._isIdentity||o._isIdentity)&&!this._isIdentityDirty&&!o._isIdentityDirty)return this._isIdentity&&o._isIdentity;var r=this.m,i=o.m;return r[0]===i[0]&&r[1]===i[1]&&r[2]===i[2]&&r[3]===i[3]&&r[4]===i[4]&&r[5]===i[5]&&r[6]===i[6]&&r[7]===i[7]&&r[8]===i[8]&&r[9]===i[9]&&r[10]===i[10]&&r[11]===i[11]&&r[12]===i[12]&&r[13]===i[13]&&r[14]===i[14]&&r[15]===i[15]},t.prototype.clone=function(){var o=new t;return o.copyFrom(this),o},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var t=0|this._m[0],o=1;o<16;o++)t=397*t^(0|this._m[o]);return t},t.prototype.decompose=function(o,r,i){if(this._isIdentity)return i&&i.setAll(0),o&&o.setAll(1),r&&r.copyFromFloats(0,0,0,1),!0;var n=this._m;if(i&&i.copyFromFloats(n[12],n[13],n[14]),(o=o||h.Vector3[0]).x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),o.y=Math.sqrt(n[4]*n[4]+n[5]*n[5]+n[6]*n[6]),o.z=Math.sqrt(n[8]*n[8]+n[9]*n[9]+n[10]*n[10]),this.determinant()<=0&&(o.y*=-1),0===o.x||0===o.y||0===o.z)return r&&r.copyFromFloats(0,0,0,1),!1;if(r){var e=1/o.x,s=1/o.y,u=1/o.z;t.FromValuesToRef(n[0]*e,n[1]*e,n[2]*e,0,n[4]*s,n[5]*s,n[6]*s,0,n[8]*u,n[9]*u,n[10]*u,0,0,0,0,1,h.Matrix[0]),a.FromRotationMatrixToRef(h.Matrix[0],r)}return!0},t.prototype.getRow=function(t){if(t<0||t>3)return null;var o=4*t;return new s(this._m[o+0],this._m[o+1],this._m[o+2],this._m[o+3])},t.prototype.setRow=function(t,o){return this.setRowFromFloats(t,o.x,o.y,o.z,o.w)},t.prototype.transpose=function(){return t.Transpose(this)},t.prototype.transposeToRef=function(o){return t.TransposeToRef(this,o),this},t.prototype.setRowFromFloats=function(t,o,r,i,n){if(t<0||t>3)return this;var e=4*t;return this._m[e+0]=o,this._m[e+1]=r,this._m[e+2]=i,this._m[e+3]=n,this._markAsUpdated(),this},t.prototype.scale=function(o){var r=new t;return this.scaleToRef(o,r),r},t.prototype.scaleToRef=function(t,o){for(var r=0;r<16;r++)o._m[r]=this._m[r]*t;return o._markAsUpdated(),this},t.prototype.scaleAndAddToRef=function(t,o){for(var r=0;r<16;r++)o._m[r]+=this._m[r]*t;return o._markAsUpdated(),this},t.prototype.toNormalMatrix=function(o){var r=h.Matrix[0];this.invertToRef(r),r.transposeToRef(o);var i=o._m;t.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,o)},t.prototype.getRotationMatrix=function(){var o=new t;return this.getRotationMatrixToRef(o),o},t.prototype.getRotationMatrixToRef=function(o){var r=h.Vector3[0];if(!this.decompose(r))return t.IdentityToRef(o),this;var i=this._m,n=1/r.x,e=1/r.y,s=1/r.z;return t.FromValuesToRef(i[0]*n,i[1]*n,i[2]*n,0,i[4]*e,i[5]*e,i[6]*e,0,i[8]*s,i[9]*s,i[10]*s,0,0,0,0,1,o),this},t.prototype.toggleModelMatrixHandInPlace=function(){var t=this._m;t[2]*=-1,t[6]*=-1,t[8]*=-1,t[9]*=-1,t[14]*=-1,this._markAsUpdated()},t.prototype.toggleProjectionMatrixHandInPlace=function(){var t=this._m;t[8]*=-1,t[9]*=-1,t[10]*=-1,t[11]*=-1,this._markAsUpdated()},t.FromArray=function(o,r){void 0===r&&(r=0);var i=new t;return t.FromArrayToRef(o,r,i),i},t.FromArrayToRef=function(t,o,r){for(var i=0;i<16;i++)r._m[i]=t[i+o];r._markAsUpdated()},t.FromFloat32ArrayToRefScaled=function(t,o,r,i){for(var n=0;n<16;n++)i._m[n]=t[n+o]*r;i._markAsUpdated()},Object.defineProperty(t,"IdentityReadOnly",{get:function(){return t._identityReadOnly},enumerable:!0,configurable:!0}),t.FromValuesToRef=function(t,o,r,i,n,e,s,a,u,h,y,f,c,p,l,x,m){var d=m._m;d[0]=t,d[1]=o,d[2]=r,d[3]=i,d[4]=n,d[5]=e,d[6]=s,d[7]=a,d[8]=u,d[9]=h,d[10]=y,d[11]=f,d[12]=c,d[13]=p,d[14]=l,d[15]=x,m._markAsUpdated()},t.FromValues=function(o,r,i,n,e,s,a,u,h,y,f,c,p,l,x,m){var d=new t,z=d._m;return z[0]=o,z[1]=r,z[2]=i,z[3]=n,z[4]=e,z[5]=s,z[6]=a,z[7]=u,z[8]=h,z[9]=y,z[10]=f,z[11]=c,z[12]=p,z[13]=l,z[14]=x,z[15]=m,d._markAsUpdated(),d},t.Compose=function(o,r,i){var n=new t;return t.ComposeToRef(o,r,i,n),n},t.ComposeToRef=function(t,o,r,i){var n=i._m,e=o.x,s=o.y,a=o.z,u=o.w,h=e+e,y=s+s,f=a+a,c=e*h,p=e*y,l=e*f,x=s*y,m=s*f,d=a*f,z=u*h,R=u*y,T=u*f,w=t.x,v=t.y,F=t.z;n[0]=(1-(x+d))*w,n[1]=(p+T)*w,n[2]=(l-R)*w,n[3]=0,n[4]=(p-T)*v,n[5]=(1-(c+d))*v,n[6]=(m+z)*v,n[7]=0,n[8]=(l+R)*F,n[9]=(m-z)*F,n[10]=(1-(c+x))*F,n[11]=0,n[12]=r.x,n[13]=r.y,n[14]=r.z,n[15]=1,i._markAsUpdated()},t.Identity=function(){var o=t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return o._updateIdentityStatus(!0),o},t.IdentityToRef=function(o){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,o),o._updateIdentityStatus(!0)},t.Zero=function(){var o=t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return o._updateIdentityStatus(!1),o},t.RotationX=function(o){var r=new t;return t.RotationXToRef(o,r),r},t.Invert=function(o){var r=new t;return o.invertToRef(r),r},t.RotationXToRef=function(o,r){var i=Math.sin(o),n=Math.cos(o);t.FromValuesToRef(1,0,0,0,0,n,i,0,0,-i,n,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},t.RotationY=function(o){var r=new t;return t.RotationYToRef(o,r),r},t.RotationYToRef=function(o,r){var i=Math.sin(o),n=Math.cos(o);t.FromValuesToRef(n,0,-i,0,0,1,0,0,i,0,n,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},t.RotationZ=function(o){var r=new t;return t.RotationZToRef(o,r),r},t.RotationZToRef=function(o,r){var i=Math.sin(o),n=Math.cos(o);t.FromValuesToRef(n,i,0,0,-i,n,0,0,0,0,1,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},t.RotationAxis=function(o,r){var i=new t;return t.RotationAxisToRef(o,r,i),i},t.RotationAxisToRef=function(t,o,r){var i=Math.sin(-o),n=Math.cos(-o),e=1-n;t.normalize();var s=r._m;s[0]=t.x*t.x*e+n,s[1]=t.x*t.y*e-t.z*i,s[2]=t.x*t.z*e+t.y*i,s[3]=0,s[4]=t.y*t.x*e+t.z*i,s[5]=t.y*t.y*e+n,s[6]=t.y*t.z*e-t.x*i,s[7]=0,s[8]=t.z*t.x*e-t.y*i,s[9]=t.z*t.y*e+t.x*i,s[10]=t.z*t.z*e+n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,r._markAsUpdated()},t.RotationAlignToRef=function(t,o,r){var i=e.Cross(o,t),n=e.Dot(o,t),s=1/(1+n),a=r._m;a[0]=i.x*i.x*s+n,a[1]=i.y*i.x*s-i.z,a[2]=i.z*i.x*s+i.y,a[3]=0,a[4]=i.x*i.y*s+i.z,a[5]=i.y*i.y*s+n,a[6]=i.z*i.y*s-i.x,a[7]=0,a[8]=i.x*i.z*s-i.y,a[9]=i.y*i.z*s+i.x,a[10]=i.z*i.z*s+n,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,r._markAsUpdated()},t.RotationYawPitchRoll=function(o,r,i){var n=new t;return t.RotationYawPitchRollToRef(o,r,i,n),n},t.RotationYawPitchRollToRef=function(t,o,r,i){a.RotationYawPitchRollToRef(t,o,r,h.Quaternion[0]),h.Quaternion[0].toRotationMatrix(i)},t.Scaling=function(o,r,i){var n=new t;return t.ScalingToRef(o,r,i,n),n},t.ScalingToRef=function(o,r,i,n){t.FromValuesToRef(o,0,0,0,0,r,0,0,0,0,i,0,0,0,0,1,n),n._updateIdentityStatus(1===o&&1===r&&1===i)},t.Translation=function(o,r,i){var n=new t;return t.TranslationToRef(o,r,i,n),n},t.TranslationToRef=function(o,r,i,n){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,o,r,i,1,n),n._updateIdentityStatus(0===o&&0===r&&0===i)},t.Lerp=function(o,r,i){var n=new t;return t.LerpToRef(o,r,i,n),n},t.LerpToRef=function(t,o,r,i){for(var n=i._m,e=t.m,s=o.m,a=0;a<16;a++)n[a]=e[a]*(1-r)+s[a]*r;i._markAsUpdated()},t.DecomposeLerp=function(o,r,i){var n=new t;return t.DecomposeLerpToRef(o,r,i,n),n},t.DecomposeLerpToRef=function(o,r,i,n){var s=h.Vector3[0],u=h.Quaternion[0],y=h.Vector3[1];o.decompose(s,u,y);var f=h.Vector3[2],c=h.Quaternion[1],p=h.Vector3[3];r.decompose(f,c,p);var l=h.Vector3[4];e.LerpToRef(s,f,i,l);var x=h.Quaternion[2];a.SlerpToRef(u,c,i,x);var m=h.Vector3[5];e.LerpToRef(y,p,i,m),t.ComposeToRef(l,x,m,n)},t.LookAtLH=function(o,r,i){var n=new t;return t.LookAtLHToRef(o,r,i,n),n},t.LookAtLHToRef=function(o,r,i,n){var s=h.Vector3[0],a=h.Vector3[1],u=h.Vector3[2];r.subtractToRef(o,u),u.normalize(),e.CrossToRef(i,u,s);var y=s.lengthSquared();0===y?s.x=1:s.normalizeFromLength(Math.sqrt(y)),e.CrossToRef(u,s,a),a.normalize();var f=-e.Dot(s,o),c=-e.Dot(a,o),p=-e.Dot(u,o);t.FromValuesToRef(s.x,a.x,u.x,0,s.y,a.y,u.y,0,s.z,a.z,u.z,0,f,c,p,1,n)},t.LookAtRH=function(o,r,i){var n=new t;return t.LookAtRHToRef(o,r,i,n),n},t.LookAtRHToRef=function(o,r,i,n){var s=h.Vector3[0],a=h.Vector3[1],u=h.Vector3[2];o.subtractToRef(r,u),u.normalize(),e.CrossToRef(i,u,s);var y=s.lengthSquared();0===y?s.x=1:s.normalizeFromLength(Math.sqrt(y)),e.CrossToRef(u,s,a),a.normalize();var f=-e.Dot(s,o),c=-e.Dot(a,o),p=-e.Dot(u,o);t.FromValuesToRef(s.x,a.x,u.x,0,s.y,a.y,u.y,0,s.z,a.z,u.z,0,f,c,p,1,n)},t.OrthoLH=function(o,r,i,n){var e=new t;return t.OrthoLHToRef(o,r,i,n,e),e},t.OrthoLHToRef=function(o,r,i,n,e){var s=2/o,a=2/r,u=2/(n-i),h=-(n+i)/(n-i);t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,u,0,0,0,h,1,e),e._updateIdentityStatus(1===s&&1===a&&1===u&&0===h)},t.OrthoOffCenterLH=function(o,r,i,n,e,s){var a=new t;return t.OrthoOffCenterLHToRef(o,r,i,n,e,s,a),a},t.OrthoOffCenterLHToRef=function(o,r,i,n,e,s,a){var u=2/(r-o),h=2/(n-i),y=2/(s-e),f=-(s+e)/(s-e),c=(o+r)/(o-r),p=(n+i)/(i-n);t.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,y,0,c,p,f,1,a),a._markAsUpdated()},t.OrthoOffCenterRH=function(o,r,i,n,e,s){var a=new t;return t.OrthoOffCenterRHToRef(o,r,i,n,e,s,a),a},t.OrthoOffCenterRHToRef=function(o,r,i,n,e,s,a){t.OrthoOffCenterLHToRef(o,r,i,n,e,s,a),a._m[10]*=-1},t.PerspectiveLH=function(o,r,i,n){var e=new t,s=2*i/o,a=2*i/r,u=(n+i)/(n-i),h=-2*n*i/(n-i);return t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,u,1,0,0,h,0,e),e._updateIdentityStatus(!1),e},t.PerspectiveFovLH=function(o,r,i,n){var e=new t;return t.PerspectiveFovLHToRef(o,r,i,n,e),e},t.PerspectiveFovLHToRef=function(o,r,i,n,e,s){void 0===s&&(s=!0);var a=i,u=n,h=1/Math.tan(.5*o),y=s?h/r:h,f=s?h:h*r,c=(u+a)/(u-a),p=-2*u*a/(u-a);t.FromValuesToRef(y,0,0,0,0,f,0,0,0,0,c,1,0,0,p,0,e),e._updateIdentityStatus(!1)},t.PerspectiveFovReverseLHToRef=function(o,r,i,n,e,s){void 0===s&&(s=!0);var a=1/Math.tan(.5*o),u=s?a/r:a,h=s?a:a*r;t.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,-i,1,0,0,1,0,e),e._updateIdentityStatus(!1)},t.PerspectiveFovRH=function(o,r,i,n){var e=new t;return t.PerspectiveFovRHToRef(o,r,i,n,e),e},t.PerspectiveFovRHToRef=function(o,r,i,n,e,s){void 0===s&&(s=!0);var a=i,u=n,h=1/Math.tan(.5*o),y=s?h/r:h,f=s?h:h*r,c=-(u+a)/(u-a),p=-2*u*a/(u-a);t.FromValuesToRef(y,0,0,0,0,f,0,0,0,0,c,-1,0,0,p,0,e),e._updateIdentityStatus(!1)},t.PerspectiveFovReverseRHToRef=function(o,r,i,n,e,s){void 0===s&&(s=!0);var a=1/Math.tan(.5*o),u=s?a/r:a,h=s?a:a*r;t.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,-i,-1,0,0,-1,0,e),e._updateIdentityStatus(!1)},t.PerspectiveFovWebVRToRef=function(t,o,r,i,n){void 0===n&&(n=!1);var e=n?-1:1,s=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),u=Math.tan(t.leftDegrees*Math.PI/180),h=Math.tan(t.rightDegrees*Math.PI/180),y=2/(u+h),f=2/(s+a),c=i._m;c[0]=y,c[1]=c[2]=c[3]=c[4]=0,c[5]=f,c[6]=c[7]=0,c[8]=(u-h)*y*.5,c[9]=-(s-a)*f*.5,c[10]=-r/(o-r),c[11]=1*e,c[12]=c[13]=c[15]=0,c[14]=-2*r*o/(r-o),i._markAsUpdated()},t.GetFinalMatrix=function(o,r,i,n,e,s){var a=o.width,u=o.height,y=o.x,f=o.y,c=t.FromValues(a/2,0,0,0,0,-u/2,0,0,0,0,s-e,0,y+a/2,u/2+f,e,1),p=h.Matrix[0];return r.multiplyToRef(i,p),p.multiplyToRef(n,p),p.multiply(c)},t.GetAsMatrix2x2=function(t){var o=t.m;return new Float32Array([o[0],o[1],o[4],o[5]])},t.GetAsMatrix3x3=function(t){var o=t.m;return new Float32Array([o[0],o[1],o[2],o[4],o[5],o[6],o[8],o[9],o[10]])},t.Transpose=function(o){var r=new t;return t.TransposeToRef(o,r),r},t.TransposeToRef=function(t,o){var r=o._m,i=t.m;r[0]=i[0],r[1]=i[4],r[2]=i[8],r[3]=i[12],r[4]=i[1],r[5]=i[5],r[6]=i[9],r[7]=i[13],r[8]=i[2],r[9]=i[6],r[10]=i[10],r[11]=i[14],r[12]=i[3],r[13]=i[7],r[14]=i[11],r[15]=i[15],o._updateIdentityStatus(t._isIdentity,t._isIdentityDirty)},t.Reflection=function(o){var r=new t;return t.ReflectionToRef(o,r),r},t.ReflectionToRef=function(o,r){o.normalize();var i=o.normal.x,n=o.normal.y,e=o.normal.z,s=-2*i,a=-2*n,u=-2*e;t.FromValuesToRef(s*i+1,a*i,u*i,0,s*n,a*n+1,u*n,0,s*e,a*e,u*e+1,0,s*o.d,a*o.d,u*o.d,1,r)},t.FromXYZAxesToRef=function(o,r,i,n){t.FromValuesToRef(o.x,o.y,o.z,0,r.x,r.y,r.z,0,i.x,i.y,i.z,0,0,0,0,1,n)},t.FromQuaternionToRef=function(t,o){var r=t.x*t.x,i=t.y*t.y,n=t.z*t.z,e=t.x*t.y,s=t.z*t.w,a=t.z*t.x,u=t.y*t.w,h=t.y*t.z,y=t.x*t.w;o._m[0]=1-2*(i+n),o._m[1]=2*(e+s),o._m[2]=2*(a-u),o._m[3]=0,o._m[4]=2*(e-s),o._m[5]=1-2*(n+r),o._m[6]=2*(h+y),o._m[7]=0,o._m[8]=2*(a+u),o._m[9]=2*(h-y),o._m[10]=1-2*(i+r),o._m[11]=0,o._m[12]=0,o._m[13]=0,o._m[14]=0,o._m[15]=1,o._markAsUpdated()},t._updateFlagSeed=0,t._identityReadOnly=t.Identity(),t}();exports.Matrix=u;var h=function(){function t(){}return t.Vector3=r.ArrayTools.BuildArray(6,e.Zero),t.Matrix=r.ArrayTools.BuildArray(2,u.Identity),t.Quaternion=r.ArrayTools.BuildArray(3,a.Zero),t}(),y=function(){function t(){}return t.Vector2=r.ArrayTools.BuildArray(3,n.Zero),t.Vector3=r.ArrayTools.BuildArray(13,e.Zero),t.Vector4=r.ArrayTools.BuildArray(3,s.Zero),t.Quaternion=r.ArrayTools.BuildArray(2,a.Zero),t.Matrix=r.ArrayTools.BuildArray(8,u.Identity),t}();exports.TmpVectors=y,i._TypeStore.RegisteredTypes["BABYLON.Vector2"]=n,i._TypeStore.RegisteredTypes["BABYLON.Vector3"]=e,i._TypeStore.RegisteredTypes["BABYLON.Vector4"]=s,i._TypeStore.RegisteredTypes["BABYLON.Matrix"]=u;
},{"./math.scalar":"TAUa","./math.constants":"tvfX","../Misc/arrayTools":"6dOy","../Misc/typeStore":"sm8f"}],"q3+m":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TmpColors=exports.Color4=exports.Color3=void 0;var t=require("./math.scalar"),r=require("./math.constants"),o=require("../Misc/arrayTools"),n=require("../Misc/typeStore"),e=function(){function o(t,r,o){void 0===t&&(t=0),void 0===r&&(r=0),void 0===o&&(o=0),this.r=t,this.g=r,this.b=o}return o.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},o.prototype.getClassName=function(){return"Color3"},o.prototype.getHashCode=function(){var t=255*this.r|0;return t=397*(t=397*t^(255*this.g|0))^(255*this.b|0)},o.prototype.toArray=function(t,r){return void 0===r&&(r=0),t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,this},o.prototype.toColor4=function(t){return void 0===t&&(t=1),new i(this.r,this.g,this.b,t)},o.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},o.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},o.prototype.multiply=function(t){return new o(this.r*t.r,this.g*t.g,this.b*t.b)},o.prototype.multiplyToRef=function(t,r){return r.r=this.r*t.r,r.g=this.g*t.g,r.b=this.b*t.b,this},o.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},o.prototype.equalsFloats=function(t,r,o){return this.r===t&&this.g===r&&this.b===o},o.prototype.scale=function(t){return new o(this.r*t,this.g*t,this.b*t)},o.prototype.scaleToRef=function(t,r){return r.r=this.r*t,r.g=this.g*t,r.b=this.b*t,this},o.prototype.scaleAndAddToRef=function(t,r){return r.r+=this.r*t,r.g+=this.g*t,r.b+=this.b*t,this},o.prototype.clampToRef=function(r,o,n){return void 0===r&&(r=0),void 0===o&&(o=1),n.r=t.Scalar.Clamp(this.r,r,o),n.g=t.Scalar.Clamp(this.g,r,o),n.b=t.Scalar.Clamp(this.b,r,o),this},o.prototype.add=function(t){return new o(this.r+t.r,this.g+t.g,this.b+t.b)},o.prototype.addToRef=function(t,r){return r.r=this.r+t.r,r.g=this.g+t.g,r.b=this.b+t.b,this},o.prototype.subtract=function(t){return new o(this.r-t.r,this.g-t.g,this.b-t.b)},o.prototype.subtractToRef=function(t,r){return r.r=this.r-t.r,r.g=this.g-t.g,r.b=this.b-t.b,this},o.prototype.clone=function(){return new o(this.r,this.g,this.b)},o.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},o.prototype.copyFromFloats=function(t,r,o){return this.r=t,this.g=r,this.b=o,this},o.prototype.set=function(t,r,o){return this.copyFromFloats(t,r,o)},o.prototype.toHexString=function(){var r=255*this.r|0,o=255*this.g|0,n=255*this.b|0;return"#"+t.Scalar.ToHex(r)+t.Scalar.ToHex(o)+t.Scalar.ToHex(n)},o.prototype.toLinearSpace=function(){var t=new o;return this.toLinearSpaceToRef(t),t},o.prototype.toHSV=function(){var t=new o;return this.toHSVToRef(t),t},o.prototype.toHSVToRef=function(t){var r=this.r,o=this.g,n=this.b,e=Math.max(r,o,n),i=Math.min(r,o,n),s=0,a=0,h=e,u=e-i;0!==e&&(a=u/e),e!=i&&(e==r?(s=(o-n)/u,o<n&&(s+=6)):e==o?s=(n-r)/u+2:e==n&&(s=(r-o)/u+4),s*=60),t.r=s,t.g=a,t.b=h},o.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,r.ToLinearSpace),t.g=Math.pow(this.g,r.ToLinearSpace),t.b=Math.pow(this.b,r.ToLinearSpace),this},o.prototype.toGammaSpace=function(){var t=new o;return this.toGammaSpaceToRef(t),t},o.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,r.ToGammaSpace),t.g=Math.pow(this.g,r.ToGammaSpace),t.b=Math.pow(this.b,r.ToGammaSpace),this},o.HSVtoRGBToRef=function(t,r,o,n){var e=o*r,i=t/60,s=e*(1-Math.abs(i%2-1)),a=0,h=0,u=0;i>=0&&i<=1?(a=e,h=s):i>=1&&i<=2?(a=s,h=e):i>=2&&i<=3?(h=e,u=s):i>=3&&i<=4?(h=s,u=e):i>=4&&i<=5?(a=s,u=e):i>=5&&i<=6&&(a=e,u=s);var p=o-e;n.set(a+p,h+p,u+p)},o.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new o(0,0,0);var r=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),e=parseInt(t.substring(5,7),16);return o.FromInts(r,n,e)},o.FromArray=function(t,r){return void 0===r&&(r=0),new o(t[r],t[r+1],t[r+2])},o.FromInts=function(t,r,n){return new o(t/255,r/255,n/255)},o.Lerp=function(t,r,n){var e=new o(0,0,0);return o.LerpToRef(t,r,n,e),e},o.LerpToRef=function(t,r,o,n){n.r=t.r+(r.r-t.r)*o,n.g=t.g+(r.g-t.g)*o,n.b=t.b+(r.b-t.b)*o},o.Red=function(){return new o(1,0,0)},o.Green=function(){return new o(0,1,0)},o.Blue=function(){return new o(0,0,1)},o.Black=function(){return new o(0,0,0)},Object.defineProperty(o,"BlackReadOnly",{get:function(){return o._BlackReadOnly},enumerable:!0,configurable:!0}),o.White=function(){return new o(1,1,1)},o.Purple=function(){return new o(.5,0,.5)},o.Magenta=function(){return new o(1,0,1)},o.Yellow=function(){return new o(1,1,0)},o.Gray=function(){return new o(.5,.5,.5)},o.Teal=function(){return new o(0,1,1)},o.Random=function(){return new o(Math.random(),Math.random(),Math.random())},o._BlackReadOnly=o.Black(),o}();exports.Color3=e;var i=function(){function o(t,r,o,n){void 0===t&&(t=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=1),this.r=t,this.g=r,this.b=o,this.a=n}return o.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},o.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},o.prototype.toArray=function(t,r){return void 0===r&&(r=0),t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,t[r+3]=this.a,this},o.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},o.prototype.add=function(t){return new o(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},o.prototype.subtract=function(t){return new o(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},o.prototype.subtractToRef=function(t,r){return r.r=this.r-t.r,r.g=this.g-t.g,r.b=this.b-t.b,r.a=this.a-t.a,this},o.prototype.scale=function(t){return new o(this.r*t,this.g*t,this.b*t,this.a*t)},o.prototype.scaleToRef=function(t,r){return r.r=this.r*t,r.g=this.g*t,r.b=this.b*t,r.a=this.a*t,this},o.prototype.scaleAndAddToRef=function(t,r){return r.r+=this.r*t,r.g+=this.g*t,r.b+=this.b*t,r.a+=this.a*t,this},o.prototype.clampToRef=function(r,o,n){return void 0===r&&(r=0),void 0===o&&(o=1),n.r=t.Scalar.Clamp(this.r,r,o),n.g=t.Scalar.Clamp(this.g,r,o),n.b=t.Scalar.Clamp(this.b,r,o),n.a=t.Scalar.Clamp(this.a,r,o),this},o.prototype.multiply=function(t){return new o(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},o.prototype.multiplyToRef=function(t,r){return r.r=this.r*t.r,r.g=this.g*t.g,r.b=this.b*t.b,r.a=this.a*t.a,r},o.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},o.prototype.getClassName=function(){return"Color4"},o.prototype.getHashCode=function(){var t=255*this.r|0;return t=397*(t=397*(t=397*t^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},o.prototype.clone=function(){return new o(this.r,this.g,this.b,this.a)},o.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},o.prototype.copyFromFloats=function(t,r,o,n){return this.r=t,this.g=r,this.b=o,this.a=n,this},o.prototype.set=function(t,r,o,n){return this.copyFromFloats(t,r,o,n)},o.prototype.toHexString=function(){var r=255*this.r|0,o=255*this.g|0,n=255*this.b|0,e=255*this.a|0;return"#"+t.Scalar.ToHex(r)+t.Scalar.ToHex(o)+t.Scalar.ToHex(n)+t.Scalar.ToHex(e)},o.prototype.toLinearSpace=function(){var t=new o;return this.toLinearSpaceToRef(t),t},o.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,r.ToLinearSpace),t.g=Math.pow(this.g,r.ToLinearSpace),t.b=Math.pow(this.b,r.ToLinearSpace),t.a=this.a,this},o.prototype.toGammaSpace=function(){var t=new o;return this.toGammaSpaceToRef(t),t},o.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,r.ToGammaSpace),t.g=Math.pow(this.g,r.ToGammaSpace),t.b=Math.pow(this.b,r.ToGammaSpace),t.a=this.a,this},o.FromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length)return new o(0,0,0,0);var r=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),e=parseInt(t.substring(5,7),16),i=parseInt(t.substring(7,9),16);return o.FromInts(r,n,e,i)},o.Lerp=function(t,r,n){var e=new o(0,0,0,0);return o.LerpToRef(t,r,n,e),e},o.LerpToRef=function(t,r,o,n){n.r=t.r+(r.r-t.r)*o,n.g=t.g+(r.g-t.g)*o,n.b=t.b+(r.b-t.b)*o,n.a=t.a+(r.a-t.a)*o},o.FromColor3=function(t,r){return void 0===r&&(r=1),new o(t.r,t.g,t.b,r)},o.FromArray=function(t,r){return void 0===r&&(r=0),new o(t[r],t[r+1],t[r+2],t[r+3])},o.FromInts=function(t,r,n,e){return new o(t/255,r/255,n/255,e/255)},o.CheckColors4=function(t,r){if(t.length===3*r){for(var o=[],n=0;n<t.length;n+=3){var e=n/3*4;o[e]=t[n],o[e+1]=t[n+1],o[e+2]=t[n+2],o[e+3]=1}return o}return t},o}();exports.Color4=i;var s=function(){function t(){}return t.Color3=o.ArrayTools.BuildArray(3,e.Black),t.Color4=o.ArrayTools.BuildArray(3,function(){return new i(0,0,0,0)}),t}();exports.TmpColors=s,n._TypeStore.RegisteredTypes["BABYLON.Color3"]=e,n._TypeStore.RegisteredTypes["BABYLON.Color4"]=i;
},{"./math.scalar":"TAUa","./math.constants":"tvfX","../Misc/arrayTools":"6dOy","../Misc/typeStore":"sm8f"}],"EVXT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.expandToProperty=f,exports.serialize=v,exports.serializeAsTexture=g,exports.serializeAsColor3=m,exports.serializeAsFresnelParameters=p,exports.serializeAsVector2=b,exports.serializeAsVector3=A,exports.serializeAsMeshReference=k,exports.serializeAsColorCurves=x,exports.serializeAsColor4=C,exports.serializeAsImageProcessingConfiguration=y,exports.serializeAsQuaternion=z,exports.serializeAsMatrix=T,exports.serializeAsCameraReference=d,exports.SerializationHelper=void 0;var e=require("../Misc/tags"),r=require("../Maths/math.vector"),a=require("./devTools"),s=require("../Maths/math.color"),t={},n={},o=function(r,a,s){var t=r();e.Tags&&e.Tags.AddTagsTo(t,a.tags);var n=c(t);for(var o in n){var i=n[o],u=a[o],l=i.type;if(null!=u&&"uniqueId"!==o)switch(l){case 0:case 6:case 11:t[o]=u;break;case 1:t[o]=s||u.isRenderTarget?u:u.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:t[o]=s?u:u.clone()}}return t};function i(e){var r=e.getClassName();return t[r]||(t[r]={}),t[r]}function c(e){var r=e.getClassName();if(n[r])return n[r];n[r]={};for(var a=n[r],s=e,o=r;o;){var i=t[o];for(var c in i)a[c]=i[c];var u=void 0,l=!1;do{if(!(u=Object.getPrototypeOf(s)).getClassName){l=!0;break}if(u.getClassName()!==o)break;s=u}while(u);if(l)break;o=u.getClassName(),s=u}return a}function u(e,r){return function(a,s){var t=i(a);t[s]||(t[s]={type:e,sourceName:r})}}function l(e,r){return void 0===r&&(r=null),function(a,s){var t=r||"_"+s;Object.defineProperty(a,s,{get:function(){return this[t]},set:function(r){this[t]!==r&&(this[t]=r,a[e].apply(this))},enumerable:!0,configurable:!0})}}function f(e,r){return void 0===r&&(r=null),l(e,r)}function v(e){return u(0,e)}function g(e){return u(1,e)}function m(e){return u(2,e)}function p(e){return u(3,e)}function b(e){return u(4,e)}function A(e){return u(5,e)}function k(e){return u(6,e)}function x(e){return u(7,e)}function C(e){return u(8,e)}function y(e){return u(9,e)}function z(e){return u(10,e)}function T(e){return u(12,e)}function d(e){return u(11,e)}var P=function(){function t(){}return t.AppendSerializedAnimations=function(e,r){if(e.animations){r.animations=[];for(var a=0;a<e.animations.length;a++){var s=e.animations[a];r.animations.push(s.serialize())}}},t.Serialize=function(r,a){a||(a={}),e.Tags&&(a.tags=e.Tags.GetTags(r));var s=c(r);for(var t in s){var n=s[t],o=n.sourceName||t,i=n.type,u=r[t];if(null!=u)switch(i){case 0:a[o]=u;break;case 1:a[o]=u.serialize();break;case 2:a[o]=u.asArray();break;case 3:a[o]=u.serialize();break;case 4:case 5:a[o]=u.asArray();break;case 6:a[o]=u.id;break;case 7:a[o]=u.serialize();break;case 8:a[o]=u.asArray();break;case 9:a[o]=u.serialize();break;case 10:a[o]=u.asArray();break;case 11:a[o]=u.id;case 12:a[o]=u.asArray()}}return a},t.Parse=function(a,n,o,i){void 0===i&&(i=null);var u=a();i||(i=""),e.Tags&&e.Tags.AddTagsTo(u,n.tags);var l=c(u);for(var f in l){var v=l[f],g=n[v.sourceName||f],m=v.type;if(null!=g){var p=u;switch(m){case 0:p[f]=g;break;case 1:o&&(p[f]=t._TextureParser(g,o,i));break;case 2:p[f]=s.Color3.FromArray(g);break;case 3:p[f]=t._FresnelParametersParser(g);break;case 4:p[f]=r.Vector2.FromArray(g);break;case 5:p[f]=r.Vector3.FromArray(g);break;case 6:o&&(p[f]=o.getLastMeshByID(g));break;case 7:p[f]=t._ColorCurvesParser(g);break;case 8:p[f]=s.Color4.FromArray(g);break;case 9:p[f]=t._ImageProcessingConfigurationParser(g);break;case 10:p[f]=r.Quaternion.FromArray(g);break;case 11:o&&(p[f]=o.getCameraByID(g));case 12:p[f]=r.Matrix.FromArray(g)}}}return u},t.Clone=function(e,r){return o(e,r,!1)},t.Instanciate=function(e,r){return o(e,r,!0)},t._ImageProcessingConfigurationParser=function(e){throw a._DevTools.WarnImport("ImageProcessingConfiguration")},t._FresnelParametersParser=function(e){throw a._DevTools.WarnImport("FresnelParameters")},t._ColorCurvesParser=function(e){throw a._DevTools.WarnImport("ColorCurves")},t._TextureParser=function(e,r,s){throw a._DevTools.WarnImport("Texture")},t}();exports.SerializationHelper=P;
},{"../Misc/tags":"4qpk","../Maths/math.vector":"61Nx","./devTools":"S9x9","../Maths/math.color":"q3+m"}],"mlkt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Node=void 0;var e=require("tslib"),t=require("./Maths/math.vector"),i=require("./Misc/decorators"),n=require("./Misc/observable"),r=require("./Engines/engineStore"),o=require("./Misc/devTools"),s=function(){function s(e,i){void 0===i&&(i=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=t.Matrix.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new n.Observable,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=i||r.EngineStore.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return s.AddNodeConstructor=function(e,t){this._NodeConstructors[e]=t},s.Construct=function(e,t,i,n){var r=this._NodeConstructors[e];return r?r(t,i,n):null},Object.defineProperty(s.prototype,"doNotSerialize",{get:function(){return!!this._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(e){this._doNotSerialize=e},enumerable:!0,configurable:!0}),s.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(s.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var i=this._parentNode._children.indexOf(this);-1!==i&&this._parentNode._children.splice(i,1),e||this._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),s.prototype._addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},s.prototype._removeFromSceneRootNodes=function(){if(-1!==this._sceneRootNodesIndex){var e=this._scene.rootNodes,t=e.length-1;e[this._sceneRootNodesIndex]=e[t],e[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(s.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),s.prototype.getClassName=function(){return"Node"},Object.defineProperty(s.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),s.prototype.getScene=function(){return this._scene},s.prototype.getEngine=function(){return this._scene.getEngine()},s.prototype.addBehavior=function(e,t){var i=this;return void 0===t&&(t=!1),-1!==this._behaviors.indexOf(e)?this:(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(function(){e.attach(i)}):e.attach(this),this._behaviors.push(e),this)},s.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t?this:(this._behaviors[t].detach(),this._behaviors.splice(t,1),this)},Object.defineProperty(s.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),s.prototype.getBehaviorByName=function(e){for(var t=0,i=this._behaviors;t<i.length;t++){var n=i[t];if(n.name===e)return n}return null},s.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},s.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(s.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),s.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},s.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},s.prototype._getActionManagerForTrigger=function(e,t){return void 0===t&&(t=!0),this.parent?this.parent._getActionManagerForTrigger(e,!1):null},s.prototype._updateCache=function(e){},s.prototype._isSynchronized=function(){return!0},s.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},s.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},s.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},s.prototype.isReady=function(e){return void 0===e&&(e=!1),this._isReady},s.prototype.isEnabled=function(e){return void 0===e&&(e=!0),!1===e?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},s.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(e){e._syncParentEnabledState()})},s.prototype.setEnabled=function(e){this._isEnabled=e,this._syncParentEnabledState()},s.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},s.prototype._getDescendants=function(e,t,i){if(void 0===t&&(t=!1),this._children)for(var n=0;n<this._children.length;n++){var r=this._children[n];i&&!i(r)||e.push(r),t||r._getDescendants(e,!1,i)}},s.prototype.getDescendants=function(e,t){var i=new Array;return this._getDescendants(i,e,t),i},s.prototype.getChildMeshes=function(e,t){var i=[];return this._getDescendants(i,e,function(e){return(!t||t(e))&&void 0!==e.cullingStrategy}),i},s.prototype.getChildren=function(e,t){return void 0===t&&(t=!0),this.getDescendants(t,e)},s.prototype._setReady=function(e){e!==this._isReady&&(e?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},s.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var i=this.animations[t];if(i.name===e)return i}return null},s.prototype.createAnimationRange=function(e,t,i){if(!this._ranges[e]){this._ranges[e]=s._AnimationRangeFactory(e,t,i);for(var n=0,r=this.animations.length;n<r;n++)this.animations[n]&&this.animations[n].createRange(e,t,i)}},s.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,n=this.animations.length;i<n;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null},s.prototype.getAnimationRange=function(e){return this._ranges[e]},s.prototype.getAnimationRanges=function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t},s.prototype.beginAnimation=function(e,t,i,n){var r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,i,n):null},s.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var i=this._ranges[t];if(i){var n={};n.name=t,n.from=i.from,n.to=i.to,e.push(n)}}return e},s.prototype.computeWorldMatrix=function(e){return this._worldMatrix||(this._worldMatrix=t.Matrix.Identity()),this._worldMatrix},s.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this._isDisposed=!0,!e)for(var i=0,n=this.getDescendants(!0);i<n.length;i++){n[i].dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var r=0,o=this._behaviors;r<o.length;r++){o[r].detach()}this._behaviors=[]},s.ParseAnimationRanges=function(e,t,i){if(t.ranges)for(var n=0;n<t.ranges.length;n++){var r=t.ranges[n];e.createAnimationRange(r.name,r.from,r.to)}},s.prototype.getHierarchyBoundingVectors=function(e,i){var n,r;void 0===e&&(e=!0),void 0===i&&(i=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);if(this.getBoundingInfo&&this.subMeshes){var o=this.getBoundingInfo();n=o.boundingBox.minimumWorld.clone(),r=o.boundingBox.maximumWorld.clone()}else n=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new t.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e)for(var s=0,a=this.getDescendants(!1);s<a.length;s++){var h=a[s];if(h.computeWorldMatrix(!0),(!i||i(h))&&h.getBoundingInfo&&0!==h.getTotalVertices()){var d=h.getBoundingInfo().boundingBox,c=d.minimumWorld,p=d.maximumWorld;t.Vector3.CheckExtends(c,n,r),t.Vector3.CheckExtends(p,n,r)}}return{min:n,max:r}},s._AnimationRangeFactory=function(e,t,i){throw o._DevTools.WarnImport("AnimationRange")},s._NodeConstructors={},(0,e.__decorate)([(0,i.serialize)()],s.prototype,"name",void 0),(0,e.__decorate)([(0,i.serialize)()],s.prototype,"id",void 0),(0,e.__decorate)([(0,i.serialize)()],s.prototype,"uniqueId",void 0),(0,e.__decorate)([(0,i.serialize)()],s.prototype,"state",void 0),(0,e.__decorate)([(0,i.serialize)()],s.prototype,"metadata",void 0),s}();exports.Node=s;
},{"tslib":"90Cu","./Maths/math.vector":"61Nx","./Misc/decorators":"EVXT","./Misc/observable":"vY1+","./Engines/engineStore":"cq+N","./Misc/devTools":"S9x9"}],"LzVa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Axis=exports.Space=void 0;var e,r=require("./math.vector");exports.Space=e,function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(e||(exports.Space=e={}));var t=function(){function e(){}return e.X=new r.Vector3(1,0,0),e.Y=new r.Vector3(0,1,0),e.Z=new r.Vector3(0,0,1),e}();exports.Axis=t;
},{"./math.vector":"61Nx"}],"03YA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TransformNode=void 0;var t=require("tslib"),i=require("../Misc/decorators"),o=require("../Misc/observable"),r=require("../Maths/math.vector"),e=require("../node"),n=require("../Maths/math.axis"),a=function(e){function a(t,i,n){void 0===i&&(i=null),void 0===n&&(n=!0);var s=e.call(this,t,i)||this;return s._forward=new r.Vector3(0,0,1),s._forwardInverted=new r.Vector3(0,0,-1),s._up=new r.Vector3(0,1,0),s._right=new r.Vector3(1,0,0),s._rightInverted=new r.Vector3(-1,0,0),s._position=r.Vector3.Zero(),s._rotation=r.Vector3.Zero(),s._rotationQuaternion=null,s._scaling=r.Vector3.One(),s._isDirty=!1,s._transformToBoneReferal=null,s._isAbsoluteSynced=!1,s._billboardMode=a.BILLBOARDMODE_NONE,s._preserveParentRotationForBillboard=!1,s.scalingDeterminant=1,s._infiniteDistance=!1,s.ignoreNonUniformScaling=!1,s.reIntegrateRotationIntoRotationQuaternion=!1,s._poseMatrix=null,s._localMatrix=r.Matrix.Zero(),s._usePivotMatrix=!1,s._absolutePosition=r.Vector3.Zero(),s._absoluteScaling=r.Vector3.Zero(),s._absoluteRotationQuaternion=r.Quaternion.Identity(),s._pivotMatrix=r.Matrix.Identity(),s._postMultiplyPivotMatrix=!1,s._isWorldMatrixFrozen=!1,s._indexInSceneTransformNodesArray=-1,s.onAfterWorldMatrixUpdateObservable=new o.Observable,s._nonUniformScaling=!1,n&&s.getScene().addTransformNode(s),s}return(0,t.__extends)(a,e),Object.defineProperty(a.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(t){this._billboardMode!==t&&(this._billboardMode=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(t){t!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(t){this._infiniteDistance!==t&&(this._infiniteDistance=t)},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(a.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scaling",{get:function(){return this._scaling},set:function(t){this._scaling=t,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(t){this._rotationQuaternion=t,t&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"forward",{get:function(){return r.Vector3.Normalize(r.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"up",{get:function(){return r.Vector3.Normalize(r.Vector3.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"right",{get:function(){return r.Vector3.Normalize(r.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),a.prototype.updatePoseMatrix=function(t){return this._poseMatrix?(this._poseMatrix.copyFrom(t),this):(this._poseMatrix=t.clone(),this)},a.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=r.Matrix.Identity()),this._poseMatrix},a.prototype._isSynchronized=function(){var t=this._cache;if(this.billboardMode!==t.billboardMode||this.billboardMode!==a.BILLBOARDMODE_NONE)return!1;if(t.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!t.position.equals(this._position))return!1;if(this._rotationQuaternion){if(!t.rotationQuaternion.equals(this._rotationQuaternion))return!1}else if(!t.rotation.equals(this._rotation))return!1;return!!t.scaling.equals(this._scaling)},a.prototype._initCache=function(){e.prototype._initCache.call(this);var t=this._cache;t.localMatrixUpdated=!1,t.position=r.Vector3.Zero(),t.scaling=r.Vector3.Zero(),t.rotation=r.Vector3.Zero(),t.rotationQuaternion=new r.Quaternion(0,0,0,0),t.billboardMode=-1,t.infiniteDistance=!1},a.prototype.markAsDirty=function(t){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(a.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!0,configurable:!0}),a.prototype.setPreTransformMatrix=function(t){return this.setPivotMatrix(t,!1)},a.prototype.setPivotMatrix=function(t,i){return void 0===i&&(i=!0),this._pivotMatrix.copyFrom(t),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=i,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=r.Matrix.Invert(this._pivotMatrix)),this},a.prototype.getPivotMatrix=function(){return this._pivotMatrix},a.prototype.instantiateHierarchy=function(t,i,o){void 0===t&&(t=null);var r=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);r&&o&&o(this,r);for(var e=0,n=this.getChildTransformNodes(!0);e<n.length;e++){n[e].instantiateHierarchy(r,i,o)}return r},a.prototype.freezeWorldMatrix=function(t){return void 0===t&&(t=null),t?this._worldMatrix=t:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},a.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(a.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),a.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},a.prototype.setAbsolutePosition=function(t){if(!t)return this;var i,o,e;if(void 0===t.x){if(arguments.length<3)return this;i=arguments[0],o=arguments[1],e=arguments[2]}else i=t.x,o=t.y,e=t.z;if(this.parent){var n=r.TmpVectors.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),r.Vector3.TransformCoordinatesFromFloatsToRef(i,o,e,n,this.position)}else this.position.x=i,this.position.y=o,this.position.z=e;return this},a.prototype.setPositionWithLocalVector=function(t){return this.computeWorldMatrix(),this.position=r.Vector3.TransformNormal(t,this._localMatrix),this},a.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=r.TmpVectors.Matrix[0];return this._localMatrix.invertToRef(t),r.Vector3.TransformNormal(this.position,t)},a.prototype.locallyTranslate=function(t){return this.computeWorldMatrix(!0),this.position=r.Vector3.TransformCoordinates(t,this._localMatrix),this},a.prototype.lookAt=function(t,i,o,e,s){void 0===i&&(i=0),void 0===o&&(o=0),void 0===e&&(e=0),void 0===s&&(s=n.Space.LOCAL);var l=a._lookAtVectorCache,c=s===n.Space.LOCAL?this.position:this.getAbsolutePosition();if(t.subtractToRef(c,l),this.setDirection(l,i,o,e),s===n.Space.WORLD&&this.parent)if(this.rotationQuaternion){var h=r.TmpVectors.Matrix[0];this.rotationQuaternion.toRotationMatrix(h);var p=r.TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(p),p.invert(),h.multiplyToRef(p,h),this.rotationQuaternion.fromRotationMatrix(h)}else{var u=r.TmpVectors.Quaternion[0];r.Quaternion.FromEulerVectorToRef(this.rotation,u);h=r.TmpVectors.Matrix[0];u.toRotationMatrix(h);p=r.TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(p),p.invert(),h.multiplyToRef(p,h),u.fromRotationMatrix(h),u.toEulerAnglesToRef(this.rotation)}return this},a.prototype.getDirection=function(t){var i=r.Vector3.Zero();return this.getDirectionToRef(t,i),i},a.prototype.getDirectionToRef=function(t,i){return r.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),i),this},a.prototype.setDirection=function(t,i,o,e){void 0===i&&(i=0),void 0===o&&(o=0),void 0===e&&(e=0);var n=-Math.atan2(t.z,t.x)+Math.PI/2,a=Math.sqrt(t.x*t.x+t.z*t.z),s=-Math.atan2(t.y,a);return this.rotationQuaternion?r.Quaternion.RotationYawPitchRollToRef(n+i,s+o,e,this.rotationQuaternion):(this.rotation.x=s+o,this.rotation.y=n+i,this.rotation.z=e),this},a.prototype.setPivotPoint=function(t,i){void 0===i&&(i=n.Space.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var o=this.getWorldMatrix();if(i==n.Space.WORLD){var e=r.TmpVectors.Matrix[0];o.invertToRef(e),t=r.Vector3.TransformCoordinates(t,e)}return this.setPivotMatrix(r.Matrix.Translation(-t.x,-t.y,-t.z),!0)},a.prototype.getPivotPoint=function(){var t=r.Vector3.Zero();return this.getPivotPointToRef(t),t},a.prototype.getPivotPointToRef=function(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this},a.prototype.getAbsolutePivotPoint=function(){var t=r.Vector3.Zero();return this.getAbsolutePivotPointToRef(t),t},a.prototype.getAbsolutePivotPointToRef=function(t){return t.x=this._pivotMatrix.m[12],t.y=this._pivotMatrix.m[13],t.z=this._pivotMatrix.m[14],this.getPivotPointToRef(t),r.Vector3.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this},a.prototype.setParent=function(t){if(!t&&!this.parent)return this;var i=r.TmpVectors.Quaternion[0],o=r.TmpVectors.Vector3[0],e=r.TmpVectors.Vector3[1];if(t){var n=r.TmpVectors.Matrix[0],a=r.TmpVectors.Matrix[1];this.computeWorldMatrix(!0),t.computeWorldMatrix(!0),t.getWorldMatrix().invertToRef(a),this.getWorldMatrix().multiplyToRef(a,n),n.decompose(e,i,o)}else this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(e,i,o);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(e),this.position.copyFrom(o),this.parent=t,this},Object.defineProperty(a.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),a.prototype._updateNonUniformScalingState=function(t){return this._nonUniformScaling!==t&&(this._nonUniformScaling=t,!0)},a.prototype.attachToBone=function(t,i){return this._transformToBoneReferal=i,this.parent=t,t.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},a.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},a.prototype.rotate=function(t,i,o){var e;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),o&&o!==n.Space.LOCAL){if(this.parent){var s=r.TmpVectors.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),t=r.Vector3.TransformNormal(t,s)}(e=r.Quaternion.RotationAxisToRef(t,i,a._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else e=r.Quaternion.RotationAxisToRef(t,i,a._rotationAxisCache),this.rotationQuaternion.multiplyToRef(e,this.rotationQuaternion);return this},a.prototype.rotateAround=function(t,i,o){i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=r.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var e=r.TmpVectors.Vector3[0],n=r.TmpVectors.Vector3[1],a=r.TmpVectors.Vector3[2],s=r.TmpVectors.Quaternion[0],l=r.TmpVectors.Matrix[0],c=r.TmpVectors.Matrix[1],h=r.TmpVectors.Matrix[2],p=r.TmpVectors.Matrix[3];return t.subtractToRef(this.position,e),r.Matrix.TranslationToRef(e.x,e.y,e.z,l),r.Matrix.TranslationToRef(-e.x,-e.y,-e.z,c),r.Matrix.RotationAxisToRef(i,o,h),c.multiplyToRef(h,p),p.multiplyToRef(l,p),p.decompose(n,s,a),this.position.addInPlace(a),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},a.prototype.translate=function(t,i,o){var r=t.scale(i);if(o&&o!==n.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(r));else{var e=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(e)}return this},a.prototype.addRotation=function(t,i,o){var e;this.rotationQuaternion?e=this.rotationQuaternion:(e=r.TmpVectors.Quaternion[1],r.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,e));var n=r.TmpVectors.Quaternion[0];return r.Quaternion.RotationYawPitchRollToRef(i,t,o,n),e.multiplyInPlace(n),this.rotationQuaternion||e.toEulerAnglesToRef(this.rotation),this},a.prototype._getEffectiveParent=function(){return this.parent},a.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var i=this.getScene().getRenderId();if(!this._isDirty&&!t&&this.isSynchronized())return this._currentRenderId=i,this._worldMatrix;var o=this.getScene().activeCamera,e=0!=(this._billboardMode&a.BILLBOARDMODE_USE_POSITION),n=this._billboardMode!==a.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;n&&o&&e&&(this.lookAt(o.position),(this.billboardMode&a.BILLBOARDMODE_X)!==a.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&a.BILLBOARDMODE_Y)!==a.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&a.BILLBOARDMODE_Z)!==a.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var s=this._cache;s.pivotMatrixUpdated=!1,s.billboardMode=this.billboardMode,s.infiniteDistance=this.infiniteDistance,this._currentRenderId=i,this._childUpdateId++,this._isDirty=!1;var l=this._getEffectiveParent(),c=s.scaling,h=s.position;if(this._infiniteDistance)if(!this.parent&&o){var p=o.getWorldMatrix(),u=new r.Vector3(p.m[12],p.m[13],p.m[14]);h.copyFromFloats(this._position.x+u.x,this._position.y+u.y,this._position.z+u.z)}else h.copyFrom(this._position);else h.copyFrom(this._position);c.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var d=s.rotationQuaternion;if(this._rotationQuaternion){if(this.reIntegrateRotationIntoRotationQuaternion)this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(r.Quaternion.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0));d.copyFrom(this._rotationQuaternion)}else r.Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,d),s.rotation.copyFrom(this._rotation);if(this._usePivotMatrix){var f=r.TmpVectors.Matrix[1];r.Matrix.ScalingToRef(c.x,c.y,c.z,f);var M=r.TmpVectors.Matrix[0];d.toRotationMatrix(M),this._pivotMatrix.multiplyToRef(f,r.TmpVectors.Matrix[4]),r.TmpVectors.Matrix[4].multiplyToRef(M,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(h.x,h.y,h.z)}else r.Matrix.ComposeToRef(c,d,h,this._localMatrix);if(l&&l.getWorldMatrix){if(t&&l.computeWorldMatrix(),n){this._transformToBoneReferal?l.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),r.TmpVectors.Matrix[7]):r.TmpVectors.Matrix[7].copyFrom(l.getWorldMatrix());var _=r.TmpVectors.Vector3[5],m=r.TmpVectors.Vector3[6];r.TmpVectors.Matrix[7].decompose(m,void 0,_),r.Matrix.ScalingToRef(m.x,m.y,m.z,r.TmpVectors.Matrix[7]),r.TmpVectors.Matrix[7].setTranslation(_),this._localMatrix.multiplyToRef(r.TmpVectors.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(l.getWorldMatrix(),r.TmpVectors.Matrix[6]),r.TmpVectors.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(l.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(n&&o&&this.billboardMode&&!e){var x=r.TmpVectors.Vector3[0];if(this._worldMatrix.getTranslationToRef(x),r.TmpVectors.Matrix[1].copyFrom(o.getViewMatrix()),r.TmpVectors.Matrix[1].setTranslationFromFloats(0,0,0),r.TmpVectors.Matrix[1].invertToRef(r.TmpVectors.Matrix[0]),(this.billboardMode&a.BILLBOARDMODE_ALL)!==a.BILLBOARDMODE_ALL){r.TmpVectors.Matrix[0].decompose(void 0,r.TmpVectors.Quaternion[0],void 0);var y=r.TmpVectors.Vector3[1];r.TmpVectors.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&a.BILLBOARDMODE_X)!==a.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&a.BILLBOARDMODE_Y)!==a.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&a.BILLBOARDMODE_Z)!==a.BILLBOARDMODE_Z&&(y.z=0),r.Matrix.RotationYawPitchRollToRef(y.y,y.x,y.z,r.TmpVectors.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(r.TmpVectors.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(r.TmpVectors.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniform?this._updateNonUniformScalingState(!0):l&&l._nonUniformScaling?this._updateNonUniformScalingState(l._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=r.Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},a.prototype.resetLocalMatrix=function(t){if(void 0===t&&(t=!0),this.computeWorldMatrix(),t)for(var i=this.getChildren(),o=0;o<i.length;++o){var e=i[o];if(e){e.computeWorldMatrix();var n=r.TmpVectors.Matrix[0];e._localMatrix.multiplyToRef(this._localMatrix,n);var a=r.TmpVectors.Quaternion[0];n.decompose(e.scaling,a,e.position),e.rotationQuaternion?e.rotationQuaternion=a:a.toEulerAnglesToRef(e.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=r.Quaternion.Identity()),this._worldMatrix=r.Matrix.Identity()},a.prototype._afterComputeWorldMatrix=function(){},a.prototype.registerAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this},a.prototype.unregisterAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this},a.prototype.getPositionInCameraSpace=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),r.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},a.prototype.getDistanceToCamera=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),this.absolutePosition.subtract(t.globalPosition).length()},a.prototype.clone=function(t,o,r){var e=this,n=i.SerializationHelper.Clone(function(){return new a(t,e.getScene())},this);if(n.name=t,n.id=t,o&&(n.parent=o),!r)for(var s=this.getDescendants(!0),l=0;l<s.length;l++){var c=s[l];c.clone&&c.clone(t+"."+c.name,n)}return n},a.prototype.serialize=function(t){var o=i.SerializationHelper.Serialize(this,t);return o.type=this.getClassName(),this.parent&&(o.parentId=this.parent.id),o.localMatrix=this.getPivotMatrix().asArray(),o.isEnabled=this.isEnabled(),this.parent&&(o.parentId=this.parent.id),o},a.Parse=function(t,o,e){var n=i.SerializationHelper.Parse(function(){return new a(t.name,o)},t,o,e);return t.localMatrix?n.setPreTransformMatrix(r.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&n.setPivotMatrix(r.Matrix.FromArray(t.pivotMatrix)),n.setEnabled(t.isEnabled),t.parentId&&(n._waitingParentId=t.parentId),n},a.prototype.getChildTransformNodes=function(t,i){var o=[];return this._getDescendants(o,t,function(t){return(!i||i(t))&&t instanceof a}),o},a.prototype.dispose=function(t,i){if(void 0===i&&(i=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),t)for(var o=0,r=this.getChildTransformNodes(!0);o<r.length;o++){var n=r[o];n.parent=null,n.computeWorldMatrix(!0)}e.prototype.dispose.call(this,t,i)},a.prototype.normalizeToUnitCube=function(t,i,o){void 0===t&&(t=!0),void 0===i&&(i=!1);var r=null,e=null;i&&(this.rotationQuaternion?(e=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(r=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var n=this.getHierarchyBoundingVectors(t,o),a=n.max.subtract(n.min),s=Math.max(a.x,a.y,a.z);if(0===s)return this;var l=1/s;return this.scaling.scaleInPlace(l),i&&(this.rotationQuaternion&&e?this.rotationQuaternion.copyFrom(e):this.rotation&&r&&this.rotation.copyFrom(r)),this},a.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},a.BILLBOARDMODE_NONE=0,a.BILLBOARDMODE_X=1,a.BILLBOARDMODE_Y=2,a.BILLBOARDMODE_Z=4,a.BILLBOARDMODE_ALL=7,a.BILLBOARDMODE_USE_POSITION=128,a._lookAtVectorCache=new r.Vector3(0,0,0),a._rotationAxisCache=new r.Quaternion,(0,t.__decorate)([(0,i.serializeAsVector3)("position")],a.prototype,"_position",void 0),(0,t.__decorate)([(0,i.serializeAsVector3)("rotation")],a.prototype,"_rotation",void 0),(0,t.__decorate)([(0,i.serializeAsQuaternion)("rotationQuaternion")],a.prototype,"_rotationQuaternion",void 0),(0,t.__decorate)([(0,i.serializeAsVector3)("scaling")],a.prototype,"_scaling",void 0),(0,t.__decorate)([(0,i.serialize)("billboardMode")],a.prototype,"_billboardMode",void 0),(0,t.__decorate)([(0,i.serialize)()],a.prototype,"scalingDeterminant",void 0),(0,t.__decorate)([(0,i.serialize)("infiniteDistance")],a.prototype,"_infiniteDistance",void 0),(0,t.__decorate)([(0,i.serialize)()],a.prototype,"ignoreNonUniformScaling",void 0),(0,t.__decorate)([(0,i.serialize)()],a.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),a}(e.Node);exports.TransformNode=a;
},{"tslib":"90Cu","../Misc/decorators":"EVXT","../Misc/observable":"vY1+","../Maths/math.vector":"61Nx","../node":"mlkt","../Maths/math.axis":"LzVa"}],"clDe":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VertexBuffer=exports.Buffer=void 0;var t=function(){function t(t,e,i,r,n,s,a,o){void 0===r&&(r=0),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=i,this._instanced=s,this._divisor=o||1,this._data=e,this.byteStride=a?r:r*Float32Array.BYTES_PER_ELEMENT,n||this.create()}return t.prototype.createVertexBuffer=function(t,i,r,n,s,a,o){void 0===a&&(a=!1);var f=a?i:i*Float32Array.BYTES_PER_ELEMENT,u=n?a?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new e(this._engine,this,t,this._updatable,!0,u,void 0===s?this._instanced:s,f,r,void 0,void 0,!0,this._divisor||o)},t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},t.prototype.create=function(t){void 0===t&&(t=null),!t&&this._buffer||(t=t||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t),this._data=t):this._buffer=this._engine.createVertexBuffer(t))},t.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},t.prototype.update=function(t){this.create(t)},t.prototype.updateDirectly=function(t,e,i,r){void 0===r&&(r=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,r?e:e*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},t}();exports.Buffer=t;var e=function(){function e(i,r,n,s,a,o,f,u,c,d,h,p,_){if(void 0===h&&(h=!1),void 0===p&&(p=!1),void 0===_&&(_=1),r instanceof t?(this._buffer=r,this._ownsBuffer=!1):(this._buffer=new t(i,r,s,o,a,f,p),this._ownsBuffer=!0),this._kind=n,null==d){var y=this.getData();this.type=e.FLOAT,y instanceof Int8Array?this.type=e.BYTE:y instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:y instanceof Int16Array?this.type=e.SHORT:y instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:y instanceof Int32Array?this.type=e.INT:y instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=d;var b=e.GetTypeByteLength(this.type);p?(this._size=c||(o?o/b:e.DeduceStride(n)),this.byteStride=o||this._buffer.byteStride||this._size*b,this.byteOffset=u||0):(this._size=c||o||e.DeduceStride(n),this.byteStride=o?o*b:this._buffer.byteStride||this._size*b,this.byteOffset=(u||0)*b),this.normalized=h,this._instanced=void 0!==f&&f,this._instanceDivisor=f?_:0}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(t){this._instanceDivisor=t,this._instanced=0!=t},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(){return this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(t){this._buffer.create(t)},e.prototype.update=function(t){this._buffer.update(t)},e.prototype.updateDirectly=function(t,e,i){void 0===i&&(i=!1),this._buffer.updateDirectly(t,e,void 0,i)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,i){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,i)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '"+t+"'")}},e.ForEach=function(t,i,r,n,s,a,o,f){if(t instanceof Array)for(var u=i/4,c=r/4,d=0;d<a;d+=n){for(var h=0;h<n;h++)f(t[u+h],d+h);u+=c}else{var p=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),_=e.GetTypeByteLength(s);for(d=0;d<a;d+=n){var y=i;for(h=0;h<n;h++){f(e._GetFloatValue(p,s,y,o),d+h),y+=_}i+=r}}},e._GetFloatValue=function(t,i,r,n){switch(i){case e.BYTE:var s=t.getInt8(r);return n&&(s=Math.max(s/127,-1)),s;case e.UNSIGNED_BYTE:s=t.getUint8(r);return n&&(s/=255),s;case e.SHORT:s=t.getInt16(r,!0);return n&&(s=Math.max(s/32767,-1)),s;case e.UNSIGNED_SHORT:s=t.getUint16(r,!0);return n&&(s/=65535),s;case e.INT:return t.getInt32(r,!0);case e.UNSIGNED_INT:return t.getUint32(r,!0);case e.FLOAT:return t.getFloat32(r,!0);default:throw new Error("Invalid component type "+i)}},e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}();exports.VertexBuffer=e;
},{}],"1A0K":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VertexData=void 0;var e=require("../Maths/math.vector"),t=require("../Meshes/buffer"),i=require("../Misc/devTools"),s=require("../Maths/math.color"),r=function(){function r(){}return r.prototype.set=function(e,i){switch(i){case t.VertexBuffer.PositionKind:this.positions=e;break;case t.VertexBuffer.NormalKind:this.normals=e;break;case t.VertexBuffer.TangentKind:this.tangents=e;break;case t.VertexBuffer.UVKind:this.uvs=e;break;case t.VertexBuffer.UV2Kind:this.uvs2=e;break;case t.VertexBuffer.UV3Kind:this.uvs3=e;break;case t.VertexBuffer.UV4Kind:this.uvs4=e;break;case t.VertexBuffer.UV5Kind:this.uvs5=e;break;case t.VertexBuffer.UV6Kind:this.uvs6=e;break;case t.VertexBuffer.ColorKind:this.colors=e;break;case t.VertexBuffer.MatricesIndicesKind:this.matricesIndices=e;break;case t.VertexBuffer.MatricesWeightsKind:this.matricesWeights=e;break;case t.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case t.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}},r.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},r.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},r.prototype.updateMesh=function(e){return this._update(e),this},r.prototype.updateGeometry=function(e){return this._update(e),this},r.prototype._applyTo=function(e,i){return void 0===i&&(i=!1),this.positions&&e.setVerticesData(t.VertexBuffer.PositionKind,this.positions,i),this.normals&&e.setVerticesData(t.VertexBuffer.NormalKind,this.normals,i),this.tangents&&e.setVerticesData(t.VertexBuffer.TangentKind,this.tangents,i),this.uvs&&e.setVerticesData(t.VertexBuffer.UVKind,this.uvs,i),this.uvs2&&e.setVerticesData(t.VertexBuffer.UV2Kind,this.uvs2,i),this.uvs3&&e.setVerticesData(t.VertexBuffer.UV3Kind,this.uvs3,i),this.uvs4&&e.setVerticesData(t.VertexBuffer.UV4Kind,this.uvs4,i),this.uvs5&&e.setVerticesData(t.VertexBuffer.UV5Kind,this.uvs5,i),this.uvs6&&e.setVerticesData(t.VertexBuffer.UV6Kind,this.uvs6,i),this.colors&&e.setVerticesData(t.VertexBuffer.ColorKind,this.colors,i),this.matricesIndices&&e.setVerticesData(t.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i),this.matricesWeights&&e.setVerticesData(t.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i),this.matricesIndicesExtra&&e.setVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i),this.matricesWeightsExtra&&e.setVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i),this.indices?e.setIndices(this.indices,null,i):e.setIndices([],null),this},r.prototype._update=function(e,i,s){return this.positions&&e.updateVerticesData(t.VertexBuffer.PositionKind,this.positions,i,s),this.normals&&e.updateVerticesData(t.VertexBuffer.NormalKind,this.normals,i,s),this.tangents&&e.updateVerticesData(t.VertexBuffer.TangentKind,this.tangents,i,s),this.uvs&&e.updateVerticesData(t.VertexBuffer.UVKind,this.uvs,i,s),this.uvs2&&e.updateVerticesData(t.VertexBuffer.UV2Kind,this.uvs2,i,s),this.uvs3&&e.updateVerticesData(t.VertexBuffer.UV3Kind,this.uvs3,i,s),this.uvs4&&e.updateVerticesData(t.VertexBuffer.UV4Kind,this.uvs4,i,s),this.uvs5&&e.updateVerticesData(t.VertexBuffer.UV5Kind,this.uvs5,i,s),this.uvs6&&e.updateVerticesData(t.VertexBuffer.UV6Kind,this.uvs6,i,s),this.colors&&e.updateVerticesData(t.VertexBuffer.ColorKind,this.colors,i,s),this.matricesIndices&&e.updateVerticesData(t.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i,s),this.matricesWeights&&e.updateVerticesData(t.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i,s),this.matricesIndicesExtra&&e.updateVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,s),this.matricesWeightsExtra&&e.updateVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,s),this.indices&&e.setIndices(this.indices,null),this},r.prototype.transform=function(t){var i,s=t.m[0]*t.m[5]*t.m[10]<0,r=e.Vector3.Zero();if(this.positions){var n=e.Vector3.Zero();for(i=0;i<this.positions.length;i+=3)e.Vector3.FromArrayToRef(this.positions,i,n),e.Vector3.TransformCoordinatesToRef(n,t,r),this.positions[i]=r.x,this.positions[i+1]=r.y,this.positions[i+2]=r.z}if(this.normals){var a=e.Vector3.Zero();for(i=0;i<this.normals.length;i+=3)e.Vector3.FromArrayToRef(this.normals,i,a),e.Vector3.TransformNormalToRef(a,t,r),this.normals[i]=r.x,this.normals[i+1]=r.y,this.normals[i+2]=r.z}if(this.tangents){var o=e.Vector4.Zero(),c=e.Vector4.Zero();for(i=0;i<this.tangents.length;i+=4)e.Vector4.FromArrayToRef(this.tangents,i,o),e.Vector4.TransformNormalToRef(o,t,c),this.tangents[i]=c.x,this.tangents[i+1]=c.y,this.tangents[i+2]=c.z,this.tangents[i+3]=c.w}if(s&&this.indices)for(i=0;i<this.indices.length;i+=3){var h=this.indices[i+1];this.indices[i+1]=this.indices[i+2],this.indices[i+2]=h}return this},r.prototype.merge=function(e,t){if(void 0===t&&(t=!1),this._validate(),e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(e.indices){this.indices||(this.indices=[]);var i=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var s=this.indices.length+e.indices.length,r=t||this.indices instanceof Uint32Array?new Uint32Array(s):new Uint16Array(s);r.set(this.indices);for(var n=this.indices.length,a=0;a<e.indices.length;a++)r[n+a]=e.indices[a]+i;this.indices=r}else for(a=0;a<e.indices.length;a++)this.indices.push(e.indices[a]+i)}return this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.tangents=this._mergeElement(this.tangents,e.tangents),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra),this},r.prototype._mergeElement=function(e,t){if(!e)return t;if(!t)return e;var i=t.length+e.length,s=e instanceof Float32Array,r=t instanceof Float32Array;if(s){var n=new Float32Array(i);return n.set(e),n.set(t,e.length),n}if(r){var a=e.slice(0),o=0;for(i=t.length;o<i;o++)a.push(t[o]);return a}return e.concat(t)},r.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var e=function(e,i){var s=t.VertexBuffer.DeduceStride(e);if(i.length%s!=0)throw new Error("The "+e+"s array count must be a multiple of "+s);return i.length/s},i=e(t.VertexBuffer.PositionKind,this.positions),s=function(t,s){var r=e(t,s);if(r!==i)throw new Error("The "+t+"s element count ("+r+") does not match the positions count ("+i+")")};this.normals&&s(t.VertexBuffer.NormalKind,this.normals),this.tangents&&s(t.VertexBuffer.TangentKind,this.tangents),this.uvs&&s(t.VertexBuffer.UVKind,this.uvs),this.uvs2&&s(t.VertexBuffer.UV2Kind,this.uvs2),this.uvs3&&s(t.VertexBuffer.UV3Kind,this.uvs3),this.uvs4&&s(t.VertexBuffer.UV4Kind,this.uvs4),this.uvs5&&s(t.VertexBuffer.UV5Kind,this.uvs5),this.uvs6&&s(t.VertexBuffer.UV6Kind,this.uvs6),this.colors&&s(t.VertexBuffer.ColorKind,this.colors),this.matricesIndices&&s(t.VertexBuffer.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&s(t.VertexBuffer.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&s(t.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&s(t.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra)},r.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},r.ExtractFromMesh=function(e,t,i){return r._ExtractFrom(e,t,i)},r.ExtractFromGeometry=function(e,t,i){return r._ExtractFrom(e,t,i)},r._ExtractFrom=function(e,i,s){var n=new r;return e.isVerticesDataPresent(t.VertexBuffer.PositionKind)&&(n.positions=e.getVerticesData(t.VertexBuffer.PositionKind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.NormalKind)&&(n.normals=e.getVerticesData(t.VertexBuffer.NormalKind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.TangentKind)&&(n.tangents=e.getVerticesData(t.VertexBuffer.TangentKind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(n.uvs=e.getVerticesData(t.VertexBuffer.UVKind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&(n.uvs2=e.getVerticesData(t.VertexBuffer.UV2Kind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.UV3Kind)&&(n.uvs3=e.getVerticesData(t.VertexBuffer.UV3Kind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.UV4Kind)&&(n.uvs4=e.getVerticesData(t.VertexBuffer.UV4Kind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.UV5Kind)&&(n.uvs5=e.getVerticesData(t.VertexBuffer.UV5Kind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.UV6Kind)&&(n.uvs6=e.getVerticesData(t.VertexBuffer.UV6Kind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.ColorKind)&&(n.colors=e.getVerticesData(t.VertexBuffer.ColorKind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind)&&(n.matricesIndices=e.getVerticesData(t.VertexBuffer.MatricesIndicesKind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind)&&(n.matricesWeights=e.getVerticesData(t.VertexBuffer.MatricesWeightsKind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesExtraKind)&&(n.matricesIndicesExtra=e.getVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,i,s)),e.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsExtraKind)&&(n.matricesWeightsExtra=e.getVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,i,s)),n.indices=e.getIndices(i,s),n},r.CreateRibbon=function(e){throw i._DevTools.WarnImport("ribbonBuilder")},r.CreateBox=function(e){throw i._DevTools.WarnImport("boxBuilder")},r.CreateTiledBox=function(e){throw i._DevTools.WarnImport("tiledBoxBuilder")},r.CreateTiledPlane=function(e){throw i._DevTools.WarnImport("tiledPlaneBuilder")},r.CreateSphere=function(e){throw i._DevTools.WarnImport("sphereBuilder")},r.CreateCylinder=function(e){throw i._DevTools.WarnImport("cylinderBuilder")},r.CreateTorus=function(e){throw i._DevTools.WarnImport("torusBuilder")},r.CreateLineSystem=function(e){throw i._DevTools.WarnImport("linesBuilder")},r.CreateDashedLines=function(e){throw i._DevTools.WarnImport("linesBuilder")},r.CreateGround=function(e){throw i._DevTools.WarnImport("groundBuilder")},r.CreateTiledGround=function(e){throw i._DevTools.WarnImport("groundBuilder")},r.CreateGroundFromHeightMap=function(e){throw i._DevTools.WarnImport("groundBuilder")},r.CreatePlane=function(e){throw i._DevTools.WarnImport("planeBuilder")},r.CreateDisc=function(e){throw i._DevTools.WarnImport("discBuilder")},r.CreatePolygon=function(e,t,s,r,n,a){throw i._DevTools.WarnImport("polygonBuilder")},r.CreateIcoSphere=function(e){throw i._DevTools.WarnImport("icoSphereBuilder")},r.CreatePolyhedron=function(e){throw i._DevTools.WarnImport("polyhedronBuilder")},r.CreateTorusKnot=function(e){throw i._DevTools.WarnImport("torusKnotBuilder")},r.ComputeNormals=function(t,i,s,r){var n=0,a=0,o=0,c=0,h=0,u=0,f=0,d=0,m=0,V=0,l=0,x=0,v=0,g=0,B=0,p=0,D=0,K=0,I=0,E=0,b=!1,W=!1,y=!1,P=!1,T=1,_=0,M=null;if(r&&(b=!!r.facetNormals,W=!!r.facetPositions,y=!!r.facetPartitioning,T=!0===r.useRightHandedSystem?-1:1,_=r.ratio||0,P=!!r.depthSort,M=r.distanceTo,P)){void 0===M&&(M=e.Vector3.Zero());var U=r.depthSortedFacets}var w=0,C=0,S=0,z=0;if(y&&r&&r.bbSize){var A=0,F=0,N=0,k=0,R=0,q=0,L=0,Z=0,G=0,O=0,H=0,Y=0,j=0,X=0,J=0,Q=0,$=r.bbSize.x>r.bbSize.y?r.bbSize.x:r.bbSize.y;$=$>r.bbSize.z?$:r.bbSize.z,w=r.subDiv.X*_/r.bbSize.x,C=r.subDiv.Y*_/r.bbSize.y,S=r.subDiv.Z*_/r.bbSize.z,z=r.subDiv.max*r.subDiv.max,r.facetPartitioning.length=0}for(n=0;n<t.length;n++)s[n]=0;var ee=i.length/3|0;for(n=0;n<ee;n++){if(v=(x=3*i[3*n])+1,g=x+2,p=(B=3*i[3*n+1])+1,D=B+2,I=(K=3*i[3*n+2])+1,E=K+2,a=t[x]-t[B],o=t[v]-t[p],c=t[g]-t[D],h=t[K]-t[B],u=t[I]-t[p],d=T*(o*(f=t[E]-t[D])-c*u),m=T*(c*h-a*f),V=T*(a*u-o*h),d/=l=0===(l=Math.sqrt(d*d+m*m+V*V))?1:l,m/=l,V/=l,b&&r&&(r.facetNormals[n].x=d,r.facetNormals[n].y=m,r.facetNormals[n].z=V),W&&r&&(r.facetPositions[n].x=(t[x]+t[B]+t[K])/3,r.facetPositions[n].y=(t[v]+t[p]+t[I])/3,r.facetPositions[n].z=(t[g]+t[D]+t[E])/3),y&&r&&(A=Math.floor((r.facetPositions[n].x-r.bInfo.minimum.x*_)*w),F=Math.floor((r.facetPositions[n].y-r.bInfo.minimum.y*_)*C),N=Math.floor((r.facetPositions[n].z-r.bInfo.minimum.z*_)*S),k=Math.floor((t[x]-r.bInfo.minimum.x*_)*w),R=Math.floor((t[v]-r.bInfo.minimum.y*_)*C),q=Math.floor((t[g]-r.bInfo.minimum.z*_)*S),L=Math.floor((t[B]-r.bInfo.minimum.x*_)*w),Z=Math.floor((t[p]-r.bInfo.minimum.y*_)*C),G=Math.floor((t[D]-r.bInfo.minimum.z*_)*S),O=Math.floor((t[K]-r.bInfo.minimum.x*_)*w),H=Math.floor((t[I]-r.bInfo.minimum.y*_)*C),Y=Math.floor((t[E]-r.bInfo.minimum.z*_)*S),X=k+r.subDiv.max*R+z*q,J=L+r.subDiv.max*Z+z*G,Q=O+r.subDiv.max*H+z*Y,j=A+r.subDiv.max*F+z*N,r.facetPartitioning[j]=r.facetPartitioning[j]?r.facetPartitioning[j]:new Array,r.facetPartitioning[X]=r.facetPartitioning[X]?r.facetPartitioning[X]:new Array,r.facetPartitioning[J]=r.facetPartitioning[J]?r.facetPartitioning[J]:new Array,r.facetPartitioning[Q]=r.facetPartitioning[Q]?r.facetPartitioning[Q]:new Array,r.facetPartitioning[X].push(n),J!=X&&r.facetPartitioning[J].push(n),Q!=J&&Q!=X&&r.facetPartitioning[Q].push(n),j!=X&&j!=J&&j!=Q&&r.facetPartitioning[j].push(n)),P&&r&&r.facetPositions){var te=U[n];te.ind=3*n,te.sqDistance=e.Vector3.DistanceSquared(r.facetPositions[n],M)}s[x]+=d,s[v]+=m,s[g]+=V,s[B]+=d,s[p]+=m,s[D]+=V,s[K]+=d,s[I]+=m,s[E]+=V}for(n=0;n<s.length/3;n++)d=s[3*n],m=s[3*n+1],V=s[3*n+2],d/=l=0===(l=Math.sqrt(d*d+m*m+V*V))?1:l,m/=l,V/=l,s[3*n]=d,s[3*n+1]=m,s[3*n+2]=V},r._ComputeSides=function(t,i,s,n,a,o,c){var h,u,f=s.length,d=n.length;switch(t=t||r.DEFAULTSIDE){case r.FRONTSIDE:break;case r.BACKSIDE:var m;for(h=0;h<f;h+=3)m=s[h],s[h]=s[h+2],s[h+2]=m;for(u=0;u<d;u++)n[u]=-n[u];break;case r.DOUBLESIDE:for(var V=i.length,l=V/3,x=0;x<V;x++)i[V+x]=i[x];for(h=0;h<f;h+=3)s[h+f]=s[h+2]+l,s[h+1+f]=s[h+1]+l,s[h+2+f]=s[h]+l;for(u=0;u<d;u++)n[d+u]=-n[u];var v=a.length,g=0;for(g=0;g<v;g++)a[g+v]=a[g];for(o=o||new e.Vector4(0,0,1,1),c=c||new e.Vector4(0,0,1,1),g=0,h=0;h<v/2;h++)a[g]=o.x+(o.z-o.x)*a[g],a[g+1]=o.y+(o.w-o.y)*a[g+1],a[g+v]=c.x+(c.z-c.x)*a[g+v],a[g+v+1]=c.y+(c.w-c.y)*a[g+v+1],g+=2}},r.ImportVertexData=function(e,i){var n=new r,a=e.positions;a&&n.set(a,t.VertexBuffer.PositionKind);var o=e.normals;o&&n.set(o,t.VertexBuffer.NormalKind);var c=e.tangents;c&&n.set(c,t.VertexBuffer.TangentKind);var h=e.uvs;h&&n.set(h,t.VertexBuffer.UVKind);var u=e.uv2s;u&&n.set(u,t.VertexBuffer.UV2Kind);var f=e.uv3s;f&&n.set(f,t.VertexBuffer.UV3Kind);var d=e.uv4s;d&&n.set(d,t.VertexBuffer.UV4Kind);var m=e.uv5s;m&&n.set(m,t.VertexBuffer.UV5Kind);var V=e.uv6s;V&&n.set(V,t.VertexBuffer.UV6Kind);var l=e.colors;l&&n.set(s.Color4.CheckColors4(l,a.length/3),t.VertexBuffer.ColorKind);var x=e.matricesIndices;x&&n.set(x,t.VertexBuffer.MatricesIndicesKind);var v=e.matricesWeights;v&&n.set(v,t.VertexBuffer.MatricesWeightsKind);var g=e.indices;g&&(n.indices=g),i.setAllVerticesData(n,e.updatable)},r.FRONTSIDE=0,r.BACKSIDE=1,r.DOUBLESIDE=2,r.DEFAULTSIDE=0,r}();exports.VertexData=r;
},{"../Maths/math.vector":"61Nx","../Meshes/buffer":"clDe","../Misc/devTools":"S9x9","../Maths/math.color":"q3+m"}],"lVfJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PickingInfo=void 0;var e=require("../Maths/math.vector"),t=require("../Meshes/buffer"),r=function(){function r(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return r.prototype.getNormal=function(r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(t.VertexBuffer.NormalKind))return null;var s,a=this.pickedMesh.getIndices();if(!a)return null;if(i){var c=this.pickedMesh.getVerticesData(t.VertexBuffer.NormalKind),o=e.Vector3.FromArray(c,3*a[3*this.faceId]),n=e.Vector3.FromArray(c,3*a[3*this.faceId+1]),h=e.Vector3.FromArray(c,3*a[3*this.faceId+2]);o=o.scale(this.bu),n=n.scale(this.bv),h=h.scale(1-this.bu-this.bv),s=new e.Vector3(o.x+n.x+h.x,o.y+n.y+h.y,o.z+n.z+h.z)}else{var u=this.pickedMesh.getVerticesData(t.VertexBuffer.PositionKind),d=e.Vector3.FromArray(u,3*a[3*this.faceId]),l=e.Vector3.FromArray(u,3*a[3*this.faceId+1]),f=e.Vector3.FromArray(u,3*a[3*this.faceId+2]),p=d.subtract(l),V=f.subtract(l);s=e.Vector3.Cross(p,V)}if(r){var m=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(e.TmpVectors.Matrix[0].copyFrom(m),(m=e.TmpVectors.Matrix[0]).setTranslationFromFloats(0,0,0),m.invert(),m.transposeToRef(e.TmpVectors.Matrix[1]),m=e.TmpVectors.Matrix[1]),s=e.Vector3.TransformNormal(s,m)}return s.normalize(),s},r.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(t.VertexBuffer.UVKind))return null;var r=this.pickedMesh.getIndices();if(!r)return null;var i=this.pickedMesh.getVerticesData(t.VertexBuffer.UVKind);if(!i)return null;var s=e.Vector2.FromArray(i,2*r[3*this.faceId]),a=e.Vector2.FromArray(i,2*r[3*this.faceId+1]),c=e.Vector2.FromArray(i,2*r[3*this.faceId+2]);return s=s.scale(this.bu),a=a.scale(this.bv),c=c.scale(1-this.bu-this.bv),new e.Vector2(s.x+a.x+c.x,s.y+a.y+c.y)},r}();exports.PickingInfo=r;
},{"../Maths/math.vector":"61Nx","../Meshes/buffer":"clDe"}],"41Vu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BoundingBox=void 0;var r=require("../Misc/arrayTools"),t=require("../Maths/math.vector"),o=require("../Maths/math.constants"),e=function(){function e(o,e,i){this.vectors=r.ArrayTools.BuildArray(8,t.Vector3.Zero),this.center=t.Vector3.Zero(),this.centerWorld=t.Vector3.Zero(),this.extendSize=t.Vector3.Zero(),this.extendSizeWorld=t.Vector3.Zero(),this.directions=r.ArrayTools.BuildArray(3,t.Vector3.Zero),this.vectorsWorld=r.ArrayTools.BuildArray(8,t.Vector3.Zero),this.minimumWorld=t.Vector3.Zero(),this.maximumWorld=t.Vector3.Zero(),this.minimum=t.Vector3.Zero(),this.maximum=t.Vector3.Zero(),this.reConstruct(o,e,i)}return e.prototype.reConstruct=function(r,o,e){var i=r.x,s=r.y,n=r.z,m=o.x,c=o.y,a=o.z,u=this.vectors;this.minimum.copyFromFloats(i,s,n),this.maximum.copyFromFloats(m,c,a),u[0].copyFromFloats(i,s,n),u[1].copyFromFloats(m,c,a),u[2].copyFromFloats(m,s,n),u[3].copyFromFloats(i,c,n),u[4].copyFromFloats(i,s,a),u[5].copyFromFloats(m,c,n),u[6].copyFromFloats(i,c,a),u[7].copyFromFloats(m,s,a),o.addToRef(r,this.center).scaleInPlace(.5),o.subtractToRef(r,this.extendSize).scaleInPlace(.5),this._worldMatrix=e||t.Matrix.IdentityReadOnly,this._update(this._worldMatrix)},e.prototype.scale=function(r){var t=e.TmpVector3,o=this.maximum.subtractToRef(this.minimum,t[0]),i=o.length();o.normalizeFromLength(i);var s=i*r,n=o.scaleInPlace(.5*s),m=this.center.subtractToRef(n,t[1]),c=this.center.addToRef(n,t[2]);return this.reConstruct(m,c,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(r){var o=this.minimumWorld,e=this.maximumWorld,i=this.directions,s=this.vectorsWorld,n=this.vectors;if(r.isIdentity()){o.copyFrom(this.minimum),e.copyFrom(this.maximum);for(m=0;m<8;++m)s[m].copyFrom(n[m]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{o.setAll(Number.MAX_VALUE),e.setAll(-Number.MAX_VALUE);for(var m=0;m<8;++m){var c=s[m];t.Vector3.TransformCoordinatesToRef(n[m],r,c),o.minimizeInPlace(c),e.maximizeInPlace(c)}e.subtractToRef(o,this.extendSizeWorld).scaleInPlace(.5),e.addToRef(o,this.centerWorld).scaleInPlace(.5)}t.Vector3.FromArrayToRef(r.m,0,i[0]),t.Vector3.FromArrayToRef(r.m,4,i[1]),t.Vector3.FromArrayToRef(r.m,8,i[2]),this._worldMatrix=r},e.prototype.isInFrustum=function(r){return e.IsInFrustum(this.vectorsWorld,r)},e.prototype.isCompletelyInFrustum=function(r){return e.IsCompletelyInFrustum(this.vectorsWorld,r)},e.prototype.intersectsPoint=function(r){var t=this.minimumWorld,e=this.maximumWorld,i=t.x,s=t.y,n=t.z,m=e.x,c=e.y,a=e.z,u=r.x,l=r.y,d=r.z,h=-o.Epsilon;return!(m-u<h||h>u-i)&&(!(c-l<h||h>l-s)&&!(a-d<h||h>d-n))},e.prototype.intersectsSphere=function(r){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,r.centerWorld,r.radiusWorld)},e.prototype.intersectsMinMax=function(r,t){var o=this.minimumWorld,e=this.maximumWorld,i=o.x,s=o.y,n=o.z,m=e.x,c=e.y,a=e.z,u=r.x,l=r.y,d=r.z,h=t.x,y=t.y,p=t.z;return!(m<u||i>h)&&(!(c<l||s>y)&&!(a<d||n>p))},e.Intersects=function(r,t){return r.intersectsMinMax(t.minimumWorld,t.maximumWorld)},e.IntersectsSphere=function(r,o,i,s){var n=e.TmpVector3[0];return t.Vector3.ClampToRef(i,r,o,n),t.Vector3.DistanceSquared(i,n)<=s*s},e.IsCompletelyInFrustum=function(r,t){for(var o=0;o<6;++o)for(var e=t[o],i=0;i<8;++i)if(e.dotCoordinate(r[i])<0)return!1;return!0},e.IsInFrustum=function(r,t){for(var o=0;o<6;++o){for(var e=!0,i=t[o],s=0;s<8;++s)if(i.dotCoordinate(r[s])>=0){e=!1;break}if(e)return!1}return!0},e.TmpVector3=r.ArrayTools.BuildArray(3,t.Vector3.Zero),e}();exports.BoundingBox=e;
},{"../Misc/arrayTools":"6dOy","../Maths/math.vector":"61Nx","../Maths/math.constants":"tvfX"}],"bD0+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BoundingSphere=void 0;var r=require("../Misc/arrayTools"),t=require("../Maths/math.vector"),e=function(){function e(r,e,o){this.center=t.Vector3.Zero(),this.centerWorld=t.Vector3.Zero(),this.minimum=t.Vector3.Zero(),this.maximum=t.Vector3.Zero(),this.reConstruct(r,e,o)}return e.prototype.reConstruct=function(r,e,o){this.minimum.copyFrom(r),this.maximum.copyFrom(e);var i=t.Vector3.Distance(r,e);e.addToRef(r,this.center).scaleInPlace(.5),this.radius=.5*i,this._update(o||t.Matrix.IdentityReadOnly)},e.prototype.scale=function(r){var t=this.radius*r,o=e.TmpVector3,i=o[0].setAll(t),s=this.center.subtractToRef(i,o[1]),n=this.center.addToRef(i,o[2]);return this.reConstruct(s,n,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(r){if(r.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{t.Vector3.TransformCoordinatesToRef(this.center,r,this.centerWorld);var o=e.TmpVector3[0];t.Vector3.TransformNormalFromFloatsToRef(1,1,1,r,o),this.radiusWorld=Math.max(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z))*this.radius}},e.prototype.isInFrustum=function(r){for(var t=this.centerWorld,e=this.radiusWorld,o=0;o<6;o++)if(r[o].dotCoordinate(t)<=-e)return!1;return!0},e.prototype.isCenterInFrustum=function(r){for(var t=this.centerWorld,e=0;e<6;e++)if(r[e].dotCoordinate(t)<0)return!1;return!0},e.prototype.intersectsPoint=function(r){var e=t.Vector3.DistanceSquared(this.centerWorld,r);return!(this.radiusWorld*this.radiusWorld<e)},e.Intersects=function(r,e){var o=t.Vector3.DistanceSquared(r.centerWorld,e.centerWorld),i=r.radiusWorld+e.radiusWorld;return!(i*i<o)},e.TmpVector3=r.ArrayTools.BuildArray(3,t.Vector3.Zero),e}();exports.BoundingSphere=e;
},{"../Misc/arrayTools":"6dOy","../Maths/math.vector":"61Nx"}],"j0r+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BoundingInfo=void 0;var e=require("../Misc/arrayTools"),t=require("../Maths/math.vector"),o=require("./boundingBox"),n=require("./boundingSphere"),i={min:0,max:0},r={min:0,max:0},s=function(e,o,n){var i=t.Vector3.Dot(o.centerWorld,e),r=Math.abs(t.Vector3.Dot(o.directions[0],e))*o.extendSize.x+Math.abs(t.Vector3.Dot(o.directions[1],e))*o.extendSize.y+Math.abs(t.Vector3.Dot(o.directions[2],e))*o.extendSize.z;n.min=i-r,n.max=i+r},u=function(e,t,o){return s(e,t,i),s(e,o,r),!(i.min>r.max||r.min>i.max)},c=function(){function i(e,t,i){this._isLocked=!1,this.boundingBox=new o.BoundingBox(e,t,i),this.boundingSphere=new n.BoundingSphere(e,t,i)}return i.prototype.reConstruct=function(e,t,o){this.boundingBox.reConstruct(e,t,o),this.boundingSphere.reConstruct(e,t,o)},Object.defineProperty(i.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!0,configurable:!0}),i.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},i.prototype.centerOn=function(e,t){var o=i.TmpVector3[0].copyFrom(e).subtractInPlace(t),n=i.TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(o,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(o,n,this.boundingBox.getWorldMatrix()),this},i.prototype.scale=function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this},i.prototype.isInFrustum=function(e,t){return void 0===t&&(t=0),!(2!==t&&3!==t||!this.boundingSphere.isCenterInFrustum(e))||!!this.boundingSphere.isInFrustum(e)&&(!(1!==t&&3!==t)||this.boundingBox.isInFrustum(e))},Object.defineProperty(i.prototype,"diagonalLength",{get:function(){var e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,i.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),i.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},i.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},i.prototype.intersectsPoint=function(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))},i.prototype.intersects=function(e,i){if(!n.BoundingSphere.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!o.BoundingBox.Intersects(this.boundingBox,e.boundingBox))return!1;if(!i)return!0;var r=this.boundingBox,s=e.boundingBox;return!!u(r.directions[0],r,s)&&(!!u(r.directions[1],r,s)&&(!!u(r.directions[2],r,s)&&(!!u(s.directions[0],r,s)&&(!!u(s.directions[1],r,s)&&(!!u(s.directions[2],r,s)&&(!!u(t.Vector3.Cross(r.directions[0],s.directions[0]),r,s)&&(!!u(t.Vector3.Cross(r.directions[0],s.directions[1]),r,s)&&(!!u(t.Vector3.Cross(r.directions[0],s.directions[2]),r,s)&&(!!u(t.Vector3.Cross(r.directions[1],s.directions[0]),r,s)&&(!!u(t.Vector3.Cross(r.directions[1],s.directions[1]),r,s)&&(!!u(t.Vector3.Cross(r.directions[1],s.directions[2]),r,s)&&(!!u(t.Vector3.Cross(r.directions[2],s.directions[0]),r,s)&&(!!u(t.Vector3.Cross(r.directions[2],s.directions[1]),r,s)&&!!u(t.Vector3.Cross(r.directions[2],s.directions[2]),r,s))))))))))))))},i.TmpVector3=e.ArrayTools.BuildArray(2,t.Vector3.Zero),i}();exports.BoundingInfo=c;
},{"../Misc/arrayTools":"6dOy","../Maths/math.vector":"61Nx","./boundingBox":"41Vu","./boundingSphere":"bD0+"}],"pQh1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._MeshCollisionData=void 0;var o=require("../Maths/math.vector"),i=function(){return function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._collider=null,this._oldPositionForCollisions=new o.Vector3(0,0,0),this._diffPositionForCollisions=new o.Vector3(0,0,0)}}();exports._MeshCollisionData=i;
},{"../Maths/math.vector":"61Nx"}],"WWKm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.extractMinAndMaxIndexed=r,exports.extractMinAndMax=m;var e=require("./math.vector");function r(r,m,x,n,u){void 0===u&&(u=null);for(var A=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),t=x;t<x+n;t++){var a=3*m[t],o=r[a],y=r[a+1],M=r[a+2];A.minimizeInPlaceFromFloats(o,y,M),i.maximizeInPlaceFromFloats(o,y,M)}return u&&(A.x-=A.x*u.x+u.y,A.y-=A.y*u.x+u.y,A.z-=A.z*u.x+u.y,i.x+=i.x*u.x+u.y,i.y+=i.y*u.x+u.y,i.z+=i.z*u.x+u.y),{minimum:A,maximum:i}}function m(r,m,x,n,u){void 0===n&&(n=null);var A=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);u||(u=3);for(var t=m,a=m*u;t<m+x;t++,a+=u){var o=r[a],y=r[a+1],M=r[a+2];A.minimizeInPlaceFromFloats(o,y,M),i.maximizeInPlaceFromFloats(o,y,M)}return n&&(A.x-=A.x*n.x+n.y,A.y-=A.y*n.x+n.y,A.z-=A.z*n.x+n.y,i.x+=i.x*n.x+n.y,i.y+=i.y*n.x+n.y,i.z+=i.z*n.x+n.y),{minimum:A,maximum:i}}
},{"./math.vector":"61Nx"}],"uine":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractMesh=void 0;var t=require("tslib"),e=require("../Misc/tools"),i=require("../Misc/observable"),r=require("../Maths/math.vector"),n=require("../Engines/engine"),o=require("../Meshes/buffer"),s=require("../Meshes/mesh.vertexData"),a=require("../Meshes/transformNode"),l=require("../Collisions/pickingInfo"),c=require("../Culling/boundingInfo"),h=require("../Collisions/meshCollisionData"),u=require("../Misc/devTools"),f=require("../Maths/math.functions"),d=require("../Maths/math.color"),p=require("../Maths/math.constants"),b=require("../Maths/math.axis"),g=function(){return function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=r.Vector3.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}(),_=function(){return function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new g,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1}}(),m=function(g){function m(t,e){void 0===e&&(e=null);var o=g.call(this,t,e,!1)||this;return o._internalAbstractMeshDataInfo=new _,o.cullingStrategy=m.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,o.onCollideObservable=new i.Observable,o.onCollisionPositionChangeObservable=new i.Observable,o.onMaterialChangedObservable=new i.Observable,o.definedFacingForward=!0,o._occlusionQuery=null,o._renderingGroup=null,o.alphaIndex=Number.MAX_VALUE,o.isVisible=!0,o.isPickable=!0,o.showSubMeshesBoundingBox=!1,o.isBlocker=!1,o.enablePointerMoveEvents=!1,o.renderingGroupId=0,o._material=null,o.outlineColor=d.Color3.Red(),o.outlineWidth=.02,o.overlayColor=d.Color3.Red(),o.overlayAlpha=.5,o.useOctreeForRenderingSelection=!0,o.useOctreeForPicking=!0,o.useOctreeForCollisions=!0,o.alwaysSelectAsActiveMesh=!1,o.doNotSyncBoundingInfo=!1,o.actionManager=null,o._meshCollisionData=new h._MeshCollisionData,o.ellipsoid=new r.Vector3(.5,1,.5),o.ellipsoidOffset=new r.Vector3(0,0,0),o.edgesWidth=1,o.edgesColor=new d.Color4(1,0,0,1),o._edgesRenderer=null,o._masterMesh=null,o._boundingInfo=null,o._renderId=0,o._intersectionsInProgress=new Array,o._unIndexed=!1,o._lightSources=new Array,o._waitingData={lods:null,actions:null,freezeWorldMatrix:null},o._bonesTransformMatrices=null,o._transformMatrixTexture=null,o.onRebuildObservable=new i.Observable,o._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null),e.subtractToRef(o._meshCollisionData._oldPositionForCollisions,o._meshCollisionData._diffPositionForCollisions),o._meshCollisionData._diffPositionForCollisions.length()>n.Engine.CollisionsEpsilon&&o.position.addInPlace(o._meshCollisionData._diffPositionForCollisions),i&&o.onCollideObservable.notifyObservers(i),o.onCollisionPositionChangeObservable.notifyObservers(o.position)},o.getScene().addMesh(o),o._resyncLightSources(),o}return(0,t.__extends)(m,g),Object.defineProperty(m,"BILLBOARDMODE_NONE",{get:function(){return a.TransformNode.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(m,"BILLBOARDMODE_X",{get:function(){return a.TransformNode.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(m,"BILLBOARDMODE_Y",{get:function(){return a.TransformNode.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(m,"BILLBOARDMODE_Z",{get:function(){return a.TransformNode.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(m,"BILLBOARDMODE_ALL",{get:function(){return a.TransformNode.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(m,"BILLBOARDMODE_USE_POSITION",{get:function(){return a.TransformNode.BILLBOARDMODE_USE_POSITION},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(t){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(t){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),m.prototype._updateNonUniformScalingState=function(t){return!!g.prototype._updateNonUniformScalingState.call(this,t)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(m.prototype,"onCollide",{set:function(t){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(t)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"onCollisionPositionChange",{set:function(t){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(t)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(t){this._internalAbstractMeshDataInfo._visibility!==t&&(this._internalAbstractMeshDataInfo._visibility=t,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"material",{get:function(){return this._material},set:function(t){this._material!==t&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(t){this._internalAbstractMeshDataInfo._receiveShadows!==t&&(this._internalAbstractMeshDataInfo._receiveShadows=t,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(t){this._internalAbstractMeshDataInfo._hasVertexAlpha!==t&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=t,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(t){this._internalAbstractMeshDataInfo._useVertexColors!==t&&(this._internalAbstractMeshDataInfo._useVertexColors=t,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(t){this._internalAbstractMeshDataInfo._numBoneInfluencers!==t&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=t,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(t){this._internalAbstractMeshDataInfo._applyFog!==t&&(this._internalAbstractMeshDataInfo._applyFog=t,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(t){t!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=t,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(t){this._meshCollisionData._collisionMask=isNaN(t)?-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(t){this._meshCollisionData._collisionGroup=isNaN(t)?-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(t){var e=this._internalAbstractMeshDataInfo._skeleton;e&&e.needInitialSkinMatrix&&e._unregisterMeshWithPoseMatrix(this),t&&t.needInitialSkinMatrix&&t._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=t,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),m.prototype.getClassName=function(){return"AbstractMesh"},m.prototype.toString=function(t){var e="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");e+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var i=this._internalAbstractMeshDataInfo._skeleton;return i&&(e+=", skeleton: "+i.name),t&&(e+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],e+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),e},m.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==a.TransformNode.BILLBOARDMODE_NONE?this._masterMesh:g.prototype._getEffectiveParent.call(this)},m.prototype._getActionManagerForTrigger=function(t,e){if(void 0===e&&(e=!0),this.actionManager&&(e||this.actionManager.isRecursive)){if(!t)return this.actionManager;if(this.actionManager.hasSpecificTrigger(t))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(t,!1):null},m.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var t=0,e=this.subMeshes;t<e.length;t++){e[t]._rebuild()}},m.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var t=0,e=this.getScene().lights;t<e.length;t++){var i=e[t];i.isEnabled()&&(i.canAffectMesh(this)&&this._lightSources.push(i))}this._markSubMeshesAsLightDirty()},m.prototype._resyncLightSource=function(t){var e=t.isEnabled()&&t.canAffectMesh(this),i=this._lightSources.indexOf(t);if(-1===i){if(!e)return;this._lightSources.push(t)}else{if(e)return;this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty()},m.prototype._unBindEffect=function(){for(var t=0,e=this.subMeshes;t<e.length;t++){e[t].setEffect(null)}},m.prototype._removeLightSource=function(t,e){var i=this._lightSources.indexOf(t);-1!==i&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(e))},m.prototype._markSubMeshesAsDirty=function(t){if(this.subMeshes)for(var e=0,i=this.subMeshes;e<i.length;e++){var r=i[e];r._materialDefines&&t(r._materialDefines)}},m.prototype._markSubMeshesAsLightDirty=function(t){void 0===t&&(t=!1),this._markSubMeshesAsDirty(function(e){return e.markAsLightDirty(t)})},m.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(t){return t.markAsAttributesDirty()})},m.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var t=0,e=this.subMeshes;t<e.length;t++){var i=e[t].getMaterial();i&&i.markAsDirty(16)}},Object.defineProperty(m.prototype,"scaling",{get:function(){return this._scaling},set:function(t){this._scaling=t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),m.prototype.getLOD=function(t){return this},m.prototype.getTotalVertices=function(){return 0},m.prototype.getTotalIndices=function(){return 0},m.prototype.getIndices=function(){return null},m.prototype.getVerticesData=function(t){return null},m.prototype.setVerticesData=function(t,e,i,r){return this},m.prototype.updateVerticesData=function(t,e,i,r){return this},m.prototype.setIndices=function(t,e){return this},m.prototype.isVerticesDataPresent=function(t){return!1},m.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},m.prototype.normalizeToUnitCube=function(t,e,i){return void 0===t&&(t=!0),void 0===e&&(e=!1),g.prototype.normalizeToUnitCube.call(this,t,e,i)},m.prototype.setBoundingInfo=function(t){return this._boundingInfo=t,this},Object.defineProperty(m.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(o.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(o.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),m.prototype._preActivate=function(){},m.prototype._preActivateForIntermediateRendering=function(t){},m.prototype._activate=function(t,e){return this._renderId=t,!0},m.prototype._postActivate=function(){},m.prototype._freeze=function(){},m.prototype._unFreeze=function(){},m.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===a.TransformNode.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():g.prototype.getWorldMatrix.call(this)},m.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():g.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(m.prototype,"isAnInstance",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"hasInstances",{get:function(){return!1},enumerable:!0,configurable:!0}),m.prototype.movePOV=function(t,e,i){return this.position.addInPlace(this.calcMovePOV(t,e,i)),this},m.prototype.calcMovePOV=function(t,e,i){var n=new r.Matrix;(this.rotationQuaternion?this.rotationQuaternion:r.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(n);var o=r.Vector3.Zero(),s=this.definedFacingForward?-1:1;return r.Vector3.TransformCoordinatesFromFloatsToRef(t*s,e,i*s,n,o),o},m.prototype.rotatePOV=function(t,e,i){return this.rotation.addInPlace(this.calcRotatePOV(t,e,i)),this},m.prototype.calcRotatePOV=function(t,e,i){var n=this.definedFacingForward?1:-1;return new r.Vector3(t*n,e,i*n)},m.prototype.refreshBoundingInfo=function(t){return void 0===t&&(t=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(t),null),this)},m.prototype._refreshBoundingInfo=function(t,e){if(t){var i=(0,f.extractMinAndMax)(t,0,this.getTotalVertices(),e);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new c.BoundingInfo(i.minimum,i.maximum)}if(this.subMeshes)for(var r=0;r<this.subMeshes.length;r++)this.subMeshes[r].refreshBoundingInfo(t);this._updateBoundingInfo()},m.prototype._getPositionData=function(t){var i=this.getVerticesData(o.VertexBuffer.PositionKind);if(i&&t&&this.skeleton){i=e.Tools.Slice(i),this._generatePointsArray();var n=this.getVerticesData(o.VertexBuffer.MatricesIndicesKind),s=this.getVerticesData(o.VertexBuffer.MatricesWeightsKind);if(s&&n){var a=this.numBoneInfluencers>4,l=a?this.getVerticesData(o.VertexBuffer.MatricesIndicesExtraKind):null,c=a?this.getVerticesData(o.VertexBuffer.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var h=this.skeleton.getTransformMatrices(this),u=r.TmpVectors.Vector3[0],f=r.TmpVectors.Matrix[0],d=r.TmpVectors.Matrix[1],p=0,b=0;b<i.length;b+=3,p+=4){var g,_;for(f.reset(),g=0;g<4;g++)(_=s[p+g])>0&&(r.Matrix.FromFloat32ArrayToRefScaled(h,Math.floor(16*n[p+g]),_,d),f.addToSelf(d));if(a)for(g=0;g<4;g++)(_=c[p+g])>0&&(r.Matrix.FromFloat32ArrayToRefScaled(h,Math.floor(16*l[p+g]),_,d),f.addToSelf(d));r.Vector3.TransformCoordinatesFromFloatsToRef(i[b],i[b+1],i[b+2],f,u),u.toArray(i,b),this._positions&&this._positions[b/3].copyFrom(u)}}}return i},m.prototype._updateBoundingInfo=function(){var t=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(t.worldMatrixFromCache):this._boundingInfo=new c.BoundingInfo(this.absolutePosition,this.absolutePosition,t.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(t.worldMatrixFromCache),this},m.prototype._updateSubMeshesBoundingInfo=function(t){if(!this.subMeshes)return this;for(var e=this.subMeshes.length,i=0;i<e;i++){var r=this.subMeshes[i];(e>1||!r.IsGlobal)&&r.updateBoundingInfo(t)}return this},m.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(m.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!0,configurable:!0}),m.prototype.isInFrustum=function(t){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(t,this.cullingStrategy)},m.prototype.isCompletelyInFrustum=function(t){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(t)},m.prototype.intersectsMesh=function(t,e,i){if(void 0===e&&(e=!1),!this._boundingInfo||!t._boundingInfo)return!1;if(this._boundingInfo.intersects(t._boundingInfo,e))return!0;if(i)for(var r=0,n=this.getChildMeshes();r<n.length;r++){if(n[r].intersectsMesh(t,e,!0))return!0}return!1},m.prototype.intersectsPoint=function(t){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(t)},Object.defineProperty(m.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(t){this._meshCollisionData._checkCollisions=t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!0,configurable:!0}),m.prototype.moveWithCollisions=function(t){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var e=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=e.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,e.getNewPosition(this._meshCollisionData._oldPositionForCollisions,t,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},m.prototype._collideForSubMesh=function(t,e,i){if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(e)){t._lastColliderTransformMatrix=e.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var n=t.verticesStart,o=t.verticesStart+t.verticesCount,s=n;s<o;s++)t._lastColliderWorldVertices.push(r.Vector3.TransformCoordinates(this._positions[s],e))}return i._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial(),this),this},m.prototype._processCollisionsForSubMeshes=function(t,e){for(var i=this._scene.getCollidingSubMeshCandidates(this,t),r=i.length,n=0;n<r;n++){var o=i.data[n];r>1&&!o._checkCollision(t)||this._collideForSubMesh(o,e,t)}return this},m.prototype._checkCollision=function(t){if(!this._boundingInfo||!this._boundingInfo._checkCollision(t))return this;var e=r.TmpVectors.Matrix[0],i=r.TmpVectors.Matrix[1];return r.Matrix.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,e),this.worldMatrixFromCache.multiplyToRef(e,i),this._processCollisionsForSubMeshes(t,i),this},m.prototype._generatePointsArray=function(){return!1},m.prototype.intersects=function(t,e,i){var n=new l.PickingInfo,o="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,s=this._boundingInfo;if(!(this.subMeshes&&s&&t.intersectsSphere(s.boundingSphere,o)&&t.intersectsBox(s.boundingBox,o)))return n;if(!this._generatePointsArray())return n;for(var a=null,c=this._scene.getIntersectingSubMeshCandidates(this,t),h=c.length,u=0;u<h;u++){var f=c.data[u];if(!(h>1)||f.canIntersects(t)){var d=f.intersects(t,this._positions,this.getIndices(),e,i);if(d&&(e||!a||d.distance<a.distance)&&((a=d).subMeshId=u,e))break}}if(a){var p=this.getWorldMatrix(),b=r.TmpVectors.Vector3[0],g=r.TmpVectors.Vector3[1];r.Vector3.TransformCoordinatesToRef(t.origin,p,b),t.direction.scaleToRef(a.distance,g);var _=r.Vector3.TransformNormal(g,p).addInPlace(b);return n.hit=!0,n.distance=r.Vector3.Distance(b,_),n.pickedPoint=_,n.pickedMesh=this,n.bu=a.bu||0,n.bv=a.bv||0,n.faceId=a.faceId,n.subMeshId=a.subMeshId,n}return n},m.prototype.clone=function(t,e,i){return null},m.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},m.prototype.dispose=function(t,e){var i,r=this;for(void 0===e&&(e=!1),this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){var n=this._intersectionsInProgress[i],o=n._intersectionsInProgress.indexOf(this);n._intersectionsInProgress.splice(o,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(t){var e=t.includedOnlyMeshes.indexOf(r);-1!==e&&t.includedOnlyMeshes.splice(e,1),-1!==(e=t.excludedMeshes.indexOf(r))&&t.excludedMeshes.splice(e,1);var i=t.getShadowGenerator();if(i){var n=i.getShadowMap();n&&n.renderList&&-1!==(e=n.renderList.indexOf(r))&&n.renderList.splice(e,1)}}),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var s=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),this.getScene().removeMesh(this),e&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),g.prototype.dispose.call(this,t,e)},m.prototype.addChild=function(t){return t.setParent(this),this},m.prototype.removeChild=function(t){return t.setParent(null),this},m.prototype._initFacetData=function(){var t=this._internalAbstractMeshDataInfo._facetData;t.facetNormals||(t.facetNormals=new Array),t.facetPositions||(t.facetPositions=new Array),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(var e=0;e<t.facetNb;e++)t.facetNormals[e]=r.Vector3.Zero(),t.facetPositions[e]=r.Vector3.Zero();return t.facetDataEnabled=!0,this},m.prototype.updateFacetData=function(){var t=this._internalAbstractMeshDataInfo._facetData;t.facetDataEnabled||this._initFacetData();var e=this.getVerticesData(o.VertexBuffer.PositionKind),i=this.getIndices(),n=this.getVerticesData(o.VertexBuffer.NormalKind),a=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,i instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(i);else{for(var l=!1,c=0;c<i.length;c++)if(i[c]>65535){l=!0;break}t.depthSortedIndices=l?new Uint32Array(i):new Uint16Array(i)}if(t.facetDepthSortFunction=function(t,e){return e.sqDistance-t.sqDistance},!t.facetDepthSortFrom){var h=this.getScene().activeCamera;t.facetDepthSortFrom=h?h.position:r.Vector3.Zero()}t.depthSortedFacets=[];for(var u=0;u<t.facetNb;u++){var f={ind:3*u,sqDistance:0};t.depthSortedFacets.push(f)}t.invertedMatrix=r.Matrix.Identity(),t.facetDepthSortOrigin=r.Vector3.Zero()}t.bbSize.x=a.maximum.x-a.minimum.x>p.Epsilon?a.maximum.x-a.minimum.x:p.Epsilon,t.bbSize.y=a.maximum.y-a.minimum.y>p.Epsilon?a.maximum.y-a.minimum.y:p.Epsilon,t.bbSize.z=a.maximum.z-a.minimum.z>p.Epsilon?a.maximum.z-a.minimum.z:p.Epsilon;var d=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(d=d>t.bbSize.z?d:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/d),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/d),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/d),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=a,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(t.invertedMatrix),r.Vector3.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,s.VertexData.ComputeNormals(e,i,n,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);var b=t.depthSortedIndices.length/3|0;for(u=0;u<b;u++){var g=t.depthSortedFacets[u].ind;t.depthSortedIndices[3*u]=i[g],t.depthSortedIndices[3*u+1]=i[g+1],t.depthSortedIndices[3*u+2]=i[g+2]}this.updateIndices(t.depthSortedIndices,void 0,!0)}return this},m.prototype.getFacetLocalNormals=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetNormals||this.updateFacetData(),t.facetNormals},m.prototype.getFacetLocalPositions=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetPositions||this.updateFacetData(),t.facetPositions},m.prototype.getFacetLocalPartitioning=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetPartitioning||this.updateFacetData(),t.facetPartitioning},m.prototype.getFacetPosition=function(t){var e=r.Vector3.Zero();return this.getFacetPositionToRef(t,e),e},m.prototype.getFacetPositionToRef=function(t,e){var i=this.getFacetLocalPositions()[t],n=this.getWorldMatrix();return r.Vector3.TransformCoordinatesToRef(i,n,e),this},m.prototype.getFacetNormal=function(t){var e=r.Vector3.Zero();return this.getFacetNormalToRef(t,e),e},m.prototype.getFacetNormalToRef=function(t,e){var i=this.getFacetLocalNormals()[t];return r.Vector3.TransformNormalToRef(i,this.getWorldMatrix(),e),this},m.prototype.getFacetsAtLocalCoordinates=function(t,e,i){var r=this.getBoundingInfo(),n=this._internalAbstractMeshDataInfo._facetData,o=Math.floor((t-r.minimum.x*n.partitioningBBoxRatio)*n.subDiv.X*n.partitioningBBoxRatio/n.bbSize.x),s=Math.floor((e-r.minimum.y*n.partitioningBBoxRatio)*n.subDiv.Y*n.partitioningBBoxRatio/n.bbSize.y),a=Math.floor((i-r.minimum.z*n.partitioningBBoxRatio)*n.subDiv.Z*n.partitioningBBoxRatio/n.bbSize.z);return o<0||o>n.subDiv.max||s<0||s>n.subDiv.max||a<0||a>n.subDiv.max?null:n.facetPartitioning[o+n.subDiv.max*s+n.subDiv.max*n.subDiv.max*a]},m.prototype.getClosestFacetAtCoordinates=function(t,e,i,n,o,s){void 0===o&&(o=!1),void 0===s&&(s=!0);var a=this.getWorldMatrix(),l=r.TmpVectors.Matrix[5];a.invertToRef(l);var c=r.TmpVectors.Vector3[8];r.Vector3.TransformCoordinatesFromFloatsToRef(t,e,i,l,c);var h=this.getClosestFacetAtLocalCoordinates(c.x,c.y,c.z,n,o,s);return n&&r.Vector3.TransformCoordinatesFromFloatsToRef(n.x,n.y,n.z,a,n),h},m.prototype.getClosestFacetAtLocalCoordinates=function(t,e,i,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!0);var s=null,a=0,l=0,c=0,h=0,u=0,f=0,d=0,p=0,b=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),_=this.getFacetsAtLocalCoordinates(t,e,i);if(!_)return null;for(var m,M,y,D=Number.MAX_VALUE,I=D,v=0;v<_.length;v++)M=g[m=_[v]],h=(t-(y=b[m]).x)*M.x+(e-y.y)*M.y+(i-y.z)*M.z,(!n||n&&o&&h>=0||n&&!o&&h<=0)&&(h=M.x*y.x+M.y*y.y+M.z*y.z,u=-(M.x*t+M.y*e+M.z*i-h)/(M.x*M.x+M.y*M.y+M.z*M.z),(I=(a=(f=t+M.x*u)-t)*a+(l=(d=e+M.y*u)-e)*l+(c=(p=i+M.z*u)-i)*c)<D&&(D=I,s=m,r&&(r.x=f,r.y=d,r.z=p)));return s},m.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},m.prototype.disableFacetData=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetDataEnabled&&(t.facetDataEnabled=!1,t.facetPositions=new Array,t.facetNormals=new Array,t.facetPartitioning=new Array,t.facetParameters=null,t.depthSortedIndices=new Uint32Array(0)),this},m.prototype.updateIndices=function(t,e,i){return void 0===i&&(i=!1),this},m.prototype.createNormals=function(t){var e,i=this.getVerticesData(o.VertexBuffer.PositionKind),r=this.getIndices();return e=this.isVerticesDataPresent(o.VertexBuffer.NormalKind)?this.getVerticesData(o.VertexBuffer.NormalKind):[],s.VertexData.ComputeNormals(i,r,e,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(o.VertexBuffer.NormalKind,e,t),this},m.prototype.alignWithNormal=function(t,e){e||(e=b.Axis.Y);var i=r.TmpVectors.Vector3[0],n=r.TmpVectors.Vector3[1];return r.Vector3.CrossToRef(e,t,n),r.Vector3.CrossToRef(t,n,i),this.rotationQuaternion?r.Quaternion.RotationQuaternionFromAxisToRef(i,t,n,this.rotationQuaternion):r.Vector3.RotationFromAxisToRef(i,t,n,this.rotation),this},m.prototype._checkOcclusionQuery=function(){return!1},m.prototype.disableEdgesRendering=function(){throw u._DevTools.WarnImport("EdgesRenderer")},m.prototype.enableEdgesRendering=function(t,e){throw u._DevTools.WarnImport("EdgesRenderer")},m.OCCLUSION_TYPE_NONE=0,m.OCCLUSION_TYPE_OPTIMISTIC=1,m.OCCLUSION_TYPE_STRICT=2,m.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,m.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,m.CULLINGSTRATEGY_STANDARD=0,m.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,m.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,m.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,m}(a.TransformNode);exports.AbstractMesh=m;
},{"tslib":"90Cu","../Misc/tools":"8xSa","../Misc/observable":"vY1+","../Maths/math.vector":"61Nx","../Engines/engine":"L3af","../Meshes/buffer":"clDe","../Meshes/mesh.vertexData":"1A0K","../Meshes/transformNode":"03YA","../Collisions/pickingInfo":"lVfJ","../Culling/boundingInfo":"j0r+","../Collisions/meshCollisionData":"pQh1","../Misc/devTools":"S9x9","../Maths/math.functions":"WWKm","../Maths/math.color":"q3+m","../Maths/math.constants":"tvfX","../Maths/math.axis":"LzVa"}],"bOLa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Viewport=void 0;var t=function(){function t(t,i,h,e){this.x=t,this.y=i,this.width=h,this.height=e}return t.prototype.toGlobal=function(i,h){return new t(this.x*i,this.y*h,this.width*i,this.height*h)},t.prototype.toGlobalToRef=function(t,i,h){return h.x=this.x*t,h.y=this.y*i,h.width=this.width*t,h.height=this.height*i,this},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t}();exports.Viewport=t;
},{}],"VdRi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Plane=void 0;var t=require("./math.vector"),r=function(){function r(r,o,n,i){this.normal=new t.Vector3(r,o,n),this.d=i}return r.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},r.prototype.clone=function(){return new r(this.normal.x,this.normal.y,this.normal.z,this.d)},r.prototype.getClassName=function(){return"Plane"},r.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=397*t^(0|this.d)},r.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),r=0;return 0!==t&&(r=1/t),this.normal.x*=r,this.normal.y*=r,this.normal.z*=r,this.d*=r,this},r.prototype.transform=function(o){var n=r._TmpMatrix;t.Matrix.TransposeToRef(o,n);var i=n.m,a=this.normal.x,e=this.normal.y,s=this.normal.z,m=this.d;return new r(a*i[0]+e*i[1]+s*i[2]+m*i[3],a*i[4]+e*i[5]+s*i[6]+m*i[7],a*i[8]+e*i[9]+s*i[10]+m*i[11],a*i[12]+e*i[13]+s*i[14]+m*i[15])},r.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},r.prototype.copyFromPoints=function(t,r,o){var n,i=r.x-t.x,a=r.y-t.y,e=r.z-t.z,s=o.x-t.x,m=o.y-t.y,h=o.z-t.z,l=a*h-e*m,u=e*s-i*h,y=i*m-a*s,c=Math.sqrt(l*l+u*u+y*y);return n=0!==c?1/c:0,this.normal.x=l*n,this.normal.y=u*n,this.normal.z=y*n,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},r.prototype.isFrontFacingTo=function(r,o){return t.Vector3.Dot(this.normal,r)<=o},r.prototype.signedDistanceTo=function(r){return t.Vector3.Dot(r,this.normal)+this.d},r.FromArray=function(t){return new r(t[0],t[1],t[2],t[3])},r.FromPoints=function(t,o,n){var i=new r(0,0,0,0);return i.copyFromPoints(t,o,n),i},r.FromPositionAndNormal=function(t,o){var n=new r(0,0,0,0);return o.normalize(),n.normal=o,n.d=-(o.x*t.x+o.y*t.y+o.z*t.z),n},r.SignedDistanceToPlaneFromPositionAndNormal=function(r,o,n){var i=-(o.x*r.x+o.y*r.y+o.z*r.z);return t.Vector3.Dot(n,o)+i},r._TmpMatrix=t.Matrix.Identity(),r}();exports.Plane=r;
},{"./math.vector":"61Nx"}],"vawr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Frustum=void 0;var e=require("./math.plane"),n=function(){function n(){}return n.GetPlanes=function(o){for(var a=[],r=0;r<6;r++)a.push(new e.Plane(0,0,0,0));return n.GetPlanesToRef(o,a),a},n.GetNearPlaneToRef=function(e,n){var o=e.m;n.normal.x=o[3]+o[2],n.normal.y=o[7]+o[6],n.normal.z=o[11]+o[10],n.d=o[15]+o[14],n.normalize()},n.GetFarPlaneToRef=function(e,n){var o=e.m;n.normal.x=o[3]-o[2],n.normal.y=o[7]-o[6],n.normal.z=o[11]-o[10],n.d=o[15]-o[14],n.normalize()},n.GetLeftPlaneToRef=function(e,n){var o=e.m;n.normal.x=o[3]+o[0],n.normal.y=o[7]+o[4],n.normal.z=o[11]+o[8],n.d=o[15]+o[12],n.normalize()},n.GetRightPlaneToRef=function(e,n){var o=e.m;n.normal.x=o[3]-o[0],n.normal.y=o[7]-o[4],n.normal.z=o[11]-o[8],n.d=o[15]-o[12],n.normalize()},n.GetTopPlaneToRef=function(e,n){var o=e.m;n.normal.x=o[3]-o[1],n.normal.y=o[7]-o[5],n.normal.z=o[11]-o[9],n.d=o[15]-o[13],n.normalize()},n.GetBottomPlaneToRef=function(e,n){var o=e.m;n.normal.x=o[3]+o[1],n.normal.y=o[7]+o[5],n.normal.z=o[11]+o[9],n.d=o[15]+o[13],n.normalize()},n.GetPlanesToRef=function(e,o){n.GetNearPlaneToRef(e,o[0]),n.GetFarPlaneToRef(e,o[1]),n.GetLeftPlaneToRef(e,o[2]),n.GetRightPlaneToRef(e,o[3]),n.GetTopPlaneToRef(e,o[4]),n.GetBottomPlaneToRef(e,o[5])},n}();exports.Frustum=n;
},{"./math.plane":"VdRi"}],"AhwZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Camera=void 0;var t=require("tslib"),e=require("../Misc/decorators"),i=require("../Misc/smartArray"),r=require("../Misc/tools"),o=require("../Misc/observable"),s=require("../Maths/math.vector"),a=require("../node"),n=require("../Misc/logger"),h=require("../Misc/typeStore"),c=require("../Misc/devTools"),p=require("../Maths/math.viewport"),_=require("../Maths/math.frustum"),u=function(u){function m(t,e,r,a){void 0===a&&(a=!0);var n=u.call(this,t,r)||this;return n._position=s.Vector3.Zero(),n.upVector=s.Vector3.Up(),n.orthoLeft=null,n.orthoRight=null,n.orthoBottom=null,n.orthoTop=null,n.fov=.8,n.minZ=1,n.maxZ=1e4,n.inertia=.9,n.mode=m.PERSPECTIVE_CAMERA,n.isIntermediate=!1,n.viewport=new p.Viewport(0,0,1,1),n.layerMask=268435455,n.fovMode=m.FOVMODE_VERTICAL_FIXED,n.cameraRigMode=m.RIG_MODE_NONE,n.customRenderTargets=new Array,n.outputRenderTarget=null,n.onViewMatrixChangedObservable=new o.Observable,n.onProjectionMatrixChangedObservable=new o.Observable,n.onAfterCheckInputsObservable=new o.Observable,n.onRestoreStateObservable=new o.Observable,n.isRigCamera=!1,n._rigCameras=new Array,n._webvrViewMatrix=s.Matrix.Identity(),n._skipRendering=!1,n._projectionMatrix=new s.Matrix,n._postProcesses=new Array,n._activeMeshes=new i.SmartArray(256),n._globalPosition=s.Vector3.Zero(),n._computedViewMatrix=s.Matrix.Identity(),n._doNotComputeProjectionMatrix=!1,n._transformMatrix=s.Matrix.Zero(),n._refreshFrustumPlanes=!0,n._isCamera=!0,n._isLeftCamera=!1,n._isRightCamera=!1,n.getScene().addCamera(n),a&&!n.getScene().activeCamera&&(n.getScene().activeCamera=n),n.position=e,n}return(0,t.__extends)(m,u),Object.defineProperty(m.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!0,configurable:!0}),m.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},m.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},m.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},m.prototype.getClassName=function(){return"Camera"},m.prototype.toString=function(t){var e="Name: "+this.name;if(e+=", type: "+this.getClassName(),this.animations)for(var i=0;i<this.animations.length;i++)e+=", animation[0]: "+this.animations[i].toString(t);return e},Object.defineProperty(m.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),m.prototype.getActiveMeshes=function(){return this._activeMeshes},m.prototype.isActiveMesh=function(t){return-1!==this._activeMeshes.indexOf(t)},m.prototype.isReady=function(t){if(void 0===t&&(t=!1),t)for(var e=0,i=this._postProcesses;e<i.length;e++){var r=i[e];if(r&&!r.isReady())return!1}return u.prototype.isReady.call(this,t)},m.prototype._initCache=function(){u.prototype._initCache.call(this),this._cache.position=new s.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new s.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},m.prototype._updateCache=function(t){t||u.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},m.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},m.prototype._isSynchronizedViewMatrix=function(){return!!u.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},m.prototype._isSynchronizedProjectionMatrix=function(){var t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;var e=this.getEngine();return t=this.mode===m.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===e.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===e.getRenderWidth()&&this._cache.renderHeight===e.getRenderHeight()},m.prototype.attachControl=function(t,e){},m.prototype.detachControl=function(t){},m.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==m.RIG_MODE_NONE&&this._updateRigCameras()},m.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(m.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),m.prototype._getFirstPostProcess=function(){for(var t=0;t<this._postProcesses.length;t++)if(null!==this._postProcesses[t])return this._postProcesses[t];return null},m.prototype._cascadePostProcessesToRigCams=function(){var t=this._getFirstPostProcess();t&&t.markTextureDirty();for(var e=0,i=this._rigCameras.length;e<i;e++){var r=this._rigCameras[e],o=r._rigPostProcess;if(o)"pass"===o.getEffectName()&&(r.isIntermediate=0===this._postProcesses.length),r._postProcesses=this._postProcesses.slice(0).concat(o),o.markTextureDirty();else r._postProcesses=this._postProcesses.slice(0)}},m.prototype.attachPostProcess=function(t,e){return void 0===e&&(e=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(n.Logger.Error("You're trying to reuse a post process not defined as reusable."),0):(null==e||e<0?this._postProcesses.push(t):null===this._postProcesses[e]?this._postProcesses[e]=t:this._postProcesses.splice(e,0,t),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(t))},m.prototype.detachPostProcess=function(t){var e=this._postProcesses.indexOf(t);-1!==e&&(this._postProcesses[e]=null),this._cascadePostProcessesToRigCams()},m.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},m.prototype._getViewMatrix=function(){return s.Matrix.Identity()},m.prototype.getViewMatrix=function(t){return!t&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},m.prototype.freezeProjectionMatrix=function(t){this._doNotComputeProjectionMatrix=!0,void 0!==t&&(this._projectionMatrix=t)},m.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},m.prototype.getProjectionMatrix=function(t){if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var e=this.getEngine(),i=this.getScene();if(this.mode===m.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=e.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var r=e.useReverseDepthBuffer;(i.useRightHandedSystem?r?s.Matrix.PerspectiveFovReverseRHToRef:s.Matrix.PerspectiveFovRHToRef:r?s.Matrix.PerspectiveFovReverseLHToRef:s.Matrix.PerspectiveFovLHToRef)(this.fov,e.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===m.FOVMODE_VERTICAL_FIXED)}else{var o=e.getRenderWidth()/2,a=e.getRenderHeight()/2;i.useRightHandedSystem?s.Matrix.OrthoOffCenterRHToRef(this.orthoLeft||-o,this.orthoRight||o,this.orthoBottom||-a,this.orthoTop||a,this.minZ,this.maxZ,this._projectionMatrix):s.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-o,this.orthoRight||o,this.orthoBottom||-a,this.orthoTop||a,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=e.getRenderWidth(),this._cache.renderHeight=e.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},m.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},m.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?_.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=_.Frustum.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},m.prototype.isInFrustum=function(t,e){if(void 0===e&&(e=!1),this._updateFrustumPlanes(),e&&this.rigCameras.length>0){var i=!1;return this.rigCameras.forEach(function(e){e._updateFrustumPlanes(),i=i||t.isInFrustum(e._frustumPlanes)}),i}return t.isInFrustum(this._frustumPlanes)},m.prototype.isCompletelyInFrustum=function(t){return this._updateFrustumPlanes(),t.isCompletelyInFrustum(this._frustumPlanes)},m.prototype.getForwardRay=function(t,e,i){throw void 0===t&&(t=100),c._DevTools.WarnImport("Ray")},m.prototype.dispose=function(t,e){for(void 0===e&&(e=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var i=this._rigCameras.pop();i&&i.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==m.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var r=this._postProcesses.length;--r>=0;){var o=this._postProcesses[r];o&&o.dispose(this)}for(r=this.customRenderTargets.length;--r>=0;)this.customRenderTargets[r].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),u.prototype.dispose.call(this,t,e)},Object.defineProperty(m.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),m.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},m.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},m.prototype.setCameraRigMode=function(t,e){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){var i=this._rigCameras.pop();i&&i.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=e.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=r.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==m.RIG_MODE_NONE){var o=this.createRigCamera(this.name+"_L",0);o&&(o._isLeftCamera=!0);var s=this.createRigCamera(this.name+"_R",1);s&&(s._isRightCamera=!0),o&&s&&(this._rigCameras.push(o),this._rigCameras.push(s))}switch(this.cameraRigMode){case m.RIG_MODE_STEREOSCOPIC_ANAGLYPH:m._setStereoscopicAnaglyphRigMode(this);break;case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case m.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.RIG_MODE_STEREOSCOPIC_INTERLACED:m._setStereoscopicRigMode(this);break;case m.RIG_MODE_VR:m._setVRRigMode(this,e);break;case m.RIG_MODE_WEBVR:m._setWebVRRigMode(this,e)}this._cascadePostProcessesToRigCams(),this.update()}},m._setStereoscopicRigMode=function(t){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},m._setStereoscopicAnaglyphRigMode=function(t){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},m._setVRRigMode=function(t,e){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},m._setWebVRRigMode=function(t,e){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},m.prototype._getVRProjectionMatrix=function(){return s.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},m.prototype._updateCameraRotationMatrix=function(){},m.prototype._updateWebVRCameraRotationMatrix=function(){},m.prototype._getWebVRProjectionMatrix=function(){return s.Matrix.Identity()},m.prototype._getWebVRViewMatrix=function(){return s.Matrix.Identity()},m.prototype.setCameraRigParameter=function(t,e){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=e,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=r.Tools.ToRadians(e/.0637))},m.prototype.createRigCamera=function(t,e){return null},m.prototype._updateRigCameras=function(){for(var t=0;t<this._rigCameras.length;t++)this._rigCameras[t].minZ=this.minZ,this._rigCameras[t].maxZ=this.maxZ,this._rigCameras[t].fov=this.fov,this._rigCameras[t].upVector.copyFrom(this.upVector);this.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},m.prototype._setupInputs=function(){},m.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),this.inputs&&this.inputs.serialize(t),e.SerializationHelper.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},m.prototype.clone=function(t){return e.SerializationHelper.Clone(m.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},m.prototype.getDirection=function(t){var e=s.Vector3.Zero();return this.getDirectionToRef(t,e),e},Object.defineProperty(m.prototype,"absoluteRotation",{get:function(){var t=s.Quaternion.Zero();return this.getWorldMatrix().decompose(void 0,t),t},enumerable:!0,configurable:!0}),m.prototype.getDirectionToRef=function(t,e){s.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),e)},m.GetConstructorFromName=function(t,e,i,r,o){void 0===r&&(r=0),void 0===o&&(o=!0);var s=a.Node.Construct(t,e,i,{interaxial_distance:r,isStereoscopicSideBySide:o});return s||function(){return m._createDefaultParsedCamera(e,i)}},m.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},m.Parse=function(t,i){var r=t.type,o=m.GetConstructorFromName(r,t.name,i,t.interaxial_distance,t.isStereoscopicSideBySide),n=e.SerializationHelper.Parse(o,t,i);if(t.parentId&&(n._waitingParentId=t.parentId),n.inputs&&(n.inputs.parse(t),n._setupInputs()),n.setPosition&&(n.position.copyFromFloats(0,0,0),n.setPosition(s.Vector3.FromArray(t.position))),t.target&&n.setTarget&&n.setTarget(s.Vector3.FromArray(t.target)),t.cameraRigMode){var c=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};n.setCameraRigMode(t.cameraRigMode,c)}if(t.animations){for(var p=0;p<t.animations.length;p++){var _=t.animations[p],u=h._TypeStore.GetClass("BABYLON.Animation");u&&n.animations.push(u.Parse(_))}a.Node.ParseAnimationRanges(n,t,i)}return t.autoAnimate&&i.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),n},m._createDefaultParsedCamera=function(t,e){throw c._DevTools.WarnImport("UniversalCamera")},m.PERSPECTIVE_CAMERA=0,m.ORTHOGRAPHIC_CAMERA=1,m.FOVMODE_VERTICAL_FIXED=0,m.FOVMODE_HORIZONTAL_FIXED=1,m.RIG_MODE_NONE=0,m.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,m.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,m.RIG_MODE_STEREOSCOPIC_INTERLACED=14,m.RIG_MODE_VR=20,m.RIG_MODE_WEBVR=21,m.RIG_MODE_CUSTOM=22,m.ForceAttachControlToAlwaysPreventDefault=!1,(0,t.__decorate)([(0,e.serializeAsVector3)("position")],m.prototype,"_position",void 0),(0,t.__decorate)([(0,e.serializeAsVector3)()],m.prototype,"upVector",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"orthoLeft",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"orthoRight",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"orthoBottom",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"orthoTop",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"fov",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"minZ",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"maxZ",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"inertia",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"mode",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"layerMask",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"fovMode",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"cameraRigMode",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"interaxialDistance",void 0),(0,t.__decorate)([(0,e.serialize)()],m.prototype,"isStereoscopicSideBySide",void 0),m}(a.Node);exports.Camera=u;
},{"tslib":"90Cu","../Misc/decorators":"EVXT","../Misc/smartArray":"Hnz9","../Misc/tools":"8xSa","../Misc/observable":"vY1+","../Maths/math.vector":"61Nx","../node":"mlkt","../Misc/logger":"Yh4i","../Misc/typeStore":"sm8f","../Misc/devTools":"S9x9","../Maths/math.viewport":"bOLa","../Maths/math.frustum":"vawr"}],"bnVi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractScene=void 0;var r=function(){function r(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this.environmentTexture=null}return r.AddParser=function(r,e){this._BabylonFileParsers[r]=e},r.GetParser=function(r){return this._BabylonFileParsers[r]?this._BabylonFileParsers[r]:null},r.AddIndividualParser=function(r,e){this._IndividualBabylonFileParsers[r]=e},r.GetIndividualParser=function(r){return this._IndividualBabylonFileParsers[r]?this._IndividualBabylonFileParsers[r]:null},r.Parse=function(r,e,s,t){for(var n in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(n)&&this._BabylonFileParsers[n](r,e,s,t)},r.prototype.getNodes=function(){var r=new Array;return r=(r=(r=(r=r.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach(function(e){return r=r.concat(e.bones)}),r},r._BabylonFileParsers={},r._IndividualBabylonFileParsers={},r}();exports.AbstractScene=r;
},{}],"y4W7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MaterialDefines=void 0;var t=function(){function t(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),t.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},t.prototype.markAsUnprocessed=function(){this._isDirty=!0},t.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},t.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},t.prototype.markAsLightDirty=function(t){void 0===t&&(t=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||t,this._isDirty=!0},t.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},t.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},t.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},t.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},t.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var t=0,i=Object.keys(this);t<i.length;t++){var s=i[t];"_"!==s[0]&&this._keys.push(s)}},t.prototype.isEqual=function(t){if(this._keys.length!==t._keys.length)return!1;for(var i=0;i<this._keys.length;i++){var s=this._keys[i];if(this[s]!==t[s])return!1}return!0},t.prototype.cloneTo=function(t){this._keys.length!==t._keys.length&&(t._keys=this._keys.slice(0));for(var i=0;i<this._keys.length;i++){var s=this._keys[i];t[s]=this[s]}},t.prototype.reset=function(){for(var t=0;t<this._keys.length;t++){var i=this._keys[t];switch(typeof this[i]){case"number":this[i]=0;break;case"string":this[i]="";break;default:this[i]=!1}}},t.prototype.toString=function(){for(var t="",i=0;i<this._keys.length;i++){var s=this._keys[i],e=this[s];switch(typeof e){case"number":case"string":t+="#define "+s+" "+e+"\n";break;default:e&&(t+="#define "+s+"\n")}}return t},t}();exports.MaterialDefines=t;
},{}],"9zw0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorCurves=void 0;var e=require("tslib"),t=require("../Misc/decorators"),i=require("../Maths/math.color"),o=function(){function o(){this._dirty=!0,this._tempColor=new i.Color4(0,0,0,0),this._globalCurve=new i.Color4(0,0,0,0),this._highlightsCurve=new i.Color4(0,0,0,0),this._midtonesCurve=new i.Color4(0,0,0,0),this._shadowsCurve=new i.Color4(0,0,0,0),this._positiveCurve=new i.Color4(0,0,0,0),this._negativeCurve=new i.Color4(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(o.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),o.prototype.getClassName=function(){return"ColorCurves"},o.Bind=function(e,t,i,o,r){void 0===i&&(i="vCameraColorCurvePositive"),void 0===o&&(o="vCameraColorCurveNeutral"),void 0===r&&(r="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(o,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(r,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},o.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},o.prototype.getColorGradingDataToRef=function(e,t,i,r,s){null!=e&&(e=o.clamp(e,0,360),t=o.clamp(t,-100,100),i=o.clamp(i,-100,100),r=o.clamp(r,-100,100),t=o.applyColorGradingSliderNonlinear(t),t*=.5,r=o.applyColorGradingSliderNonlinear(r),t<0&&(t*=-1,e=(e+180)%360),o.fromHSBToRef(e,t,50+.25*r,s),s.scaleToRef(2,s),s.a=1+.01*i)},o.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100},o.fromHSBToRef=function(e,t,i,r){var s=o.clamp(e,0,360),n=o.clamp(t/100,0,1),a=o.clamp(i/100,0,1);if(0===n)r.r=a,r.g=a,r.b=a;else{s/=60;var u=Math.floor(s),l=s-u,h=a*(1-n),_=a*(1-n*l),g=a*(1-n*(1-l));switch(u){case 0:r.r=a,r.g=g,r.b=h;break;case 1:r.r=_,r.g=a,r.b=h;break;case 2:r.r=h,r.g=a,r.b=g;break;case 3:r.r=h,r.g=_,r.b=a;break;case 4:r.r=g,r.g=h,r.b=a;break;default:r.r=a,r.g=h,r.b=_}}r.a=1},o.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},o.prototype.clone=function(){return t.SerializationHelper.Clone(function(){return new o},this)},o.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},o.Parse=function(e){return t.SerializationHelper.Parse(function(){return new o},e,null,null)},(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_globalHue",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_globalDensity",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_globalSaturation",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_globalExposure",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_highlightsHue",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_highlightsDensity",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_highlightsSaturation",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_highlightsExposure",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_midtonesHue",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_midtonesDensity",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_midtonesSaturation",void 0),(0,e.__decorate)([(0,t.serialize)()],o.prototype,"_midtonesExposure",void 0),o}();exports.ColorCurves=o,t.SerializationHelper._ColorCurvesParser=o.Parse;
},{"tslib":"90Cu","../Misc/decorators":"EVXT","../Maths/math.color":"q3+m"}],"h2+3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ImageProcessingConfiguration=exports.ImageProcessingConfigurationDefines=void 0;var e=require("tslib"),t=require("../Misc/decorators"),r=require("../Misc/observable"),i=require("../Misc/tools"),o=require("../Maths/math.color"),n=require("../Materials/materialDefines"),s=require("../Materials/colorCurves"),a=function(t){function r(){var e=t.call(this)||this;return e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.rebuild(),e}return(0,e.__extends)(r,t),r}(n.MaterialDefines);exports.ImageProcessingConfigurationDefines=a;var l=function(){function n(){this.colorCurves=new s.ColorCurves,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=n.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new o.Color4(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=n.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new r.Observable}return Object.defineProperty(n.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),n.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},n.prototype.getClassName=function(){return"ImageProcessingConfiguration"},n.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&s.ColorCurves.PrepareUniforms(e)},n.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},n.prototype.prepareDefines=function(e,t){if(void 0===t&&(t=!1),t!==this.applyByPostProcess||!this._isEnabled)return e.VIGNETTE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.IMAGEPROCESSING=!1,void(e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===n._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,e.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case n.TONEMAPPING_ACES:e.TONEMAPPING_ACES=!0;break;default:e.TONEMAPPING_ACES=!1}e.CONTRAST=1!==this.contrast,e.EXPOSURE=1!==this.exposure,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.IMAGEPROCESSING=e.VIGNETTE||e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING},n.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},n.prototype.bind=function(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&s.ColorCurves.Bind(this.colorCurves,e),this._vignetteEnabled){var r=1/e.getEngine().getRenderWidth(),o=1/e.getEngine().getRenderHeight();e.setFloat2("vInverseScreenSize",r,o);var n=null!=t?t:o/r,a=Math.tan(.5*this.vignetteCameraFov),l=a*n,p=Math.sqrt(l*a);l=i.Tools.Mix(l,p,this.vignetteStretch),a=i.Tools.Mix(a,p,this.vignetteStretch),e.setFloat4("vignetteSettings1",l,a,-l*this.vignetteCentreX,-a*this.vignetteCentreY);var c=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,c)}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var u=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(u-1)/u,.5/u,u,this.colorGradingTexture.level)}},n.prototype.clone=function(){return t.SerializationHelper.Clone(function(){return new n},this)},n.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},n.Parse=function(e){return t.SerializationHelper.Parse(function(){return new n},e,null,null)},Object.defineProperty(n,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(n,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),n.TONEMAPPING_STANDARD=0,n.TONEMAPPING_ACES=1,n._VIGNETTEMODE_MULTIPLY=0,n._VIGNETTEMODE_OPAQUE=1,(0,e.__decorate)([(0,t.serializeAsColorCurves)()],n.prototype,"colorCurves",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_colorCurvesEnabled",void 0),(0,e.__decorate)([(0,t.serializeAsTexture)("colorGradingTexture")],n.prototype,"_colorGradingTexture",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_colorGradingEnabled",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_colorGradingWithGreenDepth",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_colorGradingBGR",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_exposure",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_toneMappingEnabled",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_toneMappingType",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_contrast",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"vignetteStretch",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"vignetteCentreX",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"vignetteCentreY",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"vignetteWeight",void 0),(0,e.__decorate)([(0,t.serializeAsColor4)()],n.prototype,"vignetteColor",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"vignetteCameraFov",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_vignetteBlendMode",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_vignetteEnabled",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_applyByPostProcess",void 0),(0,e.__decorate)([(0,t.serialize)()],n.prototype,"_isEnabled",void 0),n}();exports.ImageProcessingConfiguration=l,t.SerializationHelper._ImageProcessingConfigurationParser=l.Parse;
},{"tslib":"90Cu","../Misc/decorators":"EVXT","../Misc/observable":"vY1+","../Misc/tools":"8xSa","../Maths/math.color":"q3+m","../Materials/materialDefines":"y4W7","../Materials/colorCurves":"9zw0"}],"YA9y":[function(require,module,exports) {
"use strict";var r=require("../../Engines/thinEngine"),e=require("../../Meshes/WebGL/webGLDataBuffer");r.ThinEngine.prototype.createUniformBuffer=function(r){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create uniform buffer");var n=new e.WebGLDataBuffer(i);return this.bindUniformBuffer(n),r instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,r,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(r),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},r.ThinEngine.prototype.createDynamicUniformBuffer=function(r){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create dynamic uniform buffer");var n=new e.WebGLDataBuffer(i);return this.bindUniformBuffer(n),r instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,r,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(r),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},r.ThinEngine.prototype.updateUniformBuffer=function(r,e,i,n){this.bindUniformBuffer(r),void 0===i&&(i=0),void 0===n?e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,e):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(e)):e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,e.subarray(i,i+n)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(e).subarray(i,i+n)),this.bindUniformBuffer(null)},r.ThinEngine.prototype.bindUniformBuffer=function(r){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,r?r.underlyingResource:null)},r.ThinEngine.prototype.bindUniformBufferBase=function(r,e){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,e,r?r.underlyingResource:null)},r.ThinEngine.prototype.bindUniformBlock=function(r,e,i){var n=r.program,t=this._gl.getUniformBlockIndex(n,e);this._gl.uniformBlockBinding(n,t,i)};
},{"../../Engines/thinEngine":"aDNm","../../Meshes/WebGL/webGLDataBuffer":"7vCK"}],"S1/f":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UniformBuffer=void 0;var t=require("../Misc/logger");require("../Engines/Extensions/engine.uniformBuffer");var e=function(){function e(t,e,r){this._alreadyBound=!1,this._valueCache={},this._engine=t,this._noUBO=!t.supportsUniformBuffers,this._dynamic=r,this._data=e||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(e.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),e.prototype.isDynamic=function(){return void 0!==this._dynamic},e.prototype.getData=function(){return this._bufferData},e.prototype.getBuffer=function(){return this._buffer},e.prototype._fillAlignment=function(t){var e;if(e=t<=2?t:4,this._uniformLocationPointer%e!=0){var r=this._uniformLocationPointer;this._uniformLocationPointer+=e-this._uniformLocationPointer%e;for(var o=this._uniformLocationPointer-r,i=0;i<o;i++)this._data.push(0)}},e.prototype.addUniform=function(t,e){if(!this._noUBO&&void 0===this._uniformLocations[t]){var r;if(e instanceof Array)e=(r=e).length;else{e=e,r=[];for(var o=0;o<e;o++)r.push(0)}this._fillAlignment(e),this._uniformSizes[t]=e,this._uniformLocations[t]=this._uniformLocationPointer,this._uniformLocationPointer+=e;for(o=0;o<e;o++)this._data.push(r[o]);this._needSync=!0}},e.prototype.addMatrix=function(t,e){this.addUniform(t,Array.prototype.slice.call(e.toArray()))},e.prototype.addFloat2=function(t,e,r){var o=[e,r];this.addUniform(t,o)},e.prototype.addFloat3=function(t,e,r,o){var i=[e,r,o];this.addUniform(t,i)},e.prototype.addColor3=function(t,e){var r=new Array;e.toArray(r),this.addUniform(t,r)},e.prototype.addColor4=function(t,e,r){var o=new Array;e.toArray(o),o.push(r),this.addUniform(t,o)},e.prototype.addVector3=function(t,e){var r=new Array;e.toArray(r),this.addUniform(t,r)},e.prototype.addMatrix3x3=function(t){this.addUniform(t,12)},e.prototype.addMatrix2x2=function(t){this.addUniform(t,8)},e.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},e.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},e.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},e.prototype.updateUniform=function(e,r,o){var i=this._uniformLocations[e];if(void 0===i){if(this._buffer)return void t.Logger.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,o),i=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(n=0;n<o;n++)this._bufferData[i+n]=r[n];else{for(var f=!1,n=0;n<o;n++)16!==o&&this._bufferData[i+n]===r[n]||(f=!0,this._bufferData[i+n]=r[n]);this._needSync=this._needSync||f}},e.prototype._cacheMatrix=function(t,e){var r=this._valueCache[t],o=e.updateFlag;return(void 0===r||r!==o)&&(this._valueCache[t]=o,!0)},e.prototype._updateMatrix3x3ForUniform=function(t,r){for(var o=0;o<3;o++)e._tempBuffer[4*o]=r[3*o],e._tempBuffer[4*o+1]=r[3*o+1],e._tempBuffer[4*o+2]=r[3*o+2],e._tempBuffer[4*o+3]=0;this.updateUniform(t,e._tempBuffer,12)},e.prototype._updateMatrix3x3ForEffect=function(t,e){this._currentEffect.setMatrix3x3(t,e)},e.prototype._updateMatrix2x2ForEffect=function(t,e){this._currentEffect.setMatrix2x2(t,e)},e.prototype._updateMatrix2x2ForUniform=function(t,r){for(var o=0;o<2;o++)e._tempBuffer[4*o]=r[2*o],e._tempBuffer[4*o+1]=r[2*o+1],e._tempBuffer[4*o+2]=0,e._tempBuffer[4*o+3]=0;this.updateUniform(t,e._tempBuffer,8)},e.prototype._updateFloatForEffect=function(t,e){this._currentEffect.setFloat(t,e)},e.prototype._updateFloatForUniform=function(t,r){e._tempBuffer[0]=r,this.updateUniform(t,e._tempBuffer,1)},e.prototype._updateFloat2ForEffect=function(t,e,r,o){void 0===o&&(o=""),this._currentEffect.setFloat2(t+o,e,r)},e.prototype._updateFloat2ForUniform=function(t,r,o){e._tempBuffer[0]=r,e._tempBuffer[1]=o,this.updateUniform(t,e._tempBuffer,2)},e.prototype._updateFloat3ForEffect=function(t,e,r,o,i){void 0===i&&(i=""),this._currentEffect.setFloat3(t+i,e,r,o)},e.prototype._updateFloat3ForUniform=function(t,r,o,i){e._tempBuffer[0]=r,e._tempBuffer[1]=o,e._tempBuffer[2]=i,this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateFloat4ForEffect=function(t,e,r,o,i,f){void 0===f&&(f=""),this._currentEffect.setFloat4(t+f,e,r,o,i)},e.prototype._updateFloat4ForUniform=function(t,r,o,i,f){e._tempBuffer[0]=r,e._tempBuffer[1]=o,e._tempBuffer[2]=i,e._tempBuffer[3]=f,this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateMatrixForEffect=function(t,e){this._currentEffect.setMatrix(t,e)},e.prototype._updateMatrixForUniform=function(t,e){this._cacheMatrix(t,e)&&this.updateUniform(t,e.toArray(),16)},e.prototype._updateVector3ForEffect=function(t,e){this._currentEffect.setVector3(t,e)},e.prototype._updateVector3ForUniform=function(t,r){r.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateVector4ForEffect=function(t,e){this._currentEffect.setVector4(t,e)},e.prototype._updateVector4ForUniform=function(t,r){r.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateColor3ForEffect=function(t,e,r){void 0===r&&(r=""),this._currentEffect.setColor3(t+r,e)},e.prototype._updateColor3ForUniform=function(t,r){r.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateColor4ForEffect=function(t,e,r,o){void 0===o&&(o=""),this._currentEffect.setColor4(t+o,e,r)},e.prototype._updateColor4ForUniform=function(t,r,o){r.toArray(e._tempBuffer),e._tempBuffer[3]=o,this.updateUniform(t,e._tempBuffer,4)},e.prototype.setTexture=function(t,e){this._currentEffect.setTexture(t,e)},e.prototype.updateUniformDirectly=function(t,e){this.updateUniform(t,e,e.length),this.update()},e.prototype.bindToEffect=function(t,e){this._currentEffect=t,!this._noUBO&&this._buffer&&(this._alreadyBound=!0,t.bindUniformBuffer(this._buffer,e))},e.prototype.dispose=function(){if(!this._noUBO){var t=this._engine._uniformBuffers,e=t.indexOf(this);-1!==e&&(t[e]=t[t.length-1],t.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},e._MAX_UNIFORM_SIZE=256,e._tempBuffer=new Float32Array(e._MAX_UNIFORM_SIZE),e}();exports.UniformBuffer=e;
},{"../Misc/logger":"Yh4i","../Engines/Extensions/engine.uniformBuffer":"YA9y"}],"S2tp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Light=void 0;var e=require("tslib"),t=require("../Misc/decorators"),r=require("../Maths/math.vector"),i=require("../Maths/math.color"),s=require("../node"),n=require("../Materials/uniformBuffer"),o=require("../Misc/typeStore"),a=function(a){function h(e,t){var r=a.call(this,e,t)||this;return r.diffuse=new i.Color3(1,1,1),r.specular=new i.Color3(1,1,1),r.falloffType=h.FALLOFF_DEFAULT,r.intensity=1,r._range=Number.MAX_VALUE,r._inverseSquaredRange=0,r._photometricScale=1,r._intensityMode=h.INTENSITYMODE_AUTOMATIC,r._radius=1e-5,r.renderPriority=0,r._shadowEnabled=!0,r._excludeWithLayerMask=0,r._includeOnlyWithLayerMask=0,r._lightmapMode=0,r._excludedMeshesIds=new Array,r._includedOnlyMeshesIds=new Array,r._isLight=!0,r.getScene().addLight(r),r._uniformBuffer=new n.UniformBuffer(r.getScene().getEngine()),r._buildUniformLayout(),r.includedOnlyMeshes=new Array,r.excludedMeshes=new Array,r._resyncMeshes(),r}return(0,e.__extends)(h,a),Object.defineProperty(h.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),h.prototype.transferTexturesToEffect=function(e,t){return this},h.prototype._bindLight=function(e,t,r,s,n){void 0===n&&(n=!1);var o=e.toString(),a=!1;if(!n||!this._uniformBuffer._alreadyBound){if(this._uniformBuffer.bindToEffect(r,"Light"+o),this._renderId!==t.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId();var h=this.getScaledIntensity();this.transferToEffect(r,o),this.diffuse.scaleToRef(h,i.TmpColors.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",i.TmpColors.Color3[0],this.range,o),s&&(this.specular.scaleToRef(h,i.TmpColors.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",i.TmpColors.Color3[1],this.radius,o)),a=!0}if(this.transferTexturesToEffect(r,o),t.shadowsEnabled&&this.shadowEnabled){var d=this.getShadowGenerator();d&&(d.bindShadowLight(o,r),a=!0)}a&&this._uniformBuffer.update()}},h.prototype.getClassName=function(){return"Light"},h.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var r=0;r<this.animations.length;r++)t+=", animation[0]: "+this.animations[r].toString(e);return t},h.prototype._syncParentEnabledState=function(){a.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},h.prototype.setEnabled=function(e){a.prototype.setEnabled.call(this,e),this._resyncMeshes()},h.prototype.getShadowGenerator=function(){return this._shadowGenerator},h.prototype.getAbsolutePosition=function(){return r.Vector3.Zero()},h.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))},h.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},h.prototype.dispose=function(e,t){void 0===t&&(t=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var r=0,i=this.getScene().meshes;r<i.length;r++){i[r]._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),a.prototype.dispose.call(this,e,t)},h.prototype.getTypeID=function(){return 0},h.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},h.prototype.clone=function(e){var r=h.GetConstructorFromName(this.getTypeID(),e,this.getScene());return r?t.SerializationHelper.Clone(r,this):null},h.prototype.serialize=function(){var e=t.SerializationHelper.Serialize(this);return e.type=this.getTypeID(),this.parent&&(e.parentId=this.parent.id),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach(function(t){e.excludedMeshesIds.push(t.id)})),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(t){e.includedOnlyMeshesIds.push(t.id)})),t.SerializationHelper.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},h.GetConstructorFromName=function(e,t,r){var i=s.Node.Construct("Light_Type_"+e,t,r);return i||null},h.Parse=function(e,r){var i=h.GetConstructorFromName(e.type,e.name,r);if(!i)return null;var n=t.SerializationHelper.Parse(i,e,r);if(e.excludedMeshesIds&&(n._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(n._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(n._waitingParentId=e.parentId),void 0!==e.falloffType&&(n.falloffType=e.falloffType),void 0!==e.lightmapMode&&(n.lightmapMode=e.lightmapMode),e.animations){for(var a=0;a<e.animations.length;a++){var d=e.animations[a],l=o._TypeStore.GetClass("BABYLON.Animation");l&&n.animations.push(l.Parse(d))}s.Node.ParseAnimationRanges(n,e,r)}return e.autoAnimate&&r.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),n},h.prototype._hookArrayForExcluded=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];for(var n=r.apply(e,i),o=0,a=i;o<a.length;o++){a[o]._resyncLightSource(t)}return n};var i=e.splice;e.splice=function(r,s){for(var n=i.apply(e,[r,s]),o=0,a=n;o<a.length;o++){a[o]._resyncLightSource(t)}return n};for(var s=0,n=e;s<n.length;s++){n[s]._resyncLightSource(this)}},h.prototype._hookArrayForIncludedOnly=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var n=r.apply(e,i);return t._resyncMeshes(),n};var i=e.splice;e.splice=function(r,s){var n=i.apply(e,[r,s]);return t._resyncMeshes(),n},this._resyncMeshes()},h.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){t[e]._resyncLightSource(this)}},h.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var r=t[e];-1!==r.lightSources.indexOf(this)&&r._markSubMeshesAsLightDirty()}},h.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},h.prototype._getPhotometricScale=function(){var e=0,t=this.getTypeID(),r=this.intensityMode;switch(r===h.INTENSITYMODE_AUTOMATIC&&(r=t===h.LIGHTTYPEID_DIRECTIONALLIGHT?h.INTENSITYMODE_ILLUMINANCE:h.INTENSITYMODE_LUMINOUSINTENSITY),t){case h.LIGHTTYPEID_POINTLIGHT:case h.LIGHTTYPEID_SPOTLIGHT:switch(r){case h.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case h.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case h.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case h.LIGHTTYPEID_DIRECTIONALLIGHT:switch(r){case h.INTENSITYMODE_ILLUMINANCE:e=1;break;case h.INTENSITYMODE_LUMINANCE:var i=this.radius;i=Math.max(i,.001),e=2*Math.PI*(1-Math.cos(i))}break;case h.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},h.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},h.FALLOFF_DEFAULT=0,h.FALLOFF_PHYSICAL=1,h.FALLOFF_GLTF=2,h.FALLOFF_STANDARD=3,h.LIGHTMAP_DEFAULT=0,h.LIGHTMAP_SPECULAR=1,h.LIGHTMAP_SHADOWSONLY=2,h.INTENSITYMODE_AUTOMATIC=0,h.INTENSITYMODE_LUMINOUSPOWER=1,h.INTENSITYMODE_LUMINOUSINTENSITY=2,h.INTENSITYMODE_ILLUMINANCE=3,h.INTENSITYMODE_LUMINANCE=4,h.LIGHTTYPEID_POINTLIGHT=0,h.LIGHTTYPEID_DIRECTIONALLIGHT=1,h.LIGHTTYPEID_SPOTLIGHT=2,h.LIGHTTYPEID_HEMISPHERICLIGHT=3,(0,e.__decorate)([(0,t.serializeAsColor3)()],h.prototype,"diffuse",void 0),(0,e.__decorate)([(0,t.serializeAsColor3)()],h.prototype,"specular",void 0),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"falloffType",void 0),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"intensity",void 0),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"range",null),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"intensityMode",null),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"radius",null),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"_renderPriority",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_reorderLightsInScene")],h.prototype,"renderPriority",void 0),(0,e.__decorate)([(0,t.serialize)("shadowEnabled")],h.prototype,"_shadowEnabled",void 0),(0,e.__decorate)([(0,t.serialize)("excludeWithLayerMask")],h.prototype,"_excludeWithLayerMask",void 0),(0,e.__decorate)([(0,t.serialize)("includeOnlyWithLayerMask")],h.prototype,"_includeOnlyWithLayerMask",void 0),(0,e.__decorate)([(0,t.serialize)("lightmapMode")],h.prototype,"_lightmapMode",void 0),h}(s.Node);exports.Light=a;
},{"tslib":"90Cu","../Misc/decorators":"EVXT","../Maths/math.vector":"61Nx","../Maths/math.color":"q3+m","../node":"mlkt","../Materials/uniformBuffer":"S1/f","../Misc/typeStore":"sm8f"}],"8u+X":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActionEvent=void 0;var e=function(){function e(e,t,n,r,i,o){this.source=e,this.pointerX=t,this.pointerY=n,this.meshUnderPointer=r,this.sourceEvent=i,this.additionalData=o}return e.CreateNew=function(t,n,r){var i=t.getScene();return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer||t,n,r)},e.CreateNewFromSprite=function(t,n,r,i){return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer,r,i)},e.CreateNewFromScene=function(t,n){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,n)},e.CreateNewFromPrimitive=function(t,n,r,i){return new e(t,n.x,n.y,null,r,i)},e}();exports.ActionEvent=e;
},{}],"GlKa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IntersectionInfo=void 0;var t=function(){return function(t,e,s){this.bu=t,this.bv=e,this.distance=s,this.faceId=0,this.subMeshId=0}}();exports.IntersectionInfo=t;
},{}],"xQHL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubMesh=exports.BaseSubMesh=void 0;var e=require("tslib"),t=require("./buffer"),n=require("../Collisions/intersectionInfo"),i=require("../Culling/boundingInfo"),r=require("../Maths/math.functions"),s=function(){function e(){this._materialDefines=null,this._materialEffect=null}return Object.defineProperty(e.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(e){this._materialDefines=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),e.prototype.setEffect=function(e,t){void 0===t&&(t=null),this._materialEffect!==e?(this._materialDefines=t,this._materialEffect=e):e||(this._materialDefines=null)},e}();exports.BaseSubMesh=s;var o=function(s){function o(e,t,n,i,r,o,u,a){void 0===a&&(a=!0);var h=s.call(this)||this;return h.materialIndex=e,h.verticesStart=t,h.verticesCount=n,h.indexStart=i,h.indexCount=r,h._linesIndexCount=0,h._linesIndexBuffer=null,h._lastColliderWorldVertices=null,h._lastColliderTransformMatrix=null,h._renderId=0,h._alphaIndex=0,h._distanceToCamera=0,h._currentMaterial=null,h._mesh=o,h._renderingMesh=u||o,o.subMeshes.push(h),h._trianglePlanes=[],h._id=o.subMeshes.length-1,a&&(h.refreshBoundingInfo(),o.computeWorldMatrix(!0)),h}return(0,e.__extends)(o,s),o.AddToMesh=function(e,t,n,i,r,s,u,a){return void 0===a&&(a=!0),new o(e,t,n,i,r,s,u,a)},Object.defineProperty(o.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),o.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},o.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},o.prototype.getMesh=function(){return this._mesh},o.prototype.getRenderingMesh=function(){return this._renderingMesh},o.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(null==e)return this._mesh.getScene().defaultMaterial;if(e.getSubMaterial){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},o.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(t.VertexBuffer.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var n,s=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===s.length){var o=this._renderingMesh.getBoundingInfo();n={minimum:o.minimum.clone(),maximum:o.maximum.clone()}}else n=(0,r.extractMinAndMaxIndexed)(e,s,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new i.BoundingInfo(n.minimum,n.maximum),this},o.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},o.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this},o.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},o.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},o.prototype.render=function(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},o.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var n=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)n.push(e[i],e[i+1],e[i+1],e[i+2],e[i+2],e[i]);this._linesIndexBuffer=t.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer},o.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},o.prototype.intersects=function(e,t,n,i,r){var s=this.getMaterial();if(!s)return null;var o=3,u=!1;switch(s.fillMode){case 3:case 4:case 5:case 6:case 8:return null;case 7:o=1,u=!0}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?n.length?this._intersectLines(e,t,n,this._mesh.intersectionThreshold,i):this._intersectUnIndexedLines(e,t,n,this._mesh.intersectionThreshold,i):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,n,i,r):this._intersectTriangles(e,t,n,o,u,i,r)},o.prototype._intersectLines=function(e,t,i,r,s){for(var o=null,u=this.indexStart;u<this.indexStart+this.indexCount;u+=2){var a=t[i[u]],h=t[i[u+1]],l=e.intersectionSegment(a,h,r);if(!(l<0)&&((s||!o||l<o.distance)&&((o=new n.IntersectionInfo(null,null,l)).faceId=u/2,s)))break}return o},o.prototype._intersectUnIndexedLines=function(e,t,i,r,s){for(var o=null,u=this.verticesStart;u<this.verticesStart+this.verticesCount;u+=2){var a=t[u],h=t[u+1],l=e.intersectionSegment(a,h,r);if(!(l<0)&&((s||!o||l<o.distance)&&((o=new n.IntersectionInfo(null,null,l)).faceId=u/2,s)))break}return o},o.prototype._intersectTriangles=function(e,t,n,i,r,s,o){for(var u=null,a=-1,h=this.indexStart;h<this.indexStart+this.indexCount;h+=i){a++;var l=n[h],f=n[h+1],d=n[h+2];if(r&&4294967295===d)h+=2;else{var c=t[l],g=t[f],_=t[d];if(!o||o(c,g,_,e)){var m=e.intersectsTriangle(c,g,_);if(m){if(m.distance<0)continue;if((s||!u||m.distance<u.distance)&&((u=m).faceId=a,s))break}}}}return u},o.prototype._intersectUnIndexedTriangles=function(e,t,n,i,r){for(var s=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=3){var u=t[o],a=t[o+1],h=t[o+2];if(!r||r(u,a,h,e)){var l=e.intersectsTriangle(u,a,h);if(l){if(l.distance<0)continue;if((i||!s||l.distance<s.distance)&&((s=l).faceId=o/3,i))break}}}return s},o.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},o.prototype.clone=function(e,t){var n=new o(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){var r=this.getBoundingInfo();if(!r)return n;n._boundingInfo=new i.BoundingInfo(r.minimum,r.maximum)}return n},o.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},o.prototype.getClassName=function(){return"SubMesh"},o.CreateFromIndices=function(e,t,n,i,r){for(var s=Number.MAX_VALUE,u=-Number.MAX_VALUE,a=(r||i).getIndices(),h=t;h<t+n;h++){var l=a[h];l<s&&(s=l),l>u&&(u=l)}return new o(e,s,u-s+1,t,n,i,r)},o}(s);exports.SubMesh=o;
},{"tslib":"90Cu","./buffer":"clDe","../Collisions/intersectionInfo":"GlKa","../Culling/boundingInfo":"j0r+","../Maths/math.functions":"WWKm"}],"zMir":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Material=void 0;var e=require("tslib"),t=require("../Misc/decorators"),i=require("../Misc/tools"),r=require("../Misc/observable"),s=require("../Engines/engineStore"),n=require("../Meshes/subMesh"),a=require("./uniformBuffer"),o=require("../Misc/logger"),l=require("../Maths/math.plane"),c=function(){function c(e,t,n){this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new r.Observable,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=c.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this.name=e,this.id=e||i.Tools.RandomId(),this._scene=t||s.EngineStore.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=c.ClockWiseSideOrientation:this.sideOrientation=c.CounterClockWiseSideOrientation,this._uniformBuffer=new a.UniformBuffer(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,n||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(c.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alpha=e,this.markAsDirty(c.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(c.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new r.Observable),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new r.Observable),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(c.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(c.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"wireframe",{get:function(){switch(this._fillMode){case c.WireFrameFillMode:case c.LineListDrawMode:case c.LineLoopDrawMode:case c.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(e){this.fillMode=e?c.WireFrameFillMode:c.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case c.PointFillMode:case c.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(e){this.fillMode=e?c.PointFillMode:c.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fillMode",{get:function(){return this._fillMode},set:function(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(c.MiscDirtyFlag))},enumerable:!0,configurable:!0}),c.prototype.toString=function(e){return"Name: "+this.name},c.prototype.getClassName=function(){return"Material"},Object.defineProperty(c.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),c.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},c.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},c.prototype.isReady=function(e,t){return!0},c.prototype.isReadyForSubMesh=function(e,t,i){return!1},c.prototype.getEffect=function(){return this._effect},c.prototype.getScene=function(){return this._scene},c.prototype.needAlphaBlending=function(){return this.alpha<1},c.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha},c.prototype.needAlphaTesting=function(){return!1},c.prototype.getAlphaTestTexture=function(){return null},c.prototype.markDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var i=t[e];if(i.subMeshes)for(var r=0,s=i.subMeshes;r<s.length;r++){var n=s[r];n.getMaterial()===this&&(n.effect&&(n.effect._wasPreviouslyReady=!1))}}},c.prototype._preBind=function(e,t){void 0===t&&(t=null);var i=this._scene.getEngine(),r=(null==t?this.sideOrientation:t)===c.ClockWiseSideOrientation;return i.enableEffect(e||this._effect),i.setState(this.backFaceCulling,this.zOffset,!1,r),r},c.prototype.bind=function(e,t){},c.prototype.bindForSubMesh=function(e,t,i){},c.prototype.bindOnlyWorldMatrix=function(e){},c.prototype.bindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},c.prototype.bindView=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("view",this.getScene().getViewMatrix())},c.prototype.bindViewProjection=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("viewProjection",this.getScene().getTransformMatrix())},c.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},c.prototype._afterBind=function(e){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}if(0!==this.depthFunction){t=this._scene.getEngine();this._cachedDepthFunctionState=t.getDepthFunction()||0,t.setDepthFunction(this.depthFunction)}},c.prototype.unbind=function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction)&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState);this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},c.prototype.getActiveTextures=function(){return[]},c.prototype.hasTexture=function(e){return!1},c.prototype.clone=function(e){return null},c.prototype.getBindedMeshes=function(){var e=this;if(this.meshMap){var t=new Array;for(var i in this.meshMap){var r=this.meshMap[i];r&&t.push(r)}return t}return this._scene.meshes.filter(function(t){return t.material===e})},c.prototype.forceCompilation=function(t,i,r,s){var a=this,o=(0,e.__assign)({clipPlane:!1,useInstances:!1},r),c=new n.BaseSubMesh,h=this.getScene(),u=function(){if(a._scene&&a._scene.getEngine()){c._materialDefines&&(c._materialDefines._renderId=-1);var e=h.clipPlane;o.clipPlane&&(h.clipPlane=new l.Plane(0,0,0,1)),a._storeEffectOnSubMeshes?a.isReadyForSubMesh(t,c,o.useInstances)?i&&i(a):c.effect&&c.effect.getCompilationError()&&c.effect.allFallbacksProcessed()?s&&s(c.effect.getCompilationError()):setTimeout(u,16):a.isReady()?i&&i(a):setTimeout(u,16),o.clipPlane&&(h.clipPlane=e)}};u()},c.prototype.forceCompilationAsync=function(e,t){var i=this;return new Promise(function(r,s){i.forceCompilation(e,function(){r()},t,function(e){s(e)})})},c.prototype.markAsDirty=function(e){this.getScene().blockMaterialDirtyMechanism||(c._DirtyCallbackArray.length=0,e&c.TextureDirtyFlag&&c._DirtyCallbackArray.push(c._TextureDirtyCallBack),e&c.LightDirtyFlag&&c._DirtyCallbackArray.push(c._LightsDirtyCallBack),e&c.FresnelDirtyFlag&&c._DirtyCallbackArray.push(c._FresnelDirtyCallBack),e&c.AttributesDirtyFlag&&c._DirtyCallbackArray.push(c._AttributeDirtyCallBack),e&c.MiscDirtyFlag&&c._DirtyCallbackArray.push(c._MiscDirtyCallBack),c._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(c._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},c.prototype._markAllSubMeshesAsDirty=function(e){if(!this.getScene().blockMaterialDirtyMechanism)for(var t=0,i=this.getScene().meshes;t<i.length;t++){var r=i[t];if(r.subMeshes)for(var s=0,n=r.subMeshes;s<n.length;s++){var a=n[s];a.getMaterial()===this&&(a._materialDefines&&e(a._materialDefines))}}},c.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(c._AllDirtyCallBack)},c.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(c._ImageProcessingDirtyCallBack)},c.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(c._TextureDirtyCallBack)},c.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(c._FresnelDirtyCallBack)},c.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(c._FresnelAndMiscDirtyCallBack)},c.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(c._LightsDirtyCallBack)},c.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(c._AttributeDirtyCallBack)},c.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(c._MiscDirtyCallBack)},c.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(c._TextureAndMiscDirtyCallBack)},c.prototype.dispose=function(e,t,i){var r=this.getScene();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),!0!==i)if(this.meshMap)for(var s in this.meshMap){(o=this.meshMap[s])&&(o.material=null,this.releaseVertexArrayObject(o,e))}else for(var n=0,a=r.meshes;n<a.length;n++){var o;(o=a[n]).material!==this||o.sourceMesh||(o.material=null,this.releaseVertexArrayObject(o,e))}this._uniformBuffer.dispose(),e&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},c.prototype.releaseVertexArrayObject=function(e,t){if(e.geometry){var i=e.geometry;if(this._storeEffectOnSubMeshes)for(var r=0,s=e.subMeshes;r<s.length;r++){var n=s[r];i._releaseVertexArrayObject(n._materialEffect),t&&n._materialEffect&&n._materialEffect.dispose()}else i._releaseVertexArrayObject(this._effect)}},c.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},c.Parse=function(e,t,r){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return o.Logger.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";return i.Tools.Instantiate(e.customType).Parse(e,t,r)},c.TriangleFillMode=0,c.WireFrameFillMode=1,c.PointFillMode=2,c.PointListDrawMode=3,c.LineListDrawMode=4,c.LineLoopDrawMode=5,c.LineStripDrawMode=6,c.TriangleStripDrawMode=7,c.TriangleFanDrawMode=8,c.ClockWiseSideOrientation=0,c.CounterClockWiseSideOrientation=1,c.TextureDirtyFlag=1,c.LightDirtyFlag=2,c.FresnelDirtyFlag=4,c.AttributesDirtyFlag=8,c.MiscDirtyFlag=16,c.AllDirtyFlag=31,c._AllDirtyCallBack=function(e){return e.markAllAsDirty()},c._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},c._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},c._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},c._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},c._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},c._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},c._FresnelAndMiscDirtyCallBack=function(e){c._FresnelDirtyCallBack(e),c._MiscDirtyCallBack(e)},c._TextureAndMiscDirtyCallBack=function(e){c._TextureDirtyCallBack(e),c._MiscDirtyCallBack(e)},c._DirtyCallbackArray=[],c._RunDirtyCallBacks=function(e){for(var t=0,i=c._DirtyCallbackArray;t<i.length;t++){(0,i[t])(e)}},(0,e.__decorate)([(0,t.serialize)()],c.prototype,"id",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"uniqueId",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"name",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"checkReadyOnEveryCall",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"checkReadyOnlyOnce",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"state",void 0),(0,e.__decorate)([(0,t.serialize)("alpha")],c.prototype,"_alpha",void 0),(0,e.__decorate)([(0,t.serialize)("backFaceCulling")],c.prototype,"_backFaceCulling",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"sideOrientation",void 0),(0,e.__decorate)([(0,t.serialize)("alphaMode")],c.prototype,"_alphaMode",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"_needDepthPrePass",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"disableDepthWrite",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"forceDepthWrite",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"depthFunction",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"separateCullingPass",void 0),(0,e.__decorate)([(0,t.serialize)("fogEnabled")],c.prototype,"_fogEnabled",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"pointSize",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"zOffset",void 0),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"wireframe",null),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"pointsCloud",null),(0,e.__decorate)([(0,t.serialize)()],c.prototype,"fillMode",null),c}();exports.Material=c;
},{"tslib":"90Cu","../Misc/decorators":"EVXT","../Misc/tools":"8xSa","../Misc/observable":"vY1+","../Engines/engineStore":"cq+N","../Meshes/subMesh":"xQHL","./uniformBuffer":"S1/f","../Misc/logger":"Yh4i","../Maths/math.plane":"VdRi"}],"lx6p":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PostProcessManager=void 0;var e=require("../Materials/material"),r=require("../Meshes/buffer"),t=function(){function t(e){this._vertexBuffers={},this._scene=e}return t.prototype._prepareBuffers=function(){if(!this._vertexBuffers[r.VertexBuffer.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[r.VertexBuffer.PositionKind]=new r.VertexBuffer(this._scene.getEngine(),e,r.VertexBuffer.PositionKind,!1,!1,2),this._buildIndexBuffer()}},t.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},t.prototype._rebuild=function(){var e=this._vertexBuffers[r.VertexBuffer.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},t.prototype._prepareFrame=function(e,r){void 0===e&&(e=null),void 0===r&&(r=null);var t=this._scene.activeCamera;return!!t&&(!(!(r=r||t._postProcesses.filter(function(e){return null!=e}))||0===r.length||!this._scene.postProcessesEnabled)&&(r[0].activate(t,e,null!=r),!0))},t.prototype.directRender=function(r,t,s,i,n){void 0===t&&(t=null),void 0===s&&(s=!1),void 0===i&&(i=0),void 0===n&&(n=0);for(var f=this._scene.getEngine(),u=0;u<r.length;u++){u<r.length-1?r[u+1].activate(this._scene.activeCamera,t):t?f.bindFramebuffer(t,i,void 0,void 0,s,n):f.restoreDefaultFramebuffer();var o=r[u],a=o.apply();a&&(o.onBeforeRenderObservable.notifyObservers(a),this._prepareBuffers(),f.bindBuffers(this._vertexBuffers,this._indexBuffer,a),f.drawElementsType(e.Material.TriangleFillMode,0,6),o.onAfterRenderObservable.notifyObservers(a))}f.setDepthBuffer(!0),f.setDepthWrite(!0)},t.prototype._finalizeFrame=function(r,t,s,i,n){void 0===n&&(n=!1);var f=this._scene.activeCamera;if(f&&0!==(i=i||f._postProcesses.filter(function(e){return null!=e})).length&&this._scene.postProcessesEnabled){for(var u=this._scene.getEngine(),o=0,a=i.length;o<a;o++){var l=i[o];if(o<a-1?l._outputTexture=i[o+1].activate(f,t):t?(u.bindFramebuffer(t,s,void 0,void 0,n),l._outputTexture=t):(u.restoreDefaultFramebuffer(),l._outputTexture=null),r)break;var p=l.apply();p&&(l.onBeforeRenderObservable.notifyObservers(p),this._prepareBuffers(),u.bindBuffers(this._vertexBuffers,this._indexBuffer,p),u.drawElementsType(e.Material.TriangleFillMode,0,6),l.onAfterRenderObservable.notifyObservers(p))}u.setDepthBuffer(!0),u.setDepthWrite(!0),u.setAlphaMode(0)}},t.prototype.dispose=function(){var e=this._vertexBuffers[r.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[r.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},t}();exports.PostProcessManager=t;
},{"../Materials/material":"zMir","../Meshes/buffer":"clDe"}],"/j8S":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderingGroup=void 0;var e=require("../Misc/smartArray"),t=require("../Maths/math.vector"),r=function(){function r(t,r,s,n,a){void 0===s&&(s=null),void 0===n&&(n=null),void 0===a&&(a=null),this.index=t,this._opaqueSubMeshes=new e.SmartArray(256),this._transparentSubMeshes=new e.SmartArray(256),this._alphaTestSubMeshes=new e.SmartArray(256),this._depthOnlySubMeshes=new e.SmartArray(256),this._particleSystems=new e.SmartArray(256),this._spriteManagers=new e.SmartArray(256),this._edgesRenderers=new e.SmartArray(16),this._scene=r,this.opaqueSortCompareFn=s,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=a}return Object.defineProperty(r.prototype,"opaqueSortCompareFn",{set:function(e){this._opaqueSortCompareFn=e,this._renderOpaque=e?this.renderOpaqueSorted:r.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"alphaTestSortCompareFn",{set:function(e){this._alphaTestSortCompareFn=e,this._renderAlphaTest=e?this.renderAlphaTestSorted:r.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"transparentSortCompareFn",{set:function(e){this._transparentSortCompareFn=e||r.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),r.prototype.render=function(e,t,r,s){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var n=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(n.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),n.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var a=n.getStencilBuffer();if(n.setStencilBuffer(!1),t&&this._renderSprites(),r&&this._renderParticles(s),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),n.setAlphaMode(0)),n.setStencilBuffer(!1),this._edgesRenderers.length){for(var i=0;i<this._edgesRenderers.length;i++)this._edgesRenderers.data[i].render();n.setAlphaMode(0)}n.setStencilBuffer(a)}},r.prototype.renderOpaqueSorted=function(e){return r.renderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},r.prototype.renderAlphaTestSorted=function(e){return r.renderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},r.prototype.renderTransparentSorted=function(e){return r.renderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)},r.renderSorted=function(e,s,n,a){for(var i,o=0,h=n?n.globalPosition:r._zeroVector;o<e.length;o++)(i=e.data[o])._alphaIndex=i.getMesh().alphaIndex,i._distanceToCamera=t.Vector3.Distance(i.getBoundingInfo().boundingSphere.centerWorld,h);var p=e.data.slice(0,e.length);for(s&&p.sort(s),o=0;o<p.length;o++){if(i=p[o],a){var d=i.getMaterial();if(d&&d.needDepthPrePass){var u=d.getScene().getEngine();u.setColorWrite(!1),u.setAlphaMode(0),i.render(!1),u.setColorWrite(!0)}}i.render(a)}},r.renderUnsorted=function(e){for(var t=0;t<e.length;t++){e.data[t].render(!1)}},r.defaultTransparentSortCompare=function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:r.backToFrontSortCompare(e,t)},r.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},r.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},r.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},r.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},r.prototype.dispatch=function(e,t,r){void 0===t&&(t=e.getMesh()),void 0===r&&(r=e.getMaterial()),null!=r&&(r.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):r.needAlphaTesting()?(r.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(r.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.push(t._edgesRenderer))},r.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},r.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},r.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var r=0;r<this._particleSystems.length;r++){var s=this._particleSystems.data[r];if(0!==(t&&t.layerMask&s.layerMask)){var n=s.emitter;n.position&&e&&-1===e.indexOf(n)||this._scene._activeParticles.addCount(s.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},r.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var r=this._spriteManagers.data[t];0!==(e&&e.layerMask&r.layerMask)&&r.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},r._zeroVector=t.Vector3.Zero(),r}();exports.RenderingGroup=r;
},{"../Misc/smartArray":"Hnz9","../Maths/math.vector":"61Nx"}],"G1uW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderingManager=exports.RenderingGroupInfo=void 0;var e=require("./renderingGroup"),r=function(){return function(){}}();exports.RenderingGroupInfo=r;var t=function(){function t(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new r,this._scene=e;for(var n=t.MIN_RENDERINGGROUPS;n<t.MAX_RENDERINGGROUPS;n++)this._autoClearDepthStencil[n]={autoClear:!0,depth:!0,stencil:!0}}return t.prototype._clearDepthStencilBuffer=function(e,r){void 0===e&&(e=!0),void 0===r&&(r=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,r),this._depthStencilBufferAlreadyCleaned=!0)},t.prototype.render=function(e,r,n,o){var i=this._renderingGroupInfo;if(i.scene=this._scene,i.camera=this._scene.activeCamera,this._scene.spriteManagers&&o)for(var s=0;s<this._scene.spriteManagers.length;s++){var p=this._scene.spriteManagers[s];this.dispatchSprites(p)}for(s=t.MIN_RENDERINGGROUPS;s<t.MAX_RENDERINGGROUPS;s++){this._depthStencilBufferAlreadyCleaned=s===t.MIN_RENDERINGGROUPS;var a=this._renderingGroups[s];if(a){var u=Math.pow(2,s);if(i.renderingGroupId=s,this._scene.onBeforeRenderingGroupObservable.notifyObservers(i,u),t.AUTOCLEAR){var h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(s):this._autoClearDepthStencil[s];h&&h.autoClear&&this._clearDepthStencilBuffer(h.depth,h.stencil)}for(var c=0,d=this._scene._beforeRenderingGroupDrawStage;c<d.length;c++){d[c].action(s)}a.render(e,o,n,r);for(var _=0,l=this._scene._afterRenderingGroupDrawStage;_<l.length;_++){l[_].action(s)}this._scene.onAfterRenderingGroupObservable.notifyObservers(i,u)}}},t.prototype.reset=function(){for(var e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){var r=this._renderingGroups[e];r&&r.prepare()}},t.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},t.prototype.freeRenderingGroups=function(){for(var e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){var r=this._renderingGroups[e];r&&r.dispose()}},t.prototype._prepareRenderingGroup=function(r){void 0===this._renderingGroups[r]&&(this._renderingGroups[r]=new e.RenderingGroup(r,this._scene,this._customOpaqueSortCompareFn[r],this._customAlphaTestSortCompareFn[r],this._customTransparentSortCompareFn[r]))},t.prototype.dispatchSprites=function(e){var r=e.renderingGroupId||0;this._prepareRenderingGroup(r),this._renderingGroups[r].dispatchSprites(e)},t.prototype.dispatchParticles=function(e){var r=e.renderingGroupId||0;this._prepareRenderingGroup(r),this._renderingGroups[r].dispatchParticles(e)},t.prototype.dispatch=function(e,r,t){void 0===r&&(r=e.getMesh());var n=r.renderingGroupId||0;this._prepareRenderingGroup(n),this._renderingGroups[n].dispatch(e,r,t)},t.prototype.setRenderingOrder=function(e,r,t,n){if(void 0===r&&(r=null),void 0===t&&(t=null),void 0===n&&(n=null),this._customOpaqueSortCompareFn[e]=r,this._customAlphaTestSortCompareFn[e]=t,this._customTransparentSortCompareFn[e]=n,this._renderingGroups[e]){var o=this._renderingGroups[e];o.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],o.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],o.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},t.prototype.setRenderingAutoClearDepthStencil=function(e,r,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0),this._autoClearDepthStencil[e]={autoClear:r,depth:t,stencil:n}},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},t.MAX_RENDERINGGROUPS=4,t.MIN_RENDERINGGROUPS=0,t.AUTOCLEAR=!0,t}();exports.RenderingManager=t;
},{"./renderingGroup":"/j8S"}],"7t/x":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Stage=exports.SceneComponentConstants=void 0;var E=require("tslib"),R=function(){function E(){}return E.NAME_EFFECTLAYER="EffectLayer",E.NAME_LAYER="Layer",E.NAME_LENSFLARESYSTEM="LensFlareSystem",E.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",E.NAME_PARTICLESYSTEM="ParticleSystem",E.NAME_GAMEPAD="Gamepad",E.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",E.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",E.NAME_DEPTHRENDERER="DepthRenderer",E.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",E.NAME_SPRITE="Sprite",E.NAME_OUTLINERENDERER="Outline",E.NAME_PROCEDURALTEXTURE="ProceduralTexture",E.NAME_SHADOWGENERATOR="ShadowGenerator",E.NAME_OCTREE="Octree",E.NAME_PHYSICSENGINE="PhysicsEngine",E.NAME_AUDIO="Audio",E.STEP_ISREADYFORMESH_EFFECTLAYER=0,E.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,E.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,E.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,E.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,E.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,E.STEP_BEFORECAMERADRAW_LAYER=1,E.STEP_BEFORERENDERTARGETDRAW_LAYER=0,E.STEP_BEFORERENDERINGMESH_OUTLINE=0,E.STEP_AFTERRENDERINGMESH_OUTLINE=0,E.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,E.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,E.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,E.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,E.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,E.STEP_AFTERRENDERTARGETDRAW_LAYER=0,E.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,E.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,E.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,E.STEP_AFTERCAMERADRAW_LAYER=3,E.STEP_AFTERRENDER_AUDIO=0,E.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,E.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,E.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,E.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,E.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,E.STEP_POINTERMOVE_SPRITE=0,E.STEP_POINTERDOWN_SPRITE=0,E.STEP_POINTERUP_SPRITE=0,E}();exports.SceneComponentConstants=R;var A=function(R){function A(E){return R.apply(this,E)||this}return(0,E.__extends)(A,R),A.Create=function(){return Object.create(A.prototype)},A.prototype.registerStep=function(E,R,A){var T=0;for(Number.MAX_VALUE;T<this.length;T++){if(E<this[T].index)break}this.splice(T,0,{index:E,component:R,action:A.bind(R)})},A.prototype.clear=function(){this.length=0},A}(Array);exports.Stage=A;
},{"tslib":"90Cu"}],"z5YY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PointerInfo=exports.PointerInfoPre=exports.PointerInfoBase=exports.PointerEventTypes=void 0;var e=require("tslib"),t=require("../Maths/math.vector"),r=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}();exports.PointerEventTypes=r;var n=function(){return function(e,t){this.type=e,this.event=t}}();exports.PointerInfoBase=n;var o=function(r){function n(e,n,o,i){var s=r.call(this,e,n)||this;return s.ray=null,s.skipOnPointerObservable=!1,s.localPosition=new t.Vector2(o,i),s}return(0,e.__extends)(n,r),n}(n);exports.PointerInfoPre=o;var i=function(t){function r(e,r,n){var o=t.call(this,e,r)||this;return o.pickInfo=n,o}return(0,e.__extends)(r,t),r}(n);exports.PointerInfo=i;
},{"tslib":"90Cu","../Maths/math.vector":"61Nx"}],"EKXW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractActionManager=void 0;var r=function(){function r(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(r,"HasTriggers",{get:function(){for(var e in r.Triggers)if(r.Triggers.hasOwnProperty(e))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r,"HasPickTriggers",{get:function(){for(var e in r.Triggers)if(r.Triggers.hasOwnProperty(e)){var i=parseInt(e);if(i>=1&&i<=7)return!0}return!1},enumerable:!0,configurable:!0}),r.HasSpecificTrigger=function(e){for(var i in r.Triggers){if(r.Triggers.hasOwnProperty(i))if(parseInt(i)===e)return!0}return!1},r.Triggers={},r}();exports.AbstractActionManager=r;
},{}],"HUG+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KeyboardInfoPre=exports.KeyboardInfo=exports.KeyboardEventTypes=void 0;var e=require("tslib"),r=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}();exports.KeyboardEventTypes=r;var t=function(){return function(e,r){this.type=e,this.event=r}}();exports.KeyboardInfo=t;var n=function(r){function t(e,t){var n=r.call(this,e,t)||this;return n.type=e,n.event=t,n.skipOnPointerObservable=!1,n}return(0,e.__extends)(t,r),t}(t);exports.KeyboardInfoPre=n;
},{"tslib":"90Cu"}],"2Kn+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InputManager=void 0;var e=require("../Events/pointerEvents"),i=require("../Actions/abstractActionManager"),t=require("../Maths/math.vector"),r=require("../Actions/actionEvent"),n=require("../Misc/tools"),o=require("../Events/keyboardEvents"),s=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!0,configurable:!0}),e}(),a=function(){function a(e){this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new t.Vector2(0,0),this._previousStartingPointerPosition=new t.Vector2(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._scene=e}return Object.defineProperty(a.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"unTranslatedPointer",{get:function(){return new t.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!0,configurable:!0}),a.prototype._updatePointerPosition=function(e){var i=this._scene.getEngine().getInputElementClientRect();i&&(this._pointerX=e.clientX-i.left,this._pointerY=e.clientY-i.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},a.prototype._processPointerMove=function(i,t){var r=this._scene,n=r.getEngine(),o=n.getInputElement();if(o){o.tabIndex=n.canvasTabIndex,r.doNotHandleCursors||(o.style.cursor=r.defaultCursor);var s=!!(i&&i.hit&&i.pickedMesh);s?(r.setPointerOverMesh(i.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(r.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?o.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:o.style.cursor=r.hoverCursor))):r.setPointerOverMesh(null);for(var a=0,c=r._pointerMoveStage;a<c.length;a++){i=c[a].action(this._unTranslatedPointerX,this._unTranslatedPointerY,i,s,o)}if(i){var P=t.type===this._wheelEventName?e.PointerEventTypes.POINTERWHEEL:e.PointerEventTypes.POINTERMOVE;if(r.onPointerMove&&r.onPointerMove(t,i,P),r.onPointerObservable.hasObservers()){var l=new e.PointerInfo(P,t,i);this._setRayOnPointerInfo(l),r.onPointerObservable.notifyObservers(l,P)}}}},a.prototype._setRayOnPointerInfo=function(e){var i=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=i.createPickingRay(e.event.offsetX,e.event.offsetY,t.Matrix.Identity(),i.activeCamera)))},a.prototype._checkPrePointerObservable=function(i,t,r){var n=this._scene,o=new e.PointerInfoPre(r,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return i&&(o.ray=i.ray),n.onPrePointerObservable.notifyObservers(o,r),!!o.skipOnPointerObservable},a.prototype.simulatePointerMove=function(i,t){var r=new PointerEvent("pointermove",t);this._checkPrePointerObservable(i,r,e.PointerEventTypes.POINTERMOVE)||this._processPointerMove(i,r)},a.prototype.simulatePointerDown=function(i,t){var r=new PointerEvent("pointerdown",t);this._checkPrePointerObservable(i,r,e.PointerEventTypes.POINTERDOWN)||this._processPointerDown(i,r)},a.prototype._processPointerDown=function(i,t){var n=this,o=this._scene;if(i&&i.hit&&i.pickedMesh){this._pickedDownMesh=i.pickedMesh;var s=i.pickedMesh._getActionManagerForTrigger();if(s){if(s.hasPickTriggers)switch(s.processTrigger(5,r.ActionEvent.CreateNew(i.pickedMesh,t)),t.button){case 0:s.processTrigger(2,r.ActionEvent.CreateNew(i.pickedMesh,t));break;case 1:s.processTrigger(4,r.ActionEvent.CreateNew(i.pickedMesh,t));break;case 2:s.processTrigger(3,r.ActionEvent.CreateNew(i.pickedMesh,t))}s.hasSpecificTrigger(8)&&window.setTimeout(function(){var e=o.pick(n._unTranslatedPointerX,n._unTranslatedPointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e==n._pickedDownMesh},!1,o.cameraToUseForPointers);e&&e.hit&&e.pickedMesh&&s&&0!==n._totalPointersPressed&&Date.now()-n._startingPointerTime>a.LongPressDelay&&!n._isPointerSwiping()&&(n._startingPointerTime=0,s.processTrigger(8,r.ActionEvent.CreateNew(e.pickedMesh,t)))},a.LongPressDelay)}}else for(var c=0,P=o._pointerDownStage;c<P.length;c++){i=P[c].action(this._unTranslatedPointerX,this._unTranslatedPointerY,i,t)}if(i){var l=e.PointerEventTypes.POINTERDOWN;if(o.onPointerDown&&o.onPointerDown(t,i,l),o.onPointerObservable.hasObservers()){var p=new e.PointerInfo(l,t,i);this._setRayOnPointerInfo(p),o.onPointerObservable.notifyObservers(p,l)}}},a.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>a.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>a.DragMovementThreshold},a.prototype.simulatePointerUp=function(i,t,r){var n=new PointerEvent("pointerup",t),o=new s;r?o.doubleClick=!0:o.singleClick=!0,this._checkPrePointerObservable(i,n,e.PointerEventTypes.POINTERUP)||this._processPointerUp(i,n,o)},a.prototype._processPointerUp=function(i,t,n){var o=this._scene;if(i&&i&&i.pickedMesh){if(this._pickedUpMesh=i.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(o.onPointerPick&&o.onPointerPick(t,i),n.singleClick&&!n.ignore&&o.onPointerObservable.hasObservers())){var s=e.PointerEventTypes.POINTERPICK,a=new e.PointerInfo(s,t,i);this._setRayOnPointerInfo(a),o.onPointerObservable.notifyObservers(a,s)}var c=i.pickedMesh._getActionManagerForTrigger();if(c&&!n.ignore){c.processTrigger(7,r.ActionEvent.CreateNew(i.pickedMesh,t)),!n.hasSwiped&&n.singleClick&&c.processTrigger(1,r.ActionEvent.CreateNew(i.pickedMesh,t));var P=i.pickedMesh._getActionManagerForTrigger(6);n.doubleClick&&P&&P.processTrigger(6,r.ActionEvent.CreateNew(i.pickedMesh,t))}}else if(!n.ignore)for(var l=0,p=o._pointerUpStage;l<p.length;l++){i=p[l].action(this._unTranslatedPointerX,this._unTranslatedPointerY,i,t)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var v=this._pickedDownMesh._getActionManagerForTrigger(16);v&&v.processTrigger(16,r.ActionEvent.CreateNew(this._pickedDownMesh,t))}var u=0;if(o.onPointerObservable.hasObservers()){if(!n.ignore&&!n.hasSwiped&&(n.singleClick&&o.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP)?u=e.PointerEventTypes.POINTERTAP:n.doubleClick&&o.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)&&(u=e.PointerEventTypes.POINTERDOUBLETAP),u)){a=new e.PointerInfo(u,t,i);this._setRayOnPointerInfo(a),o.onPointerObservable.notifyObservers(a,u)}if(!n.ignore){u=e.PointerEventTypes.POINTERUP;a=new e.PointerInfo(u,t,i);this._setRayOnPointerInfo(a),o.onPointerObservable.notifyObservers(a,u)}}o.onPointerUp&&!n.ignore&&o.onPointerUp(t,i,u)},a.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._pointerCaptures[e]},a.prototype.attachControl=function(t,c,P,l){var p=this;void 0===t&&(t=!0),void 0===c&&(c=!0),void 0===P&&(P=!0),void 0===l&&(l=null);var v=this._scene;if(l||(l=v.getEngine().getInputElement()),l){var u,h=v.getEngine();this._initActionManager=function(e,i){if(!p._meshPickProceed){var t=v.pick(p._unTranslatedPointerX,p._unTranslatedPointerY,v.pointerDownPredicate,!1,v.cameraToUseForPointers);p._currentPickResult=t,t&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),p._meshPickProceed=!0}return e},this._delayedSimpleClick=function(e,i,t){(Date.now()-p._previousStartingPointerTime>a.DoubleClickDelay&&!p._doubleClickOccured||e!==p._previousButtonPressed)&&(p._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,t(i,p._currentPickResult))},this._initClickEvent=function(t,r,n,o){var c=new s;p._currentPickResult=null;var P=null,l=t.hasSpecificMask(e.PointerEventTypes.POINTERPICK)||r.hasSpecificMask(e.PointerEventTypes.POINTERPICK)||t.hasSpecificMask(e.PointerEventTypes.POINTERTAP)||r.hasSpecificMask(e.PointerEventTypes.POINTERTAP)||t.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)||r.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP);!l&&i.AbstractActionManager&&(P=p._initActionManager(P,c))&&(l=P.hasPickTriggers);var v=!1;if(l){var u=n.button;if(c.hasSwiped=p._isPointerSwiping(),!c.hasSwiped){var h=!a.ExclusiveDoubleClickMode;h||(h=!t.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)&&!r.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP))&&!i.AbstractActionManager.HasSpecificTrigger(6)&&(P=p._initActionManager(P,c))&&(h=!P.hasSpecificTrigger(6)),h?(Date.now()-p._previousStartingPointerTime>a.DoubleClickDelay||u!==p._previousButtonPressed)&&(c.singleClick=!0,o(c,p._currentPickResult),v=!0):(p._previousDelayedSimpleClickTimeout=p._delayedSimpleClickTimeout,p._delayedSimpleClickTimeout=window.setTimeout(p._delayedSimpleClick.bind(p,u,c,o),a.DoubleClickDelay));var _=t.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)||r.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP);!_&&i.AbstractActionManager.HasSpecificTrigger(6)&&(P=p._initActionManager(P,c))&&(_=P.hasSpecificTrigger(6)),_&&(u===p._previousButtonPressed&&Date.now()-p._previousStartingPointerTime<a.DoubleClickDelay&&!p._doubleClickOccured?(c.hasSwiped||p._isPointerSwiping()?(p._doubleClickOccured=!1,p._previousStartingPointerTime=p._startingPointerTime,p._previousStartingPointerPosition.x=p._startingPointerPosition.x,p._previousStartingPointerPosition.y=p._startingPointerPosition.y,p._previousButtonPressed=u,a.ExclusiveDoubleClickMode?(p._previousDelayedSimpleClickTimeout&&clearTimeout(p._previousDelayedSimpleClickTimeout),p._previousDelayedSimpleClickTimeout=p._delayedSimpleClickTimeout,o(c,p._previousPickResult)):o(c,p._currentPickResult)):(p._previousStartingPointerTime=0,p._doubleClickOccured=!0,c.doubleClick=!0,c.ignore=!1,a.ExclusiveDoubleClickMode&&p._previousDelayedSimpleClickTimeout&&clearTimeout(p._previousDelayedSimpleClickTimeout),p._previousDelayedSimpleClickTimeout=p._delayedSimpleClickTimeout,o(c,p._currentPickResult)),v=!0):(p._doubleClickOccured=!1,p._previousStartingPointerTime=p._startingPointerTime,p._previousStartingPointerPosition.x=p._startingPointerPosition.x,p._previousStartingPointerPosition.y=p._startingPointerPosition.y,p._previousButtonPressed=u))}}v||o(c,p._currentPickResult)},this._onPointerMove=function(i){if(p._updatePointerPosition(i),!p._checkPrePointerObservable(null,i,i.type===p._wheelEventName?e.PointerEventTypes.POINTERWHEEL:e.PointerEventTypes.POINTERMOVE)&&(v.cameraToUseForPointers||v.activeCamera)){v.pointerMovePredicate||(v.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||v.constantlyUpdateMeshUnderPointer||null!=e._getActionManagerForTrigger())&&(!v.cameraToUseForPointers||0!=(v.cameraToUseForPointers.layerMask&e.layerMask))});var t=v.pick(p._unTranslatedPointerX,p._unTranslatedPointerY,v.pointerMovePredicate,!1,v.cameraToUseForPointers);p._processPointerMove(t,i)}},this._onPointerDown=function(i){if(p._totalPointersPressed++,p._pickedDownMesh=null,p._meshPickProceed=!1,p._updatePointerPosition(i),v.preventDefaultOnPointerDown&&l&&(i.preventDefault(),l.focus()),p._startingPointerPosition.x=p._pointerX,p._startingPointerPosition.y=p._pointerY,p._startingPointerTime=Date.now(),!p._checkPrePointerObservable(null,i,e.PointerEventTypes.POINTERDOWN)&&(v.cameraToUseForPointers||v.activeCamera)){p._pointerCaptures[i.pointerId]=!0,v.pointerDownPredicate||(v.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!v.cameraToUseForPointers||0!=(v.cameraToUseForPointers.layerMask&e.layerMask))}),p._pickedDownMesh=null;var t=v.pick(p._unTranslatedPointerX,p._unTranslatedPointerY,v.pointerDownPredicate,!1,v.cameraToUseForPointers);p._processPointerDown(t,i)}},this._onPointerUp=function(t){0!==p._totalPointersPressed&&(p._totalPointersPressed--,p._pickedUpMesh=null,p._meshPickProceed=!1,p._updatePointerPosition(t),v.preventDefaultOnPointerUp&&l&&(t.preventDefault(),l.focus()),p._initClickEvent(v.onPrePointerObservable,v.onPointerObservable,t,function(r,n){if(v.onPrePointerObservable.hasObservers()&&!r.ignore){if(!r.hasSwiped){if(r.singleClick&&v.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP)&&p._checkPrePointerObservable(null,t,e.PointerEventTypes.POINTERTAP))return;if(r.doubleClick&&v.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)&&p._checkPrePointerObservable(null,t,e.PointerEventTypes.POINTERDOUBLETAP))return}if(p._checkPrePointerObservable(null,t,e.PointerEventTypes.POINTERUP))return}p._pointerCaptures[t.pointerId]&&(p._pointerCaptures[t.pointerId]=!1,(v.cameraToUseForPointers||v.activeCamera)&&(v.pointerUpPredicate||(v.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!v.cameraToUseForPointers||0!=(v.cameraToUseForPointers.layerMask&e.layerMask))}),!p._meshPickProceed&&(i.AbstractActionManager&&i.AbstractActionManager.HasTriggers||v.onPointerObservable.hasObservers())&&p._initActionManager(null,r),n||(n=p._currentPickResult),p._processPointerUp(n,t,r),p._previousPickResult=p._currentPickResult))}))},this._onKeyDown=function(e){var i=o.KeyboardEventTypes.KEYDOWN;if(v.onPreKeyboardObservable.hasObservers()){var t=new o.KeyboardInfoPre(i,e);if(v.onPreKeyboardObservable.notifyObservers(t,i),t.skipOnPointerObservable)return}if(v.onKeyboardObservable.hasObservers()){t=new o.KeyboardInfo(i,e);v.onKeyboardObservable.notifyObservers(t,i)}v.actionManager&&v.actionManager.processTrigger(14,r.ActionEvent.CreateNewFromScene(v,e))},this._onKeyUp=function(e){var i=o.KeyboardEventTypes.KEYUP;if(v.onPreKeyboardObservable.hasObservers()){var t=new o.KeyboardInfoPre(i,e);if(v.onPreKeyboardObservable.notifyObservers(t,i),t.skipOnPointerObservable)return}if(v.onKeyboardObservable.hasObservers()){t=new o.KeyboardInfo(i,e);v.onKeyboardObservable.notifyObservers(t,i)}v.actionManager&&v.actionManager.processTrigger(15,r.ActionEvent.CreateNewFromScene(v,e))},this._onCanvasFocusObserver=h.onCanvasFocusObservable.add((u=function(){l&&(l.addEventListener("keydown",p._onKeyDown,!1),l.addEventListener("keyup",p._onKeyUp,!1))},document.activeElement===l&&u(),u)),this._onCanvasBlurObserver=h.onCanvasBlurObservable.add(function(){l&&(l.removeEventListener("keydown",p._onKeyDown),l.removeEventListener("keyup",p._onKeyUp))});var _=n.Tools.GetPointerPrefix();if(P&&(l.addEventListener(_+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",l.addEventListener(this._wheelEventName,this._onPointerMove,!1)),c&&l.addEventListener(_+"down",this._onPointerDown,!1),t){var d=v.getEngine().getHostWindow();d&&d.addEventListener(_+"up",this._onPointerUp,!1)}}},a.prototype.detachControl=function(){var e=n.Tools.GetPointerPrefix(),i=this._scene.getEngine().getInputElement(),t=this._scene.getEngine();i&&(i.removeEventListener(e+"move",this._onPointerMove),i.removeEventListener(this._wheelEventName,this._onPointerMove),i.removeEventListener(e+"down",this._onPointerDown),window.removeEventListener(e+"up",this._onPointerUp),this._onCanvasBlurObserver&&t.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&t.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),i.removeEventListener("keydown",this._onKeyDown),i.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(i.style.cursor=this._scene.defaultCursor))},a.prototype.setPointerOverMesh=function(e){var i;this._pointerOverMesh!==e&&(this._pointerOverMesh&&(i=this._pointerOverMesh._getActionManagerForTrigger(10))&&i.processTrigger(10,r.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=e,this._pointerOverMesh&&(i=this._pointerOverMesh._getActionManagerForTrigger(9))&&i.processTrigger(9,r.ActionEvent.CreateNew(this._pointerOverMesh)))},a.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},a.DragMovementThreshold=10,a.LongPressDelay=500,a.DoubleClickDelay=300,a.ExclusiveDoubleClickMode=!1,a}();exports.InputManager=a;
},{"../Events/pointerEvents":"z5YY","../Actions/abstractActionManager":"EKXW","../Maths/math.vector":"61Nx","../Actions/actionEvent":"8u+X","../Misc/tools":"8xSa","../Events/keyboardEvents":"HUG+"}],"GIF2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UniqueIdGenerator=void 0;var e=function(){function e(){}return Object.defineProperty(e,"UniqueId",{get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e},enumerable:!0,configurable:!0}),e._UniqueIdCounter=0,e}();exports.UniqueIdGenerator=e;
},{}],"TiFm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scene=void 0;var e=require("tslib"),t=require("./Misc/tools"),r=require("./Misc/precisionDate"),i=require("./Misc/observable"),s=require("./Misc/smartArray"),n=require("./Misc/stringDictionary"),a=require("./Misc/tags"),o=require("./Maths/math.vector"),h=require("./Meshes/transformNode"),l=require("./Meshes/abstractMesh"),u=require("./Cameras/camera"),c=require("./abstractScene"),d=require("./Materials/imageProcessingConfiguration"),f=require("./Materials/uniformBuffer"),p=require("./Lights/light"),g=require("./Collisions/pickingInfo"),m=require("./Actions/actionEvent"),v=require("./PostProcesses/postProcessManager"),b=require("./Rendering/renderingManager"),_=require("./sceneComponent"),y=require("./Misc/domManagement"),M=require("./Misc/logger"),C=require("./Engines/engineStore"),O=require("./Misc/devTools"),R=require("./Inputs/scene.inputManager"),A=require("./Misc/perfCounter"),S=require("./Maths/math.color"),D=require("./Maths/math.frustum"),w=require("./Misc/uniqueIdGenerator"),T=require("./Misc/fileTools"),P=function(c){function P(t,r){var n=c.call(this)||this;n._inputManager=new R.InputManager(n),n.cameraToUseForPointers=null,n._isScene=!0,n._blockEntityCollection=!1,n.autoClear=!0,n.autoClearDepthAndStencil=!0,n.clearColor=new S.Color4(.2,.2,.3,1),n.ambientColor=new S.Color3(0,0,0),n._environmentIntensity=1,n._forceWireframe=!1,n._skipFrustumClipping=!1,n._forcePointsCloud=!1,n.animationsEnabled=!0,n._animationPropertiesOverride=null,n.useConstantAnimationDeltaTime=!1,n.constantlyUpdateMeshUnderPointer=!1,n.hoverCursor="pointer",n.defaultCursor="",n.doNotHandleCursors=!1,n.preventDefaultOnPointerDown=!0,n.preventDefaultOnPointerUp=!0,n.metadata=null,n.reservedDataStore=null,n.disableOfflineSupportExceptionRules=new Array,n.onDisposeObservable=new i.Observable,n._onDisposeObserver=null,n.onBeforeRenderObservable=new i.Observable,n._onBeforeRenderObserver=null,n.onAfterRenderObservable=new i.Observable,n.onAfterRenderCameraObservable=new i.Observable,n._onAfterRenderObserver=null,n.onBeforeAnimationsObservable=new i.Observable,n.onAfterAnimationsObservable=new i.Observable,n.onBeforeDrawPhaseObservable=new i.Observable,n.onAfterDrawPhaseObservable=new i.Observable,n.onReadyObservable=new i.Observable,n.onBeforeCameraRenderObservable=new i.Observable,n._onBeforeCameraRenderObserver=null,n.onAfterCameraRenderObservable=new i.Observable,n._onAfterCameraRenderObserver=null,n.onBeforeActiveMeshesEvaluationObservable=new i.Observable,n.onAfterActiveMeshesEvaluationObservable=new i.Observable,n.onBeforeParticlesRenderingObservable=new i.Observable,n.onAfterParticlesRenderingObservable=new i.Observable,n.onDataLoadedObservable=new i.Observable,n.onNewCameraAddedObservable=new i.Observable,n.onCameraRemovedObservable=new i.Observable,n.onNewLightAddedObservable=new i.Observable,n.onLightRemovedObservable=new i.Observable,n.onNewGeometryAddedObservable=new i.Observable,n.onGeometryRemovedObservable=new i.Observable,n.onNewTransformNodeAddedObservable=new i.Observable,n.onTransformNodeRemovedObservable=new i.Observable,n.onNewMeshAddedObservable=new i.Observable,n.onMeshRemovedObservable=new i.Observable,n.onNewSkeletonAddedObservable=new i.Observable,n.onSkeletonRemovedObservable=new i.Observable,n.onNewMaterialAddedObservable=new i.Observable,n.onMaterialRemovedObservable=new i.Observable,n.onNewTextureAddedObservable=new i.Observable,n.onTextureRemovedObservable=new i.Observable,n.onBeforeRenderTargetsRenderObservable=new i.Observable,n.onAfterRenderTargetsRenderObservable=new i.Observable,n.onBeforeStepObservable=new i.Observable,n.onAfterStepObservable=new i.Observable,n.onActiveCameraChanged=new i.Observable,n.onBeforeRenderingGroupObservable=new i.Observable,n.onAfterRenderingGroupObservable=new i.Observable,n.onMeshImportedObservable=new i.Observable,n.onAnimationFileImportedObservable=new i.Observable,n._registeredForLateAnimationBindings=new s.SmartArrayNoDuplicate(256),n.onPrePointerObservable=new i.Observable,n.onPointerObservable=new i.Observable,n.onPreKeyboardObservable=new i.Observable,n.onKeyboardObservable=new i.Observable,n._useRightHandedSystem=!1,n._timeAccumulator=0,n._currentStepId=0,n._currentInternalStep=0,n._fogEnabled=!0,n._fogMode=P.FOGMODE_NONE,n.fogColor=new S.Color3(.2,.2,.3),n.fogDensity=.1,n.fogStart=0,n.fogEnd=1e3,n._shadowsEnabled=!0,n._lightsEnabled=!0,n.activeCameras=new Array,n._texturesEnabled=!0,n.particlesEnabled=!0,n.spritesEnabled=!0,n._skeletonsEnabled=!0,n.lensFlaresEnabled=!0,n.collisionsEnabled=!0,n.gravity=new o.Vector3(0,-9.807,0),n.postProcessesEnabled=!0,n.postProcesses=new Array,n.renderTargetsEnabled=!0,n.dumpNextRenderTargets=!1,n.customRenderTargets=new Array,n.importedMeshesFiles=new Array,n.probesEnabled=!0,n._meshesForIntersections=new s.SmartArrayNoDuplicate(256),n.proceduralTexturesEnabled=!0,n._totalVertices=new A.PerfCounter,n._activeIndices=new A.PerfCounter,n._activeParticles=new A.PerfCounter,n._activeBones=new A.PerfCounter,n._animationTime=0,n.animationTimeScale=1,n._renderId=0,n._frameId=0,n._executeWhenReadyTimeoutId=-1,n._intermediateRendering=!1,n._viewUpdateFlag=-1,n._projectionUpdateFlag=-1,n._toBeDisposed=new Array(256),n._activeRequests=new Array,n._pendingData=new Array,n._isDisposed=!1,n.dispatchAllSubMeshesOfActiveMeshes=!1,n._activeMeshes=new s.SmartArray(256),n._processedMaterials=new s.SmartArray(256),n._renderTargets=new s.SmartArrayNoDuplicate(256),n._activeParticleSystems=new s.SmartArray(256),n._activeSkeletons=new s.SmartArrayNoDuplicate(32),n._softwareSkinnedMeshes=new s.SmartArrayNoDuplicate(32),n._activeAnimatables=new Array,n._transformMatrix=o.Matrix.Zero(),n.requireLightSorting=!1,n._components=[],n._serializableComponents=[],n._transientComponents=[],n._beforeCameraUpdateStage=_.Stage.Create(),n._beforeClearStage=_.Stage.Create(),n._gatherRenderTargetsStage=_.Stage.Create(),n._gatherActiveCameraRenderTargetsStage=_.Stage.Create(),n._isReadyForMeshStage=_.Stage.Create(),n._beforeEvaluateActiveMeshStage=_.Stage.Create(),n._evaluateSubMeshStage=_.Stage.Create(),n._activeMeshStage=_.Stage.Create(),n._cameraDrawRenderTargetStage=_.Stage.Create(),n._beforeCameraDrawStage=_.Stage.Create(),n._beforeRenderTargetDrawStage=_.Stage.Create(),n._beforeRenderingGroupDrawStage=_.Stage.Create(),n._beforeRenderingMeshStage=_.Stage.Create(),n._afterRenderingMeshStage=_.Stage.Create(),n._afterRenderingGroupDrawStage=_.Stage.Create(),n._afterCameraDrawStage=_.Stage.Create(),n._afterRenderTargetDrawStage=_.Stage.Create(),n._afterRenderStage=_.Stage.Create(),n._pointerMoveStage=_.Stage.Create(),n._pointerDownStage=_.Stage.Create(),n._pointerUpStage=_.Stage.Create(),n.geometriesByUniqueId=null,n._defaultMeshCandidates={data:[],length:0},n._defaultSubMeshCandidates={data:[],length:0},n._preventFreeActiveMeshesAndRenderingGroups=!1,n._activeMeshesFrozen=!1,n._skipEvaluateActiveMeshesCompletely=!1,n._allowPostProcessClearColor=!0,n.getDeterministicFrameTime=function(){return n._engine.getTimeStep()},n._blockMaterialDirtyMechanism=!1;var a=(0,e.__assign)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},r);return n._engine=t||C.EngineStore.LastCreatedEngine,a.virtual||(C.EngineStore._LastCreatedScene=n,n._engine.scenes.push(n)),n._uid=null,n._renderingManager=new b.RenderingManager(n),v.PostProcessManager&&(n.postProcessManager=new v.PostProcessManager(n)),y.DomManagement.IsWindowObjectExist()&&n.attachControl(),n._createUbo(),d.ImageProcessingConfiguration&&(n._imageProcessingConfiguration=new d.ImageProcessingConfiguration),n.setDefaultCandidateProviders(),a.useGeometryUniqueIdsMap&&(n.geometriesByUniqueId={}),n.useMaterialMeshMap=a.useMaterialMeshMap,n.useClonedMeshMap=a.useClonedMeshMap,r&&r.virtual||n._engine.onNewSceneAddedObservable.notifyObservers(n),n}return(0,e.__extends)(P,c),P.DefaultMaterialFactory=function(e){throw O._DevTools.WarnImport("StandardMaterial")},P.CollisionCoordinatorFactory=function(){throw O._DevTools.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(P.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(e){this._environmentIntensity!==e&&(this._environmentIntensity=e,this.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!0,configurable:!0}),Object.defineProperty(P,"DragMovementThreshold",{get:function(){return R.InputManager.DragMovementThreshold},set:function(e){R.InputManager.DragMovementThreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(P,"LongPressDelay",{get:function(){return R.InputManager.LongPressDelay},set:function(e){R.InputManager.LongPressDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(P,"DoubleClickDelay",{get:function(){return R.InputManager.DoubleClickDelay},set:function(e){R.InputManager.DoubleClickDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(P,"ExclusiveDoubleClickMode",{get:function(){return R.InputManager.ExclusiveDoubleClickMode},set:function(e){R.InputManager.ExclusiveDoubleClickMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),P.prototype.setStepId=function(e){this._currentStepId=e},P.prototype.getStepId=function(){return this._currentStepId},P.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(P.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=P.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=P.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),P.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,t=this._transientComponents;e<t.length;e++){t[e].register()}this._transientComponents=[]}},P.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e);var t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)},P.prototype._getComponent=function(e){for(var t=0,r=this._components;t<r.length;t++){var i=r[t];if(i.name===e)return i}return null},P.prototype.getClassName=function(){return"Scene"},P.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},P.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},P.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(P.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(P.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!0,configurable:!0}),P.prototype.getCachedMaterial=function(){return this._cachedMaterial},P.prototype.getCachedEffect=function(){return this._cachedEffect},P.prototype.getCachedVisibility=function(){return this._cachedVisibility},P.prototype.isCachedMaterialInvalid=function(e,t,r){return void 0===r&&(r=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==r},P.prototype.getEngine=function(){return this._engine},P.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(P.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),P.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(P.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),P.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(P.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),P.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(P.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),P.prototype.getActiveMeshes=function(){return this._activeMeshes},P.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},P.prototype.getRenderId=function(){return this._renderId},P.prototype.getFrameId=function(){return this._frameId},P.prototype.incrementRenderId=function(){this._renderId++},P.prototype._createUbo=function(){this._sceneUbo=new f.UniformBuffer(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},P.prototype.simulatePointerMove=function(e,t){return this._inputManager.simulatePointerMove(e,t),this},P.prototype.simulatePointerDown=function(e,t){return this._inputManager.simulatePointerDown(e,t),this},P.prototype.simulatePointerUp=function(e,t,r){return this._inputManager.simulatePointerUp(e,t,r),this},P.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._inputManager.isPointerCaptured(e)},P.prototype.attachControl=function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r=!0),this._inputManager.attachControl(e,t,r)},P.prototype.detachControl=function(){this._inputManager.detachControl()},P.prototype.isReady=function(){if(this._isDisposed)return!1;var e,t=this.getEngine();if(!t.areAllEffectsReady())return!1;if(this._pendingData.length>0)return!1;for(e=0;e<this.meshes.length;e++){var r=this.meshes[e];if(r.isEnabled()&&(r.subMeshes&&0!==r.subMeshes.length)){if(!r.isReady(!0))return!1;for(var i="InstancedMesh"===r.getClassName()||"InstancedLinesMesh"===r.getClassName()||t.getCaps().instancedArrays&&r.instances.length>0,s=0,n=this._isReadyForMeshStage;s<n.length;s++){if(!n[s].action(r,i))return!1}}}for(e=0;e<this.geometries.length;e++){if(2===this.geometries[e].delayLoadState)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var a=0,o=this.activeCameras;a<o.length;a++){if(!o[a].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var h=0,l=this.particleSystems;h<l.length;h++){if(!l[h].isReady())return!1}return!0},P.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},P.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},P.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},P.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},P.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},P.prototype._executeOnceBeforeRender=function(e){var t=this,r=function(){e(),setTimeout(function(){t.unregisterBeforeRender(r)})};this.registerBeforeRender(r)},P.prototype.executeOnceBeforeRender=function(e,t){var r=this;void 0!==t?setTimeout(function(){r._executeOnceBeforeRender(e)},t):this._executeOnceBeforeRender(e)},P.prototype._addPendingData=function(e){this._pendingData.push(e)},P.prototype._removePendingData=function(e){var t=this.isLoading,r=this._pendingData.indexOf(e);-1!==r&&this._pendingData.splice(r,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},P.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(P.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),P.prototype.executeWhenReady=function(e){var t=this;this.onReadyObservable.add(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},P.prototype.whenReadyAsync=function(){var e=this;return new Promise(function(t){e.executeWhenReady(function(){t()})})},P.prototype._checkIsReady=function(){var e=this;return this._registerTransientComponents(),this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150))},Object.defineProperty(P.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),P.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=r.PrecisionDate.Now},P.prototype.getViewMatrix=function(){return this._viewMatrix},P.prototype.getProjectionMatrix=function(){return this._projectionMatrix},P.prototype.getTransformMatrix=function(){return this._transformMatrix},P.prototype.setTransformMatrix=function(e,t,r,i){this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?D.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=D.Frustum.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(r,i):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},P.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},P.prototype.getUniqueId=function(){return w.UniqueIdGenerator.UniqueId},P.prototype.addMesh=function(e,t){var r=this;void 0===t&&(t=!1),this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){r.addMesh(e)}))},P.prototype.removeMesh=function(e,t){var r=this;void 0===t&&(t=!1);var i=this.meshes.indexOf(e);return-1!==i&&(this.meshes[i]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){r.removeMesh(e)}),i},P.prototype.addTransformNode=function(e){this._blockEntityCollection||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))},P.prototype.removeTransformNode=function(e){var t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){var r=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=r,r._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t},P.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e)),t},P.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},P.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var r=0,i=this.meshes;r<i.length;r++){i[r]._removeLightSource(e,!1)}this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t},P.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes());var r=this.activeCameras.indexOf(e);return-1!==r&&this.activeCameras.splice(r,1),this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},P.prototype.removeParticleSystem=function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&this.particleSystems.splice(t,1),t},P.prototype.removeAnimation=function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t},P.prototype.stopAnimation=function(e,t,r){},P.prototype.removeAnimationGroup=function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t},P.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),t},P.prototype.removeMaterial=function(e){var t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){var r=this.materials[this.materials.length-1];this.materials[t]=r,r._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t},P.prototype.removeActionManager=function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t},P.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},P.prototype.addLight=function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(var t=0,r=this.meshes;t<r.length;t++){var i=r[t];-1===i.lightSources.indexOf(e)&&(i.lightSources.push(e),i._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)}},P.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(p.Light.CompareLightsPriority)},P.prototype.addCamera=function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())},P.prototype.addSkeleton=function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))},P.prototype.addParticleSystem=function(e){this._blockEntityCollection||this.particleSystems.push(e)},P.prototype.addAnimation=function(e){this._blockEntityCollection||this.animations.push(e)},P.prototype.addAnimationGroup=function(e){this._blockEntityCollection||this.animationGroups.push(e)},P.prototype.addMultiMaterial=function(e){this._blockEntityCollection||this.multiMaterials.push(e)},P.prototype.addMaterial=function(e){this._blockEntityCollection||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))},P.prototype.addMorphTargetManager=function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)},P.prototype.addGeometry=function(e){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))},P.prototype.addActionManager=function(e){this.actionManagers.push(e)},P.prototype.addTexture=function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))},P.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0);var r=this._engine.getInputElement();r&&(this.activeCamera&&this.activeCamera.detachControl(r),this.activeCamera=e,t&&e.attachControl(r))},P.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},P.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},P.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null},P.prototype.getMaterialByUniqueID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].uniqueId===e)return this.materials[t];return null},P.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},P.prototype.getLastMaterialByID=function(e){for(var t=this.materials.length-1;t>=0;t--)if(this.materials[t].id===e)return this.materials[t];return null},P.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},P.prototype.getTextureByUniqueID=function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null},P.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},P.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},P.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},P.prototype.getBoneByID=function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],i=0;i<r.bones.length;i++)if(r.bones[i].id===e)return r.bones[i];return null},P.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],i=0;i<r.bones.length;i++)if(r.bones[i].name===e)return r.bones[i];return null},P.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},P.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},P.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},P.prototype.getParticleSystemByID=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},P.prototype.getGeometryByID=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null},P.prototype._getGeometryByUniqueID=function(e){if(this.geometriesByUniqueId){var t=this.geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(var r=0;r<this.geometries.length;r++)if(this.geometries[r].uniqueId===e)return this.geometries[r];return null},P.prototype.pushGeometry=function(e,t){return!(!t&&this._getGeometryByUniqueID(e.uniqueId))&&(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},P.prototype.removeGeometry=function(e){var t;if(this.geometriesByUniqueId){if(void 0===(t=this.geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;if(t!==this.geometries.length-1){var r=this.geometries[this.geometries.length-1];this.geometries[t]=r,this.geometriesByUniqueId&&(this.geometriesByUniqueId[r.uniqueId]=t,this.geometriesByUniqueId[e.uniqueId]=void 0)}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},P.prototype.getGeometries=function(){return this.geometries},P.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},P.prototype.getMeshesByID=function(e){return this.meshes.filter(function(t){return t.id===e})},P.prototype.getTransformNodeByID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},P.prototype.getTransformNodeByUniqueID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null},P.prototype.getTransformNodesByID=function(e){return this.transformNodes.filter(function(t){return t.id===e})},P.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},P.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},P.prototype.getLastEntryByID=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},P.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var r=this.getTransformNodeByID(e);if(r)return r;var i=this.getLightByID(e);if(i)return i;var s=this.getCameraByID(e);if(s)return s;var n=this.getBoneByID(e);return n||null},P.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var r=this.getTransformNodeByName(e);if(r)return r;var i=this.getLightByName(e);if(i)return i;var s=this.getCameraByName(e);if(s)return s;var n=this.getBoneByName(e);return n||null},P.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},P.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},P.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},P.prototype.getSkeletonByUniqueId=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null},P.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},P.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},P.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},P.prototype.getMorphTargetById=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var r=this.morphTargetManagers[t],i=0;i<r.numTargets;++i){var s=r.getTarget(i);if(s.id===e)return s}return null},P.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(P.prototype,"uid",{get:function(){return this._uid||(this._uid=t.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),P.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new n.StringDictionary),this._externalData.add(e,t)},P.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},P.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new n.StringDictionary),this._externalData.getOrAddWithFactory(e,t)},P.prototype.removeExternalData=function(e){return this._externalData.remove(e)},P.prototype._evaluateSubMesh=function(e,t,r){if(r.hasInstances||r.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var i=0,s=this._evaluateSubMeshStage;i<s.length;i++){s[i].action(t,e)}var n=e.getMaterial();null!=n&&(n.hasRenderTargetTextures&&null!=n.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(n)&&(this._processedMaterials.push(n),this._renderTargets.concatWithNoDuplicate(n.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,n))}},P.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(P.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!0,configurable:!0}),P.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}},P.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}},P.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},P.prototype.freezeActiveMeshes=function(e){var t=this;return void 0===e&&(e=!1),this.executeWhenReady(function(){if(t.activeCamera){t._frustumPlanes||t.setTransformMatrix(t.activeCamera.getViewMatrix(),t.activeCamera.getProjectionMatrix()),t._evaluateActiveMeshes(),t._activeMeshesFrozen=!0,t._skipEvaluateActiveMeshesCompletely=e;for(var r=0;r<t._activeMeshes.length;r++)t._activeMeshes.data[r]._freeze()}}),this},P.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},P.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var e=this._activeMeshes.length,t=0;t<e;t++){(a=this._activeMeshes.data[t]).computeWorldMatrix()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var r=0,i=this._beforeEvaluateActiveMeshStage;r<i.length;r++){i[r].action()}var s=this.getActiveMeshCandidates(),n=s.length;for(t=0;t<n;t++){var a;if(!(a=s.data[t]).isBlocked&&(this._totalVertices.addCount(a.getTotalVertices(),!1),a.isReady()&&a.isEnabled()&&0!==a.scaling.lengthSquared())){a.computeWorldMatrix(),a.actionManager&&a.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(a);var o=this.customLODSelector?this.customLODSelector(a,this.activeCamera):a.getLOD(this.activeCamera);null!=o&&(o!==a&&o.billboardMode!==h.TransformNode.BILLBOARDMODE_NONE&&o.computeWorldMatrix(),a._preActivate(),a.isVisible&&a.visibility>0&&0!=(a.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||a.alwaysSelectAsActiveMesh||a.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(a),this.activeCamera._activeMeshes.push(a),o!==a&&o._activate(this._renderId,!1),a._activate(this._renderId,!1)&&(a.isAnInstance?a._internalAbstractMeshDataInfo._actAsRegularMesh&&(o=a):o._internalAbstractMeshDataInfo._onlyForInstances=!1,o._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(a,o)),a._postActivate()))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var l=0;l<this.particleSystems.length;l++){var u=this.particleSystems[l];if(u.isStarted()&&u.emitter){var c=u.emitter;c.position&&!c.isEnabled()||(this._activeParticleSystems.push(u),u.animate(),this._renderingManager.dispatchParticles(u))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},P.prototype._activeMesh=function(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&t.skeleton.prepare(),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));for(var r=0,i=this._activeMeshStage;r<i.length;r++){i[r].action(e,t)}if(null!=t&&void 0!==t.subMeshes&&null!==t.subMeshes&&t.subMeshes.length>0)for(var s=this.getActiveSubMeshCandidates(t),n=s.length,a=0;a<n;a++){var o=s.data[a];this._evaluateSubMesh(o,t,e)}},P.prototype.updateTransformMatrix=function(e){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},P.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget){if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var e=this.activeCamera.outputRenderTarget.getInternalTexture();e?this.getEngine().bindFramebuffer(e):M.Logger.Error("Camera contains invalid customDefaultRenderTarget")}}else this.getEngine().restoreDefaultFramebuffer()},P.prototype._renderForCamera=function(e,r){if(!e||!e._skipRendering){var i=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");i.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(e._rigCameras[0].getViewMatrix(),e._rigCameras[0].getProjectionMatrix(),e._rigCameras[1].getViewMatrix(),e._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var s=0;s<this._softwareSkinnedMeshes.length;s++){var n=this._softwareSkinnedMeshes.data[s];n.applySkeleton(n.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),r&&r.customRenderTargets&&r.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(r.customRenderTargets);for(var a=0,o=this._gatherActiveCameraRenderTargetsStage;a<o.length;a++){o[a].action(this._renderTargets)}if(this.renderTargetsEnabled){this._intermediateRendering=!0;var h=!1;if(this._renderTargets.length>0){t.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var l=0;l<this._renderTargets.length;l++){var u=this._renderTargets.data[l];if(u._shouldRender()){this._renderId++;var c=u.activeCamera&&u.activeCamera!==this.activeCamera;u.render(c,this.dumpNextRenderTargets),h=!0}}t.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var d=0,f=this._cameraDrawRenderTargetStage;d<f.length;d++){h=f[d].action(this.activeCamera)||h}this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(h=!0),h&&this._bindFrameBuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._prepareFrame();for(var p=0,g=this._beforeCameraDrawStage;p<g.length;p++){g[p].action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var m=0,v=this._afterCameraDrawStage;m<v.length;m++){v[m].action(this.activeCamera)}this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._finalizeFrame(e.isIntermediate),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},P.prototype._processSubCameras=function(e){if(e.cameraRigMode===u.Camera.RIG_MODE_NONE||e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)return this._renderForCamera(e),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else for(var t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e);this._activeCamera=e,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(e)},P.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var r=0;t.actionManager&&r<t.actionManager.actions.length;r++){var i=t.actionManager.actions[r];if(12===i.trigger||13===i.trigger){var s=i.getTriggerParameter(),n=s instanceof l.AbstractMesh?s:s.mesh,a=n.intersectsMesh(t,s.usePreciseIntersection),o=t._intersectionsInProgress.indexOf(n);a&&-1===o?12===i.trigger?(i._executeCurrent(m.ActionEvent.CreateNew(t,void 0,n)),t._intersectionsInProgress.push(n)):13===i.trigger&&t._intersectionsInProgress.push(n):!a&&o>-1&&(13===i.trigger&&i._executeCurrent(m.ActionEvent.CreateNew(t,void 0,n)),t.actionManager.hasSpecificTrigger(13,function(e){var t=e instanceof l.AbstractMesh?e:e.mesh;return n===t})&&13!==i.trigger||t._intersectionsInProgress.splice(o,1))}}}},P.prototype._advancePhysicsEngineStep=function(e){},P.prototype._animate=function(){},P.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(P.MinDeltaTime,Math.min(this._engine.getDeltaTime(),P.MaxDeltaTime))+this._timeAccumulator,t=this._engine.getTimeStep(),r=1e3/t/1e3,i=0,s=this._engine.getLockstepMaxSteps(),n=Math.floor(e/t);for(n=Math.min(n,s);e>0&&i<n;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*r,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,i++,e-=t;this._timeAccumulator=e<0?0:e}else{e=this.useConstantAnimationDeltaTime?16:Math.max(P.MinDeltaTime,Math.min(this._engine.getDeltaTime(),P.MaxDeltaTime));this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(e)}},P.prototype.render=function(e,r){if(void 0===e&&(e=!0),void 0===r&&(r=!1),!this.isDisposed){this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),r||this.animate();for(var i=0,s=this._beforeCameraUpdateStage;i<s.length;i++){s[i].action()}if(e)if(this.activeCameras.length>0)for(var n=0;n<this.activeCameras.length;n++){var a=this.activeCameras[n];if(a.update(),a.cameraRigMode!==u.Camera.RIG_MODE_NONE)for(var o=0;o<a._rigCameras.length;o++)a._rigCameras[o].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==u.Camera.RIG_MODE_NONE))for(o=0;o<this.activeCamera._rigCameras.length;o++)this.activeCamera._rigCameras[o].update();this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var h=this.getEngine(),l=this.activeCamera;if(this.renderTargetsEnabled){t.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var c=0;c<this.customRenderTargets.length;c++){var d=this.customRenderTargets[c];if(d._shouldRender()){if(this._renderId++,this.activeCamera=d.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");h.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),d.render(l!==this.activeCamera,this.dumpNextRenderTargets)}}t.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=l,this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var f=0,p=this._beforeClearStage;f<p.length;f++){p[f].action()}(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var g=0,m=this._gatherRenderTargetsStage;g<m.length;g++){m[g].action(this._renderTargets)}if(this.activeCameras.length>0)for(n=0;n<this.activeCameras.length;n++)n>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[n]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var v=0,b=this._afterRenderStage;v<b.length;v++){b[v].action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(o=0;o<this._toBeDisposed.length;o++){var _=this._toBeDisposed[o];_&&_.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},P.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},P.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},P.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,C.EngineStore._LastCreatedScene===this&&(C.EngineStore._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var e=0,t=this._components;e<t.length;e++){t[e].dispose()}this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var r=0,i=this._activeRequests;r<i.length;r++){i[r].abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var s,n=this._engine.getInputElement();if(n)for(s=0;s<this.cameras.length;s++)this.cameras[s].detachControl(n);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),(s=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(s,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(P.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),P.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;if(t)for(var r in t._indices=[],t._vertexBuffers)t._vertexBuffers.hasOwnProperty(r)&&(t._vertexBuffers[r]._buffer._data=null)}},P.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var r=t[e];r._buffer&&(r._buffer=null)}},P.prototype.getWorldExtends=function(e){var t=new o.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new o.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach(function(e){if(e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance){var i=e.getBoundingInfo(),s=i.boundingBox.minimumWorld,n=i.boundingBox.maximumWorld;o.Vector3.CheckExtends(s,t,r),o.Vector3.CheckExtends(n,t,r)}}),{min:t,max:r}},P.prototype.createPickingRay=function(e,t,r,i,s){throw void 0===s&&(s=!1),O._DevTools.WarnImport("Ray")},P.prototype.createPickingRayToRef=function(e,t,r,i,s,n){throw void 0===n&&(n=!1),O._DevTools.WarnImport("Ray")},P.prototype.createPickingRayInCameraSpace=function(e,t,r){throw O._DevTools.WarnImport("Ray")},P.prototype.createPickingRayInCameraSpaceToRef=function(e,t,r,i){throw O._DevTools.WarnImport("Ray")},P.prototype.pick=function(e,t,r,i,s,n){var a=new g.PickingInfo;return a._pickingUnavailable=!0,a},P.prototype.pickWithRay=function(e,t,r,i){throw O._DevTools.WarnImport("Ray")},P.prototype.multiPick=function(e,t,r,i,s){throw O._DevTools.WarnImport("Ray")},P.prototype.multiPickWithRay=function(e,t,r){throw O._DevTools.WarnImport("Ray")},P.prototype.setPointerOverMesh=function(e){this._inputManager.setPointerOverMesh(e)},P.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},P.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++){t[e]._rebuild()}for(var r=0,i=this.meshes;r<i.length;r++){i[r]._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var s=0,n=this._components;s<n.length;s++){n[s].rebuild()}for(var a=0,o=this.particleSystems;a<o.length;a++){o[a].rebuild()}},P.prototype._rebuildTextures=function(){for(var e=0,t=this.textures;e<t.length;e++){t[e]._rebuild()}this.markAllMaterialsAsDirty(1)},P.prototype._getByTags=function(e,t,r){if(void 0===t)return e;var i=[];for(var s in r=r||function(e){},e){var n=e[s];a.Tags&&a.Tags.MatchesQuery(n,t)&&(i.push(n),r(n))}return i},P.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},P.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},P.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},P.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},P.prototype.setRenderingOrder=function(e,t,r,i){void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),this._renderingManager.setRenderingOrder(e,t,r,i)},P.prototype.setRenderingAutoClearDepthStencil=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,r,i)},P.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(P.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(31))},enumerable:!0,configurable:!0}),P.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var r=0,i=this.materials;r<i.length;r++){var s=i[r];t&&!t(s)||s.markAsDirty(e)}},P.prototype._loadFile=function(e,t,r,i,s,n){var a=this,o=T.FileTools.LoadFile(e,t,r,i?this.offlineProvider:void 0,s,n);return this._activeRequests.push(o),o.onCompleteObservable.add(function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)}),o},P.prototype._loadFileAsync=function(e,t,r,i){var s=this;return new Promise(function(n,a){s._loadFile(e,function(e){n(e)},t,r,i,function(e,t){a(t)})})},P.prototype._requestFile=function(e,t,r,i,s,n,a){var o=this,h=T.FileTools.RequestFile(e,t,r,i?this.offlineProvider:void 0,s,n,a);return this._activeRequests.push(h),h.onCompleteObservable.add(function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)}),h},P.prototype._requestFileAsync=function(e,t,r,i,s){var n=this;return new Promise(function(a,o){n._requestFile(e,function(e){a(e)},t,r,i,function(e){o(e)},s)})},P.prototype._readFile=function(e,t,r,i,s){var n=this,a=T.FileTools.ReadFile(e,t,r,i,s);return this._activeRequests.push(a),a.onCompleteObservable.add(function(e){n._activeRequests.splice(n._activeRequests.indexOf(e),1)}),a},P.prototype._readFileAsync=function(e,t,r){var i=this;return new Promise(function(s,n){i._readFile(e,function(e){s(e)},t,r,function(e){n(e)})})},P.FOGMODE_NONE=0,P.FOGMODE_EXP=1,P.FOGMODE_EXP2=2,P.FOGMODE_LINEAR=3,P.MinDeltaTime=1,P.MaxDeltaTime=1e3,P}(c.AbstractScene);exports.Scene=P;
},{"tslib":"90Cu","./Misc/tools":"8xSa","./Misc/precisionDate":"G7Te","./Misc/observable":"vY1+","./Misc/smartArray":"Hnz9","./Misc/stringDictionary":"JXIB","./Misc/tags":"4qpk","./Maths/math.vector":"61Nx","./Meshes/transformNode":"03YA","./Meshes/abstractMesh":"uine","./Cameras/camera":"AhwZ","./abstractScene":"bnVi","./Materials/imageProcessingConfiguration":"h2+3","./Materials/uniformBuffer":"S1/f","./Lights/light":"S2tp","./Collisions/pickingInfo":"lVfJ","./Actions/actionEvent":"8u+X","./PostProcesses/postProcessManager":"lx6p","./Rendering/renderingManager":"G1uW","./sceneComponent":"7t/x","./Misc/domManagement":"GCrr","./Misc/logger":"Yh4i","./Engines/engineStore":"cq+N","./Misc/devTools":"S9x9","./Inputs/scene.inputManager":"2Kn+","./Misc/perfCounter":"177K","./Maths/math.color":"q3+m","./Maths/math.frustum":"vawr","./Misc/uniqueIdGenerator":"GIF2","./Misc/fileTools":"qMSH"}],"sSbP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Curve3=exports.Path3D=exports.Path2=exports.Arc2=exports.Angle=exports.BezierCurve=exports.Orientation=void 0;var t,n=require("./math.scalar"),i=require("./math.vector"),r=require("./math.constants");exports.Orientation=t,function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(t||(exports.Orientation=t={}));var e=function(){function t(){}return t.Interpolate=function(t,n,i,r,e){for(var o=1-3*r+3*n,s=3*r-6*n,a=3*n,h=t,u=0;u<5;u++){var p=h*h;h-=(o*(p*h)+s*p+a*h-t)*(1/(3*o*p+2*s*h+a)),h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*e+Math.pow(h,3)},t}();exports.BezierCurve=e;var o=function(){function t(t){this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.prototype.degrees=function(){return 180*this._radians/Math.PI},t.prototype.radians=function(){return this._radians},t.BetweenTwoPoints=function(n,i){var r=i.subtract(n);return new t(Math.atan2(r.y,r.x))},t.FromRadians=function(n){return new t(n)},t.FromDegrees=function(n){return new t(n*Math.PI/180)},t}();exports.Angle=o;var s=function(){return function(n,r,e){this.startPoint=n,this.midPoint=r,this.endPoint=e;var s=Math.pow(r.x,2)+Math.pow(r.y,2),a=(Math.pow(n.x,2)+Math.pow(n.y,2)-s)/2,h=(s-Math.pow(e.x,2)-Math.pow(e.y,2))/2,u=(n.x-r.x)*(r.y-e.y)-(r.x-e.x)*(n.y-r.y);this.centerPoint=new i.Vector2((a*(r.y-e.y)-h*(n.y-r.y))/u,((n.x-r.x)*h-(r.x-e.x)*a)/u),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=o.BetweenTwoPoints(this.centerPoint,this.startPoint);var p=this.startAngle.degrees(),c=o.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=o.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-p>180&&(c-=360),c-p<-180&&(c+=360),l-c>180&&(l-=360),l-c<-180&&(l+=360),this.orientation=c-p<0?t.CW:t.CCW,this.angle=o.FromDegrees(this.orientation===t.CW?p-l:l-p)}}();exports.Arc2=s;var a=function(){function n(t,n){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new i.Vector2(t,n))}return n.prototype.addLineTo=function(t,n){if(this.closed)return this;var r=new i.Vector2(t,n),e=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(e).length(),this},n.prototype.addArcTo=function(n,r,e,o,a){if(void 0===a&&(a=36),this.closed)return this;var h=this._points[this._points.length-1],u=new i.Vector2(n,r),p=new i.Vector2(e,o),c=new s(h,u,p),l=c.angle.radians()/a;c.orientation===t.CW&&(l*=-1);for(var _=c.startAngle.radians()+l,g=0;g<a;g++){var v=Math.cos(_)*c.radius+c.centerPoint.x,d=Math.sin(_)*c.radius+c.centerPoint.y;this.addLineTo(v,d),_+=l}return this},n.prototype.close=function(){return this.closed=!0,this},n.prototype.length=function(){var t=this._length;if(this.closed){var n=this._points[this._points.length-1];t+=this._points[0].subtract(n).length()}return t},n.prototype.getPoints=function(){return this._points},n.prototype.getPointAtLengthPosition=function(t){if(t<0||t>1)return i.Vector2.Zero();for(var n=t*this.length(),r=0,e=0;e<this._points.length;e++){var o=(e+1)%this._points.length,s=this._points[e],a=this._points[o].subtract(s),h=a.length()+r;if(n>=r&&n<=h){var u=a.normalize(),p=n-r;return new i.Vector2(s.x+u.x*p,s.y+u.y*p)}r=h}return i.Vector2.Zero()},n.StartingAt=function(t,i){return new n(t,i)},n}();exports.Path2=a;var h=function(){function t(t,n,r,e){void 0===n&&(n=null),void 0===e&&(e=!1),this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:i.Vector3.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:i.Matrix.Identity()};for(var o=0;o<t.length;o++)this._curve[o]=t[o].clone();this._raw=r||!1,this._alignTangentsWithPath=e,this._compute(n,e)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getPoints=function(){return this._curve},t.prototype.length=function(){return this._distances[this._distances.length-1]},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.getPointAt=function(t){return this._updatePointAtData(t).point},t.prototype.getTangentAt=function(t,n){return void 0===n&&(n=!1),this._updatePointAtData(t,n),n?i.Vector3.TransformCoordinates(i.Vector3.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},t.prototype.getNormalAt=function(t,n){return void 0===n&&(n=!1),this._updatePointAtData(t,n),n?i.Vector3.TransformCoordinates(i.Vector3.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},t.prototype.getBinormalAt=function(t,n){return void 0===n&&(n=!1),this._updatePointAtData(t,n),n?i.Vector3.TransformCoordinates(i.Vector3.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},t.prototype.getDistanceAt=function(t){return this.length()*t},t.prototype.getPreviousPointIndexAt=function(t){return this._updatePointAtData(t),this._pointAtData.previousPointArrayIndex},t.prototype.getSubPositionAt=function(t){return this._updatePointAtData(t),this._pointAtData.subPosition},t.prototype.getClosestPositionTo=function(t){for(var n=Number.MAX_VALUE,r=0,e=0;e<this._curve.length-1;e++){var o=this._curve[e+0],s=this._curve[e+1].subtract(o).normalize(),a=this._distances[e+1]-this._distances[e+0],h=Math.min(Math.max(i.Vector3.Dot(s,t.subtract(o).normalize()),0)*i.Vector3.Distance(o,t)/a,1),u=i.Vector3.Distance(o.add(s.scale(h*a)),t);u<n&&(n=u,r=(this._distances[e+0]+a*h)/this.length())}return r},t.prototype.slice=function(n,i){if(void 0===n&&(n=0),void 0===i&&(i=1),n<0&&(n=1- -1*n%1),i<0&&(i=1- -1*i%1),n>i){var r=n;n=i,i=r}var e=this.getCurve(),o=this.getPointAt(n),s=this.getPreviousPointIndexAt(n),a=this.getPointAt(i),h=this.getPreviousPointIndexAt(i)+1,u=[];return 0!==n&&(s++,u.push(o)),u.push.apply(u,e.slice(s,h)),1===i&&1!==n||u.push(a),new t(u,this.getNormalAt(n),this._raw,this._alignTangentsWithPath)},t.prototype.update=function(t,n,i){void 0===n&&(n=null),void 0===i&&(i=!1);for(var r=0;r<t.length;r++)this._curve[r].x=t[r].x,this._curve[r].y=t[r].y,this._curve[r].z=t[r].z;return this._compute(n,i),this},t.prototype._compute=function(t,n){void 0===n&&(n=!1);var r=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[r-1]=this._curve[r-1].subtract(this._curve[r-2]),this._raw||this._tangents[r-1].normalize();var e,o,s,a,h,u=this._tangents[0],p=this._normalVector(u,t);this._normals[0]=p,this._raw||this._normals[0].normalize(),this._binormals[0]=i.Vector3.Cross(u,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var c=1;c<r;c++)e=this._getLastNonNullVector(c),c<r-1&&(o=this._getFirstNonNullVector(c),this._tangents[c]=n?o:e.add(o),this._tangents[c].normalize()),this._distances[c]=this._distances[c-1]+e.length(),s=this._tangents[c],h=this._binormals[c-1],this._normals[c]=i.Vector3.Cross(h,s),this._raw||(0===this._normals[c].length()?(a=this._normals[c-1],this._normals[c]=a.clone()):this._normals[c].normalize()),this._binormals[c]=i.Vector3.Cross(s,this._normals[c]),this._raw||this._binormals[c].normalize();this._pointAtData.id=NaN},t.prototype._getFirstNonNullVector=function(t){for(var n=1,i=this._curve[t+n].subtract(this._curve[t]);0===i.length()&&t+n+1<this._curve.length;)n++,i=this._curve[t+n].subtract(this._curve[t]);return i},t.prototype._getLastNonNullVector=function(t){for(var n=1,i=this._curve[t].subtract(this._curve[t-n]);0===i.length()&&t>n+1;)n++,i=this._curve[t].subtract(this._curve[t-n]);return i},t.prototype._normalVector=function(t,e){var o,s,a=t.length();(0===a&&(a=1),null==e)?(s=n.Scalar.WithinEpsilon(Math.abs(t.y)/a,1,r.Epsilon)?n.Scalar.WithinEpsilon(Math.abs(t.x)/a,1,r.Epsilon)?n.Scalar.WithinEpsilon(Math.abs(t.z)/a,1,r.Epsilon)?i.Vector3.Zero():new i.Vector3(0,0,1):new i.Vector3(1,0,0):new i.Vector3(0,-1,0),o=i.Vector3.Cross(t,s)):(o=i.Vector3.Cross(t,e),i.Vector3.CrossToRef(o,t,o));return o.normalize(),o},t.prototype._updatePointAtData=function(t,n){if(void 0===n&&(n=!1),this._pointAtData.id===t)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=t;var r=this.getPoints();if(t<=0)return this._setPointAtData(0,0,r[0],0,n);if(t>=1)return this._setPointAtData(1,1,r[r.length-1],r.length-1,n);for(var e,o=r[0],s=0,a=t*this.length(),h=1;h<r.length;h++){e=r[h];var u=i.Vector3.Distance(o,e);if((s+=u)===a)return this._setPointAtData(t,1,e,h,n);if(s>a){var p=(s-a)/u,c=o.subtract(e),l=e.add(c.scaleInPlace(p));return this._setPointAtData(t,1-p,l,h-1,n)}o=e}return this._pointAtData},t.prototype._setPointAtData=function(t,n,i,r,e){return this._pointAtData.point=i,this._pointAtData.position=t,this._pointAtData.subPosition=n,this._pointAtData.previousPointArrayIndex=r,this._pointAtData.interpolateReady=e,e&&this._updateInterpolationMatrix(),this._pointAtData},t.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=i.Matrix.Identity();var t=this._pointAtData.previousPointArrayIndex;if(t!==this._tangents.length-1){var n=t+1,r=this._tangents[t].clone(),e=this._normals[t].clone(),o=this._binormals[t].clone(),s=this._tangents[n].clone(),a=this._normals[n].clone(),h=this._binormals[n].clone(),u=i.Quaternion.RotationQuaternionFromAxis(e,o,r),p=i.Quaternion.RotationQuaternionFromAxis(a,h,s);i.Quaternion.Slerp(u,p,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},t}();exports.Path3D=h;var u=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(n,r,e,o){o=o>2?o:3;for(var s=new Array,a=function(t,n,i,r){return(1-t)*(1-t)*n+2*t*(1-t)*i+t*t*r},h=0;h<=o;h++)s.push(new i.Vector3(a(h/o,n.x,r.x,e.x),a(h/o,n.y,r.y,e.y),a(h/o,n.z,r.z,e.z)));return new t(s)},t.CreateCubicBezier=function(n,r,e,o,s){s=s>3?s:4;for(var a=new Array,h=function(t,n,i,r,e){return(1-t)*(1-t)*(1-t)*n+3*t*(1-t)*(1-t)*i+3*t*t*(1-t)*r+t*t*t*e},u=0;u<=s;u++)a.push(new i.Vector3(h(u/s,n.x,r.x,e.x,o.x),h(u/s,n.y,r.y,e.y,o.y),h(u/s,n.z,r.z,e.z,o.z)));return new t(a)},t.CreateHermiteSpline=function(n,r,e,o,s){for(var a=new Array,h=1/s,u=0;u<=s;u++)a.push(i.Vector3.Hermite(n,r,e,o,u*h));return new t(a)},t.CreateCatmullRomSpline=function(n,r,e){var o=new Array,s=1/r,a=0;if(e){for(var h=n.length,u=0;u<h;u++){a=0;for(var p=0;p<r;p++)o.push(i.Vector3.CatmullRom(n[u%h],n[(u+1)%h],n[(u+2)%h],n[(u+3)%h],a)),a+=s}o.push(o[0])}else{var c=new Array;c.push(n[0].clone()),Array.prototype.push.apply(c,n),c.push(n[n.length-1].clone());for(u=0;u<c.length-3;u++){a=0;for(p=0;p<r;p++)o.push(i.Vector3.CatmullRom(c[u],c[u+1],c[u+2],c[u+3],a)),a+=s}u--,o.push(i.Vector3.CatmullRom(c[u],c[u+1],c[u+2],c[u+3],a))}return new t(o)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype.continue=function(n){for(var i=this._points[this._points.length-1],r=this._points.slice(),e=n.getPoints(),o=1;o<e.length;o++)r.push(e[o].subtract(e[0]).add(i));return new t(r)},t.prototype._computeLength=function(t){for(var n=0,i=1;i<t.length;i++)n+=t[i].subtract(t[i-1]).length();return n},t}();exports.Curve3=u;
},{"./math.scalar":"TAUa","./math.vector":"61Nx","./math.constants":"tvfX"}],"j04N":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Size=void 0;var t=function(){function t(t,i){this.width=t,this.height=i}return t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){var t=0|this.width;return t=397*t^(0|this.height)},t.prototype.copyFrom=function(t){this.width=t.width,this.height=t.height},t.prototype.copyFromFloats=function(t,i){return this.width=t,this.height=i,this},t.prototype.set=function(t,i){return this.copyFromFloats(t,i)},t.prototype.multiplyByFloats=function(i,e){return new t(this.width*i,this.height*e)},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(t){return!!t&&(this.width===t.width&&this.height===t.height)},Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.Zero=function(){return new t(0,0)},t.prototype.add=function(i){return new t(this.width+i.width,this.height+i.height)},t.prototype.subtract=function(i){return new t(this.width-i.width,this.height-i.height)},t.Lerp=function(i,e,h){return new t(i.width+(e.width-i.width)*h,i.height+(e.height-i.height)*h)},t}();exports.Size=t;
},{}],"gFNp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PositionNormalTextureVertex=exports.PositionNormalVertex=void 0;var o=require("./math.vector"),t=function(){function t(t,e){void 0===t&&(t=o.Vector3.Zero()),void 0===e&&(e=o.Vector3.Up()),this.position=t,this.normal=e}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();exports.PositionNormalVertex=t;var e=function(){function t(t,e,r){void 0===t&&(t=o.Vector3.Zero()),void 0===e&&(e=o.Vector3.Up()),void 0===r&&(r=o.Vector2.Zero()),this.position=t,this.normal=e,this.uv=r}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();exports.PositionNormalTextureVertex=e;
},{"./math.vector":"61Nx"}],"iyC1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./math.axis");Object.keys(e).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(exports,t,{enumerable:!0,get:function(){return e[t]}})});var t=require("./math.color");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})});var r=require("./math.constants");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return r[e]}})});var u=require("./math.frustum");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return u[e]}})});var n=require("./math.path");Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return n[e]}})});var o=require("./math.plane");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return o[e]}})});var a=require("./math.size");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return a[e]}})});var c=require("./math.vector");Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return c[e]}})});var f=require("./math.vertexFormat");Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return f[e]}})});var i=require("./math.viewport");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return i[e]}})});
},{"./math.axis":"LzVa","./math.color":"q3+m","./math.constants":"tvfX","./math.frustum":"vawr","./math.path":"sSbP","./math.plane":"VdRi","./math.size":"j04N","./math.vector":"61Nx","./math.vertexFormat":"gFNp","./math.viewport":"bOLa"}],"v9Ss":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.System=void 0;var e=require("@babylonjs/core/Engines/engine"),t=require("@babylonjs/core/scene"),i=require("@babylonjs/core/Maths/math"),n=function(){function n(t,i){var n,s=this;this.maxScaling=1,this.rendering=!1,this.started=!1,this.checkingScroll=!0,this.needProcess=!0,this.limitFPS=!1,this.limitSwitch=!0,this._startListeners=[],this._stopListeners=[],this._beginListeners=[],this._endListeners=[],this.canvas=t,n=i?{limitDeviceRatio:this.maxScaling,preserveDrawingBuffer:!0,stencil:!0}:{limitDeviceRatio:this.maxScaling},this.engine=new e.Engine(this.canvas,!0,n,!1),this.engine.enableOfflineSupport=!1,this.buildScene(),window.addEventListener("scroll",function(){s.checkScroll()}),window.addEventListener("focus",function(){s.checkScroll()})}return n.prototype.buildScene=function(){this.scene=new t.Scene(this.engine),this.scene.shadowsEnabled=!1,this.scene.ambientColor=new i.Color3(1,1,1)},n.prototype.setCheckScroll=function(e){this.checkingScroll=e,e&&this.started&&this.checkScroll()},n.prototype.setNeedProcess=function(e){this.needProcess=e},n.prototype.checkScroll=function(){!this.started||!this.checkingScroll&&this.needProcess||(this.checkVisible()?this.startRender():this.pauseRender())},n.prototype.checkVisible=function(){var e=this.canvas.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(e.bottom<0||e.top-t>=0)},n.prototype.launchRender=function(){this.started=!0,this.scene.render(),this.checkScroll()},n.prototype.stopRender=function(){this.started=!1,this.pauseRender()},n.prototype.pauseRender=function(){this.rendering&&(this.sendToStopListener(),this.rendering=!1,this.engine.stopRenderLoop(),this.scene.render())},n.prototype.startRender=function(){!this.rendering&&this.started&&(this.rendering=!0,this.forceRender())},n.prototype.forceRender=function(){var e=this;this.sendToStartListener(),this.engine.stopRenderLoop(),this.limitFPS?this.engine.runRenderLoop(function(){e.limitSwitch&&e.scene.render(),e.limitSwitch=!e.limitSwitch}):this.engine.runRenderLoop(function(){e.scene.render()})},n.prototype.optimize=function(){this.scene.autoClear=!1,this.scene.autoClearDepthAndStencil=!1},n.prototype.unOptimize=function(){this.scene.autoClear=!0,this.scene.autoClearDepthAndStencil=!0},n.prototype.optimizeHard=function(){this.optimize(),this.scene.freezeActiveMeshes(),this.setLimitFPS(!0)},n.prototype.unOptimizeHard=function(){this.unOptimize(),this.scene.unfreezeActiveMeshes(),this.setLimitFPS(!1)},n.prototype.setLimitFPS=function(e){e!=this.limitFPS&&(this.limitFPS=e,this.rendering&&this.forceRender())},n.prototype.on=function(e,t){"start"==e?this._startListeners.push(t):"stop"==e?this._stopListeners.push(t):"begin"==e?this._beginListeners.push(t):"end"==e&&this._endListeners.push(t)},n.prototype.sendToStartListener=function(){for(var e=0;e<this._startListeners.length;e++)this._startListeners[e]()},n.prototype.sendToStopListener=function(){for(var e=0;e<this._stopListeners.length;e++)this._stopListeners[e]()},n.prototype.sendToBeginListener=function(e){for(var t=0;t<this._beginListeners.length;t++)this._beginListeners[t](e)},n.prototype.sendToEndListener=function(e){for(var t=0;t<this._endListeners.length;t++)this._endListeners[t](e)},n}();exports.System=n;
},{"@babylonjs/core/Engines/engine":"L3af","@babylonjs/core/scene":"TiFm","@babylonjs/core/Maths/math":"iyC1"}],"JAeh":[function(require,module,exports) {
function t(){this.__data__=[],this.size=0}module.exports=t;
},{}],"Dwod":[function(require,module,exports) {
function e(e,n){return e===n||e!=e&&n!=n}module.exports=e;
},{}],"VJD6":[function(require,module,exports) {
var r=require("./eq");function e(e,n){for(var t=e.length;t--;)if(r(e[t][0],n))return t;return-1}module.exports=e;
},{"./eq":"Dwod"}],"rsvh":[function(require,module,exports) {
var e=require("./_assocIndexOf"),r=Array.prototype,t=r.splice;function a(r){var a=this.__data__,o=e(a,r);return!(o<0)&&(o==a.length-1?a.pop():t.call(a,o,1),--this.size,!0)}module.exports=a;
},{"./_assocIndexOf":"VJD6"}],"feic":[function(require,module,exports) {
var r=require("./_assocIndexOf");function e(e){var a=this.__data__,o=r(a,e);return o<0?void 0:a[o][1]}module.exports=e;
},{"./_assocIndexOf":"VJD6"}],"Fsaw":[function(require,module,exports) {
var e=require("./_assocIndexOf");function r(r){return e(this.__data__,r)>-1}module.exports=r;
},{"./_assocIndexOf":"VJD6"}],"+iNE":[function(require,module,exports) {
var s=require("./_assocIndexOf");function e(e,r){var t=this.__data__,i=s(t,e);return i<0?(++this.size,t.push([e,r])):t[i][1]=r,this}module.exports=e;
},{"./_assocIndexOf":"VJD6"}],"Cctp":[function(require,module,exports) {
var e=require("./_listCacheClear"),t=require("./_listCacheDelete"),r=require("./_listCacheGet"),l=require("./_listCacheHas"),o=require("./_listCacheSet");function a(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var l=e[t];this.set(l[0],l[1])}}a.prototype.clear=e,a.prototype.delete=t,a.prototype.get=r,a.prototype.has=l,a.prototype.set=o,module.exports=a;
},{"./_listCacheClear":"JAeh","./_listCacheDelete":"rsvh","./_listCacheGet":"feic","./_listCacheHas":"Fsaw","./_listCacheSet":"+iNE"}],"v1ke":[function(require,module,exports) {
var e=require("./_ListCache");function i(){this.__data__=new e,this.size=0}module.exports=i;
},{"./_ListCache":"Cctp"}],"DL4z":[function(require,module,exports) {
function e(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}module.exports=e;
},{}],"5VkU":[function(require,module,exports) {
function t(t){return this.__data__.get(t)}module.exports=t;
},{}],"xfO4":[function(require,module,exports) {
function t(t){return this.__data__.has(t)}module.exports=t;
},{}],"oTY2":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3],t="object"==typeof e&&e&&e.Object===Object&&e;module.exports=t;
},{}],"/xIe":[function(require,module,exports) {
var e=require("./_freeGlobal"),t="object"==typeof self&&self&&self.Object===Object&&self,l=e||t||Function("return this")();module.exports=l;
},{"./_freeGlobal":"oTY2"}],"DLZd":[function(require,module,exports) {
var o=require("./_root"),r=o.Symbol;module.exports=r;
},{"./_root":"/xIe"}],"Bpn7":[function(require,module,exports) {
var r=require("./_Symbol"),t=Object.prototype,e=t.hasOwnProperty,o=t.toString,a=r?r.toStringTag:void 0;function l(r){var t=e.call(r,a),l=r[a];try{r[a]=void 0;var c=!0}catch(n){}var i=o.call(r);return c&&(t?r[a]=l:delete r[a]),i}module.exports=l;
},{"./_Symbol":"DLZd"}],"BWPB":[function(require,module,exports) {
var t=Object.prototype,o=t.toString;function r(t){return o.call(t)}module.exports=r;
},{}],"7Wi4":[function(require,module,exports) {
var e=require("./_Symbol"),r=require("./_getRawTag"),o=require("./_objectToString"),t="[object Null]",i="[object Undefined]",n=e?e.toStringTag:void 0;function u(e){return null==e?void 0===e?i:t:n&&n in Object(e)?r(e):o(e)}module.exports=u;
},{"./_Symbol":"DLZd","./_getRawTag":"Bpn7","./_objectToString":"BWPB"}],"nXTg":[function(require,module,exports) {
function n(n){var o=typeof n;return null!=n&&("object"==o||"function"==o)}module.exports=n;
},{}],"e+zN":[function(require,module,exports) {
var e=require("./_baseGetTag"),r=require("./isObject"),t="[object AsyncFunction]",n="[object Function]",o="[object GeneratorFunction]",c="[object Proxy]";function u(u){if(!r(u))return!1;var i=e(u);return i==n||i==o||i==t||i==c}module.exports=u;
},{"./_baseGetTag":"7Wi4","./isObject":"nXTg"}],"LNrE":[function(require,module,exports) {
var r=require("./_root"),e=r["__core-js_shared__"];module.exports=e;
},{"./_root":"/xIe"}],"J11c":[function(require,module,exports) {
var e=require("./_coreJsData"),r=function(){var r=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function n(e){return!!r&&r in e}module.exports=n;
},{"./_coreJsData":"LNrE"}],"IM5E":[function(require,module,exports) {
var t=Function.prototype,r=t.toString;function n(t){if(null!=t){try{return r.call(t)}catch(n){}try{return t+""}catch(n){}}return""}module.exports=n;
},{}],"oeg0":[function(require,module,exports) {
var e=require("./isFunction"),r=require("./_isMasked"),t=require("./isObject"),o=require("./_toSource"),n=/[\\^$.*+?()[\]{}|]/g,c=/^\[object .+?Constructor\]$/,i=Function.prototype,u=Object.prototype,p=i.toString,s=u.hasOwnProperty,a=RegExp("^"+p.call(s).replace(n,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function l(n){return!(!t(n)||r(n))&&(e(n)?a:c).test(o(n))}module.exports=l;
},{"./isFunction":"e+zN","./_isMasked":"J11c","./isObject":"nXTg","./_toSource":"IM5E"}],"0bbX":[function(require,module,exports) {
function n(n,o){return null==n?void 0:n[o]}module.exports=n;
},{}],"OCOe":[function(require,module,exports) {
var e=require("./_baseIsNative"),r=require("./_getValue");function u(u,a){var i=r(u,a);return e(i)?i:void 0}module.exports=u;
},{"./_baseIsNative":"oeg0","./_getValue":"0bbX"}],"aIG+":[function(require,module,exports) {
var e=require("./_getNative"),r=require("./_root"),o=e(r,"Map");module.exports=o;
},{"./_getNative":"OCOe","./_root":"/xIe"}],"P7bi":[function(require,module,exports) {
var e=require("./_getNative"),r=e(Object,"create");module.exports=r;
},{"./_getNative":"OCOe"}],"Snxj":[function(require,module,exports) {
var e=require("./_nativeCreate");function t(){this.__data__=e?e(null):{},this.size=0}module.exports=t;
},{"./_nativeCreate":"P7bi"}],"UQvh":[function(require,module,exports) {
function t(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}module.exports=t;
},{}],"VUWp":[function(require,module,exports) {
var e=require("./_nativeCreate"),r="__lodash_hash_undefined__",t=Object.prototype,a=t.hasOwnProperty;function _(t){var _=this.__data__;if(e){var o=_[t];return o===r?void 0:o}return a.call(_,t)?_[t]:void 0}module.exports=_;
},{"./_nativeCreate":"P7bi"}],"6jcd":[function(require,module,exports) {
var e=require("./_nativeCreate"),r=Object.prototype,t=r.hasOwnProperty;function a(r){var a=this.__data__;return e?void 0!==a[r]:t.call(a,r)}module.exports=a;
},{"./_nativeCreate":"P7bi"}],"uRwc":[function(require,module,exports) {
var e=require("./_nativeCreate"),_="__lodash_hash_undefined__";function i(i,t){var a=this.__data__;return this.size+=this.has(i)?0:1,a[i]=e&&void 0===t?_:t,this}module.exports=i;
},{"./_nativeCreate":"P7bi"}],"1urg":[function(require,module,exports) {
var e=require("./_hashClear"),r=require("./_hashDelete"),t=require("./_hashGet"),h=require("./_hashHas"),o=require("./_hashSet");function a(e){var r=-1,t=null==e?0:e.length;for(this.clear();++r<t;){var h=e[r];this.set(h[0],h[1])}}a.prototype.clear=e,a.prototype.delete=r,a.prototype.get=t,a.prototype.has=h,a.prototype.set=o,module.exports=a;
},{"./_hashClear":"Snxj","./_hashDelete":"UQvh","./_hashGet":"VUWp","./_hashHas":"6jcd","./_hashSet":"uRwc"}],"WA1k":[function(require,module,exports) {
var e=require("./_Hash"),i=require("./_ListCache"),r=require("./_Map");function a(){this.size=0,this.__data__={hash:new e,map:new(r||i),string:new e}}module.exports=a;
},{"./_Hash":"1urg","./_ListCache":"Cctp","./_Map":"aIG+"}],"Wmk/":[function(require,module,exports) {
function o(o){var n=typeof o;return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==o:null===o}module.exports=o;
},{}],"2bq9":[function(require,module,exports) {
var r=require("./_isKeyable");function e(e,a){var t=e.__data__;return r(a)?t["string"==typeof a?"string":"hash"]:t.map}module.exports=e;
},{"./_isKeyable":"Wmk/"}],"EMU/":[function(require,module,exports) {
var e=require("./_getMapData");function t(t){var r=e(this,t).delete(t);return this.size-=r?1:0,r}module.exports=t;
},{"./_getMapData":"2bq9"}],"SCZX":[function(require,module,exports) {
var e=require("./_getMapData");function t(t){return e(this,t).get(t)}module.exports=t;
},{"./_getMapData":"2bq9"}],"u16+":[function(require,module,exports) {
var e=require("./_getMapData");function r(r){return e(this,r).has(r)}module.exports=r;
},{"./_getMapData":"2bq9"}],"8yv6":[function(require,module,exports) {
var e=require("./_getMapData");function t(t,i){var s=e(this,t),r=s.size;return s.set(t,i),this.size+=s.size==r?0:1,this}module.exports=t;
},{"./_getMapData":"2bq9"}],"Re+8":[function(require,module,exports) {
var e=require("./_mapCacheClear"),r=require("./_mapCacheDelete"),t=require("./_mapCacheGet"),a=require("./_mapCacheHas"),p=require("./_mapCacheSet");function o(e){var r=-1,t=null==e?0:e.length;for(this.clear();++r<t;){var a=e[r];this.set(a[0],a[1])}}o.prototype.clear=e,o.prototype.delete=r,o.prototype.get=t,o.prototype.has=a,o.prototype.set=p,module.exports=o;
},{"./_mapCacheClear":"WA1k","./_mapCacheDelete":"EMU/","./_mapCacheGet":"SCZX","./_mapCacheHas":"u16+","./_mapCacheSet":"8yv6"}],"PR3K":[function(require,module,exports) {
var e=require("./_ListCache"),i=require("./_Map"),t=require("./_MapCache"),s=200;function _(_,a){var r=this.__data__;if(r instanceof e){var h=r.__data__;if(!i||h.length<s-1)return h.push([_,a]),this.size=++r.size,this;r=this.__data__=new t(h)}return r.set(_,a),this.size=r.size,this}module.exports=_;
},{"./_ListCache":"Cctp","./_Map":"aIG+","./_MapCache":"Re+8"}],"c7y0":[function(require,module,exports) {
var e=require("./_ListCache"),t=require("./_stackClear"),r=require("./_stackDelete"),a=require("./_stackGet"),s=require("./_stackHas"),o=require("./_stackSet");function i(t){var r=this.__data__=new e(t);this.size=r.size}i.prototype.clear=t,i.prototype.delete=r,i.prototype.get=a,i.prototype.has=s,i.prototype.set=o,module.exports=i;
},{"./_ListCache":"Cctp","./_stackClear":"v1ke","./_stackDelete":"DL4z","./_stackGet":"5VkU","./_stackHas":"xfO4","./_stackSet":"PR3K"}],"+G4/":[function(require,module,exports) {
var _="__lodash_hash_undefined__";function t(t){return this.__data__.set(t,_),this}module.exports=t;
},{}],"lLZC":[function(require,module,exports) {
var e=require("./_MapCache"),t=require("./_setCacheAdd"),r=require("./_setCacheHas");function a(t){var r=-1,a=null==t?0:t.length;for(this.__data__=new e;++r<a;)this.add(t[r])}a.prototype.add=a.prototype.push=t,a.prototype.has=r,module.exports=a;
},{"./_MapCache":"Re+8","./_setCacheAdd":"+G4/","./_setCacheHas":"xfO4"}],"1qzz":[function(require,module,exports) {
function r(r,n){for(var e=-1,t=null==r?0:r.length;++e<t;)if(n(r[e],e,r))return!0;return!1}module.exports=r;
},{}],"8/G1":[function(require,module,exports) {
function e(e,n){return e.has(n)}module.exports=e;
},{}],"j6GS":[function(require,module,exports) {
var e=require("./_SetCache"),r=require("./_arraySome"),i=require("./_cacheHas"),t=1,a=2;function n(n,f,u,o,v,c){var l=u&t,s=n.length,d=f.length;if(s!=d&&!(l&&d>s))return!1;var h=c.get(n);if(h&&c.get(f))return h==f;var g=-1,b=!0,k=u&a?new e:void 0;for(c.set(n,f),c.set(f,n);++g<s;){var q=n[g],_=f[g];if(o)var m=l?o(_,q,g,f,n,c):o(q,_,g,n,f,c);if(void 0!==m){if(m)continue;b=!1;break}if(k){if(!r(f,function(e,r){if(!i(k,r)&&(q===e||v(q,e,u,o,c)))return k.push(r)})){b=!1;break}}else if(q!==_&&!v(q,_,u,o,c)){b=!1;break}}return c.delete(n),c.delete(f),b}module.exports=n;
},{"./_SetCache":"lLZC","./_arraySome":"1qzz","./_cacheHas":"8/G1"}],"p6rg":[function(require,module,exports) {
var r=require("./_root"),e=r.Uint8Array;module.exports=e;
},{"./_root":"/xIe"}],"/Q0H":[function(require,module,exports) {
function r(r){var n=-1,o=Array(r.size);return r.forEach(function(r,e){o[++n]=[e,r]}),o}module.exports=r;
},{}],"gLm9":[function(require,module,exports) {
function r(r){var n=-1,o=Array(r.size);return r.forEach(function(r){o[++n]=r}),o}module.exports=r;
},{}],"vN3S":[function(require,module,exports) {
var e=require("./_Symbol"),r=require("./_Uint8Array"),t=require("./eq"),a=require("./_equalArrays"),c=require("./_mapToArray"),o=require("./_setToArray"),s=1,u=2,n="[object Boolean]",b="[object Date]",i="[object Error]",f="[object Map]",y="[object Number]",j="[object RegExp]",l="[object Set]",g="[object String]",m="[object Symbol]",q="[object ArrayBuffer]",v="[object DataView]",p=e?e.prototype:void 0,h=p?p.valueOf:void 0;function A(e,p,A,_,d,w,L){switch(A){case v:if(e.byteLength!=p.byteLength||e.byteOffset!=p.byteOffset)return!1;e=e.buffer,p=p.buffer;case q:return!(e.byteLength!=p.byteLength||!w(new r(e),new r(p)));case n:case b:case y:return t(+e,+p);case i:return e.name==p.name&&e.message==p.message;case j:case g:return e==p+"";case f:var S=c;case l:var O=_&s;if(S||(S=o),e.size!=p.size&&!O)return!1;var x=L.get(e);if(x)return x==p;_|=u,L.set(e,p);var z=a(S(e),S(p),_,d,w,L);return L.delete(e),z;case m:if(h)return h.call(e)==h.call(p)}return!1}module.exports=A;
},{"./_Symbol":"DLZd","./_Uint8Array":"p6rg","./eq":"Dwod","./_equalArrays":"j6GS","./_mapToArray":"/Q0H","./_setToArray":"gLm9"}],"de5t":[function(require,module,exports) {
function e(e,n){for(var r=-1,t=n.length,o=e.length;++r<t;)e[o+r]=n[r];return e}module.exports=e;
},{}],"wkyw":[function(require,module,exports) {
var r=Array.isArray;module.exports=r;
},{}],"Pv1S":[function(require,module,exports) {
var r=require("./_arrayPush"),e=require("./isArray");function u(u,a,i){var n=a(u);return e(u)?n:r(n,i(u))}module.exports=u;
},{"./_arrayPush":"de5t","./isArray":"wkyw"}],"NmX+":[function(require,module,exports) {
function r(r,n){for(var e=-1,l=null==r?0:r.length,o=0,t=[];++e<l;){var u=r[e];n(u,e,r)&&(t[o++]=u)}return t}module.exports=r;
},{}],"ahzT":[function(require,module,exports) {
function e(){return[]}module.exports=e;
},{}],"XoGU":[function(require,module,exports) {
var r=require("./_arrayFilter"),e=require("./stubArray"),t=Object.prototype,u=t.propertyIsEnumerable,n=Object.getOwnPropertySymbols,o=n?function(e){return null==e?[]:(e=Object(e),r(n(e),function(r){return u.call(e,r)}))}:e;module.exports=o;
},{"./_arrayFilter":"NmX+","./stubArray":"ahzT"}],"Gh1U":[function(require,module,exports) {
function r(r,o){for(var e=-1,n=Array(r);++e<r;)n[e]=o(e);return n}module.exports=r;
},{}],"zDNZ":[function(require,module,exports) {
function e(e){return null!=e&&"object"==typeof e}module.exports=e;
},{}],"6B4x":[function(require,module,exports) {
var e=require("./_baseGetTag"),r=require("./isObjectLike"),t="[object Arguments]";function u(u){return r(u)&&e(u)==t}module.exports=u;
},{"./_baseGetTag":"7Wi4","./isObjectLike":"zDNZ"}],"HnvO":[function(require,module,exports) {
var e=require("./_baseIsArguments"),r=require("./isObjectLike"),t=Object.prototype,l=t.hasOwnProperty,n=t.propertyIsEnumerable,u=e(function(){return arguments}())?e:function(e){return r(e)&&l.call(e,"callee")&&!n.call(e,"callee")};module.exports=u;
},{"./_baseIsArguments":"6B4x","./isObjectLike":"zDNZ"}],"t1xm":[function(require,module,exports) {
function e(){return!1}module.exports=e;
},{}],"uYyO":[function(require,module,exports) {

var e=require("./_root"),o=require("./stubFalse"),r="object"==typeof exports&&exports&&!exports.nodeType&&exports,t=r&&"object"==typeof module&&module&&!module.nodeType&&module,p=t&&t.exports===r,u=p?e.Buffer:void 0,d=u?u.isBuffer:void 0,s=d||o;module.exports=s;
},{"./_root":"/xIe","./stubFalse":"t1xm"}],"gt7M":[function(require,module,exports) {
var e=9007199254740991,r=/^(?:0|[1-9]\d*)$/;function t(t,n){var o=typeof t;return!!(n=null==n?e:n)&&("number"==o||"symbol"!=o&&r.test(t))&&t>-1&&t%1==0&&t<n}module.exports=t;
},{}],"xqyM":[function(require,module,exports) {
var e=9007199254740991;function r(r){return"number"==typeof r&&r>-1&&r%1==0&&r<=e}module.exports=r;
},{}],"wwel":[function(require,module,exports) {
var e=require("./_baseGetTag"),t=require("./isLength"),r=require("./isObjectLike"),o="[object Arguments]",b="[object Array]",c="[object Boolean]",j="[object Date]",a="[object Error]",n="[object Function]",i="[object Map]",A="[object Number]",y="[object Object]",u="[object RegExp]",g="[object Set]",l="[object String]",p="[object WeakMap]",s="[object ArrayBuffer]",m="[object DataView]",U="[object Float32Array]",f="[object Float64Array]",q="[object Int8Array]",F="[object Int16Array]",I="[object Int32Array]",d="[object Uint8Array]",h="[object Uint8ClampedArray]",k="[object Uint16Array]",x="[object Uint32Array]",B={};function D(o){return r(o)&&t(o.length)&&!!B[e(o)]}B[U]=B[f]=B[q]=B[F]=B[I]=B[d]=B[h]=B[k]=B[x]=!0,B[o]=B[b]=B[s]=B[c]=B[m]=B[j]=B[a]=B[n]=B[i]=B[A]=B[y]=B[u]=B[g]=B[l]=B[p]=!1,module.exports=D;
},{"./_baseGetTag":"7Wi4","./isLength":"xqyM","./isObjectLike":"zDNZ"}],"DgPH":[function(require,module,exports) {
function n(n){return function(r){return n(r)}}module.exports=n;
},{}],"fwxu":[function(require,module,exports) {
var e=require("./_freeGlobal"),o="object"==typeof exports&&exports&&!exports.nodeType&&exports,r=o&&"object"==typeof module&&module&&!module.nodeType&&module,t=r&&r.exports===o,p=t&&e.process,u=function(){try{var e=r&&r.require&&r.require("util").types;return e||p&&p.binding&&p.binding("util")}catch(o){}}();module.exports=u;
},{"./_freeGlobal":"oTY2"}],"l3rH":[function(require,module,exports) {
var e=require("./_baseIsTypedArray"),r=require("./_baseUnary"),a=require("./_nodeUtil"),i=a&&a.isTypedArray,s=i?r(i):e;module.exports=s;
},{"./_baseIsTypedArray":"wwel","./_baseUnary":"DgPH","./_nodeUtil":"fwxu"}],"pGun":[function(require,module,exports) {
var e=require("./_baseTimes"),r=require("./isArguments"),t=require("./isArray"),i=require("./isBuffer"),n=require("./_isIndex"),s=require("./isTypedArray"),u=Object.prototype,f=u.hasOwnProperty;function a(u,a){var o=t(u),p=!o&&r(u),y=!o&&!p&&i(u),g=!o&&!p&&!y&&s(u),h=o||p||y||g,l=h?e(u.length,String):[],q=l.length;for(var b in u)!a&&!f.call(u,b)||h&&("length"==b||y&&("offset"==b||"parent"==b)||g&&("buffer"==b||"byteLength"==b||"byteOffset"==b)||n(b,q))||l.push(b);return l}module.exports=a;
},{"./_baseTimes":"Gh1U","./isArguments":"HnvO","./isArray":"wkyw","./isBuffer":"uYyO","./_isIndex":"gt7M","./isTypedArray":"l3rH"}],"KA5M":[function(require,module,exports) {
var t=Object.prototype;function o(o){var r=o&&o.constructor;return o===("function"==typeof r&&r.prototype||t)}module.exports=o;
},{}],"7uZi":[function(require,module,exports) {
function n(n,r){return function(t){return n(r(t))}}module.exports=n;
},{}],"eDHY":[function(require,module,exports) {
var e=require("./_overArg"),r=e(Object.keys,Object);module.exports=r;
},{"./_overArg":"7uZi"}],"JXyU":[function(require,module,exports) {
var r=require("./_isPrototype"),e=require("./_nativeKeys"),t=Object.prototype,o=t.hasOwnProperty;function n(t){if(!r(t))return e(t);var n=[];for(var u in Object(t))o.call(t,u)&&"constructor"!=u&&n.push(u);return n}module.exports=n;
},{"./_isPrototype":"KA5M","./_nativeKeys":"eDHY"}],"2pI9":[function(require,module,exports) {
var e=require("./isFunction"),n=require("./isLength");function r(r){return null!=r&&n(r.length)&&!e(r)}module.exports=r;
},{"./isFunction":"e+zN","./isLength":"xqyM"}],"9x32":[function(require,module,exports) {
var e=require("./_arrayLikeKeys"),r=require("./_baseKeys"),i=require("./isArrayLike");function u(u){return i(u)?e(u):r(u)}module.exports=u;
},{"./_arrayLikeKeys":"pGun","./_baseKeys":"JXyU","./isArrayLike":"2pI9"}],"zyiI":[function(require,module,exports) {
var e=require("./_baseGetAllKeys"),r=require("./_getSymbols"),u=require("./keys");function s(s){return e(s,u,r)}module.exports=s;
},{"./_baseGetAllKeys":"Pv1S","./_getSymbols":"XoGU","./keys":"9x32"}],"qGDK":[function(require,module,exports) {
var r=require("./_getAllKeys"),t=1,e=Object.prototype,n=e.hasOwnProperty;function o(e,o,c,i,a,f){var u=c&t,s=r(e),v=s.length;if(v!=r(o).length&&!u)return!1;for(var l=v;l--;){var p=s[l];if(!(u?p in o:n.call(o,p)))return!1}var g=f.get(e);if(g&&f.get(o))return g==o;var y=!0;f.set(e,o),f.set(o,e);for(var d=u;++l<v;){var h=e[p=s[l]],b=o[p];if(i)var O=u?i(b,h,p,o,e,f):i(h,b,p,e,o,f);if(!(void 0===O?h===b||a(h,b,c,i,f):O)){y=!1;break}d||(d="constructor"==p)}if(y&&!d){var j=e.constructor,k=o.constructor;j!=k&&"constructor"in e&&"constructor"in o&&!("function"==typeof j&&j instanceof j&&"function"==typeof k&&k instanceof k)&&(y=!1)}return f.delete(e),f.delete(o),y}module.exports=o;
},{"./_getAllKeys":"zyiI"}],"qiVC":[function(require,module,exports) {
var e=require("./_getNative"),r=require("./_root"),t=e(r,"DataView");module.exports=t;
},{"./_getNative":"OCOe","./_root":"/xIe"}],"O/Rr":[function(require,module,exports) {
var e=require("./_getNative"),r=require("./_root"),o=e(r,"Promise");module.exports=o;
},{"./_getNative":"OCOe","./_root":"/xIe"}],"Fusa":[function(require,module,exports) {
var e=require("./_getNative"),r=require("./_root"),t=e(r,"Set");module.exports=t;
},{"./_getNative":"OCOe","./_root":"/xIe"}],"uxeT":[function(require,module,exports) {
var e=require("./_getNative"),r=require("./_root"),a=e(r,"WeakMap");module.exports=a;
},{"./_getNative":"OCOe","./_root":"/xIe"}],"dYZR":[function(require,module,exports) {
var e=require("./_DataView"),r=require("./_Map"),t=require("./_Promise"),a=require("./_Set"),u=require("./_WeakMap"),c=require("./_baseGetTag"),o=require("./_toSource"),i="[object Map]",n="[object Object]",s="[object Promise]",b="[object Set]",w="[object WeakMap]",j="[object DataView]",q=o(e),_=o(r),p=o(t),f=o(a),v=o(u),M=c;(e&&M(new e(new ArrayBuffer(1)))!=j||r&&M(new r)!=i||t&&M(t.resolve())!=s||a&&M(new a)!=b||u&&M(new u)!=w)&&(M=function(e){var r=c(e),t=r==n?e.constructor:void 0,a=t?o(t):"";if(a)switch(a){case q:return j;case _:return i;case p:return s;case f:return b;case v:return w}return r}),module.exports=M;
},{"./_DataView":"qiVC","./_Map":"aIG+","./_Promise":"O/Rr","./_Set":"Fusa","./_WeakMap":"uxeT","./_baseGetTag":"7Wi4","./_toSource":"IM5E"}],"hv+u":[function(require,module,exports) {
var e=require("./_Stack"),r=require("./_equalArrays"),a=require("./_equalByTag"),u=require("./_equalObjects"),t=require("./_getTag"),i=require("./isArray"),_=require("./isBuffer"),n=require("./isTypedArray"),q=1,c="[object Arguments]",l="[object Array]",o="[object Object]",p=Object.prototype,f=p.hasOwnProperty;function s(p,s,y,b,j,v){var w=i(p),A=i(s),d=w?l:t(p),g=A?l:t(s),O=(d=d==c?o:d)==o,T=(g=g==c?o:g)==o,m=d==g;if(m&&_(p)){if(!_(s))return!1;w=!0,O=!1}if(m&&!O)return v||(v=new e),w||n(p)?r(p,s,y,b,j,v):a(p,s,d,y,b,j,v);if(!(y&q)){var B=O&&f.call(p,"__wrapped__"),h=T&&f.call(s,"__wrapped__");if(B||h){var k=B?p.value():p,x=h?s.value():s;return v||(v=new e),j(k,x,y,b,v)}}return!!m&&(v||(v=new e),u(p,s,y,b,j,v))}module.exports=s;
},{"./_Stack":"c7y0","./_equalArrays":"j6GS","./_equalByTag":"vN3S","./_equalObjects":"qGDK","./_getTag":"dYZR","./isArray":"wkyw","./isBuffer":"uYyO","./isTypedArray":"l3rH"}],"vqvM":[function(require,module,exports) {
var e=require("./_baseIsEqualDeep"),r=require("./isObjectLike");function u(l,i,n,s,t){return l===i||(null==l||null==i||!r(l)&&!r(i)?l!=l&&i!=i:e(l,i,n,s,u,t))}module.exports=u;
},{"./_baseIsEqualDeep":"hv+u","./isObjectLike":"zDNZ"}],"AaS8":[function(require,module,exports) {
var r=require("./_Stack"),e=require("./_baseIsEqual"),i=1,n=2;function u(u,t,a,f){var v=a.length,o=v,l=!f;if(null==u)return!o;for(u=Object(u);v--;){var s=a[v];if(l&&s[2]?s[1]!==u[s[0]]:!(s[0]in u))return!1}for(;++v<o;){var c=(s=a[v])[0],d=u[c],q=s[1];if(l&&s[2]){if(void 0===d&&!(c in u))return!1}else{var b=new r;if(f)var _=f(d,q,c,u,t,b);if(!(void 0===_?e(q,d,i|n,f,b):_))return!1}}return!0}module.exports=u;
},{"./_Stack":"c7y0","./_baseIsEqual":"vqvM"}],"Z5/g":[function(require,module,exports) {
var e=require("./isObject");function r(r){return r==r&&!e(r)}module.exports=r;
},{"./isObject":"nXTg"}],"QpuE":[function(require,module,exports) {
var r=require("./_isStrictComparable"),e=require("./keys");function t(t){for(var a=e(t),i=a.length;i--;){var o=a[i],u=t[o];a[i]=[o,u,r(u)]}return a}module.exports=t;
},{"./_isStrictComparable":"Z5/g","./keys":"9x32"}],"xHDh":[function(require,module,exports) {
function n(n,t){return function(u){return null!=u&&(u[n]===t&&(void 0!==t||n in Object(u)))}}module.exports=n;
},{}],"1Tt+":[function(require,module,exports) {
var e=require("./_baseIsMatch"),r=require("./_getMatchData"),t=require("./_matchesStrictComparable");function a(a){var u=r(a);return 1==u.length&&u[0][2]?t(u[0][0],u[0][1]):function(r){return r===a||e(r,a,u)}}module.exports=a;
},{"./_baseIsMatch":"AaS8","./_getMatchData":"QpuE","./_matchesStrictComparable":"xHDh"}],"r4Gp":[function(require,module,exports) {
var e=require("./_baseGetTag"),r=require("./isObjectLike"),o="[object Symbol]";function t(t){return"symbol"==typeof t||r(t)&&e(t)==o}module.exports=t;
},{"./_baseGetTag":"7Wi4","./isObjectLike":"zDNZ"}],"o6kv":[function(require,module,exports) {
var e=require("./isArray"),r=require("./isSymbol"),t=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function u(u,l){if(e(u))return!1;var o=typeof u;return!("number"!=o&&"symbol"!=o&&"boolean"!=o&&null!=u&&!r(u))||(n.test(u)||!t.test(u)||null!=l&&u in Object(l))}module.exports=u;
},{"./isArray":"wkyw","./isSymbol":"r4Gp"}],"L9zR":[function(require,module,exports) {
var e=require("./_MapCache"),r="Expected a function";function t(n,a){if("function"!=typeof n||null!=a&&"function"!=typeof a)throw new TypeError(r);var c=function(){var e=arguments,r=a?a.apply(this,e):e[0],t=c.cache;if(t.has(r))return t.get(r);var o=n.apply(this,e);return c.cache=t.set(r,o)||t,o};return c.cache=new(t.Cache||e),c}t.Cache=e,module.exports=t;
},{"./_MapCache":"Re+8"}],"Qdb1":[function(require,module,exports) {
var e=require("./memoize"),r=500;function n(n){var u=e(n,function(e){return c.size===r&&c.clear(),e}),c=u.cache;return u}module.exports=n;
},{"./memoize":"L9zR"}],"wIF4":[function(require,module,exports) {
var e=require("./_memoizeCapped"),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,p=/\\(\\)?/g,u=e(function(e){var u=[];return 46===e.charCodeAt(0)&&u.push(""),e.replace(r,function(e,r,a,o){u.push(a?o.replace(p,"$1"):r||e)}),u});module.exports=u;
},{"./_memoizeCapped":"Qdb1"}],"fvqp":[function(require,module,exports) {
function r(r,n){for(var e=-1,l=null==r?0:r.length,o=Array(l);++e<l;)o[e]=n(r[e],e,r);return o}module.exports=r;
},{}],"HLaq":[function(require,module,exports) {
var r=require("./_Symbol"),e=require("./_arrayMap"),i=require("./isArray"),t=require("./isSymbol"),o=1/0,u=r?r.prototype:void 0,n=u?u.toString:void 0;function a(r){if("string"==typeof r)return r;if(i(r))return e(r,a)+"";if(t(r))return n?n.call(r):"";var u=r+"";return"0"==u&&1/r==-o?"-0":u}module.exports=a;
},{"./_Symbol":"DLZd","./_arrayMap":"fvqp","./isArray":"wkyw","./isSymbol":"r4Gp"}],"rSUi":[function(require,module,exports) {
var r=require("./_baseToString");function e(e){return null==e?"":r(e)}module.exports=e;
},{"./_baseToString":"HLaq"}],"+Mge":[function(require,module,exports) {
var r=require("./isArray"),e=require("./_isKey"),i=require("./_stringToPath"),t=require("./toString");function u(u,n){return r(u)?u:e(u,n)?[u]:i(t(u))}module.exports=u;
},{"./isArray":"wkyw","./_isKey":"o6kv","./_stringToPath":"wIF4","./toString":"rSUi"}],"+1kd":[function(require,module,exports) {
var r=require("./isSymbol"),e=1/0;function t(t){if("string"==typeof t||r(t))return t;var i=t+"";return"0"==i&&1/t==-e?"-0":i}module.exports=t;
},{"./isSymbol":"r4Gp"}],"avJP":[function(require,module,exports) {
var r=require("./_castPath"),e=require("./_toKey");function t(t,o){for(var u=0,n=(o=r(o,t)).length;null!=t&&u<n;)t=t[e(o[u++])];return u&&u==n?t:void 0}module.exports=t;
},{"./_castPath":"+Mge","./_toKey":"+1kd"}],"jBeG":[function(require,module,exports) {
var e=require("./_baseGet");function r(r,o,u){var i=null==r?void 0:e(r,o);return void 0===i?u:i}module.exports=r;
},{"./_baseGet":"avJP"}],"nSpp":[function(require,module,exports) {
function n(n,e){return null!=n&&e in Object(n)}module.exports=n;
},{}],"Btxt":[function(require,module,exports) {
var r=require("./_castPath"),e=require("./isArguments"),i=require("./isArray"),u=require("./_isIndex"),n=require("./isLength"),t=require("./_toKey");function a(a,l,s){for(var q=-1,o=(l=r(l,a)).length,g=!1;++q<o;){var h=t(l[q]);if(!(g=null!=a&&s(a,h)))break;a=a[h]}return g||++q!=o?g:!!(o=null==a?0:a.length)&&n(o)&&u(h,o)&&(i(a)||e(a))}module.exports=a;
},{"./_castPath":"+Mge","./isArguments":"HnvO","./isArray":"wkyw","./_isIndex":"gt7M","./isLength":"xqyM","./_toKey":"+1kd"}],"G4Hr":[function(require,module,exports) {
var e=require("./_baseHasIn"),r=require("./_hasPath");function u(u,a){return null!=u&&r(u,a,e)}module.exports=u;
},{"./_baseHasIn":"nSpp","./_hasPath":"Btxt"}],"vr2k":[function(require,module,exports) {
var e=require("./_baseIsEqual"),r=require("./get"),i=require("./hasIn"),u=require("./_isKey"),t=require("./_isStrictComparable"),a=require("./_matchesStrictComparable"),o=require("./_toKey"),q=1,n=2;function s(s,c){return u(s)&&t(c)?a(o(s),c):function(u){var t=r(u,s);return void 0===t&&t===c?i(u,s):e(c,t,q|n)}}module.exports=s;
},{"./_baseIsEqual":"vqvM","./get":"jBeG","./hasIn":"G4Hr","./_isKey":"o6kv","./_isStrictComparable":"Z5/g","./_matchesStrictComparable":"xHDh","./_toKey":"+1kd"}],"DSsP":[function(require,module,exports) {
function e(e){return e}module.exports=e;
},{}],"cDB8":[function(require,module,exports) {
function n(n){return function(u){return null==u?void 0:u[n]}}module.exports=n;
},{}],"YsSy":[function(require,module,exports) {
var e=require("./_baseGet");function r(r){return function(n){return e(n,r)}}module.exports=r;
},{"./_baseGet":"avJP"}],"42gf":[function(require,module,exports) {
var e=require("./_baseProperty"),r=require("./_basePropertyDeep"),u=require("./_isKey"),i=require("./_toKey");function o(o){return u(o)?e(i(o)):r(o)}module.exports=o;
},{"./_baseProperty":"cDB8","./_basePropertyDeep":"YsSy","./_isKey":"o6kv","./_toKey":"+1kd"}],"3vBz":[function(require,module,exports) {
var e=require("./_baseMatches"),r=require("./_baseMatchesProperty"),t=require("./identity"),i=require("./isArray"),u=require("./property");function o(o){return"function"==typeof o?o:null==o?t:"object"==typeof o?i(o)?r(o[0],o[1]):e(o):u(o)}module.exports=o;
},{"./_baseMatches":"1Tt+","./_baseMatchesProperty":"vr2k","./identity":"DSsP","./isArray":"wkyw","./property":"42gf"}],"8WeJ":[function(require,module,exports) {
function n(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}module.exports=n;
},{}],"AEfX":[function(require,module,exports) {
function r(r,e,n){var o=-1,t=r.length;e<0&&(e=-e>t?0:t+e),(n=n>t?t:n)<0&&(n+=t),t=e>n?0:n-e>>>0,e>>>=0;for(var a=Array(t);++o<t;)a[o]=r[o+e];return a}module.exports=r;
},{}],"aL1r":[function(require,module,exports) {
var e=require("./_baseGet"),r=require("./_baseSlice");function t(t,u){return u.length<2?t:e(t,r(u,0,-1))}module.exports=t;
},{"./_baseGet":"avJP","./_baseSlice":"AEfX"}],"l0gk":[function(require,module,exports) {
var e=require("./_castPath"),r=require("./last"),t=require("./_parent"),u=require("./_toKey");function a(a,i){return i=e(i,a),null==(a=t(a,i))||delete a[u(r(i))]}module.exports=a;
},{"./_castPath":"+Mge","./last":"8WeJ","./_parent":"aL1r","./_toKey":"+1kd"}],"+V5y":[function(require,module,exports) {
var r=require("./_baseUnset"),e=require("./_isIndex"),a=Array.prototype,t=a.splice;function i(a,i){for(var n=a?i.length:0,o=n-1;n--;){var l=i[n];if(n==o||l!==s){var s=l;e(l)?t.call(a,l,1):r(a,l)}}return a}module.exports=i;
},{"./_baseUnset":"l0gk","./_isIndex":"gt7M"}],"aVGK":[function(require,module,exports) {
var e=require("./_baseIteratee"),r=require("./_basePullAt");function t(t,u){var a=[];if(!t||!t.length)return a;var n=-1,l=[],s=t.length;for(u=e(u,3);++n<s;){var h=t[n];u(h,n,t)&&(a.push(h),l.push(n))}return r(t,l),a}module.exports=t;
},{"./_baseIteratee":"3vBz","./_basePullAt":"+V5y"}],"4k//":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Animation=exports.SystemAnimation=void 0;var t=require("./system"),e=i(require("lodash/remove"));function i(t){return t&&t.__esModule?t:{default:t}}var n=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),s=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.fps=60,n.fpsratio=1,n.focusback=!1,n.frameBeforeEnd=0,n.frameSinceStarted=0,n.list=[],n.qualityAtBreak=!1,n.lastFrameNumberCheck=8,n.firstFrameNumberCheck=2,n.scaleAccuracy=10,n.sceneAdvancedTexture={renderScale:1},n.defaultPipeline={samples:1,fxaaEnabled:!1},window.addEventListener("focus",function(){n.setFocusBack()}),window.addEventListener("blur",function(){n.setFocusBack()}),n}return n(i,t),i.prototype.forceRender=function(){var t=this;this.frameSinceStarted=0,this.sendToStartListener(),this.engine.stopRenderLoop(),this.limitFPS?this.engine.runRenderLoop(function(){t.runAnimations(),t.limitSwitch&&t.scene.render(),t.limitSwitch=!t.limitSwitch}):this.engine.runRenderLoop(function(){t.runAnimations(),t.scene.render()})},i.prototype.runAnimations=function(){this.fps=this.engine.getFps(),this.fpsratio=60/this.fps,this.frameBeforeEnd=0;for(var t=Math.min(this.fpsratio,2),e=0;e<this.list.length;e++){var i=this.list[e];i.running&&(i.funct(i.count,i.count/i.howmany),i.count>=i.howmany&&i.stop(!0),i.count+=i.step*t,i.howmany-i.count>this.frameBeforeEnd&&(this.frameBeforeEnd=Math.round(i.howmany-i.count+1)))}this.frameSinceStarted++,this.frameBeforeEnd<this.lastFrameNumberCheck&&this.qualityAtBreak?this.checkEndQuality(this.frameBeforeEnd):this.frameSinceStarted<this.firstFrameNumberCheck&&this.qualityAtBreak&&this.checkStartQuality(this.frameSinceStarted)},i.prototype.improveQualityAtBreak=function(t){this.qualityAtBreak=t},i.prototype.checkStartQuality=function(t){this.engine.setHardwareScalingLevel(1),this.sceneAdvancedTexture.renderScale=1,this.defaultPipeline.samples=1,this.defaultPipeline.fxaaEnabled=!0,this.limitSwitch||this.scene.render()},i.prototype.checkEndQuality=function(t){var e=1-(this.lastFrameNumberCheck-t)/(2*this.lastFrameNumberCheck);e=Math.round(e*this.scaleAccuracy)/this.scaleAccuracy,this.engine.setHardwareScalingLevel(e),this.sceneAdvancedTexture.renderScale=e;var i=Math.round(4-3*t/this.lastFrameNumberCheck);this.defaultPipeline.samples=i,this.defaultPipeline.fxaaEnabled=!0,this.limitSwitch||this.scene.render()},i.prototype.stopAnimations=function(){this.setFocusBack();for(var t=0;t<this.list.length;t++){this.list[t].stop(!0)}},i.prototype.restartAnimations=function(){this.setFocusBack();for(var t=0;t<this.list.length;t++){this.list[t].restart()}},i.prototype.setFocusBack=function(){var t=this;this.focusback=!0,setTimeout(function(){t.focusback=!1},200)},i.prototype.addAnimation=function(t){this.setCheckScroll(!1),this.checkVisible()&&-1==this.list.indexOf(t)&&(this.list.push(t),this.needProcess&&this.startRender())},i.prototype.removeAnimation=function(t){(0,e.default)(this.list,function(e){return e.key==t.key}),this.checkStopRender()},i.prototype.checkStopRender=function(){0==this.list.length&&this.needProcess&&this.pauseRender()},i.prototype.quickRender=function(t){var e=this;this.startRender(),setTimeout(function(){e.checkStopRender()},t||20)},i}(t.System);exports.SystemAnimation=s;var r=function(){function t(t,e,i,n){return this.start=0,this.count=0,this.step=1,this.running=!1,this.system=t,e&&this.setParam(e,i,n),this.key=Math.random().toString(36),this}return t.prototype.setParam=function(t,e,i){return this.running&&this.stop(!0),this.howmany=t-1,i&&(this.step=i),e&&(this.start=e),this.count=this.start,this},t.prototype.infinite=function(t){return this.simple(1e12,t),this},t.prototype.alternate=function(t,e,i,n,s){var r=!0,o=0;return this.simple(t,function(t,s){t>e*(o+1)&&(r=!r,o++),s=(t-=e*o)/e,r?i(t,s):n&&n(t,s)},s),this},t.prototype.loop=function(t,e,i,n,s){var r=0;return this.simple(t,function(t,s){t>e*(r+1)&&(r++,n&&n()),i(t-=e*r,t/e)},s),this},t.prototype.reverse=function(){return this.step=-this.step,this},t.prototype.simple=function(t,e,i){return this.start=0,this.count=0,this.step=1,this.howmany=t,this.go(e,i),this},t.prototype.go=function(t,e){return this.resetVar(),this.running=!0,this.funct=t,this.functend=e,this.play(),this},t.prototype.restart=function(){this.running&&(this.pause(),this.go(this.funct,this.functend))},t.prototype.resetVar=function(t){this.count=this.start,this.functend&&this.running&&this.functend(t)},t.prototype.stop=function(t){return this.resetVar(t),this.system.removeAnimation(this),this.running=!1,this},t.prototype.pause=function(){return this.system.removeAnimation(this),this.running=!1,this},t.prototype.play=function(){return this.system.addAnimation(this),this},t}();exports.Animation=r;
},{"./system":"v9Ss","lodash/remove":"aVGK"}],"sYD4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BezierCurveEase=exports.SineEase=exports.QuinticEase=exports.QuarticEase=exports.QuadraticEase=exports.PowerEase=exports.ExponentialEase=exports.ElasticEase=exports.CubicEase=exports.BounceEase=exports.BackEase=exports.CircleEase=exports.EasingFunction=void 0;var t=require("tslib"),e=require("../Maths/math.path"),n=function(){function t(){this._easingMode=t.EASINGMODE_EASEIN}return t.prototype.setEasingMode=function(t){var e=Math.min(Math.max(t,0),2);this._easingMode=e},t.prototype.getEasingMode=function(){return this._easingMode},t.prototype.easeInCore=function(t){throw new Error("You must implement this method")},t.prototype.ease=function(e){switch(this._easingMode){case t.EASINGMODE_EASEIN:return this.easeInCore(e);case t.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return e>=.5?.5*(1-this.easeInCore(2*(1-e)))+.5:.5*this.easeInCore(2*e)},t.EASINGMODE_EASEIN=0,t.EASINGMODE_EASEOUT=1,t.EASINGMODE_EASEINOUT=2,t}();exports.EasingFunction=n;var r=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){return t=Math.max(0,Math.min(1,t)),1-Math.sqrt(1-t*t)},n}(n);exports.CircleEase=r;var o=function(e){function n(t){void 0===t&&(t=1);var n=e.call(this)||this;return n.amplitude=t,n}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){var e=Math.max(0,this.amplitude);return Math.pow(t,3)-t*e*Math.sin(3.141592653589793*t)},n}(n);exports.BackEase=o;var s=function(e){function n(t,n){void 0===t&&(t=3),void 0===n&&(n=2);var r=e.call(this)||this;return r.bounces=t,r.bounciness=n,r}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){var e=Math.max(0,this.bounces),n=this.bounciness;n<=1&&(n=1.001);var r=Math.pow(n,e),o=1-n,s=(1-r)/o+.5*r,i=t*s,a=Math.log(-i*(1-n)+1)/Math.log(n),u=Math.floor(a),p=u+1,h=(1-Math.pow(n,u))/(o*s),c=.5*(h+(1-Math.pow(n,p))/(o*s)),x=t-c,E=c-h;return-Math.pow(1/n,e-u)/(E*E)*(x-E)*(x+E)},n}(n);exports.BounceEase=s;var i=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){return t*t*t},n}(n);exports.CubicEase=i;var a=function(e){function n(t,n){void 0===t&&(t=3),void 0===n&&(n=3);var r=e.call(this)||this;return r.oscillations=t,r.springiness=n,r}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){var e=Math.max(0,this.oscillations),n=Math.max(0,this.springiness);return(0==n?t:(Math.exp(n*t)-1)/(Math.exp(n)-1))*Math.sin((6.283185307179586*e+1.5707963267948966)*t)},n}(n);exports.ElasticEase=a;var u=function(e){function n(t){void 0===t&&(t=2);var n=e.call(this)||this;return n.exponent=t,n}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)},n}(n);exports.ExponentialEase=u;var p=function(e){function n(t){void 0===t&&(t=2);var n=e.call(this)||this;return n.power=t,n}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){var e=Math.max(0,this.power);return Math.pow(t,e)},n}(n);exports.PowerEase=p;var h=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){return t*t},n}(n);exports.QuadraticEase=h;var c=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){return t*t*t*t},n}(n);exports.QuarticEase=c;var x=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){return t*t*t*t*t},n}(n);exports.QuinticEase=x;var E=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return(0,t.__extends)(n,e),n.prototype.easeInCore=function(t){return 1-Math.sin(1.5707963267948966*(1-t))},n}(n);exports.SineEase=E;var l=function(n){function r(t,e,r,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===o&&(o=1);var s=n.call(this)||this;return s.x1=t,s.y1=e,s.x2=r,s.y2=o,s}return(0,t.__extends)(r,n),r.prototype.easeInCore=function(t){return e.BezierCurve.Interpolate(t,this.x1,this.y1,this.x2,this.y2)},r}(n);exports.BezierCurveEase=l;
},{"tslib":"90Cu","../Maths/math.path":"sSbP"}],"Sez+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MouseCatcher=void 0;var e=require("../System/systemAnimation"),t=s(require("lodash/remove")),i=require("@babylonjs/core/Maths/math"),n=require("@babylonjs/core/Misc/Tools"),o=require("@babylonjs/core/Animations/easing");function s(e){return e&&e.__esModule?e:{default:e}}var r=function(){function s(t,n){var s=this;this.mousecatch=new i.Vector2(0,0),this.catching=!0,this.accelerometerAvailable=!0,this.touchVector=new i.Vector2(.01,.01),this.screenQuaternion=new i.Quaternion,this.constantTranform=new i.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this.divideVector=new i.Vector2(Math.PI/8,Math.PI/8),this.deviceMaxVector=new i.Vector2(Math.PI/4,Math.PI/4),this.deviceMinVector=new i.Vector2(-Math.PI/4,-Math.PI/4),this.speed=.05,this.accuracy=.02,this.step=new i.Vector2(0,0),this.mouseReal=new i.Vector2(0,0),this.mouseCatch=new i.Vector2(0,0),this.listeners=[],this.system=t,this.animation=new e.Animation(t,10),window.addEventListener("mousemove",function(e){s.mouseOrientation(e)}),window.addEventListener("deviceorientation",function(e){s.deviceOrientation(e)}),window.addEventListener("orientationchange",function(){s.orientationChanged()}),this.orientationChanged(),this._setMobileDragEvent(n),this.curve=new o.CircleEase,this.curve.setEasingMode(o.EasingFunction.EASINGMODE_EASEOUT),window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&(this.accelerometerAvailable=!1),window.addEventListener("focus",function(){s.catching&&s.catch(s.mouseReal)})}return s.prototype.setTouchVector=function(e){this.touchVector=e},s.prototype._setMobileDragEvent=function(e){var t=this;e.addListener(function(e){if(t.catching){var n=e.multiply(t.touchVector),o=i.Vector2.Minimize(n,t.deviceMaxVector),s=i.Vector2.Maximize(o,t.deviceMinVector);s.x=-s.x,t.catch(s)}})},s.prototype.orientationChanged=function(){var e=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0;e=-n.Tools.ToRadians(e/2),this.screenQuaternion.copyFromFloats(0,Math.sin(e),0,Math.cos(e))},s.prototype.deviceOrientation=function(e){if(this.catching){var t=null!==e.gamma?e.gamma:0,o=null!==e.beta?e.beta:0,s=null!==e.alpha?e.alpha:0;if(null!==e.gamma){var r=i.Quaternion.RotationYawPitchRoll(n.Tools.ToRadians(s),n.Tools.ToRadians(o),-n.Tools.ToRadians(t));r.multiplyInPlace(this.screenQuaternion),r.multiplyInPlace(this.constantTranform),r.z*=-1,r.w*=-1;var a=r.toEulerAngles(),c=new i.Vector2(a.y,a.x);c.divideInPlace(this.divideVector);var h=i.Vector2.Minimize(c,this.deviceMaxVector),u=i.Vector2.Maximize(h,this.deviceMinVector);this.catch(u)}}},s.prototype.mouseOrientation=function(e){if(this.catching){var t=i.Vector2.Zero(),n=window.innerWidth,o=window.innerHeight;t.x=2*(e.x-n/2)/n,t.y=2*(e.y-o/2)/o,this.catch(t)}},s.prototype.start=function(){this.catching=!0},s.prototype.stop=function(){this.catching=!1},s.prototype.setSpeed=function(e){this.speed=e},s.prototype.setAccuracy=function(e){this.accuracy=e},s.prototype.catch=function(e){var t=this;if(0!=this.listeners.length){var n=this.mouseCatch,o=e.subtract(n);this.mouseReal=e;var s=5/this.speed;this.animation.simple(s,function(e,s){var r=t.speed+(1-t.speed)*t.curve.ease(s),a=o.multiply(new i.Vector2(r,r));t.mouseCatch=n.add(a),t.sendToListener()})}},s.prototype.addListener=function(e){this.listeners.push(e)},s.prototype.removeListener=function(e){(0,t.default)(this.listeners,function(e){})},s.prototype.sendToListener=function(){for(var e=0;e<this.listeners.length;e++)this.listeners[e](this.mouseCatch.clone())},s}();exports.MouseCatcher=r;
},{"../System/systemAnimation":"4k//","lodash/remove":"aVGK","@babylonjs/core/Maths/math":"iyC1","@babylonjs/core/Misc/Tools":"8xSa","@babylonjs/core/Animations/easing":"sYD4"}],"ifCa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ResponsiveCatcher=void 0;var e=require("@babylonjs/core/Cameras/camera"),t=i(require("lodash/remove"));function i(e){return e&&e.__esModule?e:{default:e}}var n=function(){function i(e,t){var i=this;this.maxScaling=1,this.isOnMobile=!1,this.canvasWidth=100,this.canvasHeight=100,this.sizeCheckInterval=100,this.horizontalFixed=!1,this.containerRatio=1,this.renderWidth=100,this.renderHeight=100,this.containerWidth=100,this.containerHeight=100,this.renderScale=1,this.fieldOfView=1,this._listeners=[],this._system=e,this._engine=e.engine,this._scene=e.scene,this._engine.onResizeObservable.add(function(){i.checkSize()}),window.addEventListener("resize",function(){i._engine.resize()}),this.setResizeContainerLoop(),t&&this.setHorizontalFixed(t),this.checkPlatform()}return i.prototype.checkPlatform=function(){var e=navigator.userAgent.toLowerCase().match(/mobile/i),t=navigator.userAgent.toLowerCase().match(/tablet/i),i=navigator.userAgent.toLowerCase().match(/android/i),n=navigator.userAgent.toLowerCase().match(/iphone/i),s=navigator.userAgent.toLowerCase().match(/ipad/i);this.isOnMobile=!!(e||t||i||n||s)},i.prototype.setResizeContainerLoop=function(){var e=this;this.intervalLoop=setInterval(function(){var t,i;i=e._system.canvas.offsetWidth,t=e._system.canvas.offsetHeight,i===e.canvasWidth&&t===e.canvasHeight||(e._engine.resize(),e._scene.render(),e.canvasWidth=i,e.canvasHeight=t)},this.sizeCheckInterval)},i.prototype.setHorizontalFixed=function(t){this.horizontalFixed=t;var i=t?e.Camera.FOVMODE_HORIZONTAL_FIXED:e.Camera.FOVMODE_VERTICAL_FIXED;if(this._scene.activeCameras.length)for(var n=0;n<this._scene.activeCameras.length;n++){this._scene.activeCameras[n].fovMode=i}else this._scene.activeCamera.fovMode=i},i.prototype.checkSize=function(){this.renderWidth=this._engine.getRenderWidth(),this.renderHeight=this._engine.getRenderHeight(),this.renderScale=1/this._engine.getHardwareScalingLevel(),this.containerWidth=this.renderWidth/this.renderScale,this.containerHeight=this.renderHeight/this.renderScale,this.containerRatio=this.containerWidth/this.containerHeight-1,this.sendToListsteners()},i.prototype.checkScaling=function(){var e=window.devicePixelRatio,t=Math.min(this.maxScaling,e);(this.renderWidth/t>800||this.renderHeight/t>800)&&(t=1),t!=this.renderScale&&(this.renderScale=t,this._engine.setHardwareScalingLevel(1/this.renderScale))},i.prototype.setFieldOfView=function(e){if(this.fieldOfView=e,this._scene.activeCameras.length)for(var t=0;t<this._scene.activeCameras.length;t++){this._scene.activeCameras[t].fov=e}else this._scene.activeCamera.fov=e},i.prototype.sendToListsteners=function(){for(var e=0;e<this._listeners.length;e++)this._listeners[e](this.containerRatio,this.containerWidth,this.containerHeight,this.renderScale)},i.prototype.addListener=function(e){this._listeners.push(e)},i.prototype.removeListener=function(e){(0,t.default)(this._listeners,function(e){})},i}();exports.ResponsiveCatcher=n;
},{"@babylonjs/core/Cameras/camera":"AhwZ","lodash/remove":"aVGK"}],"Jlz2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TouchCatcher=void 0;var t=require("@babylonjs/core/Maths/math"),e=function(){function e(e){this.scrollGap=0,this.scrollHeight=1e3,this.touchStart=t.Vector2.Zero(),this.touchGap=t.Vector2.Zero(),this.listeners=[],this._container=e,this._setTouchEvent()}return e.prototype._setTouchEvent=function(){var e=this;this._container.addEventListener("touchstart",function(t){e.touchStart.x=t.changedTouches[0].clientX,e.touchStart.y=t.changedTouches[0].clientY,0}),this._container.addEventListener("touchend",function(o){e.touchStart=t.Vector2.Zero(),e.touchGap=t.Vector2.Zero(),e.sendToListener(e.touchGap,o)}),this._container.addEventListener("touchmove",function(t){if(e.touchStart){var o=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY;e.touchGap.x=e.touchStart.x-o,e.touchGap.y=e.touchStart.y-n,0,e.sendToListener(e.touchGap,t)}})},e.prototype.addListener=function(t){this.listeners.push(t)},e.prototype.sendToListener=function(t,e){for(var o=0;o<this.listeners.length;o++)this.listeners[o](t,e)},e}();exports.TouchCatcher=e;
},{"@babylonjs/core/Maths/math":"iyC1"}],"2vpL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GradientHelper=exports.FactorGradient=exports.Color3Gradient=exports.ColorGradient=void 0;var r=require("../Maths/math.color"),t=function(){function t(){}return t.prototype.getColorToRef=function(t){this.color2?r.Color4.LerpToRef(this.color1,this.color2,Math.random(),t):t.copyFrom(this.color1)},t}();exports.ColorGradient=t;var o=function(){return function(){}}();exports.Color3Gradient=o;var e=function(){function r(){}return r.prototype.getFactor=function(){return void 0===this.factor2?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()},r}();exports.FactorGradient=e;var n=function(){function r(){}return r.GetCurrentGradient=function(r,t,o){for(var e=0;e<t.length-1;e++){var n=t[e],i=t[e+1];if(r>=n.gradient&&r<=i.gradient)return void o(n,i,(r-n.gradient)/(i.gradient-n.gradient))}var a=t.length-1;o(t[a],t[a],1)},r}();exports.GradientHelper=n;
},{"../Maths/math.color":"q3+m"}],"Znij":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MaterialHelper=void 0;var e=require("../Misc/logger"),r=require("../scene"),n=require("../Engines/engineStore"),t=require("../Meshes/buffer"),a=require("../Lights/light"),i=require("../Maths/math.color"),o=function(){function o(){}return o.BindEyePosition=function(e,r){if(r._forcedViewPosition)e.setVector3("vEyePosition",r._forcedViewPosition);else{var n=r.activeCamera.globalPosition;n||(n=r.activeCamera.devicePosition),e.setVector3("vEyePosition",r._mirroredCameraPosition?r._mirroredCameraPosition:n)}},o.PrepareDefinesForMergedUV=function(e,r,n){r._needUVs=!0,r[n]=!0,e.getTextureMatrix().isIdentityAs3x2()?(r[n+"DIRECTUV"]=e.coordinatesIndex+1,0===e.coordinatesIndex?r.MAINUV1=!0:r.MAINUV2=!0):r[n+"DIRECTUV"]=0},o.BindTextureMatrix=function(e,r,n){var t=e.getTextureMatrix();r.updateMatrix(n+"Matrix",t)},o.GetFogState=function(e,n){return n.fogEnabled&&e.applyFog&&n.fogMode!==r.Scene.FOGMODE_NONE},o.PrepareDefinesForMisc=function(e,r,n,t,a,i,o){o._areMiscDirty&&(o.LOGARITHMICDEPTH=n,o.POINTSIZE=t,o.FOG=a&&this.GetFogState(e,r),o.NONUNIFORMSCALING=e.nonUniformScaling,o.ALPHATEST=i)},o.PrepareDefinesForFrameBoundValues=function(e,r,n,t,a){void 0===a&&(a=null);var i,o,s,l,u,d,S=!1;i=null==a?void 0!==e.clipPlane&&null!==e.clipPlane:a,o=null==a?void 0!==e.clipPlane2&&null!==e.clipPlane2:a,s=null==a?void 0!==e.clipPlane3&&null!==e.clipPlane3:a,l=null==a?void 0!==e.clipPlane4&&null!==e.clipPlane4:a,u=null==a?void 0!==e.clipPlane5&&null!==e.clipPlane5:a,d=null==a?void 0!==e.clipPlane6&&null!==e.clipPlane6:a,n.CLIPPLANE!==i&&(n.CLIPPLANE=i,S=!0),n.CLIPPLANE2!==o&&(n.CLIPPLANE2=o,S=!0),n.CLIPPLANE3!==s&&(n.CLIPPLANE3=s,S=!0),n.CLIPPLANE4!==l&&(n.CLIPPLANE4=l,S=!0),n.CLIPPLANE5!==u&&(n.CLIPPLANE5=u,S=!0),n.CLIPPLANE6!==d&&(n.CLIPPLANE6=d,S=!0),n.DEPTHPREPASS!==!r.getColorWrite()&&(n.DEPTHPREPASS=!n.DEPTHPREPASS,S=!0),n.INSTANCES!==t&&(n.INSTANCES=t,S=!0),S&&n.markAsUnprocessed()},o.PrepareDefinesForBones=function(e,r){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){r.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var n=void 0!==r.BONETEXTURE;e.skeleton.isUsingTextureForMatrices&&n?r.BONETEXTURE=!0:(r.BonesPerMesh=e.skeleton.bones.length+1,r.BONETEXTURE=!n&&void 0)}else r.NUM_BONE_INFLUENCERS=0,r.BonesPerMesh=0},o.PrepareDefinesForMorphTargets=function(e,r){var n=e.morphTargetManager;n?(r.MORPHTARGETS_UV=n.supportsUVs&&r.UV1,r.MORPHTARGETS_TANGENT=n.supportsTangents&&r.TANGENT,r.MORPHTARGETS_NORMAL=n.supportsNormals&&r.NORMAL,r.MORPHTARGETS=n.numInfluencers>0,r.NUM_MORPH_INFLUENCERS=n.numInfluencers):(r.MORPHTARGETS_UV=!1,r.MORPHTARGETS_TANGENT=!1,r.MORPHTARGETS_NORMAL=!1,r.MORPHTARGETS=!1,r.NUM_MORPH_INFLUENCERS=0)},o.PrepareDefinesForAttributes=function(e,r,n,a,i,o){if(void 0===i&&(i=!1),void 0===o&&(o=!0),!r._areAttributesDirty&&r._needNormals===r._normals&&r._needUVs===r._uvs)return!1;if(r._normals=r._needNormals,r._uvs=r._needUVs,r.NORMAL=r._needNormals&&e.isVerticesDataPresent(t.VertexBuffer.NormalKind),r._needNormals&&e.isVerticesDataPresent(t.VertexBuffer.TangentKind)&&(r.TANGENT=!0),r._needUVs?(r.UV1=e.isVerticesDataPresent(t.VertexBuffer.UVKind),r.UV2=e.isVerticesDataPresent(t.VertexBuffer.UV2Kind)):(r.UV1=!1,r.UV2=!1),n){var s=e.useVertexColors&&e.isVerticesDataPresent(t.VertexBuffer.ColorKind);r.VERTEXCOLOR=s,r.VERTEXALPHA=e.hasVertexAlpha&&s&&o}return a&&this.PrepareDefinesForBones(e,r),i&&this.PrepareDefinesForMorphTargets(e,r),!0},o.PrepareDefinesForMultiview=function(e,r){if(e.activeCamera){var n=r.MULTIVIEW;r.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,r.MULTIVIEW!=n&&r.markAsUnprocessed()}},o.PrepareDefinesForLight=function(e,r,n,t,i,o,s){switch(s.needNormals=!0,void 0===i["LIGHT"+t]&&(s.needRebuild=!0),i["LIGHT"+t]=!0,i["SPOTLIGHT"+t]=!1,i["HEMILIGHT"+t]=!1,i["POINTLIGHT"+t]=!1,i["DIRLIGHT"+t]=!1,n.prepareLightSpecificDefines(i,t),i["LIGHT_FALLOFF_PHYSICAL"+t]=!1,i["LIGHT_FALLOFF_GLTF"+t]=!1,i["LIGHT_FALLOFF_STANDARD"+t]=!1,n.falloffType){case a.Light.FALLOFF_GLTF:i["LIGHT_FALLOFF_GLTF"+t]=!0;break;case a.Light.FALLOFF_PHYSICAL:i["LIGHT_FALLOFF_PHYSICAL"+t]=!0;break;case a.Light.FALLOFF_STANDARD:i["LIGHT_FALLOFF_STANDARD"+t]=!0}if(o&&!n.specular.equalsFloats(0,0,0)&&(s.specularEnabled=!0),i["SHADOW"+t]=!1,i["SHADOWCSM"+t]=!1,i["SHADOWCSMDEBUG"+t]=!1,i["SHADOWCSMNUM_CASCADES"+t]=!1,i["SHADOWCSMUSESHADOWMAXZ"+t]=!1,i["SHADOWCSMNOBLEND"+t]=!1,i["SHADOWCSM_RIGHTHANDED"+t]=!1,i["SHADOWPCF"+t]=!1,i["SHADOWPCSS"+t]=!1,i["SHADOWPOISSON"+t]=!1,i["SHADOWESM"+t]=!1,i["SHADOWCUBE"+t]=!1,i["SHADOWLOWQUALITY"+t]=!1,i["SHADOWMEDIUMQUALITY"+t]=!1,r&&r.receiveShadows&&e.shadowsEnabled&&n.shadowEnabled){var l=n.getShadowGenerator();if(l){var u=l.getShadowMap();u&&u.renderList&&u.renderList.length>0&&(s.shadowEnabled=!0,l.prepareDefines(i,t))}}n.lightmapMode!=a.Light.LIGHTMAP_DEFAULT?(s.lightmapMode=!0,i["LIGHTMAPEXCLUDED"+t]=!0,i["LIGHTMAPNOSPECULAR"+t]=n.lightmapMode==a.Light.LIGHTMAP_SHADOWSONLY):(i["LIGHTMAPEXCLUDED"+t]=!1,i["LIGHTMAPNOSPECULAR"+t]=!1)},o.PrepareDefinesForLights=function(e,r,n,t,a,i){if(void 0===a&&(a=4),void 0===i&&(i=!1),!n._areLightsDirty)return n._needNormals;var o=0,s={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!i)for(var l=0,u=r.lightSources;l<u.length;l++){var d=u[l];if(this.PrepareDefinesForLight(e,r,d,o,n,t,s),++o===a)break}n.SPECULARTERM=s.specularEnabled,n.SHADOWS=s.shadowEnabled;for(var S=o;S<a;S++)void 0!==n["LIGHT"+S]&&(n["LIGHT"+S]=!1,n["HEMILIGHT"+S]=!1,n["POINTLIGHT"+S]=!1,n["DIRLIGHT"+S]=!1,n["SPOTLIGHT"+S]=!1,n["SHADOW"+S]=!1,n["SHADOWCSM"+S]=!1,n["SHADOWCSMDEBUG"+S]=!1,n["SHADOWCSMNUM_CASCADES"+S]=!1,n["SHADOWCSMUSESHADOWMAXZ"+S]=!1,n["SHADOWCSMNOBLEND"+S]=!1,n["SHADOWCSM_RIGHTHANDED"+S]=!1,n["SHADOWPCF"+S]=!1,n["SHADOWPCSS"+S]=!1,n["SHADOWPOISSON"+S]=!1,n["SHADOWESM"+S]=!1,n["SHADOWCUBE"+S]=!1,n["SHADOWLOWQUALITY"+S]=!1,n["SHADOWMEDIUMQUALITY"+S]=!1);var p=e.getEngine().getCaps();return void 0===n.SHADOWFLOAT&&(s.needRebuild=!0),n.SHADOWFLOAT=s.shadowEnabled&&(p.textureFloatRender&&p.textureFloatLinearFiltering||p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering),n.LIGHTMAPEXCLUDED=s.lightmapMode,s.needRebuild&&n.rebuild(),s.needNormals},o.PrepareUniformsAndSamplersForLight=function(e,r,n,t,a){void 0===a&&(a=null),r.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),a&&a.push("Light"+e),n.push("shadowSampler"+e),n.push("depthSampler"+e),r.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),t&&(n.push("projectionLightSampler"+e),r.push("textureProjectionMatrix"+e))},o.PrepareUniformsAndSamplersList=function(e,r,n,t){var a;void 0===t&&(t=4);var i=null;if(e.uniformsNames){var o=e;a=o.uniformsNames,i=o.uniformBuffersNames,r=o.samplers,n=o.defines,t=o.maxSimultaneousLights||0}else a=e,r||(r=[]);for(var s=0;s<t&&n["LIGHT"+s];s++)this.PrepareUniformsAndSamplersForLight(s,a,r,n["PROJECTEDLIGHTTEXTURE"+s],i);n.NUM_MORPH_INFLUENCERS&&a.push("morphTargetInfluences")},o.HandleFallbacksForShadows=function(e,r,n,t){void 0===n&&(n=4),void 0===t&&(t=0);for(var a=0,i=0;i<n&&e["LIGHT"+i];i++)i>0&&(a=t+i,r.addFallback(a,"LIGHT"+i)),e.SHADOWS||(e["SHADOW"+i]&&r.addFallback(t,"SHADOW"+i),e["SHADOWPCF"+i]&&r.addFallback(t,"SHADOWPCF"+i),e["SHADOWPCSS"+i]&&r.addFallback(t,"SHADOWPCSS"+i),e["SHADOWPOISSON"+i]&&r.addFallback(t,"SHADOWPOISSON"+i),e["SHADOWESM"+i]&&r.addFallback(t,"SHADOWESM"+i));return a++},o.PrepareAttributesForMorphTargetsInfluencers=function(e,r,n){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=n,this.PrepareAttributesForMorphTargets(e,r,this._TmpMorphInfluencers)},o.PrepareAttributesForMorphTargets=function(r,a,i){var o=i.NUM_MORPH_INFLUENCERS;if(o>0&&n.EngineStore.LastCreatedEngine)for(var s=n.EngineStore.LastCreatedEngine.getCaps().maxVertexAttribs,l=a.morphTargetManager,u=l&&l.supportsNormals&&i.NORMAL,d=l&&l.supportsTangents&&i.TANGENT,S=l&&l.supportsUVs&&i.UV1,p=0;p<o;p++)r.push(t.VertexBuffer.PositionKind+p),u&&r.push(t.VertexBuffer.NormalKind+p),d&&r.push(t.VertexBuffer.TangentKind+p),S&&r.push(t.VertexBuffer.UVKind+"_"+p),r.length>s&&e.Logger.Error("Cannot add more vertex attributes for mesh "+a.name)},o.PrepareAttributesForBones=function(e,r,n,a){n.NUM_BONE_INFLUENCERS>0&&(a.addCPUSkinningFallback(0,r),e.push(t.VertexBuffer.MatricesIndicesKind),e.push(t.VertexBuffer.MatricesWeightsKind),n.NUM_BONE_INFLUENCERS>4&&(e.push(t.VertexBuffer.MatricesIndicesExtraKind),e.push(t.VertexBuffer.MatricesWeightsExtraKind)))},o.PrepareAttributesForInstances=function(e,r){r.INSTANCES&&this.PushAttributesForInstances(e)},o.PushAttributesForInstances=function(e){e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3")},o.BindLightProperties=function(e,r,n){e.transferToEffect(r,n+"")},o.BindLight=function(e,r,n,t,a,i){void 0===i&&(i=!1),e._bindLight(r,n,t,a,i)},o.BindLights=function(e,r,n,t,a,i){void 0===a&&(a=4),void 0===i&&(i=!1);for(var o=Math.min(r.lightSources.length,a),s=0;s<o;s++){var l=r.lightSources[s];this.BindLight(l,s,e,n,"boolean"==typeof t?t:t.SPECULARTERM,i)}},o.BindFogParameters=function(e,n,t,a){void 0===a&&(a=!1),e.fogEnabled&&n.applyFog&&e.fogMode!==r.Scene.FOGMODE_NONE&&(t.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),a?(e.fogColor.toLinearSpaceToRef(this._tempFogColor),t.setColor3("vFogColor",this._tempFogColor)):t.setColor3("vFogColor",e.fogColor))},o.BindBonesParameters=function(e,r){if(r&&e&&(e.computeBonesUsingShaders&&r._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){var n=e.skeleton;if(n.isUsingTextureForMatrices&&r.getUniformIndex("boneTextureWidth")>-1){var t=n.getTransformMatrixTexture(e);r.setTexture("boneSampler",t),r.setFloat("boneTextureWidth",4*(n.bones.length+1))}else{var a=n.getTransformMatrices(e);a&&r.setMatrices("mBones",a)}}},o.BindMorphTargetParameters=function(e,r){var n=e.morphTargetManager;e&&n&&r.setFloatArray("morphTargetInfluences",n.influences)},o.BindLogDepth=function(e,r,n){e.LOGARITHMICDEPTH&&r.setFloat("logarithmicDepthConstant",2/(Math.log(n.activeCamera.maxZ+1)/Math.LN2))},o.BindClipPlane=function(e,r){if(r.clipPlane){var n=r.clipPlane;e.setFloat4("vClipPlane",n.normal.x,n.normal.y,n.normal.z,n.d)}if(r.clipPlane2){n=r.clipPlane2;e.setFloat4("vClipPlane2",n.normal.x,n.normal.y,n.normal.z,n.d)}if(r.clipPlane3){n=r.clipPlane3;e.setFloat4("vClipPlane3",n.normal.x,n.normal.y,n.normal.z,n.d)}if(r.clipPlane4){n=r.clipPlane4;e.setFloat4("vClipPlane4",n.normal.x,n.normal.y,n.normal.z,n.d)}if(r.clipPlane5){n=r.clipPlane5;e.setFloat4("vClipPlane5",n.normal.x,n.normal.y,n.normal.z,n.d)}if(r.clipPlane6){n=r.clipPlane6;e.setFloat4("vClipPlane6",n.normal.x,n.normal.y,n.normal.z,n.d)}},o._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},o._tempFogColor=i.Color3.Black(),o}();exports.MaterialHelper=o;
},{"../Misc/logger":"Yh4i","../scene":"TiFm","../Engines/engineStore":"cq+N","../Meshes/buffer":"clDe","../Lights/light":"S2tp","../Maths/math.color":"q3+m"}],"xWwg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseTexture=void 0;var e=require("tslib"),t=require("../../Misc/decorators"),r=require("../../Misc/observable"),i=require("../../Maths/math.vector"),o=require("../../Engines/engineStore"),n=require("../../Misc/guid"),s=require("../../Maths/math.size");require("../../Misc/fileTools");var u=function(){function u(e){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=0,this.wrapU=1,this.wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=u.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new r.Observable,this._onDisposeObserver=null,this.delayLoadState=0,this._scene=null,this._texture=null,this._uid=null,this._cachedSize=s.Size.Zero(),this._scene=e||o.EngineStore.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}return Object.defineProperty(u.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(17))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(e){this._texture&&(this._texture._isRGBD=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(e){this._texture&&(this._texture._linearSpecularLOD=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(e){this._texture&&(this._texture._irradianceTexture=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"uid",{get:function(){return this._uid||(this._uid=n.GUID.RandomId()),this._uid},enumerable:!0,configurable:!0}),u.prototype.toString=function(){return this.name},u.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(u.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),u.prototype.getScene=function(){return this._scene},u.prototype.getTextureMatrix=function(){return i.Matrix.IdentityReadOnly},u.prototype.getReflectionTextureMatrix=function(){return i.Matrix.IdentityReadOnly},u.prototype.getInternalTexture=function(){return this._texture},u.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},u.prototype.isReady=function(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},u.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},u.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new s.Size(this._texture._size,this._texture._size):new s.Size(this._texture.baseWidth,this._texture.baseHeight):s.Size.Zero()},u.prototype.updateSamplingMode=function(e){if(this._texture){var t=this.getScene();t&&t.getEngine().updateTextureSamplingMode(e,this._texture)}},u.prototype.scale=function(e){},Object.defineProperty(u.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),u.prototype._getFromCache=function(e,t,r,i){if(!this._scene)return null;for(var o=this._scene.getEngine().getLoadedTexturesCache(),n=0;n<o.length;n++){var s=o[n];if(!(void 0!==i&&i!==s.invertY||s.url!==e||s.generateMipMaps!==!t||r&&r!==s.samplingMode))return s.incrementReferences(),s}return null},u.prototype._rebuild=function(){},u.prototype.delayLoad=function(){},u.prototype.clone=function(){return null},Object.defineProperty(u.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:0},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:5},enumerable:!0,configurable:!0}),u.prototype._markAllSubMeshesAsTexturesDirty=function(){var e=this.getScene();e&&e.markAllMaterialsAsDirty(1)},u.prototype.readPixels=function(e,t,r){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=null),!this._texture)return null;var i=this.getSize(),o=i.width,n=i.height,s=this.getScene();if(!s)return null;var u=s.getEngine();return 0!=t&&(o/=Math.pow(2,t),n/=Math.pow(2,t),o=Math.round(o),n=Math.round(n)),this._texture.isCube?u._readTexturePixels(this._texture,o,n,e,t,r):u._readTexturePixels(this._texture,o,n,-1,t,r)},u.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(u.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),u.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this)}void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())},u.prototype.serialize=function(){if(!this.name)return null;var e=t.SerializationHelper.Serialize(this);return t.SerializationHelper.AppendSerializedAnimations(this,e),e},u.WhenAllReady=function(e,t){var r=e.length;if(0!==r)for(var i,o,n=function(){if((i=e[s]).isReady())0==--r&&t();else if(o=i.onLoadObservable){var n=function(){o.removeCallback(n),0==--r&&t()};o.add(n)}},s=0;s<e.length;s++)n();else t()},u.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,e.__decorate)([(0,t.serialize)()],u.prototype,"uniqueId",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"name",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"metadata",void 0),(0,e.__decorate)([(0,t.serialize)("hasAlpha")],u.prototype,"_hasAlpha",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"getAlphaFromRGB",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"level",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"coordinatesIndex",void 0),(0,e.__decorate)([(0,t.serialize)("coordinatesMode")],u.prototype,"_coordinatesMode",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"wrapU",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"wrapV",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"wrapR",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"anisotropicFilteringLevel",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"isCube",null),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"is3D",null),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"is2DArray",null),(0,e.__decorate)([(0,t.serialize)(),(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"gammaSpace",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"invertZ",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"lodLevelInAlpha",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"lodGenerationOffset",null),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"lodGenerationScale",null),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"linearSpecularLOD",null),(0,e.__decorate)([(0,t.serializeAsTexture)()],u.prototype,"irradianceTexture",null),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"isRenderTarget",void 0),u}();exports.BaseTexture=u;
},{"tslib":"90Cu","../../Misc/decorators":"EVXT","../../Misc/observable":"vY1+","../../Maths/math.vector":"61Nx","../../Engines/engineStore":"cq+N","../../Misc/guid":"/kz4","../../Maths/math.size":"j04N","../../Misc/fileTools":"qMSH"}],"tMhK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Texture=void 0;var e=require("tslib"),t=require("../../Misc/decorators"),r=require("../../Misc/observable"),i=require("../../Maths/math.vector"),a=require("../../Materials/Textures/baseTexture"),o=require("../../Misc/typeStore"),n=require("../../Misc/devTools"),s=require("../../Misc/timingTools"),l=require("../../Misc/instantiationTools"),c=require("../../Maths/math.plane"),d=require("../../Misc/stringTools"),_=function(a){function _(e,t,i,o,n,l,c,d,h,u,f){void 0===i&&(i=!1),void 0===o&&(o=!0),void 0===n&&(n=_.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===h&&(h=!1);var p=a.call(this,t&&"Scene"===t.getClassName()?t:null)||this;p.url=null,p.uOffset=0,p.vOffset=0,p.uScale=1,p.vScale=1,p.uAng=0,p.vAng=0,p.wAng=0,p.uRotationCenter=.5,p.vRotationCenter=.5,p.wRotationCenter=.5,p.inspectableCustomProperties=null,p._noMipmap=!1,p._invertY=!1,p._rowGenerationMatrix=null,p._cachedTextureMatrix=null,p._projectionModeMatrix=null,p._t0=null,p._t1=null,p._t2=null,p._cachedUOffset=-1,p._cachedVOffset=-1,p._cachedUScale=0,p._cachedVScale=0,p._cachedUAng=-1,p._cachedVAng=-1,p._cachedWAng=-1,p._cachedProjectionMatrixId=-1,p._cachedCoordinatesMode=-1,p._initialSamplingMode=_.BILINEAR_SAMPLINGMODE,p._buffer=null,p._deleteBuffer=!1,p._format=null,p._delayedOnLoad=null,p._delayedOnError=null,p.onLoadObservable=new r.Observable,p._isBlocking=!0,p.name=e||"",p.url=e,p._noMipmap=i,p._invertY=o,p._initialSamplingMode=n,p._buffer=d,p._deleteBuffer=h,p._mimeType=f,u&&(p._format=u);var M=p.getScene(),x=t&&t.getCaps?t:M?M.getEngine():null;if(!x)return p;x.onBeforeTextureInitObservable.notifyObservers(p);var v=function(){p._texture&&(p._texture._invertVScale&&(p.vScale*=-1,p.vOffset+=1),null!==p._texture._cachedWrapU&&(p.wrapU=p._texture._cachedWrapU,p._texture._cachedWrapU=null),null!==p._texture._cachedWrapV&&(p.wrapV=p._texture._cachedWrapV,p._texture._cachedWrapV=null),null!==p._texture._cachedWrapR&&(p.wrapR=p._texture._cachedWrapR,p._texture._cachedWrapR=null)),p.onLoadObservable.hasObservers()&&p.onLoadObservable.notifyObservers(p),l&&l(),!p.isBlocking&&M&&M.resetCachedMaterial()};return p.url?(p._texture=p._getFromCache(p.url,i,n,o),p._texture?p._texture.isReady?s.TimingTools.SetImmediate(function(){return v()}):p._texture.onLoadedObservable.add(v):M&&M.useDelayedTextureLoading?(p.delayLoadState=4,p._delayedOnLoad=v,p._delayedOnError=c):(p._texture=x.createTexture(p.url,i,o,M,n,v,c,p._buffer,void 0,p._format,null,f),h&&delete p._buffer),p):(p._delayedOnLoad=v,p._delayedOnError=c,p)}return(0,e.__extends)(_,a),Object.defineProperty(_.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),_.prototype.updateURL=function(e,t,r){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!d.StringTools.StartsWith(this.name,"data:")||(this.name=e),this.url=e,this._buffer=t,this.delayLoadState=4,r&&(this._delayedOnLoad=r),this.delayLoad()},_.prototype.delayLoad=function(){if(4===this.delayLoadState){var e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?s.TimingTools.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},_.prototype._prepareRowForTextureGeneration=function(e,t,r,a){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,r-=this.wRotationCenter,i.Vector3.TransformCoordinatesFromFloatsToRef(e,t,r,this._rowGenerationMatrix,a),a.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,a.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,a.z+=this.wRotationCenter},_.prototype.getTextureMatrix=function(e){var t=this;if(void 0===e&&(e=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=i.Matrix.Zero(),this._rowGenerationMatrix=new i.Matrix,this._t0=i.Vector3.Zero(),this._t1=i.Vector3.Zero(),this._t2=i.Vector3.Zero()),i.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),i.Matrix.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var r=this.getScene();return r?(r.markAllMaterialsAsDirty(1,function(e){return e.hasTexture(t)}),this._cachedTextureMatrix):this._cachedTextureMatrix},_.prototype.getReflectionTextureMatrix=function(){var e=this,t=this.getScene();if(!t)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==_.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=i.Matrix.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=i.Matrix.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case _.PLANAR_MODE:i.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case _.PROJECTION_MODE:i.Matrix.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var r=t.getProjectionMatrix();this._cachedProjectionMatrixId=r.updateFlag,r.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:i.Matrix.IdentityToRef(this._cachedTextureMatrix)}return t.markAllMaterialsAsDirty(1,function(t){return-1!==t.getActiveTextures().indexOf(e)}),this._cachedTextureMatrix},_.prototype.clone=function(){var e=this;return t.SerializationHelper.Clone(function(){return new _(e._texture?e._texture.url:null,e.getScene(),e._noMipmap,e._invertY,e.samplingMode,void 0,void 0,e._texture?e._texture._buffer:void 0)},this)},_.prototype.serialize=function(){var e=this.name;_.SerializeBuffers||d.StringTools.StartsWith(this.name,"data:")&&(this.name="");var t=a.prototype.serialize.call(this);return t?(_.SerializeBuffers&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&d.StringTools.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array&&(t.base64String="data:image/png;base64,"+d.StringTools.EncodeArrayBufferToBase64(this._buffer))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,this.name=e,t):null},_.prototype.getClassName=function(){return"Texture"},_.prototype.dispose=function(){a.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},_.Parse=function(e,r,i){if(e.customType){var a=l.InstantiationTools.Instantiate(e.customType).Parse(e,r,i);return e.samplingMode&&a.updateSamplingMode&&a._samplingMode&&a._samplingMode!==e.samplingMode&&a.updateSamplingMode(e.samplingMode),a}if(e.isCube&&!e.isRenderTarget)return _._CubeTextureParser(e,r,i);if(!e.name&&!e.isRenderTarget)return null;var n=t.SerializationHelper.Parse(function(){var t,a=!0;if(e.noMipmap&&(a=!1),e.mirrorPlane){var o=_._CreateMirror(e.name,e.renderTargetSize,r,a);return o._waitingRenderList=e.renderList,o.mirrorPlane=c.Plane.FromArray(e.mirrorPlane),o}if(e.isRenderTarget){var n=null;if(e.isCube){if(r.reflectionProbes)for(var s=0;s<r.reflectionProbes.length;s++){var l=r.reflectionProbes[s];if(l.name===e.name)return l.cubeTexture}}else(n=_._CreateRenderTargetTexture(e.name,e.renderTargetSize,r,a))._waitingRenderList=e.renderList;return n}if(e.base64String)t=_.CreateFromBase64String(e.base64String,e.name,r,!a,e.invertY);else{var d=i+e.name;_.UseSerializedUrlIfAny&&e.url&&(d=e.url),t=new _(d,r,!a,e.invertY)}return t},e,r);if(n&&n._texture&&(n._texture._cachedWrapU=null,n._texture._cachedWrapV=null,n._texture._cachedWrapR=null),e.samplingMode){var s=e.samplingMode;n&&n.samplingMode!==s&&n.updateSamplingMode(s)}if(n&&e.animations)for(var d=0;d<e.animations.length;d++){var h=e.animations[d],u=o._TypeStore.GetClass("BABYLON.Animation");u&&n.animations.push(u.Parse(h))}return n},_.CreateFromBase64String=function(e,t,r,i,a,o,n,s,l){return void 0===o&&(o=_.TRILINEAR_SAMPLINGMODE),void 0===n&&(n=null),void 0===s&&(s=null),void 0===l&&(l=5),new _("data:"+t,r,i,a,o,n,s,e,!1,l)},_.LoadFromDataString=function(e,t,r,i,a,o,n,s,l,c){return void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===o&&(o=!0),void 0===n&&(n=_.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=5),"data:"!==e.substr(0,5)&&(e="data:"+e),new _(e,r,a,o,n,s,l,t,i,c)},_.SerializeBuffers=!0,_._CubeTextureParser=function(e,t,r){throw n._DevTools.WarnImport("CubeTexture")},_._CreateMirror=function(e,t,r,i){throw n._DevTools.WarnImport("MirrorTexture")},_._CreateRenderTargetTexture=function(e,t,r,i){throw n._DevTools.WarnImport("RenderTargetTexture")},_.NEAREST_SAMPLINGMODE=1,_.NEAREST_NEAREST_MIPLINEAR=8,_.BILINEAR_SAMPLINGMODE=2,_.LINEAR_LINEAR_MIPNEAREST=11,_.TRILINEAR_SAMPLINGMODE=3,_.LINEAR_LINEAR_MIPLINEAR=3,_.NEAREST_NEAREST_MIPNEAREST=4,_.NEAREST_LINEAR_MIPNEAREST=5,_.NEAREST_LINEAR_MIPLINEAR=6,_.NEAREST_LINEAR=7,_.NEAREST_NEAREST=1,_.LINEAR_NEAREST_MIPNEAREST=9,_.LINEAR_NEAREST_MIPLINEAR=10,_.LINEAR_LINEAR=2,_.LINEAR_NEAREST=12,_.EXPLICIT_MODE=0,_.SPHERICAL_MODE=1,_.PLANAR_MODE=2,_.CUBIC_MODE=3,_.PROJECTION_MODE=4,_.SKYBOX_MODE=5,_.INVCUBIC_MODE=6,_.EQUIRECTANGULAR_MODE=7,_.FIXED_EQUIRECTANGULAR_MODE=8,_.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,_.CLAMP_ADDRESSMODE=0,_.WRAP_ADDRESSMODE=1,_.MIRROR_ADDRESSMODE=2,_.UseSerializedUrlIfAny=!1,(0,e.__decorate)([(0,t.serialize)()],_.prototype,"url",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"uOffset",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"vOffset",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"uScale",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"vScale",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"uAng",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"vAng",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"wAng",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"uRotationCenter",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"vRotationCenter",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"wRotationCenter",void 0),(0,e.__decorate)([(0,t.serialize)()],_.prototype,"isBlocking",null),_}(a.BaseTexture);exports.Texture=_,t.SerializationHelper._TextureParser=_.Parse;
},{"tslib":"90Cu","../../Misc/decorators":"EVXT","../../Misc/observable":"vY1+","../../Maths/math.vector":"61Nx","../../Materials/Textures/baseTexture":"xWwg","../../Misc/typeStore":"sm8f","../../Misc/devTools":"S9x9","../../Misc/timingTools":"MgSd","../../Misc/instantiationTools":"6kA1","../../Maths/math.plane":"VdRi","../../Misc/stringTools":"VuqN"}],"8ZH4":[function(require,module,exports) {
"use strict";var e=require("../../Engines/thinEngine"),t=require("../../Materials/Textures/internalTexture");e.ThinEngine.prototype.createDynamicTexture=function(i,n,r,s){var a=new t.InternalTexture(this,t.InternalTextureSource.Dynamic);return a.baseWidth=i,a.baseHeight=n,r&&(i=this.needPOTTextures?e.ThinEngine.GetExponentOfTwo(i,this._caps.maxTextureSize):i,n=this.needPOTTextures?e.ThinEngine.GetExponentOfTwo(n,this._caps.maxTextureSize):n),a.width=i,a.height=n,a.isReady=!1,a.generateMipMaps=r,a.samplingMode=s,this.updateTextureSamplingMode(s,a),this._internalTexturesCache.push(a),a},e.ThinEngine.prototype.updateDynamicTexture=function(e,t,i,n,r,s){if(void 0===n&&(n=!1),void 0===s&&(s=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0,s),this._unpackFlipY(i),n&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var a=r?this._getInternalFormat(r):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,a,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),n&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}};
},{"../../Engines/thinEngine":"aDNm","../../Materials/Textures/internalTexture":"afLG"}],"GdtU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DynamicTexture=void 0;var e=require("tslib"),t=require("../../Misc/logger"),i=require("../../Materials/Textures/texture");require("../../Engines/Extensions/engine.dynamicTexture");var r=require("../../Misc/canvasGenerator"),n=function(n){function a(e,t,a,s,h,o){void 0===a&&(a=null),void 0===h&&(h=3),void 0===o&&(o=5);var c=n.call(this,null,a,!s,void 0,h,void 0,void 0,void 0,void 0,o)||this;c.name=e,c._engine=c.getScene().getEngine(),c.wrapU=i.Texture.CLAMP_ADDRESSMODE,c.wrapV=i.Texture.CLAMP_ADDRESSMODE,c._generateMipMaps=s,t.getContext?(c._canvas=t,c._texture=c._engine.createDynamicTexture(t.width,t.height,s,h)):(c._canvas=r.CanvasGenerator.CreateCanvas(1,1),t.width||0===t.width?c._texture=c._engine.createDynamicTexture(t.width,t.height,s,h):c._texture=c._engine.createDynamicTexture(t,t,s,h));var u=c.getSize();return c._canvas.width=u.width,c._canvas.height=u.height,c._context=c._canvas.getContext("2d"),c}return(0,e.__extends)(a,n),a.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(a.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),a.prototype._recreate=function(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)},a.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)},a.prototype.scaleTo=function(e,t){var i=this.getSize();i.width=e,i.height=t,this._recreate(i)},a.prototype.getContext=function(){return this._context},a.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},a.prototype.update=function(e,t){void 0===t&&(t=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0)},a.prototype.drawText=function(e,t,i,r,n,a,s,h){void 0===h&&(h=!0);var o=this.getSize();if(a&&(this._context.fillStyle=a,this._context.fillRect(0,0,o.width,o.height)),this._context.font=r,null==t){var c=this._context.measureText(e);t=(o.width-c.width)/2}if(null==i){var u=parseInt(r.replace(/\D/g,""));i=o.height/2+u/3.65}this._context.fillStyle=n,this._context.fillText(e,t,i),h&&this.update(s)},a.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this.getSize(),i=new a(this.name,t,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i},a.prototype.serialize=function(){var e=this.getScene();e&&!e.isReady()&&t.Logger.Warn("The scene must be ready before serializing the dynamic texture");var i=n.prototype.serialize.call(this);return this._canvas.toDataURL&&(i.base64String=this._canvas.toDataURL()),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i},a.prototype._rebuild=function(){this.update()},a}(i.Texture);exports.DynamicTexture=n;
},{"tslib":"90Cu","../../Misc/logger":"Yh4i","../../Materials/Textures/texture":"tMhK","../../Engines/Extensions/engine.dynamicTexture":"8ZH4","../../Misc/canvasGenerator":"mx8L"}],"Cwgs":[function(require,module,exports) {
"use strict";var e=require("../../Materials/Textures/internalTexture"),t=require("../../Misc/logger"),i=require("../../Misc/tools"),r=require("../engine");function a(t){return function(i,r,a,n,s,_,o,l,T,h){void 0===T&&(T=null),void 0===h&&(h=0);var u=t?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,g=t?e.InternalTextureSource.Raw3D:e.InternalTextureSource.Raw2DArray,E=new e.InternalTexture(this,g);E.baseWidth=r,E.baseHeight=a,E.baseDepth=n,E.width=r,E.height=a,E.depth=n,E.format=s,E.type=h,E.generateMipMaps=_,E.samplingMode=l,t?E.is3D=!0:E.is2DArray=!0,this._doNotHandleContextLost||(E._bufferView=i),t?this.updateRawTexture3D(E,i,s,o,T,h):this.updateRawTexture2DArray(E,i,s,o,T,h),this._bindTextureDirectly(u,E,!0);var p=this._getSamplingParameters(l,_);return this._gl.texParameteri(u,this._gl.TEXTURE_MAG_FILTER,p.mag),this._gl.texParameteri(u,this._gl.TEXTURE_MIN_FILTER,p.min),_&&this._gl.generateMipmap(u),this._bindTextureDirectly(u,null),this._internalTexturesCache.push(E),E}}function n(e){return function(t,i,r,a,n,s){void 0===n&&(n=null),void 0===s&&(s=0);var _=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,o=this._getWebGLTextureType(s),l=this._getInternalFormat(r),T=this._getRGBABufferInternalSizedFormat(s,r);this._bindTextureDirectly(_,t,!0),this._unpackFlipY(void 0===a||!!a),this._doNotHandleContextLost||(t._bufferView=i,t.format=r,t.invertY=a,t._compression=n),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&i?this._gl.compressedTexImage3D(_,0,this.getCaps().s3tc[n],t.width,t.height,t.depth,0,i):this._gl.texImage3D(_,0,T,t.width,t.height,t.depth,0,l,o,i),t.generateMipMaps&&this._gl.generateMipmap(_),this._bindTextureDirectly(_,null),t.isReady=!0}}r.Engine.prototype.updateRawTexture=function(e,t,i,r,a,n){if(void 0===a&&(a=null),void 0===n&&(n=0),e){var s=this._getRGBABufferInternalSizedFormat(n,i),_=this._getInternalFormat(i),o=this._getWebGLTextureType(n);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===r||!!r),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.type=n,e.invertY=r,e._compression=a),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),a&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[a],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,s,e.width,e.height,0,_,o,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}},r.Engine.prototype.createRawTexture=function(t,i,r,a,n,s,_,o,l){void 0===o&&(o=null),void 0===l&&(l=0);var T=new e.InternalTexture(this,e.InternalTextureSource.Raw);T.baseWidth=i,T.baseHeight=r,T.width=i,T.height=r,T.format=a,T.generateMipMaps=n,T.samplingMode=_,T.invertY=s,T._compression=o,T.type=l,this._doNotHandleContextLost||(T._bufferView=t),this.updateRawTexture(T,t,a,s,o,l),this._bindTextureDirectly(this._gl.TEXTURE_2D,T,!0);var h=this._getSamplingParameters(_,n);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,h.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,h.min),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(T),T},r.Engine.prototype.createRawCubeTexture=function(r,a,n,s,_,o,l,T){void 0===T&&(T=null);var h=this._gl,u=new e.InternalTexture(this,e.InternalTextureSource.CubeRaw);u.isCube=!0,u.format=n,u.type=s,this._doNotHandleContextLost||(u._bufferViewArray=r);var g=this._getWebGLTextureType(s),E=this._getInternalFormat(n);E===h.RGB&&(E=h.RGBA),g!==h.FLOAT||this._caps.textureFloatLinearFiltering?g!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?g!==h.FLOAT||this._caps.textureFloatRender?g!==h.HALF_FLOAT||this._caps.colorBufferFloat||(_=!1,t.Logger.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(_=!1,t.Logger.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(_=!1,l=1,t.Logger.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(_=!1,l=1,t.Logger.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var p=a,d=p;u.width=p,u.height=d,!this.needPOTTextures||i.Tools.IsExponentOfTwo(u.width)&&i.Tools.IsExponentOfTwo(u.height)||(_=!1),r&&this.updateRawCubeTexture(u,r,n,s,o,T),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,u,!0),r&&_&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var R=this._getSamplingParameters(l,_);return h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,R.mag),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,R.min),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null),u.generateMipMaps=_,u},r.Engine.prototype.updateRawCubeTexture=function(e,t,r,a,n,s,_){void 0===s&&(s=null),void 0===_&&(_=0),e._bufferViewArray=t,e.format=r,e.type=a,e.invertY=n,e._compression=s;var o=this._gl,l=this._getWebGLTextureType(a),T=this._getInternalFormat(r),h=this._getRGBABufferInternalSizedFormat(a),u=!1;T===o.RGB&&(T=o.RGBA,u=!0),this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===n||!!n),e.width%4!=0&&o.pixelStorei(o.UNPACK_ALIGNMENT,1);for(var g=0;g<6;g++){var E=t[g];s?o.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+g,_,this.getCaps().s3tc[s],e.width,e.height,0,E):(u&&(E=this._convertRGBtoRGBATextureData(E,e.width,e.height,a)),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+g,_,h,e.width,e.height,0,T,l,E))}(!this.needPOTTextures||i.Tools.IsExponentOfTwo(e.width)&&i.Tools.IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===_&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},r.Engine.prototype.createRawCubeTextureFromUrl=function(e,t,i,r,a,n,s,_,o,l,T,h){var u=this;void 0===o&&(o=null),void 0===l&&(l=null),void 0===T&&(T=3),void 0===h&&(h=!1);var g=this._gl,E=this.createRawCubeTexture(null,i,r,a,!n,h,T,null);t._addPendingData(E),E.url=e,this._internalTexturesCache.push(E);return this._loadFile(e,function(e){!function(e){var i=E.width,n=s(e);if(n){if(_){var l=u._getWebGLTextureType(a),T=u._getInternalFormat(r),p=u._getRGBABufferInternalSizedFormat(a),d=!1;T===g.RGB&&(T=g.RGBA,d=!0),u._bindTextureDirectly(g.TEXTURE_CUBE_MAP,E,!0),u._unpackFlipY(!1);for(var R=_(n),x=0;x<R.length;x++)for(var c=i>>x,f=0;f<6;f++){var m=R[x][f];d&&(m=u._convertRGBtoRGBATextureData(m,c,c,a)),g.texImage2D(f,x,p,c,c,0,T,l,m)}u._bindTextureDirectly(g.TEXTURE_CUBE_MAP,null)}else u.updateRawCubeTexture(E,n,r,a,h);E.isReady=!0,t._removePendingData(E),o&&o()}}(e)},void 0,t.offlineProvider,!0,function(e,i){t._removePendingData(E),l&&e&&l(e.status+" "+e.statusText,i)}),E},r.Engine.prototype.createRawTexture2DArray=a(!1),r.Engine.prototype.createRawTexture3D=a(!0),r.Engine.prototype.updateRawTexture2DArray=n(!1),r.Engine.prototype.updateRawTexture3D=n(!0);
},{"../../Materials/Textures/internalTexture":"afLG","../../Misc/logger":"Yh4i","../../Misc/tools":"8xSa","../engine":"L3af"}],"xNGh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RawTexture=void 0;var e=require("tslib"),t=require("./texture");require("../../Engines/Extensions/engine.rawTexture");var r=function(r){function i(e,i,n,u,o,d,v,a,x){void 0===d&&(d=!0),void 0===v&&(v=!1),void 0===a&&(a=3),void 0===x&&(x=0);var s=r.call(this,null,o,!d,v)||this;return s.format=u,s._engine=o.getEngine(),s._texture=o.getEngine().createRawTexture(e,i,n,u,d,v,a,null,x),s.wrapU=t.Texture.CLAMP_ADDRESSMODE,s.wrapV=t.Texture.CLAMP_ADDRESSMODE,s}return(0,e.__extends)(i,r),i.prototype.update=function(e){this._engine.updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},i.CreateLuminanceTexture=function(e,t,r,n,u,o,d){return void 0===u&&(u=!0),void 0===o&&(o=!1),void 0===d&&(d=3),new i(e,t,r,1,n,u,o,d)},i.CreateLuminanceAlphaTexture=function(e,t,r,n,u,o,d){return void 0===u&&(u=!0),void 0===o&&(o=!1),void 0===d&&(d=3),new i(e,t,r,2,n,u,o,d)},i.CreateAlphaTexture=function(e,t,r,n,u,o,d){return void 0===u&&(u=!0),void 0===o&&(o=!1),void 0===d&&(d=3),new i(e,t,r,0,n,u,o,d)},i.CreateRGBTexture=function(e,t,r,n,u,o,d,v){return void 0===u&&(u=!0),void 0===o&&(o=!1),void 0===d&&(d=3),void 0===v&&(v=0),new i(e,t,r,4,n,u,o,d,v)},i.CreateRGBATexture=function(e,t,r,n,u,o,d,v){return void 0===u&&(u=!0),void 0===o&&(o=!1),void 0===d&&(d=3),void 0===v&&(v=0),new i(e,t,r,5,n,u,o,d,v)},i.CreateRTexture=function(e,r,n,u,o,d,v,a){return void 0===o&&(o=!0),void 0===d&&(d=!1),void 0===v&&(v=t.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=1),new i(e,r,n,6,u,o,d,v,a)},i}(t.Texture);exports.RawTexture=r;
},{"tslib":"90Cu","./texture":"tMhK","../../Engines/Extensions/engine.rawTexture":"Cwgs"}],"B5Ud":[function(require,module,exports) {
"use strict";var e=require("tslib"),t=require("../../Materials/Textures/internalTexture"),r=require("../../Misc/logger"),i=require("../../Materials/Textures/renderTargetCreationOptions"),n=require("../thinEngine");n.ThinEngine.prototype.createRenderTargetTexture=function(e,n){var a=new i.RenderTargetCreationOptions;void 0!==n&&"object"==typeof n?(a.generateMipMaps=n.generateMipMaps,a.generateDepthBuffer=!!n.generateDepthBuffer,a.generateStencilBuffer=!!n.generateStencilBuffer,a.type=void 0===n.type?0:n.type,a.samplingMode=void 0===n.samplingMode?3:n.samplingMode,a.format=void 0===n.format?5:n.format):(a.generateMipMaps=n,a.generateDepthBuffer=!0,a.generateStencilBuffer=!1,a.type=0,a.samplingMode=3,a.format=5),(1!==a.type||this._caps.textureFloatLinearFiltering)&&(2!==a.type||this._caps.textureHalfFloatLinearFiltering)||(a.samplingMode=1),1!==a.type||this._caps.textureFloat||(a.type=0,r.Logger.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var s=this._gl,u=new t.InternalTexture(this,t.InternalTextureSource.RenderTarget),p=e.width||e,l=e.height||e,g=e.layers||0,T=this._getSamplingParameters(a.samplingMode,!!a.generateMipMaps),o=0!==g?s.TEXTURE_2D_ARRAY:s.TEXTURE_2D,h=this._getRGBABufferInternalSizedFormat(a.type,a.format),_=this._getInternalFormat(a.format),f=this._getWebGLTextureType(a.type);this._bindTextureDirectly(o,u),0!==g?(u.is2DArray=!0,s.texImage3D(o,0,h,p,l,g,0,_,f,null)):s.texImage2D(o,0,h,p,l,0,_,f,null),s.texParameteri(o,s.TEXTURE_MAG_FILTER,T.mag),s.texParameteri(o,s.TEXTURE_MIN_FILTER,T.min),s.texParameteri(o,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(o,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),a.generateMipMaps&&this._gl.generateMipmap(o),this._bindTextureDirectly(o,null);var E=s.createFramebuffer();return this._bindUnboundFramebuffer(E),u._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!a.generateStencilBuffer,a.generateDepthBuffer,p,l),u.is2DArray||s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,u._webGLTexture,0),this._bindUnboundFramebuffer(null),u._framebuffer=E,u.baseWidth=p,u.baseHeight=l,u.width=p,u.height=l,u.depth=g,u.isReady=!0,u.samples=1,u.generateMipMaps=!!a.generateMipMaps,u.samplingMode=a.samplingMode,u.type=a.type,u.format=a.format,u._generateDepthBuffer=a.generateDepthBuffer,u._generateStencilBuffer=!!a.generateStencilBuffer,this._internalTexturesCache.push(u),u},n.ThinEngine.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var r=e.width||e;return this._createDepthStencilCubeTexture(r,t)}return this._createDepthStencilTexture(e,t)},n.ThinEngine.prototype._createDepthStencilTexture=function(i,n){var a=this._gl,s=i.layers||0,u=0!==s?a.TEXTURE_2D_ARRAY:a.TEXTURE_2D,p=new t.InternalTexture(this,t.InternalTextureSource.Depth);if(!this._caps.depthTextureExtension)return r.Logger.Error("Depth texture is not supported by your browser or hardware."),p;var l=(0,e.__assign)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},n);this._bindTextureDirectly(u,p,!0),this._setupDepthStencilTexture(p,i,l.generateStencil,l.bilinearFiltering,l.comparisonFunction);var g=l.generateStencil?a.UNSIGNED_INT_24_8:a.UNSIGNED_INT,T=l.generateStencil?a.DEPTH_STENCIL:a.DEPTH_COMPONENT,o=T;return this.webGLVersion>1&&(o=l.generateStencil?a.DEPTH24_STENCIL8:a.DEPTH_COMPONENT24),p.is2DArray?a.texImage3D(u,0,o,p.width,p.height,s,0,T,g,null):a.texImage2D(u,0,o,p.width,p.height,0,T,g,null),this._bindTextureDirectly(u,null),p};
},{"tslib":"90Cu","../../Materials/Textures/internalTexture":"afLG","../../Misc/logger":"Yh4i","../../Materials/Textures/renderTargetCreationOptions":"PriA","../thinEngine":"aDNm"}],"SNt/":[function(require,module,exports) {
"use strict";var e=require("tslib"),t=require("../../Materials/Textures/internalTexture"),r=require("../../Misc/logger"),a=require("../thinEngine");a.ThinEngine.prototype.createRenderTargetCubeTexture=function(a,n){var i=(0,e.__assign)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5},n);i.generateStencilBuffer=i.generateDepthBuffer&&i.generateStencilBuffer,(1!==i.type||this._caps.textureFloatLinearFiltering)&&(2!==i.type||this._caps.textureHalfFloatLinearFiltering)||(i.samplingMode=1);var _=this._gl,u=new t.InternalTexture(this,t.InternalTextureSource.RenderTarget);this._bindTextureDirectly(_.TEXTURE_CUBE_MAP,u,!0);var s=this._getSamplingParameters(i.samplingMode,i.generateMipMaps);1!==i.type||this._caps.textureFloat||(i.type=0,r.Logger.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MAG_FILTER,s.mag),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MIN_FILTER,s.min),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE);for(var E=0;E<6;E++)_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+E,0,this._getRGBABufferInternalSizedFormat(i.type,i.format),a,a,0,this._getInternalFormat(i.format),this._getWebGLTextureType(i.type),null);var T=_.createFramebuffer();return this._bindUnboundFramebuffer(T),u._depthStencilBuffer=this._setupFramebufferDepthAttachments(i.generateStencilBuffer,i.generateDepthBuffer,a,a),i.generateMipMaps&&_.generateMipmap(_.TEXTURE_CUBE_MAP),this._bindTextureDirectly(_.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),u._framebuffer=T,u.width=a,u.height=a,u.isReady=!0,u.isCube=!0,u.samples=1,u.generateMipMaps=i.generateMipMaps,u.samplingMode=i.samplingMode,u.type=i.type,u.format=i.format,u._generateDepthBuffer=i.generateDepthBuffer,u._generateStencilBuffer=i.generateStencilBuffer,this._internalTexturesCache.push(u),u};
},{"tslib":"90Cu","../../Materials/Textures/internalTexture":"afLG","../../Misc/logger":"Yh4i","../thinEngine":"aDNm"}],"5ewe":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTargetTexture=void 0;var e=require("tslib"),t=require("../../Misc/observable"),r=require("../../Misc/tools"),i=require("../../Maths/math.vector"),s=require("../../Materials/Textures/texture"),n=require("../../PostProcesses/postProcessManager"),a=require("../../Rendering/renderingManager");require("../../Engines/Extensions/engine.renderTarget"),require("../../Engines/Extensions/engine.renderTargetCube");var o=require("../../Engines/engine"),h=function(h){function d(e,r,n,o,d,u,c,g,p,l,f,b,_){void 0===d&&(d=!0),void 0===u&&(u=0),void 0===c&&(c=!1),void 0===g&&(g=s.Texture.TRILINEAR_SAMPLINGMODE),void 0===p&&(p=!0),void 0===l&&(l=!1),void 0===f&&(f=!1),void 0===b&&(b=5),void 0===_&&(_=!1);var v=h.call(this,null,n,!o)||this;return v.isCube=c,v.renderParticles=!0,v.renderSprites=!1,v.coordinatesMode=s.Texture.PROJECTION_MODE,v.ignoreCameraViewport=!1,v.onBeforeBindObservable=new t.Observable,v.onAfterUnbindObservable=new t.Observable,v.onBeforeRenderObservable=new t.Observable,v.onAfterRenderObservable=new t.Observable,v.onClearObservable=new t.Observable,v.onResizeObservable=new t.Observable,v._currentRefreshId=-1,v._refreshRate=1,v._samples=1,v.boundingBoxPosition=i.Vector3.Zero(),(n=v.getScene())?(v.renderList=new Array,v._engine=n.getEngine(),v.name=e,v.isRenderTarget=!0,v._initialSizeParameter=r,v._processSizeParameter(r),v._resizeObserver=v.getScene().getEngine().onResizeObservable.add(function(){}),v._generateMipMaps=!!o,v._doNotChangeAspectRatio=d,v._renderingManager=new a.RenderingManager(n),v._renderingManager._useSceneAutoClearSetup=!0,f?v:(v._renderTargetOptions={generateMipMaps:o,type:u,format:b,samplingMode:g,generateDepthBuffer:p,generateStencilBuffer:l},g===s.Texture.NEAREST_SAMPLINGMODE&&(v.wrapU=s.Texture.CLAMP_ADDRESSMODE,v.wrapV=s.Texture.CLAMP_ADDRESSMODE),_||(c?(v._texture=n.getEngine().createRenderTargetCubeTexture(v.getRenderSize(),v._renderTargetOptions),v.coordinatesMode=s.Texture.INVCUBIC_MODE,v._textureMatrix=i.Matrix.Identity()):v._texture=n.getEngine().createRenderTargetTexture(v._size,v._renderTargetOptions)),v)):v}return(0,e.__extends)(d,h),Object.defineProperty(d.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),d.prototype._hookArray=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var n=0===e.length,a=r.apply(e,i);return n&&t.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),a};var i=e.splice;e.splice=function(r,s){var n=i.apply(e,[r,s]);return 0===e.length&&t.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),n}},Object.defineProperty(d.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),d.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(d.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"depthStencilTexture",{get:function(){var e;return(null===(e=this.getInternalTexture())||void 0===e?void 0:e._depthStencilTexture)||null},enumerable:!0,configurable:!0}),d.prototype.createDepthStencilTexture=function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=!0),void 0===r&&(r=!1);var i=this.getInternalTexture();if(this.getScene()&&i){var s=this.getScene().getEngine();i._depthStencilTexture=s.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:r,isCube:this.isCube})}},d.prototype._processSizeParameter=function(e){e.ratio?(this._sizeRatio=e.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=e},Object.defineProperty(d.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var t=this.getScene();t&&(this._samples=t.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!0,configurable:!0}),d.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(d.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),d.prototype.addPostProcess=function(e){if(!this._postProcessManager){var t=this.getScene();if(!t)return;this._postProcessManager=new n.PostProcessManager(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},d.prototype.clearPostProcesses=function(e){if(void 0===e&&(e=!1),this._postProcesses){if(e)for(var t=0,r=this._postProcesses;t<r.length;t++){r[t].dispose()}this._postProcesses=[]}},d.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},d.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},d.prototype.getRenderSize=function(){return this.getRenderWidth()},d.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},d.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},d.prototype.getRenderLayers=function(){var e=this._size.layers;return e||0},Object.defineProperty(d.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),d.prototype.scale=function(e){var t=Math.max(1,this.getRenderSize()*e);this.resize(t)},d.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:h.prototype.getReflectionTextureMatrix.call(this)},d.prototype.resize=function(e){var t=this.isCube;this.releaseInternalTexture();var r=this.getScene();r&&(this._processSizeParameter(e),this._texture=t?r.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):r.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},d.prototype.render=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),o=this.getScene()){var r,i=o.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var s=0;s<this._waitingRenderList.length;s++){var n=this._waitingRenderList[s],a=o.getMeshByID(n);a&&this.renderList.push(a)}delete this._waitingRenderList}if(this.renderListPredicate){var o;if(this.renderList?this.renderList.length=0:this.renderList=[],!(o=this.getScene()))return;var h=o.meshes;for(s=0;s<h.length;s++){var d=h[s];this.renderListPredicate(d)&&this.renderList.push(d)}}if(this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(r=this.activeCamera,i.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==o.activeCamera&&o.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(r=o.activeCamera)&&i.setViewport(r.viewport,this.getRenderWidth(),this.getRenderHeight()),this._defaultRenderListPrepared=!1,this.is2DArray)for(var u=0;u<this.getRenderLayers();u++)this.renderToTarget(0,e,t,u,r),o.incrementRenderId(),o.resetCachedMaterial();else if(this.isCube)for(var c=0;c<6;c++)this.renderToTarget(c,e,t,void 0,r),o.incrementRenderId(),o.resetCachedMaterial();else this.renderToTarget(0,e,t,void 0,r);this.onAfterUnbindObservable.notifyObservers(this),o.activeCamera&&((o.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==o.activeCamera)&&o.setTransformMatrix(o.activeCamera.getViewMatrix(),o.activeCamera.getProjectionMatrix(!0)),i.setViewport(o.activeCamera.viewport)),o.resetCachedMaterial()}},d.prototype._bestReflectionRenderTargetDimension=function(e,t){var r=e*t,i=o.Engine.NearestPOT(r+16384/(128+r));return Math.min(o.Engine.FloorPOT(e),i)},d.prototype._prepareRenderingManager=function(e,t,r,i){var s=this.getScene();if(s){this._renderingManager.reset();for(var n=s.getRenderId(),a=0;a<t;a++){var o=e[a];if(o){if(!o.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}o._preActivateForIntermediateRendering(n);var h=void 0;if(h=!(!i||!r)&&0==(o.layerMask&r.layerMask),o.isEnabled()&&o.isVisible&&o.subMeshes&&!h&&o._activate(n,!0)&&o.subMeshes.length){o.isAnInstance?o=o.sourceMesh:o._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,o._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var d=0;d<o.subMeshes.length;d++){var u=o.subMeshes[d];this._renderingManager.dispatch(u,o)}}}}for(var c=0;c<s.particleSystems.length;c++){var g=s.particleSystems[c],p=g.emitter;g.isStarted()&&p&&p.position&&p.isEnabled()&&(e.indexOf(p)>=0&&this._renderingManager.dispatchParticles(g))}}},d.prototype._bindFrameBuffer=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var r=this.getScene();if(r){var i=r.getEngine();this._texture&&i.bindFramebuffer(this._texture,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}},d.prototype.unbindFrameBuffer=function(e,t){var r=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,function(){r.onAfterRenderObservable.notifyObservers(t)})},d.prototype.renderToTarget=function(e,t,i,s,n){void 0===s&&(s=0),void 0===n&&(n=null);var a=this.getScene();if(a){var o=a.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):t&&a.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(e,s),this.is2DArray?this.onBeforeRenderObservable.notifyObservers(s):this.onBeforeRenderObservable.notifyObservers(e);var h=null,d=this.renderList?this.renderList:a.getActiveMeshes().data,u=this.renderList?this.renderList.length:a.getActiveMeshes().length;this.getCustomRenderList&&(h=this.getCustomRenderList(this.is2DArray?s:e,d,u)),h?this._prepareRenderingManager(h,h.length,n,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(d,u,n,!this.renderList),this._defaultRenderListPrepared=!0),h=d),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(o):o.clear(this.clearColor||a.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||a.updateTransformMatrix(!0);for(var c=0,g=a._beforeRenderTargetDrawStage;c<g.length;c++){g[c].action(this)}this._renderingManager.render(this.customRenderFunction,h,this.renderParticles,this.renderSprites);for(var p=0,l=a._afterRenderTargetDrawStage;p<l.length;p++){l[p].action(this)}this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,e,this._postProcesses,this.ignoreCameraViewport):t&&a.postProcessManager._finalizeFrame(!1,this._texture,e),this._doNotChangeAspectRatio||a.updateTransformMatrix(!0),i&&r.Tools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),o),this.isCube&&5!==e?this.onAfterRenderObservable.notifyObservers(e):(this.isCube&&5===e&&o.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(o,e))}}},d.prototype.setRenderingOrder=function(e,t,r,i){void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),this._renderingManager.setRenderingOrder(e,t,r,i)},d.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1},d.prototype.clone=function(){var e=this.getSize(),t=new d(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t},d.prototype.serialize=function(){if(!this.name)return null;var e=h.prototype.serialize.call(this);if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(var t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e},d.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),t=this.getScene();e&&t&&t.getEngine()._releaseFramebufferObjects(e)},d.prototype.dispose=function(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var e=this.getScene();if(e){var t=e.customRenderTargets.indexOf(this);t>=0&&e.customRenderTargets.splice(t,1);for(var r=0,i=e.cameras;r<i.length;r++){var s=i[r];(t=s.customRenderTargets.indexOf(this))>=0&&s.customRenderTargets.splice(t,1)}this.depthStencilTexture&&this.getScene().getEngine()._releaseTexture(this.depthStencilTexture),h.prototype.dispose.call(this)}},d.prototype._rebuild=function(){this.refreshRate===d.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=d.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},d.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},d.prototype.getViewCount=function(){return 1},d.REFRESHRATE_RENDER_ONCE=0,d.REFRESHRATE_RENDER_ONEVERYFRAME=1,d.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,d}(s.Texture);exports.RenderTargetTexture=h,s.Texture._CreateRenderTargetTexture=function(e,t,r,i){return new h(e,t,r,i)};
},{"tslib":"90Cu","../../Misc/observable":"vY1+","../../Misc/tools":"8xSa","../../Maths/math.vector":"61Nx","../../Materials/Textures/texture":"tMhK","../../PostProcesses/postProcessManager":"lx6p","../../Rendering/renderingManager":"G1uW","../../Engines/Extensions/engine.renderTarget":"B5Ud","../../Engines/Extensions/engine.renderTargetCube":"SNt/","../../Engines/engine":"L3af"}],"Mixo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProceduralTextureSceneComponent=void 0;var e=require("../../../Misc/tools"),r=require("../../../sceneComponent"),t=function(){function t(e){this.name=r.SceneComponentConstants.NAME_PROCEDURALTEXTURE,this.scene=e,this.scene.proceduralTextures=new Array}return t.prototype.register=function(){this.scene._beforeClearStage.registerStep(r.SceneComponentConstants.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){},t.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){e.Tools.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var r=0;r<this.scene.proceduralTextures.length;r++){var t=this.scene.proceduralTextures[r];t._shouldRender()&&t.render()}e.Tools.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},t}();exports.ProceduralTextureSceneComponent=t;
},{"../../../Misc/tools":"8xSa","../../../sceneComponent":"7t/x"}],"zrHh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.proceduralVertexShader=void 0;var e=require("../Materials/effect"),r="proceduralVertexShader",o="\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}";e.Effect.ShadersStore[r]=o;var i={name:r,shader:o};exports.proceduralVertexShader=i;
},{"../Materials/effect":"P0sJ"}],"T4KU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProceduralTexture=void 0;var e=require("tslib"),t=require("../../../Misc/decorators"),r=require("../../../Misc/observable"),s=require("../../../Meshes/buffer"),i=require("../../../sceneComponent"),n=require("../../../Materials/material"),o=require("../../../Materials/Textures/texture"),a=require("../../../Materials/Textures/renderTargetTexture"),f=require("./proceduralTextureSceneComponent");require("../../../Engines/Extensions/engine.renderTarget"),require("../../../Engines/Extensions/engine.renderTargetCube"),require("../../../Shaders/procedural.vertex");var h=function(o){function h(e,t,n,a,h,u,_){void 0===h&&(h=null),void 0===u&&(u=!0),void 0===_&&(_=!1);var c=o.call(this,null,a,!u)||this;c.isCube=_,c.isEnabled=!0,c.autoClear=!0,c.onGeneratedObservable=new r.Observable,c._textures={},c._currentRefreshId=-1,c._frameId=-1,c._refreshRate=1,c._vertexBuffers={},c._uniforms=new Array,c._samplers=new Array,c._floats={},c._ints={},c._floatsArrays={},c._colors3={},c._colors4={},c._vectors2={},c._vectors3={},c._matrices={},c._fallbackTextureUsed=!1,c._cachedDefines="",c._contentUpdateId=-1;var l=(a=c.getScene())._getComponent(i.SceneComponentConstants.NAME_PROCEDURALTEXTURE);l||(l=new f.ProceduralTextureSceneComponent(a),a._addComponent(l)),a.proceduralTextures.push(c),c._engine=a.getEngine(),c.name=e,c.isRenderTarget=!0,c._size=t,c._generateMipMaps=u,c.setFragment(n),c._fallbackTexture=h,_?(c._texture=c._engine.createRenderTargetCubeTexture(t,{generateMipMaps:u,generateDepthBuffer:!1,generateStencilBuffer:!1}),c.setFloat("face",0)):c._texture=c._engine.createRenderTargetTexture(t,{generateMipMaps:u,generateDepthBuffer:!1,generateStencilBuffer:!1});var d=[];return d.push(1,1),d.push(-1,1),d.push(-1,-1),d.push(1,-1),c._vertexBuffers[s.VertexBuffer.PositionKind]=new s.VertexBuffer(c._engine,d,s.VertexBuffer.PositionKind,!1,!1,2),c._createIndexBuffer(),c}return(0,e.__extends)(h,o),h.prototype.getEffect=function(){return this._effect},h.prototype.getContent=function(){return this._contentData&&this._frameId===this._contentUpdateId?this._contentData:(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._frameId,this._contentData)},h.prototype._createIndexBuffer=function(){var e=this._engine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},h.prototype._rebuild=function(){var e=this._vertexBuffers[s.VertexBuffer.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===a.RenderTargetTexture.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=a.RenderTargetTexture.REFRESHRATE_RENDER_ONCE)},h.prototype.reset=function(){void 0!==this._effect&&this._effect.dispose()},h.prototype._getDefines=function(){return""},h.prototype.isReady=function(){var e,t=this,r=this._engine;if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var i=this._getDefines();return!(!this._effect||i!==this._cachedDefines||!this._effect.isReady())||(e=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=i,this._effect=r.createEffect(e,[s.VertexBuffer.PositionKind],this._uniforms,this._samplers,i,void 0,void 0,function(){t.releaseInternalTexture(),t._fallbackTexture&&(t._texture=t._fallbackTexture._texture,t._texture&&t._texture.incrementReferences()),t._fallbackTextureUsed=!0}),this._effect.isReady())},h.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},h.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(h.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),h.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},h.prototype.getRenderSize=function(){return this._size},h.prototype.resize=function(e,t){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(e,t),this._size=e,this._generateMipMaps=t)},h.prototype._checkUniform=function(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)},h.prototype.setTexture=function(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this},h.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},h.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},h.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},h.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},h.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},h.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},h.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},h.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},h.prototype.render=function(e){var t=this.getScene();if(t){var r=this._engine;for(var s in r.enableEffect(this._effect),r.setState(!1),this._textures)this._effect.setTexture(s,this._textures[s]);for(s in this._ints)this._effect.setInt(s,this._ints[s]);for(s in this._floats)this._effect.setFloat(s,this._floats[s]);for(s in this._floatsArrays)this._effect.setArray(s,this._floatsArrays[s]);for(s in this._colors3)this._effect.setColor3(s,this._colors3[s]);for(s in this._colors4){var i=this._colors4[s];this._effect.setFloat4(s,i.r,i.g,i.b,i.a)}for(s in this._vectors2)this._effect.setVector2(s,this._vectors2[s]);for(s in this._vectors3)this._effect.setVector3(s,this._vectors3[s]);for(s in this._matrices)this._effect.setMatrix(s,this._matrices[s]);if(this._texture){if(this.isCube)for(var o=0;o<6;o++)r.bindFramebuffer(this._texture,o,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",o),this.autoClear&&r.clear(t.clearColor,!0,!1,!1),r.drawElementsType(n.Material.TriangleFillMode,0,6),5===o&&r.generateMipMapsForCubemap(this._texture);else r.bindFramebuffer(this._texture,0,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&r.clear(t.clearColor,!0,!1,!1),r.drawElementsType(n.Material.TriangleFillMode,0,6);r.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},h.prototype.clone=function(){var e=this.getSize(),t=new h(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t},h.prototype.dispose=function(){var e=this.getScene();if(e){var t=e.proceduralTextures.indexOf(this);t>=0&&e.proceduralTextures.splice(t,1);var r=this._vertexBuffers[s.VertexBuffer.PositionKind];r&&(r.dispose(),this._vertexBuffers[s.VertexBuffer.PositionKind]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),o.prototype.dispose.call(this)}},(0,e.__decorate)([(0,t.serialize)()],h.prototype,"isEnabled",void 0),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"autoClear",void 0),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"_generateMipMaps",void 0),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"_size",void 0),(0,e.__decorate)([(0,t.serialize)()],h.prototype,"refreshRate",null),h}(o.Texture);exports.ProceduralTexture=h;
},{"tslib":"90Cu","../../../Misc/decorators":"EVXT","../../../Misc/observable":"vY1+","../../../Meshes/buffer":"clDe","../../../sceneComponent":"7t/x","../../../Materials/material":"zMir","../../../Materials/Textures/texture":"tMhK","../../../Materials/Textures/renderTargetTexture":"5ewe","./proceduralTextureSceneComponent":"Mixo","../../../Engines/Extensions/engine.renderTarget":"B5Ud","../../../Engines/Extensions/engine.renderTargetCube":"SNt/","../../../Shaders/procedural.vertex":"zrHh"}],"JbAC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BoxParticleEmitter=void 0;var t=require("../../Misc/deepCopier"),i=require("../../Maths/math.vector"),o=require("../../Maths/math.scalar"),r=function(){function r(){this.direction1=new i.Vector3(0,1,0),this.direction2=new i.Vector3(0,1,0),this.minEmitBox=new i.Vector3(-.5,-.5,-.5),this.maxEmitBox=new i.Vector3(.5,.5,.5)}return r.prototype.startDirectionFunction=function(t,r,e,n){var a=o.Scalar.RandomRange(this.direction1.x,this.direction2.x),c=o.Scalar.RandomRange(this.direction1.y,this.direction2.y),s=o.Scalar.RandomRange(this.direction1.z,this.direction2.z);if(n)return r.x=a,r.y=c,void(r.z=s);i.Vector3.TransformNormalFromFloatsToRef(a,c,s,t,r)},r.prototype.startPositionFunction=function(t,r,e,n){var a=o.Scalar.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),c=o.Scalar.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),s=o.Scalar.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);if(n)return r.x=a,r.y=c,void(r.z=s);i.Vector3.TransformCoordinatesFromFloatsToRef(a,c,s,t,r)},r.prototype.clone=function(){var i=new r;return t.DeepCopier.DeepCopy(this,i),i},r.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2),t.setVector3("minEmitBox",this.minEmitBox),t.setVector3("maxEmitBox",this.maxEmitBox)},r.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},r.prototype.getClassName=function(){return"BoxParticleEmitter"},r.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t.minEmitBox=this.minEmitBox.asArray(),t.maxEmitBox=this.maxEmitBox.asArray(),t},r.prototype.parse=function(t){i.Vector3.FromArrayToRef(t.direction1,0,this.direction1),i.Vector3.FromArrayToRef(t.direction2,0,this.direction2),i.Vector3.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),i.Vector3.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)},r}();exports.BoxParticleEmitter=r;
},{"../../Misc/deepCopier":"qvOT","../../Maths/math.vector":"61Nx","../../Maths/math.scalar":"TAUa"}],"hySU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ConeParticleEmitter=void 0;var t=require("../../Misc/deepCopier"),i=require("../../Maths/math.vector"),e=require("../../Maths/math.scalar"),n=function(){function n(t,i,e){void 0===t&&(t=1),void 0===i&&(i=Math.PI),void 0===e&&(e=0),this.directionRandomizer=e,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=i,this.radius=t}return Object.defineProperty(n.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._buildHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._buildHeight()},enumerable:!0,configurable:!0}),n.prototype._buildHeight=function(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1},n.prototype.startDirectionFunction=function(t,n,r,a){if(1===Math.abs(Math.cos(this._angle))){if(a)return n.x=0,n.y=1,void(n.z=0);i.Vector3.TransformNormalFromFloatsToRef(0,1,0,t,n)}else{var o=r.position.subtract(t.getTranslation()).normalize(),s=e.Scalar.RandomRange(0,this.directionRandomizer),h=e.Scalar.RandomRange(0,this.directionRandomizer),d=e.Scalar.RandomRange(0,this.directionRandomizer);if(o.x+=s,o.y+=h,o.z+=d,o.normalize(),a)return void n.copyFrom(o);i.Vector3.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,n)}},n.prototype.startPositionFunction=function(t,n,r,a){var o,s=e.Scalar.RandomRange(0,2*Math.PI);o=this.emitFromSpawnPointOnly?1e-4:1-(o=e.Scalar.RandomRange(0,this.heightRange))*o;var h=this._radius-e.Scalar.RandomRange(0,this._radius*this.radiusRange),d=(h*=o)*Math.sin(s),u=h*Math.cos(s),l=o*this._height;if(a)return n.x=d,n.y=l,void(n.z=u);i.Vector3.TransformCoordinatesFromFloatsToRef(d,l,u,t,n)},n.prototype.clone=function(){var i=new n(this._radius,this._angle,this.directionRandomizer);return t.DeepCopier.DeepCopy(this,i),i},n.prototype.applyToShader=function(t){t.setFloat2("radius",this._radius,this.radiusRange),t.setFloat("coneAngle",this._angle),t.setFloat2("height",this._height,this.heightRange),t.setFloat("directionRandomizer",this.directionRandomizer)},n.prototype.getEffectDefines=function(){var t="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(t+="\n#define CONEEMITTERSPAWNPOINT"),t},n.prototype.getClassName=function(){return"ConeParticleEmitter"},n.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this._radius,t.angle=this._angle,t.directionRandomizer=this.directionRandomizer,t.radiusRange=this.radiusRange,t.heightRange=this.heightRange,t.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,t},n.prototype.parse=function(t){this.radius=t.radius,this.angle=t.angle,this.directionRandomizer=t.directionRandomizer,this.radiusRange=t.radiusRange,this.heightRange=t.heightRange,this.emitFromSpawnPointOnly=t.emitFromSpawnPointOnly},n}();exports.ConeParticleEmitter=n;
},{"../../Misc/deepCopier":"qvOT","../../Maths/math.vector":"61Nx","../../Maths/math.scalar":"TAUa"}],"XvV8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CylinderDirectedParticleEmitter=exports.CylinderParticleEmitter=void 0;var t=require("tslib"),i=require("../../Maths/math.vector"),e=require("../../Maths/math.scalar"),r=require("../../Misc/deepCopier"),o=function(){function t(t,i,e,r){void 0===t&&(t=1),void 0===i&&(i=1),void 0===e&&(e=1),void 0===r&&(r=0),this.radius=t,this.height=i,this.radiusRange=e,this.directionRandomizer=r}return t.prototype.startDirectionFunction=function(t,r,o,n){var a=o.position.subtract(t.getTranslation()).normalize(),s=e.Scalar.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),d=Math.atan2(a.x,a.z);d+=e.Scalar.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,a.y=s,a.x=Math.sin(d),a.z=Math.cos(d),a.normalize(),n?r.copyFrom(a):i.Vector3.TransformNormalFromFloatsToRef(a.x,a.y,a.z,t,r)},t.prototype.startPositionFunction=function(t,r,o,n){var a=e.Scalar.RandomRange(-this.height/2,this.height/2),s=e.Scalar.RandomRange(0,2*Math.PI),d=e.Scalar.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),c=Math.sqrt(d)*this.radius,h=c*Math.cos(s),u=c*Math.sin(s);n?r.copyFromFloats(h,a,u):i.Vector3.TransformCoordinatesFromFloatsToRef(h,a,u,t,r)},t.prototype.clone=function(){var i=new t(this.radius,this.directionRandomizer);return r.DeepCopier.DeepCopy(this,i),i},t.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},t.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},t.prototype.getClassName=function(){return"CylinderParticleEmitter"},t.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.height=this.height,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},t.prototype.parse=function(t){this.radius=t.radius,this.height=t.height,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},t}();exports.CylinderParticleEmitter=o;var n=function(o){function n(t,e,r,n,a){void 0===t&&(t=1),void 0===e&&(e=1),void 0===r&&(r=1),void 0===n&&(n=new i.Vector3(0,1,0)),void 0===a&&(a=new i.Vector3(0,1,0));var s=o.call(this,t,e,r)||this;return s.direction1=n,s.direction2=a,s}return(0,t.__extends)(n,o),n.prototype.startDirectionFunction=function(t,r,o){var n=e.Scalar.RandomRange(this.direction1.x,this.direction2.x),a=e.Scalar.RandomRange(this.direction1.y,this.direction2.y),s=e.Scalar.RandomRange(this.direction1.z,this.direction2.z);i.Vector3.TransformNormalFromFloatsToRef(n,a,s,t,r)},n.prototype.clone=function(){var t=new n(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return r.DeepCopier.DeepCopy(this,t),t},n.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},n.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"},n.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},n.prototype.serialize=function(){var t=o.prototype.serialize.call(this);return t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},n.prototype.parse=function(t){o.prototype.parse.call(this,t),this.direction1.copyFrom(t.direction1),this.direction2.copyFrom(t.direction2)},n}(o);exports.CylinderDirectedParticleEmitter=n;
},{"tslib":"90Cu","../../Maths/math.vector":"61Nx","../../Maths/math.scalar":"TAUa","../../Misc/deepCopier":"qvOT"}],"C9qU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HemisphericParticleEmitter=void 0;var i=require("../../Misc/deepCopier"),t=require("../../Maths/math.vector"),e=require("../../Maths/math.scalar"),r=function(){function r(i,t,e){void 0===i&&(i=1),void 0===t&&(t=1),void 0===e&&(e=0),this.radius=i,this.radiusRange=t,this.directionRandomizer=e}return r.prototype.startDirectionFunction=function(i,r,a,o){var n=a.position.subtract(i.getTranslation()).normalize(),s=e.Scalar.RandomRange(0,this.directionRandomizer),d=e.Scalar.RandomRange(0,this.directionRandomizer),c=e.Scalar.RandomRange(0,this.directionRandomizer);n.x+=s,n.y+=d,n.z+=c,n.normalize(),o?r.copyFrom(n):t.Vector3.TransformNormalFromFloatsToRef(n.x,n.y,n.z,i,r)},r.prototype.startPositionFunction=function(i,r,a,o){var n=this.radius-e.Scalar.RandomRange(0,this.radius*this.radiusRange),s=e.Scalar.RandomRange(0,1),d=e.Scalar.RandomRange(0,2*Math.PI),c=Math.acos(2*s-1),u=n*Math.cos(d)*Math.sin(c),h=n*Math.cos(c),m=n*Math.sin(d)*Math.sin(c);o?r.copyFromFloats(u,Math.abs(h),m):t.Vector3.TransformCoordinatesFromFloatsToRef(u,Math.abs(h),m,i,r)},r.prototype.clone=function(){var t=new r(this.radius,this.directionRandomizer);return i.DeepCopier.DeepCopy(this,t),t},r.prototype.applyToShader=function(i){i.setFloat("radius",this.radius),i.setFloat("radiusRange",this.radiusRange),i.setFloat("directionRandomizer",this.directionRandomizer)},r.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},r.prototype.getClassName=function(){return"HemisphericParticleEmitter"},r.prototype.serialize=function(){var i={};return i.type=this.getClassName(),i.radius=this.radius,i.radiusRange=this.radiusRange,i.directionRandomizer=this.directionRandomizer,i},r.prototype.parse=function(i){this.radius=i.radius,this.radiusRange=i.radiusRange,this.directionRandomizer=i.directionRandomizer},r}();exports.HemisphericParticleEmitter=r;
},{"../../Misc/deepCopier":"qvOT","../../Maths/math.vector":"61Nx","../../Maths/math.scalar":"TAUa"}],"Y/E3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PointParticleEmitter=void 0;var t=require("../../Misc/deepCopier"),e=require("../../Maths/math.vector"),r=require("../../Maths/math.scalar"),o=function(){function o(){this.direction1=new e.Vector3(0,1,0),this.direction2=new e.Vector3(0,1,0)}return o.prototype.startDirectionFunction=function(t,o,i,n){var c=r.Scalar.RandomRange(this.direction1.x,this.direction2.x),a=r.Scalar.RandomRange(this.direction1.y,this.direction2.y),s=r.Scalar.RandomRange(this.direction1.z,this.direction2.z);n?o.copyFromFloats(c,a,s):e.Vector3.TransformNormalFromFloatsToRef(c,a,s,t,o)},o.prototype.startPositionFunction=function(t,r,o,i){i?r.copyFromFloats(0,0,0):e.Vector3.TransformCoordinatesFromFloatsToRef(0,0,0,t,r)},o.prototype.clone=function(){var e=new o;return t.DeepCopier.DeepCopy(this,e),e},o.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},o.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},o.prototype.getClassName=function(){return"PointParticleEmitter"},o.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},o.prototype.parse=function(t){e.Vector3.FromArrayToRef(t.direction1,0,this.direction1),e.Vector3.FromArrayToRef(t.direction2,0,this.direction2)},o}();exports.PointParticleEmitter=o;
},{"../../Misc/deepCopier":"qvOT","../../Maths/math.vector":"61Nx","../../Maths/math.scalar":"TAUa"}],"X2a1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SphereDirectedParticleEmitter=exports.SphereParticleEmitter=void 0;var t=require("tslib"),i=require("../../Maths/math.vector"),e=require("../../Maths/math.scalar"),r=require("../../Misc/deepCopier"),o=function(){function t(t,i,e){void 0===t&&(t=1),void 0===i&&(i=1),void 0===e&&(e=0),this.radius=t,this.radiusRange=i,this.directionRandomizer=e}return t.prototype.startDirectionFunction=function(t,r,o,a){var n=o.position.subtract(t.getTranslation()).normalize(),s=e.Scalar.RandomRange(0,this.directionRandomizer),c=e.Scalar.RandomRange(0,this.directionRandomizer),d=e.Scalar.RandomRange(0,this.directionRandomizer);n.x+=s,n.y+=c,n.z+=d,n.normalize(),a?r.copyFrom(n):i.Vector3.TransformNormalFromFloatsToRef(n.x,n.y,n.z,t,r)},t.prototype.startPositionFunction=function(t,r,o,a){var n=this.radius-e.Scalar.RandomRange(0,this.radius*this.radiusRange),s=e.Scalar.RandomRange(0,1),c=e.Scalar.RandomRange(0,2*Math.PI),d=Math.acos(2*s-1),p=n*Math.cos(c)*Math.sin(d),u=n*Math.cos(d),h=n*Math.sin(c)*Math.sin(d);a?r.copyFromFloats(p,u,h):i.Vector3.TransformCoordinatesFromFloatsToRef(p,u,h,t,r)},t.prototype.clone=function(){var i=new t(this.radius,this.directionRandomizer);return r.DeepCopier.DeepCopy(this,i),i},t.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},t.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},t.prototype.getClassName=function(){return"SphereParticleEmitter"},t.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},t.prototype.parse=function(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},t}();exports.SphereParticleEmitter=o;var a=function(o){function a(t,e,r){void 0===t&&(t=1),void 0===e&&(e=new i.Vector3(0,1,0)),void 0===r&&(r=new i.Vector3(0,1,0));var a=o.call(this,t)||this;return a.direction1=e,a.direction2=r,a}return(0,t.__extends)(a,o),a.prototype.startDirectionFunction=function(t,r,o){var a=e.Scalar.RandomRange(this.direction1.x,this.direction2.x),n=e.Scalar.RandomRange(this.direction1.y,this.direction2.y),s=e.Scalar.RandomRange(this.direction1.z,this.direction2.z);i.Vector3.TransformNormalFromFloatsToRef(a,n,s,t,r)},a.prototype.clone=function(){var t=new a(this.radius,this.direction1,this.direction2);return r.DeepCopier.DeepCopy(this,t),t},a.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},a.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"},a.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},a.prototype.serialize=function(){var t=o.prototype.serialize.call(this);return t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},a.prototype.parse=function(t){o.prototype.parse.call(this,t),this.direction1.copyFrom(t.direction1),this.direction2.copyFrom(t.direction2)},a}(o);exports.SphereDirectedParticleEmitter=a;
},{"tslib":"90Cu","../../Maths/math.vector":"61Nx","../../Maths/math.scalar":"TAUa","../../Misc/deepCopier":"qvOT"}],"6GxD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CustomParticleEmitter=void 0;var t=require("../../Misc/deepCopier"),e=require("../../Maths/math.vector"),o=function(){function o(){this.particlePositionGenerator=function(){},this.particleDestinationGenerator=function(){}}return o.prototype.startDirectionFunction=function(t,o,r,i){var n=e.TmpVectors.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,r,n);var s=e.TmpVectors.Vector3[1];n.subtractToRef(r.position,s),s.scaleToRef(1/r.lifeTime,n)}else n.set(0,0,0);i?o.copyFrom(n):e.Vector3.TransformNormalToRef(n,t,o)},o.prototype.startPositionFunction=function(t,o,r,i){var n=e.TmpVectors.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,r,n):n.set(0,0,0),i?o.copyFrom(n):e.Vector3.TransformCoordinatesToRef(n,t,o)},o.prototype.clone=function(){var e=new o;return t.DeepCopier.DeepCopy(this,e),e},o.prototype.applyToShader=function(t){},o.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"},o.prototype.getClassName=function(){return"CustomParticleEmitter"},o.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t},o.prototype.parse=function(t){},o}();exports.CustomParticleEmitter=o;
},{"../../Misc/deepCopier":"qvOT","../../Maths/math.vector":"61Nx"}],"HTBd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshParticleEmitter=void 0;var t=require("../../Misc/deepCopier"),e=require("../../Maths/math.vector"),r=require("../../Maths/math.scalar"),o=require("../../Meshes/buffer"),i=function(){function i(t){this.mesh=t,this._indices=null,this._positions=null,this._normals=null,this._storedNormal=e.Vector3.Zero(),this.direction1=new e.Vector3(0,1,0),this.direction2=new e.Vector3(0,1,0),this.useMeshNormalsForDirection=!0,t&&(this._indices=t.getIndices(),this._positions=t.getVerticesData(o.VertexBuffer.PositionKind),this._normals=t.getVerticesData(o.VertexBuffer.NormalKind))}return i.prototype.startDirectionFunction=function(t,o,i,s){if(this.useMeshNormalsForDirection&&this._normals)e.Vector3.TransformNormalToRef(this._storedNormal,t,o);else{var n=r.Scalar.RandomRange(this.direction1.x,this.direction2.x),a=r.Scalar.RandomRange(this.direction1.y,this.direction2.y),c=r.Scalar.RandomRange(this.direction1.z,this.direction2.z);s?o.copyFromFloats(n,a,c):e.Vector3.TransformNormalFromFloatsToRef(n,a,c,t,o)}},i.prototype.startPositionFunction=function(t,r,o,i){if(this._indices&&this._positions){var s=3*Math.random()*(this._indices.length/3)|0,n=Math.random(),a=Math.random()*(1-n),c=1-n-a,h=this._indices[s],m=this._indices[s+1],d=this._indices[s+2],l=e.TmpVectors.Vector3[0],p=e.TmpVectors.Vector3[1],u=e.TmpVectors.Vector3[2],y=e.TmpVectors.Vector3[3];e.Vector3.FromArrayToRef(this._positions,3*h,l),e.Vector3.FromArrayToRef(this._positions,3*m,p),e.Vector3.FromArrayToRef(this._positions,3*d,u),y.x=n*l.x+a*p.x+c*u.x,y.y=n*l.y+a*p.y+c*u.y,y.z=n*l.z+a*p.z+c*u.z,i?r.copyFromFloats(y.x,y.y,y.z):e.Vector3.TransformCoordinatesFromFloatsToRef(y.x,y.y,y.z,t,r),this.useMeshNormalsForDirection&&this._normals&&(e.Vector3.FromArrayToRef(this._normals,3*h,l),e.Vector3.FromArrayToRef(this._normals,3*m,p),e.Vector3.FromArrayToRef(this._normals,3*d,u),this._storedNormal.x=n*l.x+a*p.x+c*u.x,this._storedNormal.y=n*l.y+a*p.y+c*u.y,this._storedNormal.z=n*l.z+a*p.z+c*u.z)}},i.prototype.clone=function(){var e=new i(this.mesh);return t.DeepCopier.DeepCopy(this,e),e},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return""},i.prototype.getClassName=function(){return"MeshParticleEmitter"},i.prototype.serialize=function(){var t,e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e.meshId=null===(t=this.mesh)||void 0===t?void 0:t.id,e.useMeshNormalsForDirection=this.useMeshNormalsForDirection,e},i.prototype.parse=function(t,r){e.Vector3.FromArrayToRef(t.direction1,0,this.direction1),e.Vector3.FromArrayToRef(t.direction2,0,this.direction2),t.meshId&&(this.mesh=r.getLastMeshByID(t.meshId)||void 0),this.useMeshNormalsForDirection=t.useMeshNormalsForDirection},i}();exports.MeshParticleEmitter=i;
},{"../../Misc/deepCopier":"qvOT","../../Maths/math.vector":"61Nx","../../Maths/math.scalar":"TAUa","../../Meshes/buffer":"clDe"}],"QlDF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./boxParticleEmitter");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}})});var r=require("./coneParticleEmitter");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return r[e]}})});var t=require("./cylinderParticleEmitter");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})});var n=require("./hemisphericParticleEmitter");Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return n[e]}})});var u=require("./pointParticleEmitter");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return u[e]}})});var o=require("./sphereParticleEmitter");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return o[e]}})});var c=require("./customParticleEmitter");Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return c[e]}})});var i=require("./meshParticleEmitter");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return i[e]}})});
},{"./boxParticleEmitter":"JbAC","./coneParticleEmitter":"hySU","./cylinderParticleEmitter":"XvV8","./hemisphericParticleEmitter":"C9qU","./pointParticleEmitter":"Y/E3","./sphereParticleEmitter":"X2a1","./customParticleEmitter":"6GxD","./meshParticleEmitter":"HTBd"}],"vY/7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseParticleSystem=void 0;var t=require("../Maths/math.vector"),e=require("../Materials/imageProcessingConfiguration"),i=require("../Particles/EmitterTypes/index"),r=require("../Maths/math.color"),n=function(){function n(i){this.animations=[],this.renderingGroupId=0,this.emitter=t.Vector3.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new t.Vector3(10,10,10),this.onAnimationEnd=null,this.blendMode=n.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new t.Vector2(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new t.Vector3(0,0,0),this.gravity=t.Vector3.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new r.Color4(1,1,1,1),this.color2=new r.Color4(1,1,1,1),this.colorDead=new r.Color4(0,0,0,1),this.textureMask=new r.Color4(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new e.ImageProcessingConfigurationDefines,this.id=i,this.name=i}return Object.defineProperty(n.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(t){this._noiseTexture!==t&&(this._noiseTexture=t,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(t){this._isAnimationSheetEnabled!=t&&(this._isAnimationSheetEnabled=t,this._reset())},enumerable:!0,configurable:!0}),n.prototype.getScene=function(){return this._scene},n.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},n.prototype.getDragGradients=function(){return this._dragGradients},n.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},n.prototype.getColorGradients=function(){return this._colorGradients},n.prototype.getSizeGradients=function(){return this._sizeGradients},n.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},n.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},n.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},n.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},n.prototype.getVelocityGradients=function(){return this._velocityGradients},n.prototype.getStartSizeGradients=function(){return this._startSizeGradients},n.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(n.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:t.Vector3.Zero()},set:function(t){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:t.Vector3.Zero()},set:function(t){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:t.Vector3.Zero()},set:function(t){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:t.Vector3.Zero()},set:function(t){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(t){this._isBillboardBased!==t&&(this._isBillboardBased=t,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(t){this._attachImageProcessingConfiguration(t)},enumerable:!0,configurable:!0}),n.prototype._attachImageProcessingConfiguration=function(t){t!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration=t||this._scene.imageProcessingConfiguration)},n.prototype._reset=function(){},n.prototype._removeGradientAndTexture=function(t,e,i){if(!e)return this;for(var r=0,n=0,o=e;n<o.length;n++){if(o[n].gradient===t){e.splice(r,1);break}r++}return i&&i.dispose(),this},n.prototype.createPointEmitter=function(t,e){var r=new i.PointParticleEmitter;return r.direction1=t,r.direction2=e,this.particleEmitterType=r,r},n.prototype.createHemisphericEmitter=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);var r=new i.HemisphericParticleEmitter(t,e);return this.particleEmitterType=r,r},n.prototype.createSphereEmitter=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);var r=new i.SphereParticleEmitter(t,e);return this.particleEmitterType=r,r},n.prototype.createDirectedSphereEmitter=function(e,r,n){void 0===e&&(e=1),void 0===r&&(r=new t.Vector3(0,1,0)),void 0===n&&(n=new t.Vector3(0,1,0));var o=new i.SphereDirectedParticleEmitter(e,r,n);return this.particleEmitterType=o,o},n.prototype.createCylinderEmitter=function(t,e,r,n){void 0===t&&(t=1),void 0===e&&(e=1),void 0===r&&(r=1),void 0===n&&(n=0);var o=new i.CylinderParticleEmitter(t,e,r,n);return this.particleEmitterType=o,o},n.prototype.createDirectedCylinderEmitter=function(e,r,n,o,s){void 0===e&&(e=1),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=new t.Vector3(0,1,0)),void 0===s&&(s=new t.Vector3(0,1,0));var a=new i.CylinderDirectedParticleEmitter(e,r,n,o,s);return this.particleEmitterType=a,a},n.prototype.createConeEmitter=function(t,e){void 0===t&&(t=1),void 0===e&&(e=Math.PI/4);var r=new i.ConeParticleEmitter(t,e);return this.particleEmitterType=r,r},n.prototype.createBoxEmitter=function(t,e,r,n){var o=new i.BoxParticleEmitter;return this.particleEmitterType=o,this.direction1=t,this.direction2=e,this.minEmitBox=r,this.maxEmitBox=n,o},n.BLENDMODE_ONEONE=0,n.BLENDMODE_STANDARD=1,n.BLENDMODE_ADD=2,n.BLENDMODE_MULTIPLY=3,n.BLENDMODE_MULTIPLYADD=4,n}();exports.BaseParticleSystem=n;
},{"../Maths/math.vector":"61Nx","../Materials/imageProcessingConfiguration":"h2+3","../Particles/EmitterTypes/index":"QlDF","../Maths/math.color":"q3+m"}],"ovyB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Particle=void 0;var t=require("../Maths/math.vector"),i=require("../Maths/math.color"),e=require("../Maths/math.scalar"),r=function(){function r(e){this.particleSystem=e,this.position=t.Vector3.Zero(),this.direction=t.Vector3.Zero(),this.color=new i.Color4(0,0,0,0),this.colorStep=new i.Color4(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new t.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new i.Color4(0,0,0,0),this._currentColor2=new i.Color4(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=r._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return r.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},r.prototype.updateCellIndex=function(){var t=this.age,i=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===i?(i=1,t=this._randomCellOffset):t+=this._randomCellOffset);var r=this._initialEndSpriteCellID-this._initialStartSpriteCellID,o=e.Scalar.Clamp(t*i%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+o*r|0},r.prototype._inheritParticleInfoToSubEmitter=function(i){if(i.particleSystem.emitter.position){var e=i.particleSystem.emitter;e.position.copyFrom(this.position),i.inheritDirection&&e.setDirection(this.direction.normalize(),0,Math.PI/2)}else{i.particleSystem.emitter.copyFrom(this.position)}this.direction.scaleToRef(i.inheritedVelocityAmount/2,t.TmpVectors.Vector3[0]),i.particleSystem._inheritedVelocityOffset.copyFrom(t.TmpVectors.Vector3[0])},r.prototype._inheritParticleInfoToSubEmitters=function(){var t=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(function(i){t._inheritParticleInfoToSubEmitter(i)})},r.prototype._reset=function(){this.age=0,this.id=r._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},r.prototype.copyTo=function(t){t.position.copyFrom(this.position),this._initialDirection?t._initialDirection?t._initialDirection.copyFrom(this._initialDirection):t._initialDirection=this._initialDirection.clone():t._initialDirection=null,t.direction.copyFrom(this.direction),this._localPosition&&(t._localPosition?t._localPosition.copyFrom(this._localPosition):t._localPosition=this._localPosition.clone()),t.color.copyFrom(this.color),t.colorStep.copyFrom(this.colorStep),t.lifeTime=this.lifeTime,t.age=this.age,t._randomCellOffset=this._randomCellOffset,t.size=this.size,t.scale.copyFrom(this.scale),t.angle=this.angle,t.angularSpeed=this.angularSpeed,t.particleSystem=this.particleSystem,t.cellIndex=this.cellIndex,t.id=this.id,t._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(t._currentColorGradient=this._currentColorGradient,t._currentColor1.copyFrom(this._currentColor1),t._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(t._currentSizeGradient=this._currentSizeGradient,t._currentSize1=this._currentSize1,t._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(t._currentAngularSpeedGradient=this._currentAngularSpeedGradient,t._currentAngularSpeed1=this._currentAngularSpeed1,t._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(t._currentVelocityGradient=this._currentVelocityGradient,t._currentVelocity1=this._currentVelocity1,t._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(t._currentLimitVelocityGradient=this._currentLimitVelocityGradient,t._currentLimitVelocity1=this._currentLimitVelocity1,t._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(t._currentDragGradient=this._currentDragGradient,t._currentDrag1=this._currentDrag1,t._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(t._initialStartSpriteCellID=this._initialStartSpriteCellID,t._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&t.remapData.copyFrom(this.remapData),this._randomNoiseCoordinates1&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),t._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(t._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),t._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},r._Count=0,r}();exports.Particle=r;
},{"../Maths/math.vector":"61Nx","../Maths/math.color":"q3+m","../Maths/math.scalar":"TAUa"}],"4nO/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneLoaderFlags=void 0;var e=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return e._ForceFullSceneLoadingForIncremental},set:function(n){e._ForceFullSceneLoadingForIncremental=n},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return e._ShowLoadingScreen},set:function(n){e._ShowLoadingScreen=n},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return e._loggingLevel},set:function(n){e._loggingLevel=n},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return e._CleanBoneMatrixWeights},set:function(n){e._CleanBoneMatrixWeights=n},enumerable:!0,configurable:!0}),e._ForceFullSceneLoadingForIncremental=!1,e._ShowLoadingScreen=!0,e._CleanBoneMatrixWeights=!1,e._loggingLevel=0,e}();exports.SceneLoaderFlags=e;
},{}],"fPSQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Geometry=void 0;var e=require("../Maths/math.vector"),t=require("../Maths/math.color"),r=require("../Meshes/mesh.vertexData"),s=require("../Meshes/buffer"),i=require("../Meshes/subMesh"),n=require("../Loading/sceneLoaderFlags"),a=require("../Culling/boundingInfo"),o=require("../Misc/tools"),f=require("../Misc/tags"),u=require("../Maths/math.functions"),d=function(){function d(e,t,r,s,i){void 0===s&&(s=!1),void 0===i&&(i=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=e,this.uniqueId=t.getUniqueId(),this._engine=t.getEngine(),this._meshes=[],this._scene=t,this._vertexBuffers={},this._indices=[],this._updatable=s,r?this.setAllVerticesData(r,s):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),i&&(this.applyToMesh(i),i.computeWorldMatrix(!0))}return Object.defineProperty(d.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),d.CreateGeometryForMesh=function(e){var t=new d(d.RandomId(),e.getScene());return t.applyToMesh(e),t},Object.defineProperty(d.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),d.prototype.getScene=function(){return this._scene},d.prototype.getEngine=function(){return this._engine},d.prototype.isReady=function(){return 1===this.delayLoadState||0===this.delayLoadState},Object.defineProperty(d.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),d.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers){this._vertexBuffers[e]._rebuild()}},d.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},d.prototype.setVerticesData=function(e,t,r,i){void 0===r&&(r=!1);var n=new s.VertexBuffer(this._engine,t,e,r,0===this._meshes.length,i);this.setVerticesBuffer(n)},d.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e])},d.prototype.setVerticesBuffer=function(e,t){void 0===t&&(t=null);var r=e.getKind();if(this._vertexBuffers[r]&&this._vertexBuffers[r].dispose(),this._vertexBuffers[r]=e,r===s.VertexBuffer.PositionKind){var i=e.getData();null!=t?this._totalVertices=t:null!=i&&(this._totalVertices=i.length/(e.byteStride/4)),this._updateExtend(i),this._resetPointsArrayCache();for(var n=this._meshes,o=n.length,f=0;f<o;f++){var u=n[f];u._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(!1),u.computeWorldMatrix(!0)}}this.notifyUpdate(r),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},d.prototype.updateVerticesDataDirectly=function(e,t,r,s){void 0===s&&(s=!1);var i=this.getVertexBuffer(e);i&&(i.updateDirectly(t,r,s),this.notifyUpdate(e))},d.prototype.updateVerticesData=function(e,t,r){void 0===r&&(r=!1);var i=this.getVertexBuffer(e);i&&(i.update(t),e===s.VertexBuffer.PositionKind&&this._updateBoundingInfo(r,t),this.notifyUpdate(e))},d.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var r=0,s=this._meshes;r<s.length;r++){var i=s[r];i._boundingInfo?i._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):i._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var n=0,o=i.subMeshes;n<o.length;n++){o[n].refreshBoundingInfo()}}},d.prototype._bind=function(e,t){if(e){void 0===t&&(t=this._indexBuffer);var r=this.getVertexBuffers();r&&(t==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[e.key]||(this._vertexArrayObjects[e.key]=this._engine.recordVertexArrayObject(r,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key],t)):this._engine.bindBuffers(r,t,e))}},d.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},d.prototype.getVerticesData=function(e,t,r){var i=this.getVertexBuffer(e);if(!i)return null;var n=i.getData();if(!n)return null;var a=i.getSize()*s.VertexBuffer.GetTypeByteLength(i.type),f=this._totalVertices*i.getSize();if(i.type!==s.VertexBuffer.FLOAT||i.byteStride!==a){var u=[];return i.forEach(f,function(e){return u.push(e)}),u}if(!(n instanceof Array||n instanceof Float32Array)||0!==i.byteOffset||n.length!==f){if(n instanceof Array){var d=i.byteOffset/4;return o.Tools.Slice(n,d,d+f)}if(n instanceof ArrayBuffer)return new Float32Array(n,i.byteOffset,f);d=n.byteOffset+i.byteOffset;if(r||t&&1!==this._meshes.length){var c=new Float32Array(f),h=new Float32Array(n.buffer,d,f);return c.set(h),c}return new Float32Array(n.buffer,d,f)}return r||t&&1!==this._meshes.length?o.Tools.Slice(n):n},d.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},d.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},d.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},d.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},d.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},d.prototype.updateIndices=function(e,t,r){if(void 0===r&&(r=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var s=e.length!==this._indices.length;if(r||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),s)for(var i=0,n=this._meshes;i<n.length;i++){n[i]._createGlobalSubMesh(!0)}}else this.setIndices(e,null,!0)},d.prototype.setIndices=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=r,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,r)),null!=t&&(this._totalVertices=t);for(var s=0,i=this._meshes;s<i.length;s++){i[s]._createGlobalSubMesh(!0)}this.notifyUpdate()},d.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},d.prototype.getIndices=function(e,t){if(!this.isReady())return null;var r=this._indices;if(t||e&&1!==this._meshes.length){for(var s=r.length,i=[],n=0;n<s;n++)i.push(r[n]);return i}return r},d.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},d.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},d.prototype.releaseForMesh=function(e,t){var r=this._meshes,s=r.indexOf(e);-1!==s&&(r.splice(s,1),e._geometry=null,0===r.length&&t&&this.dispose())},d.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var r=this._meshes;e._geometry=this,this._scene.pushGeometry(this),r.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},d.prototype._updateExtend=function(e){void 0===e&&(e=null),e||(e=this.getVerticesData(s.VertexBuffer.PositionKind)),this._extend=(0,u.extractMinAndMax)(e,0,this._totalVertices,this.boundingBias,3)},d.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var r in this._vertexBuffers){1===t&&this._vertexBuffers[r].create();var i=this._vertexBuffers[r].getBuffer();i&&(i.references=t),r===s.VertexBuffer.PositionKind&&(this._extend||this._updateExtend(),e._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(!1),e._updateBoundingInfo())}1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=t),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},d.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,r=this._meshes;t<r.length;t++){r[t]._markSubMeshesAsAttributesDirty()}},d.prototype.load=function(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))},d.prototype._queueLoad=function(e,t){var r=this;this.delayLoadingFile&&(e._addPendingData(this),e._loadFile(this.delayLoadingFile,function(s){if(r._delayLoadingFunction){r._delayLoadingFunction(JSON.parse(s),r),r.delayLoadState=1,r._delayInfo=[],e._removePendingData(r);for(var i=r._meshes,n=i.length,a=0;a<n;a++)r._applyToMesh(i[a]);t&&t()}},void 0,!0))},d.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(null!=e&&e.length>0){for(var t=0;t<e.length;t+=3){var r=e[t+0];e[t+0]=e[t+2],e[t+2]=r}this.setIndices(e)}var i=this.getVerticesData(s.VertexBuffer.PositionKind,!1);if(null!=i&&i.length>0){for(t=0;t<i.length;t+=3)i[t+2]=-i[t+2];this.setVerticesData(s.VertexBuffer.PositionKind,i,!1)}var n=this.getVerticesData(s.VertexBuffer.NormalKind,!1);if(null!=n&&n.length>0){for(t=0;t<n.length;t+=3)n[t+2]=-n[t+2];this.setVerticesData(s.VertexBuffer.NormalKind,n,!1)}},d.prototype._resetPointsArrayCache=function(){this._positions=null},d.prototype._generatePointsArray=function(){if(this._positions)return!0;var t=this.getVerticesData(s.VertexBuffer.PositionKind);if(!t||0===t.length)return!1;this._positions=[];for(var r=0;r<t.length;r+=3)this._positions.push(e.Vector3.FromArray(t,r));return!0},d.prototype.isDisposed=function(){return this._isDisposed},d.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={}}},d.prototype.dispose=function(){var e,t=this._meshes,r=t.length;for(e=0;e<r;e++)this.releaseForMesh(t[e]);for(var s in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[s].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},d.prototype.copy=function(e){var t=new r.VertexData;t.indices=[];var s=this.getIndices();if(s)for(var i=0;i<s.length;i++)t.indices.push(s[i]);var n,o=!1,f=!1;for(n in this._vertexBuffers){var u=this.getVerticesData(n);if(u&&(u instanceof Float32Array?t.set(new Float32Array(u),n):t.set(u.slice(0),n),!f)){var c=this.getVertexBuffer(n);c&&(f=!(o=c.isUpdatable()))}}var h=new d(e,this._scene,t,o);for(n in h.delayLoadState=this.delayLoadState,h.delayLoadingFile=this.delayLoadingFile,h._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)h._delayInfo=h._delayInfo||[],h._delayInfo.push(n);return h._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum),h},d.prototype.serialize=function(){var e={};return e.id=this.id,e.updatable=this._updatable,f.Tags&&f.Tags.HasTags(this)&&(e.tags=f.Tags.GetTags(this)),e},d.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},d.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(s.VertexBuffer.PositionKind)&&(e.positions=this.toNumberArray(this.getVerticesData(s.VertexBuffer.PositionKind)),this.isVertexBufferUpdatable(s.VertexBuffer.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.NormalKind)&&(e.normals=this.toNumberArray(this.getVerticesData(s.VertexBuffer.NormalKind)),this.isVertexBufferUpdatable(s.VertexBuffer.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.TangentKind)&&(e.tangets=this.toNumberArray(this.getVerticesData(s.VertexBuffer.TangentKind)),this.isVertexBufferUpdatable(s.VertexBuffer.TangentKind)&&(e.tangets._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UVKind)&&(e.uvs=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UVKind)),this.isVertexBufferUpdatable(s.VertexBuffer.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV2Kind)&&(e.uv2s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV2Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV3Kind)&&(e.uv3s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV3Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV4Kind)&&(e.uv4s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV4Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV5Kind)&&(e.uv5s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV5Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV6Kind)&&(e.uv6s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV6Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.ColorKind)&&(e.colors=this.toNumberArray(this.getVerticesData(s.VertexBuffer.ColorKind)),this.isVertexBufferUpdatable(s.VertexBuffer.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.MatricesIndicesKind)&&(e.matricesIndices=this.toNumberArray(this.getVerticesData(s.VertexBuffer.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(s.VertexBuffer.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.MatricesWeightsKind)&&(e.matricesWeights=this.toNumberArray(this.getVerticesData(s.VertexBuffer.MatricesWeightsKind)),this.isVertexBufferUpdatable(s.VertexBuffer.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this.toNumberArray(this.getIndices()),e},d.ExtractFromMesh=function(e,t){var r=e._geometry;return r?r.copy(t):null},d.RandomId=function(){return o.Tools.RandomId()},d._ImportGeometry=function(e,r){var n=r.getScene(),a=e.geometryId;if(a){var o=n.getGeometryByID(a);o&&o.applyToMesh(r)}else if(e instanceof ArrayBuffer){var f=r._binaryInfo;if(f.positionsAttrDesc&&f.positionsAttrDesc.count>0){var u=new Float32Array(e,f.positionsAttrDesc.offset,f.positionsAttrDesc.count);r.setVerticesData(s.VertexBuffer.PositionKind,u,!1)}if(f.normalsAttrDesc&&f.normalsAttrDesc.count>0){var c=new Float32Array(e,f.normalsAttrDesc.offset,f.normalsAttrDesc.count);r.setVerticesData(s.VertexBuffer.NormalKind,c,!1)}if(f.tangetsAttrDesc&&f.tangetsAttrDesc.count>0){var h=new Float32Array(e,f.tangetsAttrDesc.offset,f.tangetsAttrDesc.count);r.setVerticesData(s.VertexBuffer.TangentKind,h,!1)}if(f.uvsAttrDesc&&f.uvsAttrDesc.count>0){var l=new Float32Array(e,f.uvsAttrDesc.offset,f.uvsAttrDesc.count);r.setVerticesData(s.VertexBuffer.UVKind,l,!1)}if(f.uvs2AttrDesc&&f.uvs2AttrDesc.count>0){var p=new Float32Array(e,f.uvs2AttrDesc.offset,f.uvs2AttrDesc.count);r.setVerticesData(s.VertexBuffer.UV2Kind,p,!1)}if(f.uvs3AttrDesc&&f.uvs3AttrDesc.count>0){var _=new Float32Array(e,f.uvs3AttrDesc.offset,f.uvs3AttrDesc.count);r.setVerticesData(s.VertexBuffer.UV3Kind,_,!1)}if(f.uvs4AttrDesc&&f.uvs4AttrDesc.count>0){var V=new Float32Array(e,f.uvs4AttrDesc.offset,f.uvs4AttrDesc.count);r.setVerticesData(s.VertexBuffer.UV4Kind,V,!1)}if(f.uvs5AttrDesc&&f.uvs5AttrDesc.count>0){var x=new Float32Array(e,f.uvs5AttrDesc.offset,f.uvs5AttrDesc.count);r.setVerticesData(s.VertexBuffer.UV5Kind,x,!1)}if(f.uvs6AttrDesc&&f.uvs6AttrDesc.count>0){var y=new Float32Array(e,f.uvs6AttrDesc.offset,f.uvs6AttrDesc.count);r.setVerticesData(s.VertexBuffer.UV6Kind,y,!1)}if(f.colorsAttrDesc&&f.colorsAttrDesc.count>0){var g=new Float32Array(e,f.colorsAttrDesc.offset,f.colorsAttrDesc.count);r.setVerticesData(s.VertexBuffer.ColorKind,g,!1,f.colorsAttrDesc.stride)}if(f.matricesIndicesAttrDesc&&f.matricesIndicesAttrDesc.count>0){for(var v=new Int32Array(e,f.matricesIndicesAttrDesc.offset,f.matricesIndicesAttrDesc.count),B=[],m=0;m<v.length;m++){var b=v[m];B.push(255&b),B.push((65280&b)>>8),B.push((16711680&b)>>16),B.push(b>>24)}r.setVerticesData(s.VertexBuffer.MatricesIndicesKind,B,!1)}if(f.matricesWeightsAttrDesc&&f.matricesWeightsAttrDesc.count>0){var D=new Float32Array(e,f.matricesWeightsAttrDesc.offset,f.matricesWeightsAttrDesc.count);r.setVerticesData(s.VertexBuffer.MatricesWeightsKind,D,!1)}if(f.indicesAttrDesc&&f.indicesAttrDesc.count>0){var A=new Int32Array(e,f.indicesAttrDesc.offset,f.indicesAttrDesc.count);r.setIndices(A,null)}if(f.subMeshesAttrDesc&&f.subMeshesAttrDesc.count>0){var I=new Int32Array(e,f.subMeshesAttrDesc.offset,5*f.subMeshesAttrDesc.count);r.subMeshes=[];for(m=0;m<f.subMeshesAttrDesc.count;m++){var K=I[5*m+0],M=I[5*m+1],U=I[5*m+2],F=I[5*m+3],O=I[5*m+4];i.SubMesh.AddToMesh(K,M,U,F,O,r)}}}else if(e.positions&&e.normals&&e.indices){if(r.setVerticesData(s.VertexBuffer.PositionKind,e.positions,e.positions._updatable),r.setVerticesData(s.VertexBuffer.NormalKind,e.normals,e.normals._updatable),e.tangents&&r.setVerticesData(s.VertexBuffer.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&r.setVerticesData(s.VertexBuffer.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&r.setVerticesData(s.VertexBuffer.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&r.setVerticesData(s.VertexBuffer.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&r.setVerticesData(s.VertexBuffer.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&r.setVerticesData(s.VertexBuffer.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&r.setVerticesData(s.VertexBuffer.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&r.setVerticesData(s.VertexBuffer.ColorKind,t.Color4.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,r.setVerticesData(s.VertexBuffer.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{for(B=[],m=0;m<e.matricesIndices.length;m++){var S=e.matricesIndices[m];B.push(255&S),B.push((65280&S)>>8),B.push((16711680&S)>>16),B.push(S>>24)}r.setVerticesData(s.VertexBuffer.MatricesIndicesKind,B,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,r.setVerticesData(s.VertexBuffer.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{for(B=[],m=0;m<e.matricesIndicesExtra.length;m++){S=e.matricesIndicesExtra[m];B.push(255&S),B.push((65280&S)>>8),B.push((16711680&S)>>16),B.push(S>>24)}r.setVerticesData(s.VertexBuffer.MatricesIndicesExtraKind,B,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(d._CleanMatricesWeights(e,r),r.setVerticesData(s.VertexBuffer.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&r.setVerticesData(s.VertexBuffer.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),r.setIndices(e.indices,null)}if(e.subMeshes){r.subMeshes=[];for(var P=0;P<e.subMeshes.length;P++){var L=e.subMeshes[P];i.SubMesh.AddToMesh(L.materialIndex,L.verticesStart,L.verticesCount,L.indexStart,L.indexCount,r)}}r._shouldGenerateFlatShading&&(r.convertToFlatShadedMesh(),delete r._shouldGenerateFlatShading),r.computeWorldMatrix(!0),n.onMeshImportedObservable.notifyObservers(r)},d._CleanMatricesWeights=function(e,t){if(n.SceneLoaderFlags.CleanBoneMatrixWeights){var r=0;if(e.skeletonId>-1){var i=t.getScene().getLastSkeletonByID(e.skeletonId);if(i){r=i.bones.length;for(var a=t.getVerticesData(s.VertexBuffer.MatricesIndicesKind),o=t.getVerticesData(s.VertexBuffer.MatricesIndicesExtraKind),f=e.matricesWeights,u=e.matricesWeightsExtra,d=e.numBoneInfluencer,c=f.length,h=0;h<c;h+=4){for(var l=0,p=-1,_=0;_<4;_++){l+=V=f[h+_],V<.001&&p<0&&(p=_)}if(u)for(_=0;_<4;_++){var V;l+=V=u[h+_],V<.001&&p<0&&(p=_+4)}if((p<0||p>d-1)&&(p=d-1),l>.001){var x=1/l;for(_=0;_<4;_++)f[h+_]*=x;if(u)for(_=0;_<4;_++)u[h+_]*=x}else p>=4?(u[h+p-4]=1-l,o[h+p-4]=r):(f[h+p]=1-l,a[h+p]=r)}t.setVerticesData(s.VertexBuffer.MatricesIndicesKind,a),e.matricesWeightsExtra&&t.setVerticesData(s.VertexBuffer.MatricesIndicesExtraKind,o)}}}},d.Parse=function(t,i,n){if(i.getGeometryByID(t.id))return null;var o=new d(t.id,i,void 0,t.updatable);return f.Tags&&f.Tags.AddTagsTo(o,t.tags),t.delayLoadingFile?(o.delayLoadState=4,o.delayLoadingFile=n+t.delayLoadingFile,o._boundingInfo=new a.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum),e.Vector3.FromArray(t.boundingBoxMaximum)),o._delayInfo=[],t.hasUVs&&o._delayInfo.push(s.VertexBuffer.UVKind),t.hasUVs2&&o._delayInfo.push(s.VertexBuffer.UV2Kind),t.hasUVs3&&o._delayInfo.push(s.VertexBuffer.UV3Kind),t.hasUVs4&&o._delayInfo.push(s.VertexBuffer.UV4Kind),t.hasUVs5&&o._delayInfo.push(s.VertexBuffer.UV5Kind),t.hasUVs6&&o._delayInfo.push(s.VertexBuffer.UV6Kind),t.hasColors&&o._delayInfo.push(s.VertexBuffer.ColorKind),t.hasMatricesIndices&&o._delayInfo.push(s.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&o._delayInfo.push(s.VertexBuffer.MatricesWeightsKind),o._delayLoadingFunction=r.VertexData.ImportVertexData):r.VertexData.ImportVertexData(t,o),i.pushGeometry(o,!0),o},d}();exports.Geometry=d;
},{"../Maths/math.vector":"61Nx","../Maths/math.color":"q3+m","../Meshes/mesh.vertexData":"1A0K","../Meshes/buffer":"clDe","../Meshes/subMesh":"xQHL","../Loading/sceneLoaderFlags":"4nO/","../Culling/boundingInfo":"j0r+","../Misc/tools":"8xSa","../Misc/tags":"4qpk","../Maths/math.functions":"WWKm"}],"Huil":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MultiMaterial=void 0;var t=require("tslib"),e=require("../Materials/material"),r=require("../Misc/tags"),s=require("../Misc/typeStore"),a=function(e){function s(t,r){var s=e.call(this,t,r,!0)||this;return r.multiMaterials.push(s),s.subMaterials=new Array,s._storeEffectOnSubMeshes=!0,s}return(0,t.__extends)(s,e),Object.defineProperty(s.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(t){this._subMaterials=t,this._hookArray(t)},enumerable:!0,configurable:!0}),s.prototype.getChildren=function(){return this.subMaterials},s.prototype._hookArray=function(t){var e=this,r=t.push;t.push=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var i=r.apply(t,s);return e._markAllSubMeshesAsTexturesDirty(),i};var s=t.splice;t.splice=function(r,a){var i=s.apply(t,[r,a]);return e._markAllSubMeshesAsTexturesDirty(),i}},s.prototype.getSubMaterial=function(t){return t<0||t>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[t]},s.prototype.getActiveTextures=function(){var t;return(t=e.prototype.getActiveTextures.call(this)).concat.apply(t,this.subMaterials.map(function(t){return t?t.getActiveTextures():[]}))},s.prototype.getClassName=function(){return"MultiMaterial"},s.prototype.isReadyForSubMesh=function(t,e,r){for(var s=0;s<this.subMaterials.length;s++){var a=this.subMaterials[s];if(a){if(a._storeEffectOnSubMeshes){if(!a.isReadyForSubMesh(t,e,r))return!1;continue}if(!a.isReady(t))return!1}}return!0},s.prototype.clone=function(t,e){for(var r=new s(t,this.getScene()),a=0;a<this.subMaterials.length;a++){var i=null,u=this.subMaterials[a];i=e&&u?u.clone(t+"-"+u.name):this.subMaterials[a],r.subMaterials.push(i)}return r},s.prototype.serialize=function(){var t={};t.name=this.name,t.id=this.id,r.Tags&&(t.tags=r.Tags.GetTags(this)),t.materials=[];for(var e=0;e<this.subMaterials.length;e++){var s=this.subMaterials[e];s?t.materials.push(s.id):t.materials.push(null)}return t},s.prototype.dispose=function(t,r,s){var a=this.getScene();if(a){if(s)for(var i=0;i<this.subMaterials.length;i++){var u=this.subMaterials[i];u&&u.dispose(t,r)}(i=a.multiMaterials.indexOf(this))>=0&&a.multiMaterials.splice(i,1),e.prototype.dispose.call(this,t,r)}},s.ParseMultiMaterial=function(t,e){var a=new s(t.name,e);a.id=t.id,r.Tags&&r.Tags.AddTagsTo(a,t.tags);for(var i=0;i<t.materials.length;i++){var u=t.materials[i];u?a.subMaterials.push(e.getLastMaterialByID(u)):a.subMaterials.push(null)}return a},s}(e.Material);exports.MultiMaterial=a,s._TypeStore.RegisteredTypes["BABYLON.MultiMaterial"]=a;
},{"tslib":"90Cu","../Materials/material":"zMir","../Misc/tags":"4qpk","../Misc/typeStore":"sm8f"}],"647t":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshLODLevel=void 0;var e=function(){return function(e,t){this.distance=e,this.mesh=t}}();exports.MeshLODLevel=e;
},{}],"58SX":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mesh=exports._InstancesBatch=exports._CreationDataStorage=void 0;var e=require("tslib"),t=require("../Misc/observable"),r=require("../Misc/tools"),i=require("../Misc/deepCopier"),n=require("../Misc/tags"),a=require("../Maths/math.vector"),s=require("../Maths/math.color"),o=require("../node"),h=require("./buffer"),l=require("./mesh.vertexData"),u=require("./geometry"),f=require("./abstractMesh"),c=require("./subMesh"),d=require("../Culling/boundingInfo"),g=require("../Materials/material"),p=require("../Materials/multiMaterial"),m=require("../Loading/sceneLoaderFlags"),v=require("../Misc/decorators"),y=require("../Misc/logger"),_=require("../Misc/typeStore"),M=require("../Misc/devTools"),b=require("../sceneComponent"),I=require("./meshLODLevel"),D=require("../Misc/canvasGenerator"),x=function(){return function(){}}();exports._CreationDataStorage=x;var B=function(){return function(){this.visibleInstances={},this.batchCache=new V,this.instancesBufferSize=2048}}(),V=function(){return function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array}}();exports._InstancesBatch=V;var S=function(){return function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null}}(),A=function(f){function x(e,t,r,a,s,o){void 0===t&&(t=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=!0);var h=f.call(this,e,t)||this;if(h._internalMeshDataInfo=new S,h.delayLoadState=0,h.instances=new Array,h._creationDataStorage=null,h._geometry=null,h._instanceDataStorage=new B,h._effectiveMaterial=null,h._shouldGenerateFlatShading=!1,h._originalBuilderSideOrientation=x.DEFAULTSIDE,h.overrideMaterialSideOrientation=null,t=h.getScene(),a){if(a._geometry&&a._geometry.applyToMesh(h),i.DeepCopier.DeepCopy(a,h,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable","lightSources","morphTargetManager"],["_poseMatrix"]),h._internalMeshDataInfo._source=a,t.useClonedMeshMap&&(a._internalMeshDataInfo.meshMap||(a._internalMeshDataInfo.meshMap={}),a._internalMeshDataInfo.meshMap[h.uniqueId]=h),h._originalBuilderSideOrientation=a._originalBuilderSideOrientation,h._creationDataStorage=a._creationDataStorage,a._ranges){var l=a._ranges;for(var e in l)l.hasOwnProperty(e)&&l[e]&&h.createAnimationRange(e,l[e].from,l[e].to)}var u;if(a.metadata&&a.metadata.clone?h.metadata=a.metadata.clone():h.metadata=a.metadata,n.Tags&&n.Tags.HasTags(a)&&n.Tags.AddTagsTo(h,n.Tags.GetTags(a,!0)),h.parent=a.parent,h.setPivotMatrix(a.getPivotMatrix()),h.id=e+"."+a.id,h.material=a.material,!s)for(var c=a.getDescendants(!0),d=0;d<c.length;d++){var g=c[d];g.clone&&g.clone(e+"."+g.name,h)}if(a.morphTargetManager&&(h.morphTargetManager=a.morphTargetManager),t.getPhysicsEngine){var p=t.getPhysicsEngine();if(o&&p){var m=p.getImpostorForPhysicsObject(a);m&&(h.physicsImpostor=m.clone(h))}}for(u=0;u<t.particleSystems.length;u++){var v=t.particleSystems[u];v.emitter===a&&v.clone(v.name,h)}h.refreshBoundingInfo(),h.computeWorldMatrix(!0)}return null!==r&&(h.parent=r),h._instanceDataStorage.hardwareInstancedRendering=h.getEngine().getCaps().instancedArrays,h}return(0,e.__extends)(x,f),x._GetDefaultSideOrientation=function(e){return e||x.FRONTSIDE},Object.defineProperty(x.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new t.Observable),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new t.Observable),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new t.Observable),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new t.Observable),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(e){this._internalMeshDataInfo._morphTargetManager!==e&&(this._internalMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(e){this._instanceDataStorage.manualUpdate=e},enumerable:!0,configurable:!0}),x.prototype.instantiateHierarchy=function(e,t,r){void 0===e&&(e=null);var i=!(this.getTotalVertices()>0)||t&&t.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));i&&(i.parent=e||this.parent,i.position=this.position.clone(),i.scaling=this.scaling.clone(),this.rotationQuaternion?i.rotationQuaternion=this.rotationQuaternion.clone():i.rotation=this.rotation.clone(),r&&r(this,i));for(var n=0,a=this.getChildTransformNodes(!0);n<a.length;n++){a[n].instantiateHierarchy(i,t,r)}return i},x.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(x.prototype,"_isMesh",{get:function(){return!0},enumerable:!0,configurable:!0}),x.prototype.toString=function(e){var t=f.prototype.toString.call(this,e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var r=0;r<this.animations.length;r++)t+=", animation[0]: "+this.animations[r].toString(e);if(e)if(this._geometry){var i=this.getIndices(),n=this.getVerticesData(h.VertexBuffer.PositionKind);n&&i&&(t+=", flat shading: "+(n.length/3===i.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t},x.prototype._unBindEffect=function(){f.prototype._unBindEffect.call(this);for(var e=0,t=this.instances;e<t.length;e++){t[e]._unBindEffect()}},Object.defineProperty(x.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!0,configurable:!0}),x.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},x.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},x.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return y.Logger.Warn("You cannot use a mesh as LOD level twice"),this;var r=new I.MeshLODLevel(e,t);return this._internalMeshDataInfo._LODLevels.push(r),t&&(t._masterMesh=this),this._sortLODLevels(),this},x.prototype.getLODLevelAtDistance=function(e){for(var t=this._internalMeshDataInfo,r=0;r<t._LODLevels.length;r++){var i=t._LODLevels[r];if(i.distance===e)return i.mesh}return null},x.prototype.removeLODLevel=function(e){for(var t=this._internalMeshDataInfo,r=0;r<t._LODLevels.length;r++)t._LODLevels[r].mesh===e&&(t._LODLevels.splice(r,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},x.prototype.getLOD=function(e,t){var r,i=this._internalMeshDataInfo;if(!i._LODLevels||0===i._LODLevels.length)return this;t?r=t:r=this.getBoundingInfo().boundingSphere;var n=r.centerWorld.subtract(e.globalPosition).length();if(i._LODLevels[i._LODLevels.length-1].distance>n)return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this;for(var a=0;a<i._LODLevels.length;a++){var s=i._LODLevels[a];if(s.distance<n)return s.mesh&&(s.mesh._preActivate(),s.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(n,this,s.mesh),s.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this},Object.defineProperty(x.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),x.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},x.prototype.getVerticesData=function(e,t,r){return this._geometry?this._geometry.getVerticesData(e,t,r):null},x.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},x.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},x.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},x.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach(function(t){e.push(t)}),e}return this._geometry.getVerticesDataKinds()},x.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},x.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(x.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),x.prototype.isReady=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),2===this.delayLoadState)return!1;if(!f.prototype.isReady.call(this,e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;var r=this.getEngine(),i=this.getScene(),n=t||r.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var a=this.material||i.defaultMaterial;if(a)if(a._storeEffectOnSubMeshes)for(var s=0,o=this.subMeshes;s<o.length;s++){var h=(p=o[s]).getMaterial();if(h)if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(this,p,n))return!1}else if(!h.isReady(this,n))return!1}else if(!a.isReady(this,n))return!1;for(var l=0,u=this.lightSources;l<u.length;l++){var c=u[l].getShadowGenerator();if(c)for(var d=0,g=this.subMeshes;d<g.length;d++){var p=g[d];if(!c.isReady(p,n))return!1}}for(var m=0,v=this._internalMeshDataInfo._LODLevels;m<v.length;m++){var y=v[m];if(y.mesh&&!y.mesh.isReady(n))return!1}return!0},Object.defineProperty(x.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!0,configurable:!0}),x.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},x.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(x.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),x.prototype._preActivate=function(){var e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t?this:(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null,this)},x.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},x.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},x.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),t),this},x.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var r=this.getIndices();if(!r)return null;var i=r.length,n=!1;if(e)n=!0;else for(var a=0,s=this.subMeshes;a<s.length;a++){var o=s[a];if(o.indexStart+o.indexCount>=i){n=!0;break}if(o.verticesStart+o.verticesCount>=t){n=!0;break}}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new c.SubMesh(0,0,t,0,this.getTotalIndices(),this)},x.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),r=t/e|0,i=0;r%3!=0;)r++;this.releaseSubMeshes();for(var n=0;n<e&&!(i>=t);n++)c.SubMesh.CreateFromIndices(0,i,Math.min(r,t-i),this),i+=r;this.synchronizeInstances()}},x.prototype.setVerticesData=function(e,t,r,i){if(void 0===r&&(r=!1),this._geometry)this._geometry.setVerticesData(e,t,r,i);else{var n=new l.VertexData;n.set(t,e);var a=this.getScene();new u.Geometry(u.Geometry.RandomId(),a,n,r,this)}return this},x.prototype.removeVerticesData=function(e){this._geometry&&this._geometry.removeVerticesData(e)},x.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var r=this.getVertexBuffer(e);r&&r.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},x.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=u.Geometry.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},x.prototype.updateVerticesData=function(e,t,r,i){return this._geometry?(i?(this.makeGeometryUnique(),this.updateVerticesData(e,t,r,!1)):this._geometry.updateVerticesData(e,t,r),this):this},x.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var r=this.getVerticesData(h.VertexBuffer.PositionKind);if(!r)return this;if(e(r),this.updateVerticesData(h.VertexBuffer.PositionKind,r,!1,!1),t){var i=this.getIndices(),n=this.getVerticesData(h.VertexBuffer.NormalKind);if(!n)return this;l.VertexData.ComputeNormals(r,i,n),this.updateVerticesData(h.VertexBuffer.NormalKind,n,!1,!1)}return this},x.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var e=this._geometry,t=this._geometry.copy(u.Geometry.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},x.prototype.setIndices=function(e,t,r){if(void 0===t&&(t=null),void 0===r&&(r=!1),this._geometry)this._geometry.setIndices(e,t,r);else{var i=new l.VertexData;i.indices=e;var n=this.getScene();new u.Geometry(u.Geometry.RandomId(),n,i,r,this)}return this},x.prototype.updateIndices=function(e,t,r){return void 0===r&&(r=!1),this._geometry?(this._geometry.updateIndices(e,t,r),this):this},x.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},x.prototype._bind=function(e,t,r){if(!this._geometry)return this;var i,n=this.getScene().getEngine();if(this._unIndexed)i=null;else switch(r){case g.Material.PointFillMode:i=null;break;case g.Material.WireFrameFillMode:i=e._getLinesIndexBuffer(this.getIndices(),n);break;default:case g.Material.TriangleFillMode:i=this._geometry.getIndexBuffer()}return this._geometry._bind(t,i),this},x.prototype._draw=function(e,t,r){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var i=this.getScene().getEngine();return this._unIndexed||t==g.Material.PointFillMode?i.drawArraysType(t,e.verticesStart,e.verticesCount,r):t==g.Material.WireFrameFillMode?i.drawElementsType(t,0,e._linesIndexCount,r):i.drawElementsType(t,e.indexStart,e.indexCount,r),this},x.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},x.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},x.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},x.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},x.prototype._getInstancesRenderList=function(e,t){if(void 0===t&&(t=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var r=this.getScene(),i=r._isInIntermediateRendering(),n=i?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,a=this._instanceDataStorage.batchCache;if(a.mustReturn=!1,a.renderSelf[e]=t||!n&&this.isEnabled()&&this.isVisible,a.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){var s=this._instanceDataStorage.visibleInstances,o=r.getRenderId(),h=i?s.intermediateDefaultRenderId:s.defaultRenderId;a.visibleInstances[e]=s[o],!a.visibleInstances[e]&&h&&(a.visibleInstances[e]=s[h])}return a.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==a.visibleInstances[e]&&void 0!==a.visibleInstances[e],this._instanceDataStorage.previousBatch=a,a},x.prototype._renderWithInstances=function(e,t,r,i,n){var a=r.visibleInstances[e._id];if(!a)return this;for(var s=this._instanceDataStorage,o=s.instancesBufferSize,l=s.instancesBuffer,u=16*(a.length+1)*4;s.instancesBufferSize<u;)s.instancesBufferSize*=2;s.instancesData&&o==s.instancesBufferSize||(s.instancesData=new Float32Array(s.instancesBufferSize/4));var f=0,c=0,d=r.renderSelf[e._id];if(this._instanceDataStorage.manualUpdate)c=(d?1:0)+a.length;else{var g=this._effectiveMesh.getWorldMatrix();if(d&&(g.copyToArray(s.instancesData,f),f+=16,c++),a)for(var p=0;p<a.length;p++){a[p].getWorldMatrix().copyToArray(s.instancesData,f),f+=16,c++}}return l&&o==s.instancesBufferSize?l.updateDirectly(s.instancesData,0,c):(l&&l.dispose(),l=new h.Buffer(n,s.instancesData,!0,16,!1,!0),s.instancesBuffer=l,this.setVerticesBuffer(l.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(l.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(l.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(l.createVertexBuffer("world3",12,4))),this._processInstancedBuffers(a,d),this.getScene()._activeIndices.addCount(e.indexCount*c,!1),this._bind(e,i,t),this._draw(e,t,c),n.unbindInstanceAttributes(),this},x.prototype._processInstancedBuffers=function(e,t){},x.prototype._processRendering=function(e,t,r,i,n,a,s){var o=this.getScene(),h=o.getEngine();if(n)this._renderWithInstances(e,r,i,t,h);else{var l=0;i.renderSelf[e._id]&&(a&&a(!1,this._effectiveMesh.getWorldMatrix(),s),l++,this._draw(e,r,this._instanceDataStorage.overridenInstanceCount));var u=i.visibleInstances[e._id];if(u){var f=u.length;l+=f;for(var c=0;c<f;c++){var d=u[c].getWorldMatrix();a&&a(!0,d,s),this._draw(e,r)}}o._activeIndices.addCount(e.indexCount*l,!1)}return this},x.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),f.prototype._rebuild.call(this)},x.prototype._freeze=function(){if(this.subMeshes){for(var e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},x.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},x.prototype.render=function(e,t,r){var i=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var n=this._getInstancesRenderList(e._id,!!r);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var a,s=i.getEngine(),o=n.hardwareInstancedRendering[e._id],h=this._instanceDataStorage,l=e.getMaterial();if(!l)return this;if(!h.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==l){if(l._storeEffectOnSubMeshes){if(!l.isReadyForSubMesh(this,e,o))return this}else if(!l.isReady(this,o))return this;this._effectiveMaterial=l}t&&s.setAlphaMode(this._effectiveMaterial.alphaMode);for(var u=0,f=i._beforeRenderingMeshStage;u<f.length;u++){f[u].action(this,e,n)}if(!(a=this._effectiveMaterial._storeEffectOnSubMeshes?e.effect:this._effectiveMaterial.getEffect()))return this;var c,d=r||this._effectiveMesh;if(!h.isFrozen&&this._effectiveMaterial.backFaceCulling){var p=d._getWorldMatrixDeterminant();null==(c=this.overrideMaterialSideOrientation)&&(c=this._effectiveMaterial.sideOrientation),p<0&&(c=c===g.Material.ClockWiseSideOrientation?g.Material.CounterClockWiseSideOrientation:g.Material.ClockWiseSideOrientation),h.sideOrientation=c}else c=h.sideOrientation;var m=this._effectiveMaterial._preBind(a,c);this._effectiveMaterial.forceDepthWrite&&s.setDepthWrite(!0);var v=i.forcePointsCloud?g.Material.PointFillMode:i.forceWireframe?g.Material.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),o||this._bind(e,a,v);var y=d.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(y,this,e):this._effectiveMaterial.bind(y,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(s.setState(!0,this._effectiveMaterial.zOffset,!1,!m),this._processRendering(e,a,v,n,o,this._onBeforeDraw,this._effectiveMaterial),s.setState(!0,this._effectiveMaterial.zOffset,!1,m)),this._processRendering(e,a,v,n,o,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var _=0,M=i._afterRenderingMeshStage;_<M.length;_++){M[_].action(this,e,n)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},x.prototype._onBeforeDraw=function(e,t,r){e&&r&&r.bindOnlyWorldMatrix(t)},x.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(h.VertexBuffer.MatricesWeightsKind)&&(this.isVerticesDataPresent(h.VertexBuffer.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},x.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(h.VertexBuffer.MatricesWeightsKind),t=e.length,r=0;r<t;r+=4){var i=e[r]+e[r+1]+e[r+2]+e[r+3];if(0===i)e[r]=1;else{var n=1/i;e[r]*=n,e[r+1]*=n,e[r+2]*=n,e[r+3]*=n}}this.setVerticesData(h.VertexBuffer.MatricesWeightsKind,e)},x.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(h.VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(h.VertexBuffer.MatricesWeightsKind),r=t.length,i=0;i<r;i+=4){var n=t[i]+t[i+1]+t[i+2]+t[i+3];if(0===(n+=e[i]+e[i+1]+e[i+2]+e[i+3]))t[i]=1;else{var a=1/n;t[i]*=a,t[i+1]*=a,t[i+2]*=a,t[i+3]*=a,e[i]*=a,e[i+1]*=a,e[i+2]*=a,e[i+3]*=a}}this.setVerticesData(h.VertexBuffer.MatricesWeightsKind,t),this.setVerticesData(h.VertexBuffer.MatricesWeightsKind,e)},x.prototype.validateSkinning=function(){var e=this.getVerticesData(h.VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(h.VertexBuffer.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var r=t.length,i=0,n=0,a=0,s=0,o=null===e?4:8,l=new Array,u=0;u<=o;u++)l[u]=0;for(u=0;u<r;u+=4){for(var f=t[u],c=f,d=0===c?0:1,g=1;g<o;g++){var p=g<4?t[u+g]:e[u+g-4];p>f&&i++,0!==p&&d++,c+=p,f=p}if(l[d]++,d>a&&(a=d),0===c)n++;else{var m=1/c,v=0;for(g=0;g<o;g++)v+=g<4?Math.abs(t[u+g]-t[u+g]*m):Math.abs(e[u+g-4]-e[u+g-4]*m);v>.001&&s++}}var y=this.skeleton.bones.length,_=this.getVerticesData(h.VertexBuffer.MatricesIndicesKind),M=this.getVerticesData(h.VertexBuffer.MatricesIndicesExtraKind),b=0;for(u=0;u<r;u++)for(g=0;g<o;g++){var I=g<4?_[g]:M[g-4];(I>=y||I<0)&&b++}return{skinned:!0,valid:0===n&&0===s&&0===b,report:"Number of Weights = "+r/4+"\nMaximum influences = "+a+"\nMissing Weights = "+n+"\nNot Sorted = "+i+"\nNot Normalized = "+s+"\nWeightCounts = ["+l+"]\nNumber of bones = "+y+"\nBad Bone Indices = "+b}},x.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this},x.prototype._queueLoad=function(e){var t=this;e._addPendingData(this);var i=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return r.Tools.LoadFile(this.delayLoadingFile,function(r){r instanceof ArrayBuffer?t._delayLoadingFunction(r,t):t._delayLoadingFunction(JSON.parse(r),t),t.instances.forEach(function(e){e.refreshBoundingInfo(),e._syncSubMeshes()}),t.delayLoadState=1,e._removePendingData(t)},function(){},e.offlineProvider,i),this},x.prototype.isInFrustum=function(e){return 2!==this.delayLoadState&&(!!f.prototype.isInFrustum.call(this,e)&&(this._checkDelayState(),!0))},x.prototype.setMaterialByID=function(e){var t,r=this.getScene().materials;for(t=r.length-1;t>-1;t--)if(r[t].id===e)return this.material=r[t],this;var i=this.getScene().multiMaterials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;return this},x.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},x.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(h.VertexBuffer.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var r,i=this.getVerticesData(h.VertexBuffer.PositionKind),n=new Array;for(r=0;r<i.length;r+=3)a.Vector3.TransformCoordinates(a.Vector3.FromArray(i,r),e).toArray(n,r);if(this.setVerticesData(h.VertexBuffer.PositionKind,n,this.getVertexBuffer(h.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(h.VertexBuffer.NormalKind)){for(i=this.getVerticesData(h.VertexBuffer.NormalKind),n=[],r=0;r<i.length;r+=3)a.Vector3.TransformNormal(a.Vector3.FromArray(i,r),e).normalize().toArray(n,r);this.setVerticesData(h.VertexBuffer.NormalKind,n,this.getVertexBuffer(h.VertexBuffer.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},x.prototype.bakeCurrentTransformIntoVertices=function(e){return void 0===e&&(e=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this},Object.defineProperty(x.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),x.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},x.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},x.prototype.clone=function(e,t,r,i){return void 0===e&&(e=""),void 0===t&&(t=null),void 0===i&&(i=!0),new x(e,this.getScene(),t,this,r,i)},x.prototype.dispose=function(e,t){void 0===t&&(t=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var r=this._internalMeshDataInfo;if(r._onBeforeDrawObservable&&r._onBeforeDrawObservable.clear(),r._onBeforeBindObservable&&r._onBeforeBindObservable.clear(),r._onBeforeRenderObservable&&r._onBeforeRenderObservable.clear(),r._onAfterRenderObservable&&r._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(r.meshMap)for(var i in r.meshMap){(s=r.meshMap[i])&&(s._internalMeshDataInfo._source=null,r.meshMap[i]=void 0)}r._source&&r._source._internalMeshDataInfo.meshMap&&(r._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var n=0,a=this.getScene().meshes;n<a.length;n++){var s;(s=a[n])._internalMeshDataInfo&&s._internalMeshDataInfo._source&&s._internalMeshDataInfo._source===this&&(s._internalMeshDataInfo._source=null)}r._source=null,this._disposeInstanceSpecificData(),f.prototype.dispose.call(this,e,t)},x.prototype._disposeInstanceSpecificData=function(){},x.prototype.applyDisplacementMap=function(e,t,i,n,a,s,o){var h=this;void 0===o&&(o=!1);var l=this.getScene();return r.Tools.LoadImage(e,function(e){var r=e.width,l=e.height,u=D.CanvasGenerator.CreateCanvas(r,l).getContext("2d");u.drawImage(e,0,0);var f=u.getImageData(0,0,r,l).data;h.applyDisplacementMapFromBuffer(f,r,l,t,i,a,s,o),n&&n(h)},function(){},l.offlineProvider),this},x.prototype.applyDisplacementMapFromBuffer=function(e,t,r,i,n,s,o,u){if(void 0===u&&(u=!1),!this.isVerticesDataPresent(h.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(h.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(h.VertexBuffer.UVKind))return y.Logger.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var f=this.getVerticesData(h.VertexBuffer.PositionKind,!0,!0),c=this.getVerticesData(h.VertexBuffer.NormalKind),d=this.getVerticesData(h.VertexBuffer.UVKind),g=a.Vector3.Zero(),p=a.Vector3.Zero(),m=a.Vector2.Zero();s=s||a.Vector2.Zero(),o=o||new a.Vector2(1,1);for(var v=0;v<f.length;v+=3){a.Vector3.FromArrayToRef(f,v,g),a.Vector3.FromArrayToRef(c,v,p),a.Vector2.FromArrayToRef(d,v/3*2,m);var _=4*((Math.abs(m.x*o.x+s.x)*t%t|0)+(Math.abs(m.y*o.y+s.y)*r%r|0)*t),M=.3*(e[_]/255)+.59*(e[_+1]/255)+.11*(e[_+2]/255);p.normalize(),p.scaleInPlace(i+(n-i)*M),(g=g.add(p)).toArray(f,v)}return l.VertexData.ComputeNormals(f,this.getIndices(),c),u?(this.setVerticesData(h.VertexBuffer.PositionKind,f),this.setVerticesData(h.VertexBuffer.NormalKind,c)):(this.updateVerticesData(h.VertexBuffer.PositionKind,f),this.updateVerticesData(h.VertexBuffer.NormalKind,c)),this},x.prototype.convertToFlatShadedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},n={},s={},o=!1;for(e=0;e<r.length;e++){t=r[e];var l=this.getVertexBuffer(t);t!==h.VertexBuffer.NormalKind?(i[t]=l,n[t]=i[t].getData(),s[t]=[]):(o=l.isUpdatable(),r.splice(e,1),e--)}var u,f=this.subMeshes.slice(0),d=this.getIndices(),g=this.getTotalIndices();for(u=0;u<g;u++){var p=d[u];for(e=0;e<r.length;e++)for(var m=i[t=r[e]].getStrideSize(),v=0;v<m;v++)s[t].push(n[t][p*m+v])}var y=[],_=s[h.VertexBuffer.PositionKind];for(u=0;u<g;u+=3){d[u]=u,d[u+1]=u+1,d[u+2]=u+2;for(var M=a.Vector3.FromArray(_,3*u),b=a.Vector3.FromArray(_,3*(u+1)),I=a.Vector3.FromArray(_,3*(u+2)),D=M.subtract(b),x=I.subtract(b),B=a.Vector3.Normalize(a.Vector3.Cross(D,x)),V=0;V<3;V++)y.push(B.x),y.push(B.y),y.push(B.z)}for(this.setIndices(d),this.setVerticesData(h.VertexBuffer.NormalKind,y,o),e=0;e<r.length;e++)t=r[e],this.setVerticesData(t,s[t],i[t].isUpdatable());this.releaseSubMeshes();for(var S=0;S<f.length;S++){var A=f[S];c.SubMesh.AddToMesh(A.materialIndex,A.indexStart,A.indexCount,A.indexStart,A.indexCount,this)}return this.synchronizeInstances(),this},x.prototype.convertToUnIndexedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},n={},a={};for(e=0;e<r.length;e++){t=r[e];var s=this.getVertexBuffer(t);i[t]=s,n[t]=i[t].getData(),a[t]=[]}var o,h=this.subMeshes.slice(0),l=this.getIndices(),u=this.getTotalIndices();for(o=0;o<u;o++){var f=l[o];for(e=0;e<r.length;e++)for(var d=i[t=r[e]].getStrideSize(),g=0;g<d;g++)a[t].push(n[t][f*d+g])}for(o=0;o<u;o+=3)l[o]=o,l[o+1]=o+1,l[o+2]=o+2;for(this.setIndices(l),e=0;e<r.length;e++)t=r[e],this.setVerticesData(t,a[t],i[t].isUpdatable());this.releaseSubMeshes();for(var p=0;p<h.length;p++){var m=h[p];c.SubMesh.AddToMesh(m.materialIndex,m.indexStart,m.indexCount,m.indexStart,m.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},x.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,r,i=l.VertexData.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(h.VertexBuffer.NormalKind)&&i.normals)for(t=0;t<i.normals.length;t++)i.normals[t]*=-1;if(i.indices)for(t=0;t<i.indices.length;t+=3)r=i.indices[t+1],i.indices[t+1]=i.indices[t+2],i.indices[t+2]=r;return i.applyToMesh(this,this.isVertexBufferUpdatable(h.VertexBuffer.PositionKind)),this},x.prototype.increaseVertices=function(e){var t=l.VertexData.ExtractFromMesh(this),r=t.uvs,i=t.indices,n=t.positions,s=t.normals;if(null===i||null===n||null===s||null===r)y.Logger.Warn("VertexData contains null entries");else{for(var o,u,f=e+1,c=new Array,d=0;d<f+1;d++)c[d]=new Array;var g,p=new a.Vector3(0,0,0),m=new a.Vector3(0,0,0),v=new a.Vector2(0,0),_=new Array,M=new Array,b=new Array,I=n.length,D=r.length;for(d=0;d<i.length;d+=3){M[0]=i[d],M[1]=i[d+1],M[2]=i[d+2];for(var x=0;x<3;x++)if(o=M[x],u=M[(x+1)%3],void 0===b[o]&&void 0===b[u]?(b[o]=new Array,b[u]=new Array):(void 0===b[o]&&(b[o]=new Array),void 0===b[u]&&(b[u]=new Array)),void 0===b[o][u]&&void 0===b[u][o]){b[o][u]=[],p.x=(n[3*u]-n[3*o])/f,p.y=(n[3*u+1]-n[3*o+1])/f,p.z=(n[3*u+2]-n[3*o+2])/f,m.x=(s[3*u]-s[3*o])/f,m.y=(s[3*u+1]-s[3*o+1])/f,m.z=(s[3*u+2]-s[3*o+2])/f,v.x=(r[2*u]-r[2*o])/f,v.y=(r[2*u+1]-r[2*o+1])/f,b[o][u].push(o);for(var B=1;B<f;B++)b[o][u].push(n.length/3),n[I]=n[3*o]+B*p.x,s[I++]=s[3*o]+B*m.x,n[I]=n[3*o+1]+B*p.y,s[I++]=s[3*o+1]+B*m.y,n[I]=n[3*o+2]+B*p.z,s[I++]=s[3*o+2]+B*m.z,r[D++]=r[2*o]+B*v.x,r[D++]=r[2*o+1]+B*v.y;b[o][u].push(u),b[u][o]=new Array,g=b[o][u].length;for(var V=0;V<g;V++)b[u][o][V]=b[o][u][g-1-V]}c[0][0]=i[d],c[1][0]=b[i[d]][i[d+1]][1],c[1][1]=b[i[d]][i[d+2]][1];for(B=2;B<f;B++){c[B][0]=b[i[d]][i[d+1]][B],c[B][B]=b[i[d]][i[d+2]][B],p.x=(n[3*c[B][B]]-n[3*c[B][0]])/B,p.y=(n[3*c[B][B]+1]-n[3*c[B][0]+1])/B,p.z=(n[3*c[B][B]+2]-n[3*c[B][0]+2])/B,m.x=(s[3*c[B][B]]-s[3*c[B][0]])/B,m.y=(s[3*c[B][B]+1]-s[3*c[B][0]+1])/B,m.z=(s[3*c[B][B]+2]-s[3*c[B][0]+2])/B,v.x=(r[2*c[B][B]]-r[2*c[B][0]])/B,v.y=(r[2*c[B][B]+1]-r[2*c[B][0]+1])/B;for(x=1;x<B;x++)c[B][x]=n.length/3,n[I]=n[3*c[B][0]]+x*p.x,s[I++]=s[3*c[B][0]]+x*m.x,n[I]=n[3*c[B][0]+1]+x*p.y,s[I++]=s[3*c[B][0]+1]+x*m.y,n[I]=n[3*c[B][0]+2]+x*p.z,s[I++]=s[3*c[B][0]+2]+x*m.z,r[D++]=r[2*c[B][0]]+x*v.x,r[D++]=r[2*c[B][0]+1]+x*v.y}c[f]=b[i[d+1]][i[d+2]],_.push(c[0][0],c[1][0],c[1][1]);for(B=1;B<f;B++){for(x=0;x<B;x++)_.push(c[B][x],c[B+1][x],c[B+1][x+1]),_.push(c[B][x],c[B+1][x+1],c[B][x+1]);_.push(c[B][x],c[B+1][x],c[B+1][x+1])}}t.indices=_,t.applyToMesh(this,this.isVertexBufferUpdatable(h.VertexBuffer.PositionKind))}},x.prototype.forceSharedVertices=function(){var e=l.VertexData.ExtractFromMesh(this),t=e.uvs,r=e.indices,i=e.positions,n=e.colors;if(void 0===r||void 0===i||null===r||null===i)y.Logger.Warn("VertexData contains empty entries");else{for(var a,s,o=new Array,u=new Array,f=new Array,c=new Array,d=new Array,g=0,p=new Array,m=0;m<r.length;m+=3){s=[r[m],r[m+1],r[m+2]],d=new Array;for(var v=0;v<3;v++){d[v]="";for(var _=0;_<3;_++)Math.abs(i[3*s[v]+_])<1e-8&&(i[3*s[v]+_]=0),d[v]+=i[3*s[v]+_]+"|";d[v]=d[v].slice(0,-1)}if(d[0]!=d[1]&&d[0]!=d[2]&&d[1]!=d[2])for(v=0;v<3;v++){if((a=p.indexOf(d[v]))<0){p.push(d[v]),a=g++;for(_=0;_<3;_++)o.push(i[3*s[v]+_]);if(null!=n)for(_=0;_<4;_++)c.push(n[4*s[v]+_]);if(null!=t)for(_=0;_<2;_++)f.push(t[2*s[v]+_])}u.push(a)}}var M=new Array;l.VertexData.ComputeNormals(o,u,M),e.positions=o,e.indices=u,e.normals=M,null!=t&&(e.uvs=f),null!=n&&(e.colors=c),e.applyToMesh(this,this.isVertexBufferUpdatable(h.VertexBuffer.PositionKind))}},x._instancedMeshFactory=function(e,t){throw M._DevTools.WarnImport("InstancedMesh")},x._PhysicsImpostorParser=function(e,t,r){throw M._DevTools.WarnImport("PhysicsImpostor")},x.prototype.createInstance=function(e){return x._instancedMeshFactory(e,this)},x.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this},x.prototype.optimizeIndices=function(e){var t=this,i=this.getIndices(),n=this.getVerticesData(h.VertexBuffer.PositionKind);if(!n||!i)return this;for(var s=new Array,o=0;o<n.length;o+=3)s.push(a.Vector3.FromArray(n,o));var l=new Array;return r.AsyncLoop.SyncAsyncForLoop(s.length,40,function(e){for(var t=s.length-1-e,r=s[t],i=0;i<t;++i){var n=s[i];if(r.equals(n)){l[t]=i;break}}},function(){for(var r=0;r<i.length;++r)i[r]=l[i[r]]||i[r];var n=t.subMeshes.slice(0);t.setIndices(i),t.subMeshes=n,e&&e(t)}),this},x.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.type=this.getClassName(),n.Tags&&n.Tags.HasTags(this)&&(e.tags=n.Tags.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,e.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t){var r=t.id;e.geometryId=r,e.subMeshes=[];for(var i=0;i<this.subMeshes.length;i++){var a=this.subMeshes[i];e.subMeshes.push({materialIndex:a.materialIndex,verticesStart:a.verticesStart,verticesCount:a.verticesCount,indexStart:a.indexStart,indexCount:a.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialId=this.material.id):this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id),this.getScene()._getComponent(b.SceneComponentConstants.NAME_PHYSICSENGINE)){var s=this.getPhysicsImpostor();s&&(e.physicsMass=s.getParam("mass"),e.physicsFriction=s.getParam("friction"),e.physicsRestitution=s.getParam("mass"),e.physicsImpostor=s.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var o=0;o<this.instances.length;o++){var h=this.instances[o];if(!h.doNotSerialize){var l={name:h.name,id:h.id,position:h.position.asArray(),scaling:h.scaling.asArray()};h.parent&&(l.parentId=h.parent.id),h.rotationQuaternion?l.rotationQuaternion=h.rotationQuaternion.asArray():h.rotation&&(l.rotation=h.rotation.asArray()),e.instances.push(l),v.SerializationHelper.AppendSerializedAnimations(h,l),l.ranges=h.serializeAnimationRanges()}}v.SerializationHelper.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},x.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._internalMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return y.Logger.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var t=0;t<e.numInfluencers;t++){var r=e.getActiveTarget(t),i=r.getPositions();if(!i)return void y.Logger.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(h.VertexBuffer.PositionKind+t,i,!1,3);var n=r.getNormals();n&&this.geometry.setVerticesData(h.VertexBuffer.NormalKind+t,n,!1,3);var a=r.getTangents();a&&this.geometry.setVerticesData(h.VertexBuffer.TangentKind+t,a,!1,3);var s=r.getUVs();s&&this.geometry.setVerticesData(h.VertexBuffer.UVKind+"_"+t,s,!1,2)}}else for(t=0;this.geometry.isVerticesDataPresent(h.VertexBuffer.PositionKind+t);)this.geometry.removeVerticesData(h.VertexBuffer.PositionKind+t),this.geometry.isVerticesDataPresent(h.VertexBuffer.NormalKind+t)&&this.geometry.removeVerticesData(h.VertexBuffer.NormalKind+t),this.geometry.isVerticesDataPresent(h.VertexBuffer.TangentKind+t)&&this.geometry.removeVerticesData(h.VertexBuffer.TangentKind+t),this.geometry.isVerticesDataPresent(h.VertexBuffer.UVKind+t)&&this.geometry.removeVerticesData(h.VertexBuffer.UVKind+"_"+t),t++}},x.Parse=function(e,t,r){var i;if((i=e.type&&"GroundMesh"===e.type?x._GroundMeshParser(e,t):new x(e.name,t)).id=e.id,n.Tags&&n.Tags.AddTagsTo(i,e.tags),i.position=a.Vector3.FromArray(e.position),void 0!==e.metadata&&(i.metadata=e.metadata),e.rotationQuaternion?i.rotationQuaternion=a.Quaternion.FromArray(e.rotationQuaternion):e.rotation&&(i.rotation=a.Vector3.FromArray(e.rotation)),i.scaling=a.Vector3.FromArray(e.scaling),e.localMatrix?i.setPreTransformMatrix(a.Matrix.FromArray(e.localMatrix)):e.pivotMatrix&&i.setPivotMatrix(a.Matrix.FromArray(e.pivotMatrix)),i.setEnabled(e.isEnabled),i.isVisible=e.isVisible,i.infiniteDistance=e.infiniteDistance,i.showBoundingBox=e.showBoundingBox,i.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(i.applyFog=e.applyFog),void 0!==e.pickable&&(i.isPickable=e.pickable),void 0!==e.alphaIndex&&(i.alphaIndex=e.alphaIndex),i.receiveShadows=e.receiveShadows,i.billboardMode=e.billboardMode,void 0!==e.visibility&&(i.visibility=e.visibility),i.checkCollisions=e.checkCollisions,i.overrideMaterialSideOrientation=e.overrideMaterialSideOrientation,void 0!==e.isBlocker&&(i.isBlocker=e.isBlocker),i._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(i._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(i._waitingParentId=e.parentId),void 0!==e.actions&&(i._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(i.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(i.overlayColor=s.Color3.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(i.renderOverlay=e.renderOverlay),i.isUnIndexed=!!e.isUnIndexed,i.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(i.delayLoadState=4,i.delayLoadingFile=r+e.delayLoadingFile,i._boundingInfo=new d.BoundingInfo(a.Vector3.FromArray(e.boundingBoxMinimum),a.Vector3.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(i._binaryInfo=e._binaryInfo),i._delayInfo=[],e.hasUVs&&i._delayInfo.push(h.VertexBuffer.UVKind),e.hasUVs2&&i._delayInfo.push(h.VertexBuffer.UV2Kind),e.hasUVs3&&i._delayInfo.push(h.VertexBuffer.UV3Kind),e.hasUVs4&&i._delayInfo.push(h.VertexBuffer.UV4Kind),e.hasUVs5&&i._delayInfo.push(h.VertexBuffer.UV5Kind),e.hasUVs6&&i._delayInfo.push(h.VertexBuffer.UV6Kind),e.hasColors&&i._delayInfo.push(h.VertexBuffer.ColorKind),e.hasMatricesIndices&&i._delayInfo.push(h.VertexBuffer.MatricesIndicesKind),e.hasMatricesWeights&&i._delayInfo.push(h.VertexBuffer.MatricesWeightsKind),i._delayLoadingFunction=u.Geometry._ImportGeometry,m.SceneLoaderFlags.ForceFullSceneLoadingForIncremental&&i._checkDelayState()):u.Geometry._ImportGeometry(e,i),e.materialId?i.setMaterialByID(e.materialId):i.material=null,e.morphTargetManagerId>-1&&(i.morphTargetManager=t.getMorphTargetManagerById(e.morphTargetManagerId)),e.skeletonId>-1&&(i.skeleton=t.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(i.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var l=0;l<e.animations.length;l++){var f=e.animations[l];(v=_._TypeStore.GetClass("BABYLON.Animation"))&&i.animations.push(v.Parse(f))}o.Node.ParseAnimationRanges(i,e,t)}if(e.autoAnimate&&t.beginAnimation(i,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?i.layerMask=Math.abs(parseInt(e.layerMask)):i.layerMask=268435455,e.physicsImpostor&&x._PhysicsImpostorParser(t,i,e),e.lodMeshIds&&(i._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(var c=0;c<e.instances.length;c++){var g=e.instances[c],p=i.createInstance(g.name);if(g.id&&(p.id=g.id),n.Tags&&(g.tags?n.Tags.AddTagsTo(p,g.tags):n.Tags.AddTagsTo(p,e.tags)),p.position=a.Vector3.FromArray(g.position),void 0!==g.metadata&&(p.metadata=g.metadata),g.parentId&&(p._waitingParentId=g.parentId),g.rotationQuaternion?p.rotationQuaternion=a.Quaternion.FromArray(g.rotationQuaternion):g.rotation&&(p.rotation=a.Vector3.FromArray(g.rotation)),p.scaling=a.Vector3.FromArray(g.scaling),null!=g.checkCollisions&&null!=g.checkCollisions&&(p.checkCollisions=g.checkCollisions),null!=g.pickable&&null!=g.pickable&&(p.isPickable=g.pickable),null!=g.showBoundingBox&&null!=g.showBoundingBox&&(p.showBoundingBox=g.showBoundingBox),null!=g.showSubMeshesBoundingBox&&null!=g.showSubMeshesBoundingBox&&(p.showSubMeshesBoundingBox=g.showSubMeshesBoundingBox),null!=g.alphaIndex&&null!=g.showSubMeshesBoundingBox&&(p.alphaIndex=g.alphaIndex),g.physicsImpostor&&x._PhysicsImpostorParser(t,p,g),g.animations){for(l=0;l<g.animations.length;l++){var v;f=g.animations[l],(v=_._TypeStore.GetClass("BABYLON.Animation"))&&p.animations.push(v.Parse(f))}o.Node.ParseAnimationRanges(p,g,t),g.autoAnimate&&t.beginAnimation(p,g.autoAnimateFrom,g.autoAnimateTo,g.autoAnimateLoop,g.autoAnimateSpeed||1)}}return i},x.CreateRibbon=function(e,t,r,i,n,a,s,o,h){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateDisc=function(e,t,r,i,n,a){throw void 0===i&&(i=null),M._DevTools.WarnImport("MeshBuilder")},x.CreateBox=function(e,t,r,i,n){throw void 0===r&&(r=null),M._DevTools.WarnImport("MeshBuilder")},x.CreateSphere=function(e,t,r,i,n,a){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateHemisphere=function(e,t,r,i){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateCylinder=function(e,t,r,i,n,a,s,o,h){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateTorus=function(e,t,r,i,n,a,s){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateTorusKnot=function(e,t,r,i,n,a,s,o,h,l){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateLines=function(e,t,r,i,n){throw void 0===r&&(r=null),void 0===i&&(i=!1),void 0===n&&(n=null),M._DevTools.WarnImport("MeshBuilder")},x.CreateDashedLines=function(e,t,r,i,n,a,s,o){throw void 0===a&&(a=null),M._DevTools.WarnImport("MeshBuilder")},x.CreatePolygon=function(e,t,r,i,n,a,s){throw void 0===s&&(s=earcut),M._DevTools.WarnImport("MeshBuilder")},x.ExtrudePolygon=function(e,t,r,i,n,a,s,o){throw void 0===o&&(o=earcut),M._DevTools.WarnImport("MeshBuilder")},x.ExtrudeShape=function(e,t,r,i,n,a,s,o,h,l){throw void 0===s&&(s=null),M._DevTools.WarnImport("MeshBuilder")},x.ExtrudeShapeCustom=function(e,t,r,i,n,a,s,o,h,l,u,f){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateLathe=function(e,t,r,i,n,a,s){throw M._DevTools.WarnImport("MeshBuilder")},x.CreatePlane=function(e,t,r,i,n){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateGround=function(e,t,r,i,n,a){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateTiledGround=function(e,t,r,i,n,a,s,o,h){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateGroundFromHeightMap=function(e,t,r,i,n,a,s,o,h,l,u){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateTube=function(e,t,r,i,n,a,s,o,h,l){throw M._DevTools.WarnImport("MeshBuilder")},x.CreatePolyhedron=function(e,t,r){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateIcoSphere=function(e,t,r){throw M._DevTools.WarnImport("MeshBuilder")},x.CreateDecal=function(e,t,r,i,n,a){throw M._DevTools.WarnImport("MeshBuilder")},x.prototype.setPositionsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourcePositions){var t=this.getVerticesData(h.VertexBuffer.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(h.VertexBuffer.PositionKind)||this.setVerticesData(h.VertexBuffer.PositionKind,t,!0)}return e._sourcePositions},x.prototype.setNormalsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourceNormals){var t=this.getVerticesData(h.VertexBuffer.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(h.VertexBuffer.NormalKind)||this.setVerticesData(h.VertexBuffer.NormalKind,t,!0)}return e._sourceNormals},x.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(h.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(h.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(h.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(h.VertexBuffer.MatricesWeightsKind))return this;var t=this._internalMeshDataInfo;if(!t._sourcePositions){var r=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=r}t._sourceNormals||this.setNormalsForCPUSkinning();var i=this.getVerticesData(h.VertexBuffer.PositionKind);if(!i)return this;i instanceof Float32Array||(i=new Float32Array(i));var n=this.getVerticesData(h.VertexBuffer.NormalKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));var s=this.getVerticesData(h.VertexBuffer.MatricesIndicesKind),o=this.getVerticesData(h.VertexBuffer.MatricesWeightsKind);if(!o||!s)return this;for(var l,u=this.numBoneInfluencers>4,f=u?this.getVerticesData(h.VertexBuffer.MatricesIndicesExtraKind):null,c=u?this.getVerticesData(h.VertexBuffer.MatricesWeightsExtraKind):null,d=e.getTransformMatrices(this),g=a.Vector3.Zero(),p=new a.Matrix,m=new a.Matrix,v=0,y=0;y<i.length;y+=3,v+=4){var _;for(l=0;l<4;l++)(_=o[v+l])>0&&(a.Matrix.FromFloat32ArrayToRefScaled(d,Math.floor(16*s[v+l]),_,m),p.addToSelf(m));if(u)for(l=0;l<4;l++)(_=c[v+l])>0&&(a.Matrix.FromFloat32ArrayToRefScaled(d,Math.floor(16*f[v+l]),_,m),p.addToSelf(m));a.Vector3.TransformCoordinatesFromFloatsToRef(t._sourcePositions[y],t._sourcePositions[y+1],t._sourcePositions[y+2],p,g),g.toArray(i,y),a.Vector3.TransformNormalFromFloatsToRef(t._sourceNormals[y],t._sourceNormals[y+1],t._sourceNormals[y+2],p,g),g.toArray(n,y),p.reset()}return this.updateVerticesData(h.VertexBuffer.PositionKind,i),this.updateVerticesData(h.VertexBuffer.NormalKind,n),this},x.MinMax=function(e){var t=null,r=null;return e.forEach(function(e){var i=e.getBoundingInfo().boundingBox;t&&r?(t.minimizeInPlace(i.minimumWorld),r.maximizeInPlace(i.maximumWorld)):(t=i.minimumWorld,r=i.maximumWorld)}),t&&r?{min:t,max:r}:{min:a.Vector3.Zero(),max:a.Vector3.Zero()}},x.Center=function(e){var t=e instanceof Array?x.MinMax(e):e;return a.Vector3.Center(t.min,t.max)},x.MergeMeshes=function(e,t,r,i,n,a){var s;if(void 0===t&&(t=!0),!r){var o=0;for(s=0;s<e.length;s++)if(e[s]&&(o+=e[s].getTotalVertices())>=65536)return y.Logger.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(a){var h,u,f=null;n=!1}var d,g=new Array,m=new Array,v=null,_=new Array,M=null;for(s=0;s<e.length;s++)if(e[s]){var b=e[s];if(b.isAnInstance)return y.Logger.Warn("Cannot merge instance meshes."),null;var I=b.computeWorldMatrix(!0);if((d=l.VertexData.ExtractFromMesh(b,!0,!0)).transform(I),v?v.merge(d,r):(v=d,M=b),n&&_.push(b.getTotalIndices()),a)if(b.material){var D=b.material;if(D instanceof p.MultiMaterial){for(u=0;u<D.subMaterials.length;u++)g.indexOf(D.subMaterials[u])<0&&g.push(D.subMaterials[u]);for(h=0;h<b.subMeshes.length;h++)m.push(g.indexOf(D.subMaterials[b.subMeshes[h].materialIndex])),_.push(b.subMeshes[h].indexCount)}else for(g.indexOf(D)<0&&g.push(D),h=0;h<b.subMeshes.length;h++)m.push(g.indexOf(D)),_.push(b.subMeshes[h].indexCount)}else for(h=0;h<b.subMeshes.length;h++)m.push(0),_.push(b.subMeshes[h].indexCount)}if(M=M,i||(i=new x(M.name+"_merged",M.getScene())),v.applyToMesh(i),i.checkCollisions=M.checkCollisions,t)for(s=0;s<e.length;s++)e[s]&&e[s].dispose();if(n||a){i.releaseSubMeshes(),s=0;for(var B=0;s<_.length;)c.SubMesh.CreateFromIndices(0,B,_[s],i),B+=_[s],s++}if(a){for((f=new p.MultiMaterial(M.name+"_merged",M.getScene())).subMaterials=g,h=0;h<i.subMeshes.length;h++)i.subMeshes[h].materialIndex=m[h];i.material=f}else i.material=M.material;return i},x.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},x.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var r=this.instances[this.instances.length-1];this.instances[t]=r,r._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},x.FRONTSIDE=l.VertexData.FRONTSIDE,x.BACKSIDE=l.VertexData.BACKSIDE,x.DOUBLESIDE=l.VertexData.DOUBLESIDE,x.DEFAULTSIDE=l.VertexData.DEFAULTSIDE,x.NO_CAP=0,x.CAP_START=1,x.CAP_END=2,x.CAP_ALL=3,x.NO_FLIP=0,x.FLIP_TILE=1,x.ROTATE_TILE=2,x.FLIP_ROW=3,x.ROTATE_ROW=4,x.FLIP_N_ROTATE_TILE=5,x.FLIP_N_ROTATE_ROW=6,x.CENTER=0,x.LEFT=1,x.RIGHT=2,x.TOP=3,x.BOTTOM=4,x._GroundMeshParser=function(e,t){throw M._DevTools.WarnImport("GroundMesh")},x}(f.AbstractMesh);exports.Mesh=A;
},{"tslib":"90Cu","../Misc/observable":"vY1+","../Misc/tools":"8xSa","../Misc/deepCopier":"qvOT","../Misc/tags":"4qpk","../Maths/math.vector":"61Nx","../Maths/math.color":"q3+m","../node":"mlkt","./buffer":"clDe","./mesh.vertexData":"1A0K","./geometry":"fPSQ","./abstractMesh":"uine","./subMesh":"xQHL","../Culling/boundingInfo":"j0r+","../Materials/material":"zMir","../Materials/multiMaterial":"Huil","../Loading/sceneLoaderFlags":"4nO/","../Misc/decorators":"EVXT","../Misc/logger":"Yh4i","../Misc/typeStore":"sm8f","../Misc/devTools":"S9x9","../sceneComponent":"7t/x","./meshLODLevel":"647t","../Misc/canvasGenerator":"mx8L"}],"pRe7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubEmitter=exports.SubEmitterType=void 0;var e,t=require("../Maths/math.vector"),i=require("../Meshes/abstractMesh"),r=require("../Meshes/mesh"),s=require("../Misc/devTools");exports.SubEmitterType=e,function(e){e[e.ATTACHED=0]="ATTACHED",e[e.END=1]="END"}(e||(exports.SubEmitterType=e={}));var n=function(){function n(t){this.particleSystem=t,this.type=e.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,t.emitter&&t.emitter.dispose||(t.emitter=new i.AbstractMesh("SubemitterSystemEmitter",t.getScene())),t.onDisposeObservable.add(function(){t.emitter&&t.emitter.dispose&&t.emitter.dispose()})}return n.prototype.clone=function(){var e=this.particleSystem.emitter;e?e instanceof t.Vector3?e=e.clone():e instanceof i.AbstractMesh&&((e=new r.Mesh("",e.getScene())).isVisible=!1):e=new t.Vector3;var s=new n(this.particleSystem.clone("",e));return s.particleSystem.name+="Clone",s.type=this.type,s.inheritDirection=this.inheritDirection,s.inheritedVelocityAmount=this.inheritedVelocityAmount,s.particleSystem._disposeEmitterOnDispose=!0,s.particleSystem.disposeOnStop=!0,s},n.prototype.serialize=function(){var e={};return e.type=this.type,e.inheritDirection=this.inheritDirection,e.inheritedVelocityAmount=this.inheritedVelocityAmount,e.particleSystem=this.particleSystem.serialize(),e},n._ParseParticleSystem=function(e,t,i){throw s._DevTools.WarnImport("ParseParticle")},n.Parse=function(e,t,i){var r=e.particleSystem,s=new n(n._ParseParticleSystem(r,t,i));return s.type=e.type,s.inheritDirection=e.inheritDirection,s.inheritedVelocityAmount=e.inheritedVelocityAmount,s.particleSystem._isSubEmitter=!0,s},n.prototype.dispose=function(){this.particleSystem.dispose()},n}();exports.SubEmitter=n;
},{"../Maths/math.vector":"61Nx","../Meshes/abstractMesh":"uine","../Meshes/mesh":"58SX","../Misc/devTools":"S9x9"}],"8jHv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clipPlaneFragmentDeclaration=void 0;var e=require("../../Materials/effect"),n="clipPlaneFragmentDeclaration",i="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif";e.Effect.IncludesShadersStore[n]=i;var a={name:n,shader:i};exports.clipPlaneFragmentDeclaration=a;
},{"../../Materials/effect":"P0sJ"}],"bE0f":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.imageProcessingDeclaration=void 0;var e=require("../../Materials/effect"),n="imageProcessingDeclaration",r="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif";e.Effect.IncludesShadersStore[n]=r;var i={name:n,shader:r};exports.imageProcessingDeclaration=i;
},{"../../Materials/effect":"P0sJ"}],"diEu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.helperFunctions=void 0;var a=require("../../Materials/effect"),n="helperFunctions",e="const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat toGammaSpace(float color)\n{\nreturn pow(color,GammaEncodePowerApprox);\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D);\n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}\n";a.Effect.IncludesShadersStore[n]=e;var r={name:n,shader:e};exports.helperFunctions=r;
},{"../../Materials/effect":"P0sJ"}],"IFDo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.imageProcessingFunctions=void 0;var e=require("../../Materials/effect"),n="imageProcessingFunctions",r="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x;\n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}";e.Effect.IncludesShadersStore[n]=r;var t={name:n,shader:r};exports.imageProcessingFunctions=t;
},{"../../Materials/effect":"P0sJ"}],"XNhN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clipPlaneFragment=void 0;var n=require("../../Materials/effect"),e="clipPlaneFragment",i="#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nif (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nif (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif";n.Effect.IncludesShadersStore[e]=i;var f={name:e,shader:i};exports.clipPlaneFragment=f;
},{"../../Materials/effect":"P0sJ"}],"zL12":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.particlesPixelShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/clipPlaneFragmentDeclaration"),require("./ShadersInclude/imageProcessingDeclaration"),require("./ShadersInclude/helperFunctions"),require("./ShadersInclude/imageProcessingFunctions"),require("./ShadersInclude/clipPlaneFragment");var r="particlesPixelShader",a="\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\n\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n}";e.Effect.ShadersStore[r]=a;var n={name:r,shader:a};exports.particlesPixelShader=n;
},{"../Materials/effect":"P0sJ","./ShadersInclude/clipPlaneFragmentDeclaration":"8jHv","./ShadersInclude/imageProcessingDeclaration":"bE0f","./ShadersInclude/helperFunctions":"diEu","./ShadersInclude/imageProcessingFunctions":"IFDo","./ShadersInclude/clipPlaneFragment":"XNhN"}],"nbz1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clipPlaneVertexDeclaration=void 0;var e=require("../../Materials/effect"),n="clipPlaneVertexDeclaration",i="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif";e.Effect.IncludesShadersStore[n]=i;var a={name:n,shader:i};exports.clipPlaneVertexDeclaration=a;
},{"../../Materials/effect":"P0sJ"}],"BIQH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clipPlaneVertex=void 0;var e=require("../../Materials/effect"),n="clipPlaneVertex",i="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif";e.Effect.IncludesShadersStore[n]=i;var l={name:n,shader:i};exports.clipPlaneVertex=l;
},{"../../Materials/effect":"P0sJ"}],"GYYh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.particlesVertexShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/clipPlaneVertexDeclaration"),require("./ShadersInclude/clipPlaneVertex");var n="particlesVertexShader",r="\nattribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos;\n#endif\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#endif\nvoid main(void) {\nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD\n\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition;\nvec3 worldPos=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\n\ngl_Position=projection*vec4(viewPos,1.0);\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(worldPos,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset*particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=invView*vec4(viewPos,1.0);\n#endif\n#include<clipPlaneVertex>\n}";e.Effect.ShadersStore[n]=r;var o={name:n,shader:r};exports.particlesVertexShader=o;
},{"../Materials/effect":"P0sJ","./ShadersInclude/clipPlaneVertexDeclaration":"nbz1","./ShadersInclude/clipPlaneVertex":"BIQH"}],"3mS/":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ParticleSystem=void 0;var e=require("tslib"),t=require("../Misc/gradients"),r=require("../Misc/observable"),i=require("../Maths/math.vector"),a=require("../Maths/math.scalar"),n=require("../Meshes/buffer"),s=require("../Meshes/abstractMesh"),o=require("../Materials/material"),c=require("../Materials/materialHelper"),d=require("../Materials/imageProcessingConfiguration"),l=require("../Materials/Textures/texture"),h=require("../Materials/Textures/dynamicTexture"),u=require("../Materials/Textures/rawTexture"),p=require("../Materials/Textures/Procedurals/proceduralTexture"),f=require("../Engines/engineStore"),_=require("../Particles/EmitterTypes/index"),m=require("./baseParticleSystem"),g=require("./particle"),G=require("./subEmitter"),S=require("../Misc/decorators"),v=require("../Misc/deepCopier"),y=require("../Misc/typeStore");require("../Shaders/particles.fragment"),require("../Shaders/particles.vertex");var x=require("../Maths/math.color"),E=function(m){function E(e,n,s,o,c,d){void 0===o&&(o=null),void 0===c&&(c=!1),void 0===d&&(d=.01);var l=m.call(this,e)||this;return l._inheritedVelocityOffset=new i.Vector3,l.onDisposeObservable=new r.Observable,l._particles=new Array,l._stockParticles=new Array,l._newPartsExcess=0,l._vertexBuffers={},l._scaledColorStep=new x.Color4(0,0,0,0),l._colorDiff=new x.Color4(0,0,0,0),l._scaledDirection=i.Vector3.Zero(),l._scaledGravity=i.Vector3.Zero(),l._currentRenderId=-1,l._useInstancing=!1,l._started=!1,l._stopped=!1,l._actualFrame=0,l._currentEmitRate1=0,l._currentEmitRate2=0,l._currentStartSize1=0,l._currentStartSize2=0,l._rawTextureWidth=256,l._useRampGradients=!1,l._disposeEmitterOnDispose=!1,l.isLocal=!1,l.recycleParticle=function(e){var t=l._particles.pop();t!==e&&t.copyTo(e),l._stockParticles.push(t)},l._createParticle=function(){var e;if(0!==l._stockParticles.length?(e=l._stockParticles.pop())._reset():e=new g.Particle(l),l._subEmitters&&l._subEmitters.length>0){var t=l._subEmitters[Math.floor(Math.random()*l._subEmitters.length)];e._attachedSubEmitters=[],t.forEach(function(t){if(t.type===G.SubEmitterType.ATTACHED){var r=t.clone();e._attachedSubEmitters.push(r),r.particleSystem.start()}})}return e},l._emitFromParticle=function(e){if(l._subEmitters&&0!==l._subEmitters.length){var t=Math.floor(Math.random()*l._subEmitters.length);l._subEmitters[t].forEach(function(t){if(t.type===G.SubEmitterType.END){var r=t.clone();e._inheritParticleInfoToSubEmitter(r),r.particleSystem._rootParticleSystem=l,l.activeSubSystems.push(r.particleSystem),r.particleSystem.start()}})}},l._capacity=n,l._epsilon=d,l._isAnimationSheetEnabled=c,l._scene=s||f.EngineStore.LastCreatedScene,l._attachImageProcessingConfiguration(null),l._customEffect=o,l._scene.particleSystems.push(l),l._useInstancing=l._scene.getEngine().getCaps().instancedArrays,l._createIndexBuffer(),l._createVertexBuffers(),l.particleEmitterType=new _.BoxParticleEmitter,l.updateFunction=function(e){var r=null,n=null;l.noiseTexture&&(r=l.noiseTexture.getSize(),n=l.noiseTexture.getContent());for(var s,o=function(){s=e[c];var o=l._scaledUpdateSpeed,d=s.age;if(s.age+=o,s.age>s.lifeTime){var h=s.age-d;o=(s.lifeTime-d)*o/h,s.age=s.lifeTime}var u=s.age/s.lifeTime;l._colorGradients&&l._colorGradients.length>0?t.GradientHelper.GetCurrentGradient(u,l._colorGradients,function(e,t,r){e!==s._currentColorGradient&&(s._currentColor1.copyFrom(s._currentColor2),t.getColorToRef(s._currentColor2),s._currentColorGradient=e),x.Color4.LerpToRef(s._currentColor1,s._currentColor2,r,s.color)}):(s.colorStep.scaleToRef(o,l._scaledColorStep),s.color.addInPlace(l._scaledColorStep),s.color.a<0&&(s.color.a=0)),l._angularSpeedGradients&&l._angularSpeedGradients.length>0&&t.GradientHelper.GetCurrentGradient(u,l._angularSpeedGradients,function(e,t,r){e!==s._currentAngularSpeedGradient&&(s._currentAngularSpeed1=s._currentAngularSpeed2,s._currentAngularSpeed2=t.getFactor(),s._currentAngularSpeedGradient=e),s.angularSpeed=a.Scalar.Lerp(s._currentAngularSpeed1,s._currentAngularSpeed2,r)}),s.angle+=s.angularSpeed*o;var p=o;if(l._velocityGradients&&l._velocityGradients.length>0&&t.GradientHelper.GetCurrentGradient(u,l._velocityGradients,function(e,t,r){e!==s._currentVelocityGradient&&(s._currentVelocity1=s._currentVelocity2,s._currentVelocity2=t.getFactor(),s._currentVelocityGradient=e),p*=a.Scalar.Lerp(s._currentVelocity1,s._currentVelocity2,r)}),s.direction.scaleToRef(p,l._scaledDirection),l._limitVelocityGradients&&l._limitVelocityGradients.length>0&&t.GradientHelper.GetCurrentGradient(u,l._limitVelocityGradients,function(e,t,r){e!==s._currentLimitVelocityGradient&&(s._currentLimitVelocity1=s._currentLimitVelocity2,s._currentLimitVelocity2=t.getFactor(),s._currentLimitVelocityGradient=e);var i=a.Scalar.Lerp(s._currentLimitVelocity1,s._currentLimitVelocity2,r);s.direction.length()>i&&s.direction.scaleInPlace(l.limitVelocityDamping)}),l._dragGradients&&l._dragGradients.length>0&&t.GradientHelper.GetCurrentGradient(u,l._dragGradients,function(e,t,r){e!==s._currentDragGradient&&(s._currentDrag1=s._currentDrag2,s._currentDrag2=t.getFactor(),s._currentDragGradient=e);var i=a.Scalar.Lerp(s._currentDrag1,s._currentDrag2,r);l._scaledDirection.scaleInPlace(1-i)}),l.isLocal?(s._localPosition.addInPlace(l._scaledDirection),i.Vector3.TransformCoordinatesToRef(s._localPosition,l._emitterWorldMatrix,s.position)):s.position.addInPlace(l._scaledDirection),n&&r&&s._randomNoiseCoordinates1){var f=l._fetchR(s._randomNoiseCoordinates1.x,s._randomNoiseCoordinates1.y,r.width,r.height,n),_=l._fetchR(s._randomNoiseCoordinates1.z,s._randomNoiseCoordinates2.x,r.width,r.height,n),m=l._fetchR(s._randomNoiseCoordinates2.y,s._randomNoiseCoordinates2.z,r.width,r.height,n),g=i.TmpVectors.Vector3[0],G=i.TmpVectors.Vector3[1];g.copyFromFloats((2*f-1)*l.noiseStrength.x,(2*_-1)*l.noiseStrength.y,(2*m-1)*l.noiseStrength.z),g.scaleToRef(o,G),s.direction.addInPlace(G)}if(l.gravity.scaleToRef(o,l._scaledGravity),s.direction.addInPlace(l._scaledGravity),l._sizeGradients&&l._sizeGradients.length>0&&t.GradientHelper.GetCurrentGradient(u,l._sizeGradients,function(e,t,r){e!==s._currentSizeGradient&&(s._currentSize1=s._currentSize2,s._currentSize2=t.getFactor(),s._currentSizeGradient=e),s.size=a.Scalar.Lerp(s._currentSize1,s._currentSize2,r)}),l._useRampGradients&&(l._colorRemapGradients&&l._colorRemapGradients.length>0&&t.GradientHelper.GetCurrentGradient(u,l._colorRemapGradients,function(e,t,r){var i=a.Scalar.Lerp(e.factor1,t.factor1,r),n=a.Scalar.Lerp(e.factor2,t.factor2,r);s.remapData.x=i,s.remapData.y=n-i}),l._alphaRemapGradients&&l._alphaRemapGradients.length>0&&t.GradientHelper.GetCurrentGradient(u,l._alphaRemapGradients,function(e,t,r){var i=a.Scalar.Lerp(e.factor1,t.factor1,r),n=a.Scalar.Lerp(e.factor2,t.factor2,r);s.remapData.z=i,s.remapData.w=n-i})),l._isAnimationSheetEnabled&&s.updateCellIndex(),s._inheritParticleInfoToSubEmitters(),s.age>=s.lifeTime)return l._emitFromParticle(s),s._attachedSubEmitters&&(s._attachedSubEmitters.forEach(function(e){e.particleSystem.disposeOnStop=!0,e.particleSystem.stop()}),s._attachedSubEmitters=null),l.recycleParticle(s),c--,"continue"},c=0;c<e.length;c++)o()},l}return(0,e.__extends)(E,m),Object.defineProperty(E.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(e){this._useRampGradients!==e&&(this._useRampGradients=e,this._resetEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"particles",{get:function(){return this._particles},enumerable:!0,configurable:!0}),E.prototype.getClassName=function(){return"ParticleSystem"},E.prototype._addFactorGradient=function(e,r,i,a){var n=new t.FactorGradient;n.gradient=r,n.factor1=i,n.factor2=a,e.push(n),e.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0})},E.prototype._removeFactorGradient=function(e,t){if(e)for(var r=0,i=0,a=e;i<a.length;i++){if(a[i].gradient===t){e.splice(r,1);break}r++}},E.prototype.addLifeTimeGradient=function(e,t,r){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,e,t,r),this},E.prototype.removeLifeTimeGradient=function(e){return this._removeFactorGradient(this._lifeTimeGradients,e),this},E.prototype.addSizeGradient=function(e,t,r){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,t,r),this},E.prototype.removeSizeGradient=function(e){return this._removeFactorGradient(this._sizeGradients,e),this},E.prototype.addColorRemapGradient=function(e,t,r){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,e,t,r),this},E.prototype.removeColorRemapGradient=function(e){return this._removeFactorGradient(this._colorRemapGradients,e),this},E.prototype.addAlphaRemapGradient=function(e,t,r){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,e,t,r),this},E.prototype.removeAlphaRemapGradient=function(e){return this._removeFactorGradient(this._alphaRemapGradients,e),this},E.prototype.addAngularSpeedGradient=function(e,t,r){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,t,r),this},E.prototype.removeAngularSpeedGradient=function(e){return this._removeFactorGradient(this._angularSpeedGradients,e),this},E.prototype.addVelocityGradient=function(e,t,r){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,t,r),this},E.prototype.removeVelocityGradient=function(e){return this._removeFactorGradient(this._velocityGradients,e),this},E.prototype.addLimitVelocityGradient=function(e,t,r){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,t,r),this},E.prototype.removeLimitVelocityGradient=function(e){return this._removeFactorGradient(this._limitVelocityGradients,e),this},E.prototype.addDragGradient=function(e,t,r){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,t,r),this},E.prototype.removeDragGradient=function(e){return this._removeFactorGradient(this._dragGradients,e),this},E.prototype.addEmitRateGradient=function(e,t,r){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,e,t,r),this},E.prototype.removeEmitRateGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},E.prototype.addStartSizeGradient=function(e,t,r){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,e,t,r),this},E.prototype.removeStartSizeGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},E.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture){for(var e=new Uint8Array(4*this._rawTextureWidth),r=x.TmpColors.Color3[0],i=0;i<this._rawTextureWidth;i++){var a=i/this._rawTextureWidth;t.GradientHelper.GetCurrentGradient(a,this._rampGradients,function(t,a,n){x.Color3.LerpToRef(t.color,a.color,n,r),e[4*i]=255*r.r,e[4*i+1]=255*r.g,e[4*i+2]=255*r.b,e[4*i+3]=255})}this._rampGradientsTexture=u.RawTexture.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,l.Texture.NEAREST_SAMPLINGMODE)}},E.prototype.getRampGradients=function(){return this._rampGradients},E.prototype.addRampGradient=function(e,r){this._rampGradients||(this._rampGradients=[]);var i=new t.Color3Gradient;return i.gradient=e,i.color=r,this._rampGradients.push(i),this._rampGradients.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture(),this},E.prototype.removeRampGradient=function(e){return this._removeGradientAndTexture(e,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},E.prototype.addColorGradient=function(e,r,i){this._colorGradients||(this._colorGradients=[]);var a=new t.ColorGradient;return a.gradient=e,a.color1=r,a.color2=i,this._colorGradients.push(a),this._colorGradients.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this},E.prototype.removeColorGradient=function(e){if(!this._colorGradients)return this;for(var t=0,r=0,i=this._colorGradients;r<i.length;r++){if(i[r].gradient===e){this._colorGradients.splice(t,1);break}t++}return this},E.prototype._fetchR=function(e,t,r,i,a){return a[4*(((e=.5*Math.abs(e)+.5)*r%r|0)+((t=.5*Math.abs(t)+.5)*i%i|0)*r)]/255},E.prototype._reset=function(){this._resetEffect()},E.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._createVertexBuffers()},E.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==E.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var e=this._scene.getEngine();this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new n.Buffer(e,this._vertexData,!0,this._vertexBufferSize);var t=0,r=this._vertexBuffer.createVertexBuffer(n.VertexBuffer.PositionKind,t,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[n.VertexBuffer.PositionKind]=r,t+=3;var i=this._vertexBuffer.createVertexBuffer(n.VertexBuffer.ColorKind,t,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[n.VertexBuffer.ColorKind]=i,t+=4;var a=this._vertexBuffer.createVertexBuffer("angle",t,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=a,t+=1;var s,o=this._vertexBuffer.createVertexBuffer("size",t,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=o,t+=2,this._isAnimationSheetEnabled){var c=this._vertexBuffer.createVertexBuffer("cellIndex",t,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=c,t+=1}if(!this._isBillboardBased||this.billboardMode===E.BILLBOARDMODE_STRETCHED){var d=this._vertexBuffer.createVertexBuffer("direction",t,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=d,t+=3}if(this._useRampGradients){var l=this._vertexBuffer.createVertexBuffer("remapData",t,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=l,t+=4}if(this._useInstancing){var h=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new n.Buffer(e,h,!1,2),s=this._spriteBuffer.createVertexBuffer("offset",0,2)}else s=this._vertexBuffer.createVertexBuffer("offset",t,2,this._vertexBufferSize,this._useInstancing),t+=2;this._vertexBuffers.offset=s},E.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var e=[],t=0,r=0;r<this._capacity;r++)e.push(t),e.push(t+1),e.push(t+2),e.push(t),e.push(t+2),e.push(t+3),t+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}},E.prototype.getCapacity=function(){return this._capacity},E.prototype.isAlive=function(){return this._alive},E.prototype.isStarted=function(){return this._started},E.prototype._prepareSubEmitterInternalArray=function(){var e=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach(function(t){t instanceof E?e._subEmitters.push([new G.SubEmitter(t)]):t instanceof G.SubEmitter?e._subEmitters.push([t]):t instanceof Array&&e._subEmitters.push(t)})},E.prototype.start=function(e){var t=this;if(void 0===e&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(e)setTimeout(function(){t.start(0)},e);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){this.emitter instanceof s.AbstractMesh&&this.emitter.computeWorldMatrix(!0);var r=this.noiseTexture;if(r&&r.onGeneratedObservable)r.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var e=0;e<t.preWarmCycles;e++)t.animate(!0),r.render()})});else for(var i=0;i<this.preWarmCycles;i++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},E.prototype.stop=function(e){void 0===e&&(e=!0),this._stopped=!0,e&&this._stopSubEmitters()},E.prototype.reset=function(){this._stockParticles=[],this._particles=[]},E.prototype._appendParticleVertex=function(e,t,r,a){var n=e*this._vertexBufferSize;if(this._vertexData[n++]=t.position.x+this.worldOffset.x,this._vertexData[n++]=t.position.y+this.worldOffset.y,this._vertexData[n++]=t.position.z+this.worldOffset.z,this._vertexData[n++]=t.color.r,this._vertexData[n++]=t.color.g,this._vertexData[n++]=t.color.b,this._vertexData[n++]=t.color.a,this._vertexData[n++]=t.angle,this._vertexData[n++]=t.scale.x*t.size,this._vertexData[n++]=t.scale.y*t.size,this._isAnimationSheetEnabled&&(this._vertexData[n++]=t.cellIndex),this._isBillboardBased)this.billboardMode===E.BILLBOARDMODE_STRETCHED&&(this._vertexData[n++]=t.direction.x,this._vertexData[n++]=t.direction.y,this._vertexData[n++]=t.direction.z);else if(t._initialDirection){var s=t._initialDirection;this.isLocal&&(i.Vector3.TransformNormalToRef(s,this._emitterWorldMatrix,i.TmpVectors.Vector3[0]),s=i.TmpVectors.Vector3[0]),0===s.x&&0===s.z&&(s.x=.001),this._vertexData[n++]=s.x,this._vertexData[n++]=s.y,this._vertexData[n++]=s.z}else{var o=t.direction;this.isLocal&&(i.Vector3.TransformNormalToRef(o,this._emitterWorldMatrix,i.TmpVectors.Vector3[0]),o=i.TmpVectors.Vector3[0]),0===o.x&&0===o.z&&(o.x=.001),this._vertexData[n++]=o.x,this._vertexData[n++]=o.y,this._vertexData[n++]=o.z}this._useRampGradients&&(this._vertexData[n++]=t.remapData.x,this._vertexData[n++]=t.remapData.y,this._vertexData[n++]=t.remapData.z,this._vertexData[n++]=t.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===r?r=this._epsilon:1===r&&(r=1-this._epsilon),0===a?a=this._epsilon:1===a&&(a=1-this._epsilon)),this._vertexData[n++]=r,this._vertexData[n++]=a)},E.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(e){e.stop(!0)}),this.activeSubSystems=new Array)},E.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var e=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==e&&this._rootParticleSystem.activeSubSystems.splice(e,1),this._rootParticleSystem=null}},E.prototype._update=function(e){var r,n=this;if(this._alive=this._particles.length>0,this.emitter.position){var s=this.emitter;this._emitterWorldMatrix=s.getWorldMatrix()}else{var o=this.emitter;this._emitterWorldMatrix=i.Matrix.Translation(o.x,o.y,o.z)}this.updateFunction(this._particles);for(var c,d=function(){if(l._particles.length===l._capacity)return"break";if(r=l._createParticle(),l._particles.push(r),l.targetStopDuration&&l._lifeTimeGradients&&l._lifeTimeGradients.length>0){var e=a.Scalar.Clamp(l._actualFrame/l.targetStopDuration);t.GradientHelper.GetCurrentGradient(e,l._lifeTimeGradients,function(t,i){var n=t,s=i,o=n.getFactor(),c=s.getFactor(),d=(e-n.gradient)/(s.gradient-n.gradient);r.lifeTime=a.Scalar.Lerp(o,c,d)})}else r.lifeTime=a.Scalar.RandomRange(l.minLifeTime,l.maxLifeTime);var s=a.Scalar.RandomRange(l.minEmitPower,l.maxEmitPower);if(l.startPositionFunction?l.startPositionFunction(l._emitterWorldMatrix,r.position,r,l.isLocal):l.particleEmitterType.startPositionFunction(l._emitterWorldMatrix,r.position,r,l.isLocal),l.isLocal&&(r._localPosition?r._localPosition.copyFrom(r.position):r._localPosition=r.position.clone(),i.Vector3.TransformCoordinatesToRef(r._localPosition,l._emitterWorldMatrix,r.position)),l.startDirectionFunction?l.startDirectionFunction(l._emitterWorldMatrix,r.direction,r,l.isLocal):l.particleEmitterType.startDirectionFunction(l._emitterWorldMatrix,r.direction,r,l.isLocal),0===s?r._initialDirection?r._initialDirection.copyFrom(r.direction):r._initialDirection=r.direction.clone():r._initialDirection=null,r.direction.scaleInPlace(s),l._sizeGradients&&0!==l._sizeGradients.length?(r._currentSizeGradient=l._sizeGradients[0],r._currentSize1=r._currentSizeGradient.getFactor(),r.size=r._currentSize1,l._sizeGradients.length>1?r._currentSize2=l._sizeGradients[1].getFactor():r._currentSize2=r._currentSize1):r.size=a.Scalar.RandomRange(l.minSize,l.maxSize),r.scale.copyFromFloats(a.Scalar.RandomRange(l.minScaleX,l.maxScaleX),a.Scalar.RandomRange(l.minScaleY,l.maxScaleY)),l._startSizeGradients&&l._startSizeGradients[0]&&l.targetStopDuration){var o=l._actualFrame/l.targetStopDuration;t.GradientHelper.GetCurrentGradient(o,l._startSizeGradients,function(e,t,i){e!==n._currentStartSizeGradient&&(n._currentStartSize1=n._currentStartSize2,n._currentStartSize2=t.getFactor(),n._currentStartSizeGradient=e);var s=a.Scalar.Lerp(n._currentStartSize1,n._currentStartSize2,i);r.scale.scaleInPlace(s)})}l._angularSpeedGradients&&0!==l._angularSpeedGradients.length?(r._currentAngularSpeedGradient=l._angularSpeedGradients[0],r.angularSpeed=r._currentAngularSpeedGradient.getFactor(),r._currentAngularSpeed1=r.angularSpeed,l._angularSpeedGradients.length>1?r._currentAngularSpeed2=l._angularSpeedGradients[1].getFactor():r._currentAngularSpeed2=r._currentAngularSpeed1):r.angularSpeed=a.Scalar.RandomRange(l.minAngularSpeed,l.maxAngularSpeed),r.angle=a.Scalar.RandomRange(l.minInitialRotation,l.maxInitialRotation),l._velocityGradients&&l._velocityGradients.length>0&&(r._currentVelocityGradient=l._velocityGradients[0],r._currentVelocity1=r._currentVelocityGradient.getFactor(),l._velocityGradients.length>1?r._currentVelocity2=l._velocityGradients[1].getFactor():r._currentVelocity2=r._currentVelocity1),l._limitVelocityGradients&&l._limitVelocityGradients.length>0&&(r._currentLimitVelocityGradient=l._limitVelocityGradients[0],r._currentLimitVelocity1=r._currentLimitVelocityGradient.getFactor(),l._limitVelocityGradients.length>1?r._currentLimitVelocity2=l._limitVelocityGradients[1].getFactor():r._currentLimitVelocity2=r._currentLimitVelocity1),l._dragGradients&&l._dragGradients.length>0&&(r._currentDragGradient=l._dragGradients[0],r._currentDrag1=r._currentDragGradient.getFactor(),l._dragGradients.length>1?r._currentDrag2=l._dragGradients[1].getFactor():r._currentDrag2=r._currentDrag1),l._colorGradients&&0!==l._colorGradients.length?(r._currentColorGradient=l._colorGradients[0],r._currentColorGradient.getColorToRef(r.color),r._currentColor1.copyFrom(r.color),l._colorGradients.length>1?l._colorGradients[1].getColorToRef(r._currentColor2):r._currentColor2.copyFrom(r.color)):(c=a.Scalar.RandomRange(0,1),x.Color4.LerpToRef(l.color1,l.color2,c,r.color),l.colorDead.subtractToRef(r.color,l._colorDiff),l._colorDiff.scaleToRef(1/r.lifeTime,r.colorStep)),l._isAnimationSheetEnabled&&(r._initialStartSpriteCellID=l.startSpriteCellID,r._initialEndSpriteCellID=l.endSpriteCellID),r.direction.addInPlace(l._inheritedVelocityOffset),l._useRampGradients&&(r.remapData=new i.Vector4(0,1,0,1)),l.noiseTexture&&(r._randomNoiseCoordinates1?(r._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),r._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(r._randomNoiseCoordinates1=new i.Vector3(Math.random(),Math.random(),Math.random()),r._randomNoiseCoordinates2=new i.Vector3(Math.random(),Math.random(),Math.random()))),r._inheritParticleInfoToSubEmitters()},l=this,h=0;h<e;h++){if("break"===d())break}},E._GetAttributeNamesOrOptions=function(e,t,r){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===r&&(r=!1);var i=[n.VertexBuffer.PositionKind,n.VertexBuffer.ColorKind,"angle","offset","size"];return e&&i.push("cellIndex"),t||i.push("direction"),r&&i.push("remapData"),i},E._GetEffectCreationOptions=function(e){void 0===e&&(e=!1);var t=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMask","translationPivot","eyePosition"];return e&&t.push("particlesInfos"),t},E.prototype._getEffect=function(e){if(this._customEffect)return this._customEffect;var t=[];if(this._scene.clipPlane&&t.push("#define CLIPPLANE"),this._scene.clipPlane2&&t.push("#define CLIPPLANE2"),this._scene.clipPlane3&&t.push("#define CLIPPLANE3"),this._scene.clipPlane4&&t.push("#define CLIPPLANE4"),this._scene.clipPlane5&&t.push("#define CLIPPLANE5"),this._scene.clipPlane6&&t.push("#define CLIPPLANE6"),this._isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),e===E.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&t.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case E.BILLBOARDMODE_Y:t.push("#define BILLBOARDY");break;case E.BILLBOARDMODE_STRETCHED:t.push("#define BILLBOARDSTRETCHED");break;case E.BILLBOARDMODE_ALL:}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(this._imageProcessingConfigurationDefines.toString()));var r=t.join("\n");if(this._cachedDefines!==r){this._cachedDefines=r;var i=E._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==E.BILLBOARDMODE_STRETCHED,this._useRampGradients),a=E._GetEffectCreationOptions(this._isAnimationSheetEnabled),n=["diffuseSampler","rampSampler"];d.ImageProcessingConfiguration&&(d.ImageProcessingConfiguration.PrepareUniforms(a,this._imageProcessingConfigurationDefines),d.ImageProcessingConfiguration.PrepareSamplers(n,this._imageProcessingConfigurationDefines)),this._effect=this._scene.getEngine().createEffect("particles",i,a,n,r)}return this._effect},E.prototype.animate=function(e){var r=this;if(void 0===e&&(e=!1),this._started){if(!e){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var i;if(this._scaledUpdateSpeed=this.updateSpeed*(e?this.preWarmStepOffset:this._scene.getAnimationRatio()),this.manualEmitCount>-1)i=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var n=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var s=this._actualFrame/this.targetStopDuration;t.GradientHelper.GetCurrentGradient(s,this._emitRateGradients,function(e,t,i){e!==r._currentEmitRateGradient&&(r._currentEmitRate1=r._currentEmitRate2,r._currentEmitRate2=t.getFactor(),r._currentEmitRateGradient=e),n=a.Scalar.Lerp(r._currentEmitRate1,r._currentEmitRate2,i)})}i=n*this._scaledUpdateSpeed>>0,this._newPartsExcess+=n*this._scaledUpdateSpeed-i}if(this._newPartsExcess>1&&(i+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?i=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(i),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),!e){for(var o=0,c=0;c<this._particles.length;c++){var d=this._particles[c];this._appendParticleVertices(o,d),o+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},E.prototype._appendParticleVertices=function(e,t){this._appendParticleVertex(e++,t,0,0),this._useInstancing||(this._appendParticleVertex(e++,t,1,0),this._appendParticleVertex(e++,t,1,1),this._appendParticleVertex(e++,t,0,1))},E.prototype.rebuild=function(){for(var e in this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild(),this._vertexBuffers)this._vertexBuffers[e]._rebuild()},E.prototype.isReady=function(){if(!(this.emitter&&this._imageProcessingConfiguration.isReady()&&this.particleTexture&&this.particleTexture.isReady()))return!1;if(this.blendMode!==E.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else{if(!this._getEffect(E.BLENDMODE_MULTIPLY).isReady())return!1;if(!this._getEffect(E.BLENDMODE_ADD).isReady())return!1}return!0},E.prototype._render=function(e){var t=this._getEffect(e),r=this._scene.getEngine();r.enableEffect(t);var i=this._scene.getViewMatrix();if(t.setTexture("diffuseSampler",this.particleTexture),t.setMatrix("view",i),t.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var a=this.particleTexture.getBaseSize();t.setFloat3("particlesInfos",this.spriteCellWidth/a.width,this.spriteCellHeight/a.height,a.width/this.spriteCellWidth)}if(t.setVector2("translationPivot",this.translationPivot),t.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased){var n=this._scene.activeCamera;t.setVector3("eyePosition",n.globalPosition)}if(this._rampGradientsTexture&&t.setTexture("rampSampler",this._rampGradientsTexture),this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6){var s=i.clone();s.invert(),t.setMatrix("invView",s),c.MaterialHelper.BindClipPlane(t,this._scene)}switch(r.bindBuffers(this._vertexBuffers,this._indexBuffer,t),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(t),e){case E.BLENDMODE_ADD:r.setAlphaMode(1);break;case E.BLENDMODE_ONEONE:r.setAlphaMode(6);break;case E.BLENDMODE_STANDARD:r.setAlphaMode(2);break;case E.BLENDMODE_MULTIPLY:r.setAlphaMode(4)}return this._useInstancing?r.drawArraysType(o.Material.TriangleFanDrawMode,0,4,this._particles.length):r.drawElementsType(o.Material.TriangleFillMode,0,6*this._particles.length),this._particles.length},E.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var e=this._scene.getEngine();e.setState(!1),this.forceDepthWrite&&e.setDepthWrite(!0);var t=0;return this.blendMode===E.BLENDMODE_MULTIPLYADD&&(t=this._render(E.BLENDMODE_MULTIPLY)+this._render(E.BLENDMODE_ADD)),t=this._render(this.blendMode),e.unbindInstanceAttributes(),e.setAlphaMode(0),t},E.prototype.dispose=function(e){if(void 0===e&&(e=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var t=0;t<this._subEmitters.length;t++)for(var r=0,i=this._subEmitters[t];r<i.length;r++){i[r].dispose()}this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),(t=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(t,1),this._scene._activeParticleSystems.dispose(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.reset()},E.prototype.clone=function(e,t){var r=null,i=null;if(null!=this.customShader){var a=(i=this.customShader).shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"";r=this._scene.getEngine().createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,a)}else this._customEffect&&(r=this._customEffect);var n=new E(e,this._capacity,this._scene,r);(n.customShader=i,v.DeepCopier.DeepCopy(this,n,["particles","customShader","noiseTexture","particleTexture","onDisposeObservable"]),void 0===t&&(t=this.emitter),n.noiseTexture=this.noiseTexture,n.emitter=t,this.particleTexture)&&(this.particleTexture instanceof h.DynamicTexture?(n.particleTexture=this.particleTexture.clone(),n.particleTexture.getContext().drawImage(this.particleTexture.getContext().canvas,0,0),n.particleTexture.update()):n.particleTexture=new l.Texture(this.particleTexture.url,this._scene));return this._colorGradients&&this._colorGradients.forEach(function(e){n.addColorGradient(e.gradient,e.color1,e.color2)}),this._dragGradients&&this._dragGradients.forEach(function(e){n.addDragGradient(e.gradient,e.factor1,e.factor2)}),this._angularSpeedGradients&&this._angularSpeedGradients.forEach(function(e){n.addAngularSpeedGradient(e.gradient,e.factor1,e.factor2)}),this._emitRateGradients&&this._emitRateGradients.forEach(function(e){n.addEmitRateGradient(e.gradient,e.factor1,e.factor2)}),this._lifeTimeGradients&&this._lifeTimeGradients.forEach(function(e){n.addLifeTimeGradient(e.gradient,e.factor1,e.factor2)}),this._limitVelocityGradients&&this._limitVelocityGradients.forEach(function(e){n.addLimitVelocityGradient(e.gradient,e.factor1,e.factor2)}),this._sizeGradients&&this._sizeGradients.forEach(function(e){n.addSizeGradient(e.gradient,e.factor1,e.factor2)}),this._startSizeGradients&&this._startSizeGradients.forEach(function(e){n.addStartSizeGradient(e.gradient,e.factor1,e.factor2)}),this._velocityGradients&&this._velocityGradients.forEach(function(e){n.addVelocityGradient(e.gradient,e.factor1,e.factor2)}),this._rampGradients&&this._rampGradients.forEach(function(e){n.addRampGradient(e.gradient,e.color)}),this._colorRemapGradients&&this._colorRemapGradients.forEach(function(e){n.addColorRemapGradient(e.gradient,e.factor1,e.factor2)}),this._alphaRemapGradients&&this._alphaRemapGradients.forEach(function(e){n.addAlphaRemapGradient(e.gradient,e.factor1,e.factor2)}),this.preventAutoStart||n.start(),n},E.prototype.serialize=function(){var e={};if(E._Serialize(e,this),e.textureMask=this.textureMask.asArray(),e.customShader=this.customShader,e.preventAutoStart=this.preventAutoStart,this.subEmitters){e.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var t=0,r=this._subEmitters;t<r.length;t++){for(var i=[],a=0,n=r[t];a<n.length;a++){var s=n[a];i.push(s.serialize())}e.subEmitters.push(i)}}return e},E._Serialize=function(e,t){if(e.name=t.name,e.id=t.id,e.capacity=t.getCapacity(),t.emitter.position){var r=t.emitter;e.emitterId=r.id}else{var i=t.emitter;e.emitter=i.asArray()}t.particleEmitterType&&(e.particleEmitterType=t.particleEmitterType.serialize()),t.particleTexture&&(e.textureName=t.particleTexture.name,e.invertY=t.particleTexture._invertY),e.isLocal=t.isLocal,S.SerializationHelper.AppendSerializedAnimations(t,e),e.beginAnimationOnStart=t.beginAnimationOnStart,e.beginAnimationFrom=t.beginAnimationFrom,e.beginAnimationTo=t.beginAnimationTo,e.beginAnimationLoop=t.beginAnimationLoop,e.startDelay=t.startDelay,e.renderingGroupId=t.renderingGroupId,e.isBillboardBased=t.isBillboardBased,e.billboardMode=t.billboardMode,e.minAngularSpeed=t.minAngularSpeed,e.maxAngularSpeed=t.maxAngularSpeed,e.minSize=t.minSize,e.maxSize=t.maxSize,e.minScaleX=t.minScaleX,e.maxScaleX=t.maxScaleX,e.minScaleY=t.minScaleY,e.maxScaleY=t.maxScaleY,e.minEmitPower=t.minEmitPower,e.maxEmitPower=t.maxEmitPower,e.minLifeTime=t.minLifeTime,e.maxLifeTime=t.maxLifeTime,e.emitRate=t.emitRate,e.gravity=t.gravity.asArray(),e.noiseStrength=t.noiseStrength.asArray(),e.color1=t.color1.asArray(),e.color2=t.color2.asArray(),e.colorDead=t.colorDead.asArray(),e.updateSpeed=t.updateSpeed,e.targetStopDuration=t.targetStopDuration,e.blendMode=t.blendMode,e.preWarmCycles=t.preWarmCycles,e.preWarmStepOffset=t.preWarmStepOffset,e.minInitialRotation=t.minInitialRotation,e.maxInitialRotation=t.maxInitialRotation,e.startSpriteCellID=t.startSpriteCellID,e.endSpriteCellID=t.endSpriteCellID,e.spriteCellChangeSpeed=t.spriteCellChangeSpeed,e.spriteCellWidth=t.spriteCellWidth,e.spriteCellHeight=t.spriteCellHeight,e.spriteRandomStartCell=t.spriteRandomStartCell,e.isAnimationSheetEnabled=t.isAnimationSheetEnabled;var a=t.getColorGradients();if(a){e.colorGradients=[];for(var n=0,s=a;n<s.length;n++){var o=s[n],c={gradient:o.gradient,color1:o.color1.asArray()};o.color2&&(c.color2=o.color2.asArray()),e.colorGradients.push(c)}}var d=t.getRampGradients();if(d){e.rampGradients=[];for(var l=0,h=d;l<h.length;l++){var u=h[l];c={gradient:u.gradient,color:u.color.asArray()};e.rampGradients.push(c)}e.useRampGradients=t.useRampGradients}var p=t.getColorRemapGradients();if(p){e.colorRemapGradients=[];for(var f=0,_=p;f<_.length;f++){var m=_[f];c={gradient:m.gradient,factor1:m.factor1};void 0!==m.factor2&&(c.factor2=m.factor2),e.colorRemapGradients.push(c)}}var g=t.getAlphaRemapGradients();if(g){e.alphaRemapGradients=[];for(var G=0,v=g;G<v.length;G++){var y=v[G];c={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2&&(c.factor2=y.factor2),e.alphaRemapGradients.push(c)}}var x=t.getSizeGradients();if(x){e.sizeGradients=[];for(var E=0,D=x;E<D.length;E++){var b=D[E];c={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2&&(c.factor2=b.factor2),e.sizeGradients.push(c)}}var T=t.getAngularSpeedGradients();if(T){e.angularSpeedGradients=[];for(var R=0,C=T;R<C.length;R++){var P=C[R];c={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2&&(c.factor2=P.factor2),e.angularSpeedGradients.push(c)}}var A=t.getVelocityGradients();if(A){e.velocityGradients=[];for(var B=0,L=A;B<L.length;B++){var z=L[B];c={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2&&(c.factor2=z.factor2),e.velocityGradients.push(c)}}var M=t.getDragGradients();if(M){e.dragGradients=[];for(var I=0,V=M;I<V.length;I++){var F=V[I];c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2&&(c.factor2=F.factor2),e.dragGradients.push(c)}}var O=t.getEmitRateGradients();if(O){e.emitRateGradients=[];for(var w=0,N=O;w<N.length;w++){var W=N[w];c={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2&&(c.factor2=W.factor2),e.emitRateGradients.push(c)}}var H=t.getStartSizeGradients();if(H){e.startSizeGradients=[];for(var k=0,q=H;k<q.length;k++){var Y=q[k];c={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2&&(c.factor2=Y.factor2),e.startSizeGradients.push(c)}}var U=t.getLifeTimeGradients();if(U){e.lifeTimeGradients=[];for(var X=0,j=U;X<j.length;X++){var K=j[X];c={gradient:K.gradient,factor1:K.factor1};void 0!==K.factor2&&(c.factor2=K.factor2),e.lifeTimeGradients.push(c)}}var Z=t.getLimitVelocityGradients();if(Z){e.limitVelocityGradients=[];for(var J=0,Q=Z;J<Q.length;J++){var $=Q[J];c={gradient:$.gradient,factor1:$.factor1};void 0!==$.factor2&&(c.factor2=$.factor2),e.limitVelocityGradients.push(c)}e.limitVelocityDamping=t.limitVelocityDamping}t.noiseTexture&&(e.noiseTexture=t.noiseTexture.serialize())},E._Parse=function(e,t,r,a){if(e.textureName&&(t.particleTexture=new l.Texture(a+e.textureName,r,!1,void 0===e.invertY||e.invertY),t.particleTexture.name=e.textureName),e.emitterId||0===e.emitterId||void 0!==e.emitter?e.emitterId?t.emitter=r.getLastMeshByID(e.emitterId):t.emitter=i.Vector3.FromArray(e.emitter):t.emitter=i.Vector3.Zero(),t.isLocal=!!e.isLocal,void 0!==e.renderingGroupId&&(t.renderingGroupId=e.renderingGroupId),void 0!==e.isBillboardBased&&(t.isBillboardBased=e.isBillboardBased),void 0!==e.billboardMode&&(t.billboardMode=e.billboardMode),e.animations){for(var n=0;n<e.animations.length;n++){var s=e.animations[n],o=y._TypeStore.GetClass("BABYLON.Animation");o&&t.animations.push(o.Parse(s))}t.beginAnimationOnStart=e.beginAnimationOnStart,t.beginAnimationFrom=e.beginAnimationFrom,t.beginAnimationTo=e.beginAnimationTo,t.beginAnimationLoop=e.beginAnimationLoop}if(e.autoAnimate&&r.beginAnimation(t,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),t.startDelay=0|e.startDelay,t.minAngularSpeed=e.minAngularSpeed,t.maxAngularSpeed=e.maxAngularSpeed,t.minSize=e.minSize,t.maxSize=e.maxSize,e.minScaleX&&(t.minScaleX=e.minScaleX,t.maxScaleX=e.maxScaleX,t.minScaleY=e.minScaleY,t.maxScaleY=e.maxScaleY),void 0!==e.preWarmCycles&&(t.preWarmCycles=e.preWarmCycles,t.preWarmStepOffset=e.preWarmStepOffset),void 0!==e.minInitialRotation&&(t.minInitialRotation=e.minInitialRotation,t.maxInitialRotation=e.maxInitialRotation),t.minLifeTime=e.minLifeTime,t.maxLifeTime=e.maxLifeTime,t.minEmitPower=e.minEmitPower,t.maxEmitPower=e.maxEmitPower,t.emitRate=e.emitRate,t.gravity=i.Vector3.FromArray(e.gravity),e.noiseStrength&&(t.noiseStrength=i.Vector3.FromArray(e.noiseStrength)),t.color1=x.Color4.FromArray(e.color1),t.color2=x.Color4.FromArray(e.color2),t.colorDead=x.Color4.FromArray(e.colorDead),t.updateSpeed=e.updateSpeed,t.targetStopDuration=e.targetStopDuration,t.blendMode=e.blendMode,e.colorGradients)for(var c=0,d=e.colorGradients;c<d.length;c++){var h=d[c];t.addColorGradient(h.gradient,x.Color4.FromArray(h.color1),h.color2?x.Color4.FromArray(h.color2):void 0)}if(e.rampGradients){for(var u=0,f=e.rampGradients;u<f.length;u++){var m=f[u];t.addRampGradient(m.gradient,x.Color3.FromArray(m.color))}t.useRampGradients=e.useRampGradients}if(e.colorRemapGradients)for(var g=0,G=e.colorRemapGradients;g<G.length;g++){var S=G[g];t.addColorRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2)}if(e.alphaRemapGradients)for(var v=0,E=e.alphaRemapGradients;v<E.length;v++){var D=E[v];t.addAlphaRemapGradient(D.gradient,void 0!==D.factor1?D.factor1:D.factor,D.factor2)}if(e.sizeGradients)for(var b=0,T=e.sizeGradients;b<T.length;b++){var R=T[b];t.addSizeGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2)}if(e.angularSpeedGradients)for(var C=0,P=e.angularSpeedGradients;C<P.length;C++){var A=P[C];t.addAngularSpeedGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2)}if(e.velocityGradients)for(var B=0,L=e.velocityGradients;B<L.length;B++){var z=L[B];t.addVelocityGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2)}if(e.dragGradients)for(var M=0,I=e.dragGradients;M<I.length;M++){var V=I[M];t.addDragGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2)}if(e.emitRateGradients)for(var F=0,O=e.emitRateGradients;F<O.length;F++){var w=O[F];t.addEmitRateGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2)}if(e.startSizeGradients)for(var N=0,W=e.startSizeGradients;N<W.length;N++){var H=W[N];t.addStartSizeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2)}if(e.lifeTimeGradients)for(var k=0,q=e.lifeTimeGradients;k<q.length;k++){var Y=q[k];t.addLifeTimeGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2)}if(e.limitVelocityGradients){for(var U=0,X=e.limitVelocityGradients;U<X.length;U++){var j=X[U];t.addLimitVelocityGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2)}t.limitVelocityDamping=e.limitVelocityDamping}var K;if(e.noiseTexture&&(t.noiseTexture=p.ProceduralTexture.Parse(e.noiseTexture,r,a)),e.particleEmitterType){switch(e.particleEmitterType.type){case"SphereParticleEmitter":K=new _.SphereParticleEmitter;break;case"SphereDirectedParticleEmitter":K=new _.SphereDirectedParticleEmitter;break;case"ConeEmitter":case"ConeParticleEmitter":K=new _.ConeParticleEmitter;break;case"CylinderParticleEmitter":K=new _.CylinderParticleEmitter;break;case"HemisphericParticleEmitter":K=new _.HemisphericParticleEmitter;break;case"BoxEmitter":case"BoxParticleEmitter":default:K=new _.BoxParticleEmitter}K.parse(e.particleEmitterType,r)}else(K=new _.BoxParticleEmitter).parse(e,r);t.particleEmitterType=K,t.startSpriteCellID=e.startSpriteCellID,t.endSpriteCellID=e.endSpriteCellID,t.spriteCellWidth=e.spriteCellWidth,t.spriteCellHeight=e.spriteCellHeight,t.spriteCellChangeSpeed=e.spriteCellChangeSpeed,t.spriteRandomStartCell=e.spriteRandomStartCell},E.Parse=function(e,t,r,i){void 0===i&&(i=!1);var a=e.name,n=null,s=null;if(e.customShader){var o=(s=e.customShader).shaderOptions.defines.length>0?s.shaderOptions.defines.join("\n"):"";n=t.getEngine().createEffectForParticles(s.shaderPath.fragmentElement,s.shaderOptions.uniforms,s.shaderOptions.samplers,o)}var c=new E(a,e.capacity,t,n,e.isAnimationSheetEnabled);if(c.customShader=s,e.id&&(c.id=e.id),e.subEmitters){c.subEmitters=[];for(var d=0,l=e.subEmitters;d<l.length;d++){for(var h=[],u=0,p=l[d];u<p.length;u++){var f=p[u];h.push(G.SubEmitter.Parse(f,t,r))}c.subEmitters.push(h)}}return E._Parse(e,c,t,r),c.textureMask=x.Color4.FromArray(e.textureMask),e.preventAutoStart&&(c.preventAutoStart=e.preventAutoStart),i||c.preventAutoStart||c.start(),c},E.BILLBOARDMODE_Y=2,E.BILLBOARDMODE_ALL=7,E.BILLBOARDMODE_STRETCHED=8,E}(m.BaseParticleSystem);exports.ParticleSystem=E,G.SubEmitter._ParseParticleSystem=E.Parse;
},{"tslib":"90Cu","../Misc/gradients":"2vpL","../Misc/observable":"vY1+","../Maths/math.vector":"61Nx","../Maths/math.scalar":"TAUa","../Meshes/buffer":"clDe","../Meshes/abstractMesh":"uine","../Materials/material":"zMir","../Materials/materialHelper":"Znij","../Materials/imageProcessingConfiguration":"h2+3","../Materials/Textures/texture":"tMhK","../Materials/Textures/dynamicTexture":"GdtU","../Materials/Textures/rawTexture":"xNGh","../Materials/Textures/Procedurals/proceduralTexture":"T4KU","../Engines/engineStore":"cq+N","../Particles/EmitterTypes/index":"QlDF","./baseParticleSystem":"vY/7","./particle":"ovyB","./subEmitter":"pRe7","../Misc/decorators":"EVXT","../Misc/deepCopier":"qvOT","../Misc/typeStore":"sm8f","../Shaders/particles.fragment":"zL12","../Shaders/particles.vertex":"GYYh","../Maths/math.color":"q3+m"}],"9mLv":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("@babylonjs/core/Maths/math"),i=require("@babylonjs/core/Particles/particleSystem"),e=require("@babylonjs/core/Materials/Textures/texture"),r=function(){function r(t,i){this.direction1={x:0,y:0,z:0},this.direction2={x:0,y:0,z:0},this.maximumParticle=2e3,this.system=t,this.particlekey="naker",this.initDirectionVectors(),this.setParticle(),this.setOptions(i),this.particle.start()}return r.prototype.setParticle=function(e){var r=e||this.maximumParticle,o=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),s=new i.ParticleSystem("particles"+o,r,this.system.scene);s.emitter=t.Vector3.Zero(),s.gravity=new t.Vector3(0,0,0),s.minEmitBox=new t.Vector3(-40,-40,-40),s.maxEmitBox=new t.Vector3(40,40,40),s.minInitialRotation=Math.PI,s.maxInitialRotation=Math.PI,s.maxScaleX=-1,s.minScaleX=-1,s.disposeOnStop=!1,s.blendMode=i.ParticleSystem.BLENDMODE_MULTIPLYADD,s.useRampGradients=!0,s.updateSpeed=1/30,this.initDirectionVectors(),this.particle=s},r.prototype.initDirectionVectors=function(){this.direction1Vector=t.Vector3.Zero(),this.direction2Vector=t.Vector3.Zero()},r.prototype.setOptions=function(t){this._setOptions(t),this.checkParticlePower(t.power)},r.prototype._setOptions=function(t){void 0!==t.life&&this.setLife(t.life),void 0!==t.power&&this.setPower(t.power),void 0!==t.texture&&this.setTexture(t.texture),void 0!==t.number&&this.setNumber(t.number),void 0!==t.colorStart&&this.setColorStart(t.colorStart),void 0!==t.colorEnd&&this.setColorEnd(t.colorEnd),void 0!==t.sizeStart&&this.setSizeStart(t.sizeStart),void 0!==t.sizeEnd&&this.setSizeEnd(t.sizeEnd),void 0!==t.direction1&&this.setDirection1(t.direction1),void 0!==t.direction2&&this.setDirection2(t.direction2)},r.prototype.getOptions=function(){return{life:this.life,power:this.power,texture:this.texture,number:this.number,colorStart:this.colorStart,colorEnd:this.colorEnd,sizeStart:this.sizeStart,sizeEnd:this.sizeEnd,direction1:this.direction1,direction2:this.direction2}},r.prototype.setTexture=function(t){var i=this;if(this.texture=t,t)var r=new e.Texture(t,this.system.scene,!0,!1,e.Texture.NEAREST_SAMPLINGMODE,function(){i.particle.particleTexture=r},function(t){console.log(t)});else this.particle.particleTexture&&this.particle.particleTexture.dispose()},r.prototype.setNumber=function(t){t=Math.min(t,this.maximumParticle),this.number=t,this.particle.emitRate=this.number},r.prototype.setColorStart=function(t){this.colorStart=t,this.setColors()},r.prototype.setColorEnd=function(t){this.colorEnd=t,this.setColors()},r.prototype.setColors=function(){var i=this.colorStart,e=this.colorEnd;if(i&&e){var r=t.Color3.FromInts(i[0],i[1],i[2]),o=t.Color3.FromInts(e[0],e[1],e[2]);this.particle.removeRampGradient(0),this.particle.removeRampGradient(1),this.particle.addRampGradient(0,r),this.particle.addRampGradient(1,o),this.particle.removeColorGradient(0),this.particle.removeColorGradient(.9),this.particle.removeColorGradient(1),this.particle.addColorGradient(0,new t.Color4(1,1,1,i[3])),this.particle.addColorGradient(.9,new t.Color4(1,1,1,e[3])),this.particle.addColorGradient(1,new t.Color4(1,1,1,0))}},r.prototype.setSizeStart=function(t){this.sizeStart=t,this.setSizes()},r.prototype.setSizeEnd=function(t){this.sizeEnd=t,this.setSizes()},r.prototype.setSizes=function(){var t=this.sizeStart,i=this.sizeEnd;t&&i&&(this.particle.removeSizeGradient(0),this.particle.removeSizeGradient(1),this.particle.addSizeGradient(0,t),this.particle.addSizeGradient(1,i))},r.prototype.setPower=function(t){this.power=t,this.particle.minEmitPower=t,this.particle.maxEmitPower=2*t},r.prototype.setLife=function(t){this.life=t,t>=10&&(t=1e29),this.particle.minLifeTime=t,this.particle.maxLifeTime=3*t},r.prototype.resetSystem=function(t){this.particle.dispose(),this.setParticle(t),this._setOptions(this),this.particle.start()},r.prototype.setDirection1=function(t){for(var i in t)this.direction1[i]=t[i],this.direction1Vector[i]=t[i];this.particle.direction1=this.direction1Vector,this.checkPower()},r.prototype.setDirection2=function(t){for(var i in t)this.direction2[i]=t[i],this.direction2Vector[i]=t[i];this.particle.direction2=this.direction2Vector,this.checkPower()},r.prototype.checkParticlePower=function(t){0==t?this.setLife(1e7):0!=t&&0==this.power&&this.setLife(5),this.resetSystem(this.number)},r.prototype.checkPower=function(){var t=this.particle.direction1,i=this.particle.direction2;0!=t.x||0!=t.y||0!=t.z||0!=i.x||0!=i.y||0!=i.z?this.setPower(this.power):(this.particle.minEmitPower=0,this.particle.maxEmitPower=0)},r.prototype.destroy=function(){this.particle.dispose()},r}();exports.Particle=r;
},{"@babylonjs/core/Maths/math":"iyC1","@babylonjs/core/Particles/particleSystem":"3mS/","@babylonjs/core/Materials/Textures/texture":"tMhK"}],"YiV/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RibbonBuilder=void 0;var e=require("../../Maths/math.vector"),t=require("../mesh"),r=require("../buffer"),a=require("../mesh.vertexData"),o=require("../../Culling/boundingInfo");a.VertexData.CreateRibbon=function(e){var t=e.pathArray,o=e.closeArray||!1,n=e.closePath||!1,i=e.invertUV||!1,l=Math.floor(t[0].length/2),s=e.offset||l;s=s>l?l:Math.floor(s);var u,f,h,c,g=0===e.sideOrientation?0:e.sideOrientation||a.VertexData.DEFAULTSIDE,d=e.uvs,v=e.colors,x=[],D=[],V=[],b=[],p=[],_=[],m=[],y=[],A=[],S=[];if(t.length<2){var B=[],C=[];for(h=0;h<t[0].length-s;h++)B.push(t[0][h]),C.push(t[0][h+s]);t=[B,C]}var F,M,P,w,z,I=0,K=n?1:0;for(u=t[0].length,f=0;f<t.length;f++){for(m[f]=0,p[f]=[0],u=u<(M=(F=t[f]).length)?u:M,c=0;c<M;)x.push(F[c].x,F[c].y,F[c].z),c>0&&(P=F[c].subtract(F[c-1]).length()+m[f],p[f].push(P),m[f]=P),c++;n&&(c--,x.push(F[0].x,F[0].y,F[0].z),P=F[c].subtract(F[0]).length()+m[f],p[f].push(P),m[f]=P),A[f]=M+K,S[f]=I,I+=M+K}var O,U,E=null,N=null;for(h=0;h<u+K;h++){for(y[h]=0,_[h]=[0],f=0;f<t.length-1;f++)w=t[f],z=t[f+1],h===u?(E=w[0],N=z[0]):(E=w[h],N=z[h]),P=N.subtract(E).length()+y[h],_[h].push(P),y[h]=P;o&&N&&E&&(w=t[f],z=t[0],h===u&&(N=z[0]),P=N.subtract(E).length()+y[h],y[h]=P)}if(d)for(f=0;f<d.length;f++)b.push(d[f].x,d[f].y);else for(f=0;f<t.length;f++)for(h=0;h<u+K;h++)O=0!=m[f]?p[f][h]/m[f]:0,U=0!=y[h]?_[h][f]/y[h]:0,i?b.push(U,O):b.push(O,U);for(var R=0,q=A[f=0]-1,L=A[f+1]-1,T=q<L?q:L,X=S[1]-S[0],j=o?A.length:A.length-1;R<=T&&f<j;)D.push(R,R+X,R+1),D.push(R+X+1,R+1,R+X),(R+=1)===T&&(++f===A.length-1?(X=S[0]-S[f],q=A[f]-1,L=A[0]-1):(X=S[f+1]-S[f],q=A[f]-1,L=A[f+1]-1),R=S[f],T=q<L?q+R:L+R);if(a.VertexData.ComputeNormals(x,D,V),n){var k=0,G=0;for(f=0;f<t.length;f++)k=3*S[f],G=f+1<t.length?3*(S[f+1]-1):V.length-3,V[k]=.5*(V[k]+V[G]),V[k+1]=.5*(V[k+1]+V[G+1]),V[k+2]=.5*(V[k+2]+V[G+2]),V[G]=V[k],V[G+1]=V[k+1],V[G+2]=V[k+2]}a.VertexData._ComputeSides(g,x,D,V,b,e.frontUVs,e.backUVs);var H=null;if(v){H=new Float32Array(4*v.length);for(var J=0;J<v.length;J++)H[4*J]=v[J].r,H[4*J+1]=v[J].g,H[4*J+2]=v[J].b,H[4*J+3]=v[J].a}var Q=new a.VertexData,W=new Float32Array(x),Y=new Float32Array(V),Z=new Float32Array(b);return Q.indices=D,Q.positions=W,Q.normals=Y,Q.uvs=Z,H&&Q.set(H,r.VertexBuffer.ColorKind),n&&(Q._idx=S),Q},t.Mesh.CreateRibbon=function(e,t,r,a,o,i,l,s,u){return void 0===r&&(r=!1),void 0===l&&(l=!1),n.CreateRibbon(e,{pathArray:t,closeArray:r,closePath:a,offset:o,updatable:l,sideOrientation:s,instance:u},i)};var n=function(){function n(){}return n.CreateRibbon=function(n,i,l){void 0===l&&(l=null);var s=i.pathArray,u=i.closeArray,f=i.closePath,h=t.Mesh._GetDefaultSideOrientation(i.sideOrientation),c=i.instance,g=i.updatable;if(c){var d=e.TmpVectors.Vector3[0].setAll(Number.MAX_VALUE),v=e.TmpVectors.Vector3[1].setAll(-Number.MAX_VALUE),x=c.getVerticesData(r.VertexBuffer.PositionKind);if(function(e){for(var r=s[0].length,a=c,o=0,n=a._originalBuilderSideOrientation===t.Mesh.DOUBLESIDE?2:1,i=1;i<=n;++i)for(var l=0;l<s.length;++l){var u=s[l],f=u.length;r=r<f?r:f;for(var h=0;h<r;++h){var g=u[h];e[o]=g.x,e[o+1]=g.y,e[o+2]=g.z,d.minimizeInPlaceFromFloats(g.x,g.y,g.z),v.maximizeInPlaceFromFloats(g.x,g.y,g.z),o+=3}a._creationDataStorage&&a._creationDataStorage.closePath&&(g=u[0],e[o]=g.x,e[o+1]=g.y,e[o+2]=g.z,o+=3)}}(x),c._boundingInfo?c._boundingInfo.reConstruct(d,v,c._worldMatrix):c._boundingInfo=new o.BoundingInfo(d,v,c._worldMatrix),c.updateVerticesData(r.VertexBuffer.PositionKind,x,!1,!1),i.colors){for(var D=c.getVerticesData(r.VertexBuffer.ColorKind),V=0,b=0;V<i.colors.length;V++,b+=4){var p=i.colors[V];D[b]=p.r,D[b+1]=p.g,D[b+2]=p.b,D[b+3]=p.a}c.updateVerticesData(r.VertexBuffer.ColorKind,D,!1,!1)}if(i.uvs){for(var _=c.getVerticesData(r.VertexBuffer.UVKind),m=0;m<i.uvs.length;m++)_[2*m]=i.uvs[m].x,_[2*m+1]=i.uvs[m].y;c.updateVerticesData(r.VertexBuffer.UVKind,_,!1,!1)}if(!c.areNormalsFrozen||c.isFacetDataEnabled){var y=c.getIndices(),A=c.getVerticesData(r.VertexBuffer.NormalKind),S=c.isFacetDataEnabled?c.getFacetDataParameters():null;if(a.VertexData.ComputeNormals(x,y,A,S),c._creationDataStorage&&c._creationDataStorage.closePath)for(var B=0,C=0,F=0;F<s.length;F++)B=3*c._creationDataStorage.idx[F],C=F+1<s.length?3*(c._creationDataStorage.idx[F+1]-1):A.length-3,A[B]=.5*(A[B]+A[C]),A[B+1]=.5*(A[B+1]+A[C+1]),A[B+2]=.5*(A[B+2]+A[C+2]),A[C]=A[B],A[C+1]=A[B+1],A[C+2]=A[B+2];c.areNormalsFrozen||c.updateVerticesData(r.VertexBuffer.NormalKind,A,!1,!1)}return c}var M=new t.Mesh(n,l);M._originalBuilderSideOrientation=h,M._creationDataStorage=new t._CreationDataStorage;var P=a.VertexData.CreateRibbon(i);return f&&(M._creationDataStorage.idx=P._idx),M._creationDataStorage.closePath=f,M._creationDataStorage.closeArray=u,P.applyToMesh(M,g),M},n}();exports.RibbonBuilder=n;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","../buffer":"clDe","../mesh.vertexData":"1A0K","../../Culling/boundingInfo":"j0r+"}],"2npO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DiscBuilder=void 0;var e=require("../mesh"),r=require("../mesh.vertexData");r.VertexData.CreateDisc=function(e){var t=new Array,a=new Array,i=new Array,s=new Array,n=e.radius||.5,o=e.tessellation||64,u=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,d=0===e.sideOrientation?0:e.sideOrientation||r.VertexData.DEFAULTSIDE;t.push(0,0,0),s.push(.5,.5);for(var c=2*Math.PI*u,l=c/o,p=0;p<c;p+=l){var h=Math.cos(p),D=Math.sin(p),v=(h+1)/2,f=(1-D)/2;t.push(n*h,n*D,0),s.push(v,f)}1===u&&(t.push(t[3],t[4],t[5]),s.push(s[2],s[3]));for(var x=t.length/3,O=1;O<x-1;O++)a.push(O+1,0,O);r.VertexData.ComputeNormals(t,a,i),r.VertexData._ComputeSides(d,t,a,i,s,e.frontUVs,e.backUVs);var M=new r.VertexData;return M.indices=a,M.positions=t,M.normals=i,M.uvs=s,M},e.Mesh.CreateDisc=function(e,r,a,i,s,n){void 0===i&&(i=null);var o={radius:r,tessellation:a,sideOrientation:n,updatable:s};return t.CreateDisc(e,o,i)};var t=function(){function t(){}return t.CreateDisc=function(t,a,i){void 0===i&&(i=null);var s=new e.Mesh(t,i);return a.sideOrientation=e.Mesh._GetDefaultSideOrientation(a.sideOrientation),s._originalBuilderSideOrientation=a.sideOrientation,r.VertexData.CreateDisc(a).applyToMesh(s,a.updatable),s},t}();exports.DiscBuilder=t;
},{"../mesh":"58SX","../mesh.vertexData":"1A0K"}],"FvhN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BoxBuilder=void 0;var e=require("../../Maths/math.vector"),t=require("../../Maths/math.color"),r=require("../mesh"),o=require("../mesh.vertexData");o.VertexData.CreateBox=function(r){var a,i=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],n=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],s=[],u=r.width||r.size||1,p=r.height||r.size||1,d=r.depth||r.size||1,c=r.wrap||!1,f=void 0===r.topBaseAt?1:r.topBaseAt,h=void 0===r.bottomBaseAt?0:r.bottomBaseAt,v=[2,0,3,1][f=(f+4)%4],l=[2,0,1,3][h=(h+4)%4],x=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(c){i=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],x=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var B=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],D=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],O=[17,18,19,16],V=[22,23,20,21];v>0;)B.unshift(B.pop()),O.unshift(O.pop()),v--;for(;l>0;)D.unshift(D.pop()),V.unshift(V.pop()),l--;B=B.flat(),D=D.flat(),x=x.concat(B).concat(D),i.push(O[0],O[2],O[3],O[0],O[1],O[2]),i.push(V[0],V[2],V[3],V[0],V[1],V[2])}var w=[u/2,p/2,d/2];a=x.reduce(function(e,t,r){return e.concat(t*w[r%3])},[]);for(var m=0===r.sideOrientation?0:r.sideOrientation||o.VertexData.DEFAULTSIDE,C=r.faceUV||new Array(6),b=r.faceColors,M=[],z=0;z<6;z++)void 0===C[z]&&(C[z]=new e.Vector4(0,0,1,1)),b&&void 0===b[z]&&(b[z]=new t.Color4(1,1,1,1));for(var A=0;A<6;A++)if(s.push(C[A].z,C[A].w),s.push(C[A].x,C[A].w),s.push(C[A].x,C[A].y),s.push(C[A].z,C[A].y),b)for(var y=0;y<4;y++)M.push(b[A].r,b[A].g,b[A].b,b[A].a);o.VertexData._ComputeSides(m,a,i,n,s,r.frontUVs,r.backUVs);var S=new o.VertexData;if(S.indices=i,S.positions=a,S.normals=n,S.uvs=s,b){var U=m===o.VertexData.DOUBLESIDE?M.concat(M):M;S.colors=U}return S},r.Mesh.CreateBox=function(e,t,r,o,i){void 0===r&&(r=null);var n={size:t,sideOrientation:i,updatable:o};return a.CreateBox(e,n,r)};var a=function(){function e(){}return e.CreateBox=function(e,t,a){void 0===a&&(a=null);var i=new r.Mesh(e,a);return t.sideOrientation=r.Mesh._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,o.VertexData.CreateBox(t).applyToMesh(i,t.updatable),i},e}();exports.BoxBuilder=a;
},{"../../Maths/math.vector":"61Nx","../../Maths/math.color":"q3+m","../mesh":"58SX","../mesh.vertexData":"1A0K"}],"Tf7d":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TiledBoxBuilder=void 0;var t=require("../../Maths/math.vector"),r=require("../../Maths/math.color"),e=require("../mesh"),n=require("../mesh.vertexData");n.VertexData.CreateTiledBox=function(a){for(var o=a.faceUV||new Array(6),i=a.faceColors,c=a.pattern||e.Mesh.NO_FLIP,u=a.width||a.size||1,l=a.height||a.size||1,s=a.depth||a.size||1,f=a.tileWidth||a.tileSize||1,d=a.tileHeight||a.tileSize||1,m=a.alignHorizontal||0,h=a.alignVertical||0,p=0===a.sideOrientation?0:a.sideOrientation||n.VertexData.DEFAULTSIDE,x=0;x<6;x++)void 0===o[x]&&(o[x]=new t.Vector4(0,0,1,1)),i&&void 0===i[x]&&(i[x]=new r.Color4(1,1,1,1));var V=u/2,v=l/2,T=s/2,M=[];for(x=0;x<2;x++)M[x]=n.VertexData.CreateTiledPlane({pattern:c,tileWidth:f,tileHeight:d,width:u,height:l,alignVertical:h,alignHorizontal:m,sideOrientation:p});for(x=2;x<4;x++)M[x]=n.VertexData.CreateTiledPlane({pattern:c,tileWidth:f,tileHeight:d,width:s,height:l,alignVertical:h,alignHorizontal:m,sideOrientation:p});var z=h;h===e.Mesh.BOTTOM?z=e.Mesh.TOP:h===e.Mesh.TOP&&(z=e.Mesh.BOTTOM);for(x=4;x<6;x++)M[x]=n.VertexData.CreateTiledPlane({pattern:c,tileWidth:f,tileHeight:d,width:u,height:s,alignVertical:z,alignHorizontal:m,sideOrientation:p});var g=[],O=[],y=[],w=[],D=[],P=[],B=[],N=[],C=0,H=0,I=0;for(x=0;x<6;x++){C=M[x].positions.length;P[x]=[],B[x]=[];for(var S=0;S<C/3;S++)P[x].push(new t.Vector3(M[x].positions[3*S],M[x].positions[3*S+1],M[x].positions[3*S+2])),B[x].push(new t.Vector3(M[x].normals[3*S],M[x].normals[3*S+1],M[x].normals[3*S+2]));H=M[x].uvs.length,N[x]=[];for(var b=0;b<H;b+=2)N[x][b]=o[x].x+(o[x].z-o[x].x)*M[x].uvs[b],N[x][b+1]=o[x].y+(o[x].w-o[x].y)*M[x].uvs[b+1];if(y=y.concat(N[x]),w=w.concat(M[x].indices.map(function(t){return t+I})),I+=P[x].length,i)for(var _=0;_<4;_++)D.push(i[x].r,i[x].g,i[x].b,i[x].a)}var R=new t.Vector3(0,0,T),q=t.Matrix.RotationY(Math.PI);g=P[0].map(function(r){return t.Vector3.TransformNormal(r,q).add(R)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[]),O=B[0].map(function(r){return t.Vector3.TransformNormal(r,q)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[]),g=g.concat(P[1].map(function(t){return t.subtract(R)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[])),O=O.concat(B[1].map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[]));var E=new t.Vector3(V,0,0),W=t.Matrix.RotationY(-Math.PI/2);g=g.concat(P[2].map(function(r){return t.Vector3.TransformNormal(r,W).add(E)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[])),O=O.concat(B[2].map(function(r){return t.Vector3.TransformNormal(r,W)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[]));var L=t.Matrix.RotationY(Math.PI/2);g=g.concat(P[3].map(function(r){return t.Vector3.TransformNormal(r,L).subtract(E)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[])),O=O.concat(B[3].map(function(r){return t.Vector3.TransformNormal(r,L)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[]));var U=new t.Vector3(0,v,0),Y=t.Matrix.RotationX(Math.PI/2);g=g.concat(P[4].map(function(r){return t.Vector3.TransformNormal(r,Y).add(U)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[])),O=O.concat(B[4].map(function(r){return t.Vector3.TransformNormal(r,Y)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[]));var A=t.Matrix.RotationX(-Math.PI/2);g=g.concat(P[5].map(function(r){return t.Vector3.TransformNormal(r,A).subtract(U)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[])),O=O.concat(B[5].map(function(r){return t.Vector3.TransformNormal(r,A)}).map(function(t){return[t.x,t.y,t.z]}).reduce(function(t,r){return t.concat(r)},[])),n.VertexData._ComputeSides(p,g,w,O,y);var F=new n.VertexData;if(F.indices=w,F.positions=g,F.normals=O,F.uvs=y,i){var X=p===n.VertexData.DOUBLESIDE?D.concat(D):D;F.colors=X}return F};var a=function(){function t(){}return t.CreateTiledBox=function(t,r,a){void 0===a&&(a=null);var o=new e.Mesh(t,a);return r.sideOrientation=e.Mesh._GetDefaultSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,n.VertexData.CreateTiledBox(r).applyToMesh(o,r.updatable),o},t}();exports.TiledBoxBuilder=a;
},{"../../Maths/math.vector":"61Nx","../../Maths/math.color":"q3+m","../mesh":"58SX","../mesh.vertexData":"1A0K"}],"vUoe":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SphereBuilder=void 0;var e=require("../../Maths/math.vector"),r=require("../mesh"),t=require("../mesh.vertexData");t.VertexData.CreateSphere=function(r){for(var a=r.segments||32,i=r.diameterX||r.diameter||1,n=r.diameterY||r.diameter||1,s=r.diameterZ||r.diameter||1,o=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1,u=r.slice&&r.slice<=0?1:r.slice||1,d=0===r.sideOrientation?0:r.sideOrientation||t.VertexData.DEFAULTSIDE,p=new e.Vector3(i/2,n/2,s/2),h=2+a,c=2*h,l=[],m=[],v=[],f=[],x=0;x<=h;x++){for(var S=x/h,V=S*Math.PI*u,M=0;M<=c;M++){var D=M/c,O=D*Math.PI*2*o,C=e.Matrix.RotationZ(-V),y=e.Matrix.RotationY(O),_=e.Vector3.TransformCoordinates(e.Vector3.Up(),C),b=e.Vector3.TransformCoordinates(_,y),g=b.multiply(p),T=b.divide(p).normalize();m.push(g.x,g.y,g.z),v.push(T.x,T.y,T.z),f.push(D,S)}if(x>0)for(var U=m.length/3,q=U-2*(c+1);q+c+2<U;q++)l.push(q),l.push(q+1),l.push(q+c+1),l.push(q+c+1),l.push(q+1),l.push(q+c+2)}t.VertexData._ComputeSides(d,m,l,v,f,r.frontUVs,r.backUVs);var w=new t.VertexData;return w.indices=l,w.positions=m,w.normals=v,w.uvs=f,w},r.Mesh.CreateSphere=function(e,r,t,i,n,s){var o={segments:r,diameterX:t,diameterY:t,diameterZ:t,sideOrientation:s,updatable:n};return a.CreateSphere(e,o,i)};var a=function(){function e(){}return e.CreateSphere=function(e,a,i){void 0===i&&(i=null);var n=new r.Mesh(e,i);return a.sideOrientation=r.Mesh._GetDefaultSideOrientation(a.sideOrientation),n._originalBuilderSideOrientation=a.sideOrientation,t.VertexData.CreateSphere(a).applyToMesh(n,a.updatable),n},e}();exports.SphereBuilder=a;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","../mesh.vertexData":"1A0K"}],"F7uc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CylinderBuilder=void 0;var e=require("../../Maths/math.vector"),r=require("../../Maths/math.color"),t=require("../mesh"),a=require("../mesh.vertexData"),s=require("../../scene"),o=require("../../Maths/math.axis");a.VertexData.CreateCylinder=function(s){var i=s.height||2,n=0===s.diameterTop?0:s.diameterTop||s.diameter||1,h=0===s.diameterBottom?0:s.diameterBottom||s.diameter||1;n=n||1e-5,h=h||1e-5;var u,p=s.tessellation||24,y=s.subdivisions||1,c=!!s.hasRings,d=!!s.enclose,x=0===s.cap?0:s.cap||t.Mesh.CAP_ALL,l=s.arc&&(s.arc<=0||s.arc>1)?1:s.arc||1,v=0===s.sideOrientation?0:s.sideOrientation||a.VertexData.DEFAULTSIDE,f=s.faceUV||new Array(3),z=s.faceColors,m=2+(1+(1!==l&&d?2:0))*(c?y:1);for(u=0;u<m;u++)z&&void 0===z[u]&&(z[u]=new r.Color4(1,1,1,1));for(u=0;u<m;u++)f&&void 0===f[u]&&(f[u]=new e.Vector4(0,0,1,1));var w,C,M,V,A,g,b=new Array,D=new Array,T=new Array,_=new Array,O=new Array,L=2*Math.PI*l/p,P=(h-n)/2/i,q=e.Vector3.Zero(),S=e.Vector3.Zero(),B=e.Vector3.Zero(),E=e.Vector3.Zero(),U=e.Vector3.Zero(),Z=o.Axis.Y,F=1,I=1,R=0,j=0;for(V=0;V<=y;V++)for(M=((C=V/y)*(n-h)+h)/2,F=c&&0!==V&&V!==y?2:1,g=0;g<F;g++){for(c&&(I+=g),d&&(I+=2*g),A=0;A<=p;A++)w=A*L,q.x=Math.cos(-w)*M,q.y=-i/2+C*i,q.z=Math.sin(-w)*M,0===n&&V===y?(S.x=T[T.length-3*(p+1)],S.y=T[T.length-3*(p+1)+1],S.z=T[T.length-3*(p+1)+2]):(S.x=q.x,S.z=q.z,S.y=Math.sqrt(S.x*S.x+S.z*S.z)*P,S.normalize()),0===A&&(B.copyFrom(q),E.copyFrom(S)),D.push(q.x,q.y,q.z),T.push(S.x,S.y,S.z),j=c?R!==I?f[I].y:f[I].w:f[I].y+(f[I].w-f[I].y)*C,_.push(f[I].x+(f[I].z-f[I].x)*A/p,j),z&&O.push(z[I].r,z[I].g,z[I].b,z[I].a);1!==l&&d&&(D.push(q.x,q.y,q.z),D.push(0,q.y,0),D.push(0,q.y,0),D.push(B.x,B.y,B.z),e.Vector3.CrossToRef(Z,S,U),U.normalize(),T.push(U.x,U.y,U.z,U.x,U.y,U.z),e.Vector3.CrossToRef(E,Z,U),U.normalize(),T.push(U.x,U.y,U.z,U.x,U.y,U.z),j=c?R!==I?f[I+1].y:f[I+1].w:f[I+1].y+(f[I+1].w-f[I+1].y)*C,_.push(f[I+1].x,j),_.push(f[I+1].z,j),j=c?R!==I?f[I+2].y:f[I+2].w:f[I+2].y+(f[I+2].w-f[I+2].y)*C,_.push(f[I+2].x,j),_.push(f[I+2].z,j),z&&(O.push(z[I+1].r,z[I+1].g,z[I+1].b,z[I+1].a),O.push(z[I+1].r,z[I+1].g,z[I+1].b,z[I+1].a),O.push(z[I+2].r,z[I+2].g,z[I+2].b,z[I+2].a),O.push(z[I+2].r,z[I+2].g,z[I+2].b,z[I+2].a))),R!==I&&(R=I)}var k=1!==l&&d?p+4:p;for(V=0,I=0;I<y;I++){var G=0,N=0,Y=0,H=0;for(A=0;A<p;A++)G=V*(k+1)+A,N=(V+1)*(k+1)+A,Y=V*(k+1)+(A+1),H=(V+1)*(k+1)+(A+1),b.push(G,N,Y),b.push(H,Y,N);1!==l&&d&&(b.push(G+2,N+2,Y+2),b.push(H+2,Y+2,N+2),b.push(G+4,N+4,Y+4),b.push(H+4,Y+4,N+4)),V=c?V+2:V+1}var J=function(r){var t=r?n/2:h/2;if(0!==t){var a,s,o,u=r?f[m-1]:f[0],y=null;z&&(y=r?z[m-1]:z[0]);var c=D.length/3,d=r?i/2:-i/2,x=new e.Vector3(0,d,0);D.push(x.x,x.y,x.z),T.push(0,r?1:-1,0),_.push(u.x+.5*(u.z-u.x),u.y+.5*(u.w-u.y)),y&&O.push(y.r,y.g,y.b,y.a);var v=new e.Vector2(.5,.5);for(o=0;o<=p;o++){a=2*Math.PI*o*l/p;var w=Math.cos(-a),C=Math.sin(-a);s=new e.Vector3(w*t,d,C*t);var M=new e.Vector2(w*v.x+.5,C*v.y+.5);D.push(s.x,s.y,s.z),T.push(0,r?1:-1,0),_.push(u.x+(u.z-u.x)*M.x,u.y+(u.w-u.y)*M.y),y&&O.push(y.r,y.g,y.b,y.a)}for(o=0;o<p;o++)r?(b.push(c),b.push(c+(o+2)),b.push(c+(o+1))):(b.push(c),b.push(c+(o+1)),b.push(c+(o+2)))}};x!==t.Mesh.CAP_START&&x!==t.Mesh.CAP_ALL||J(!1),x!==t.Mesh.CAP_END&&x!==t.Mesh.CAP_ALL||J(!0),a.VertexData._ComputeSides(v,D,b,T,_,s.frontUVs,s.backUVs);var K=new a.VertexData;return K.indices=b,K.positions=D,K.normals=T,K.uvs=_,z&&(K.colors=O),K},t.Mesh.CreateCylinder=function(e,r,a,o,n,h,u,p,y){void 0!==u&&u instanceof s.Scene||(void 0!==u&&(y=p||t.Mesh.DEFAULTSIDE,p=u),u=h,h=1);var c={height:r,diameterTop:a,diameterBottom:o,tessellation:n,subdivisions:h,sideOrientation:y,updatable:p};return i.CreateCylinder(e,c,u)};var i=function(){function e(){}return e.CreateCylinder=function(e,r,s){var o=new t.Mesh(e,s);return r.sideOrientation=t.Mesh._GetDefaultSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,a.VertexData.CreateCylinder(r).applyToMesh(o,r.updatable),o},e}();exports.CylinderBuilder=i;
},{"../../Maths/math.vector":"61Nx","../../Maths/math.color":"q3+m","../mesh":"58SX","../mesh.vertexData":"1A0K","../../scene":"TiFm","../../Maths/math.axis":"LzVa"}],"xveZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TorusBuilder=void 0;var e=require("../../Maths/math.vector"),t=require("../mesh"),r=require("../mesh.vertexData");r.VertexData.CreateTorus=function(t){for(var a=[],i=[],s=[],n=[],o=t.diameter||1,u=t.thickness||.5,h=t.tessellation||16,d=0===t.sideOrientation?0:t.sideOrientation||r.VertexData.DEFAULTSIDE,l=h+1,p=0;p<=h;p++)for(var c=p/h,v=p*Math.PI*2/h-Math.PI/2,x=e.Matrix.Translation(o/2,0,0).multiply(e.Matrix.RotationY(v)),M=0;M<=h;M++){var f=1-M/h,T=M*Math.PI*2/h+Math.PI,m=Math.cos(T),V=Math.sin(T),D=new e.Vector3(m,V,0),O=D.scale(u/2),C=new e.Vector2(c,f);O=e.Vector3.TransformCoordinates(O,x),D=e.Vector3.TransformNormal(D,x),i.push(O.x,O.y,O.z),s.push(D.x,D.y,D.z),n.push(C.x,C.y);var y=(p+1)%l,I=(M+1)%l;a.push(p*l+M),a.push(p*l+I),a.push(y*l+M),a.push(p*l+I),a.push(y*l+I),a.push(y*l+M)}r.VertexData._ComputeSides(d,i,a,s,n,t.frontUVs,t.backUVs);var P=new r.VertexData;return P.indices=a,P.positions=i,P.normals=s,P.uvs=n,P},t.Mesh.CreateTorus=function(e,t,r,i,s,n,o){var u={diameter:t,thickness:r,tessellation:i,sideOrientation:o,updatable:n};return a.CreateTorus(e,u,s)};var a=function(){function e(){}return e.CreateTorus=function(e,a,i){var s=new t.Mesh(e,i);return a.sideOrientation=t.Mesh._GetDefaultSideOrientation(a.sideOrientation),s._originalBuilderSideOrientation=a.sideOrientation,r.VertexData.CreateTorus(a).applyToMesh(s,a.updatable),s},e}();exports.TorusBuilder=a;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","../mesh.vertexData":"1A0K"}],"dSzl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TorusKnotBuilder=void 0;var e=require("../../Maths/math.vector"),r=require("../mesh"),t=require("../mesh.vertexData");t.VertexData.CreateTorusKnot=function(r){var a,s,n=new Array,o=new Array,i=new Array,u=new Array,h=r.radius||2,d=r.tube||.5,p=r.radialSegments||32,c=r.tubularSegments||32,l=r.p||2,v=r.q||3,M=0===r.sideOrientation?0:r.sideOrientation||t.VertexData.DEFAULTSIDE,f=function(r){var t=Math.cos(r),a=Math.sin(r),s=v/l*r,n=Math.cos(s),o=h*(2+n)*.5*t,i=h*(2+n)*a*.5,u=h*Math.sin(s)*.5;return new e.Vector3(o,i,u)};for(a=0;a<=p;a++){var m=a%p/p*2*l*Math.PI,x=f(m),V=f(m+.01),D=V.subtract(x),b=V.add(x),y=e.Vector3.Cross(D,b);for(b=e.Vector3.Cross(y,D),y.normalize(),b.normalize(),s=0;s<c;s++){var C=s%c/c*2*Math.PI,O=-d*Math.cos(C),T=d*Math.sin(C);o.push(x.x+O*b.x+T*y.x),o.push(x.y+O*b.y+T*y.y),o.push(x.z+O*b.z+T*y.z),u.push(a/p),u.push(s/c)}}for(a=0;a<p;a++)for(s=0;s<c;s++){var S=(s+1)%c,w=a*c+s,K=(a+1)*c+s,g=(a+1)*c+S,q=a*c+S;n.push(q),n.push(K),n.push(w),n.push(q),n.push(g),n.push(K)}t.VertexData.ComputeNormals(o,n,i),t.VertexData._ComputeSides(M,o,n,i,u,r.frontUVs,r.backUVs);var z=new t.VertexData;return z.indices=n,z.positions=o,z.normals=i,z.uvs=u,z},r.Mesh.CreateTorusKnot=function(e,r,t,s,n,o,i,u,h,d){var p={radius:r,tube:t,radialSegments:s,tubularSegments:n,p:o,q:i,sideOrientation:d,updatable:h};return a.CreateTorusKnot(e,p,u)};var a=function(){function e(){}return e.CreateTorusKnot=function(e,a,s){var n=new r.Mesh(e,s);return a.sideOrientation=r.Mesh._GetDefaultSideOrientation(a.sideOrientation),n._originalBuilderSideOrientation=a.sideOrientation,t.VertexData.CreateTorusKnot(a).applyToMesh(n,a.updatable),n},e}();exports.TorusKnotBuilder=a;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","../mesh.vertexData":"1A0K"}],"dfs9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstancedMesh=void 0;var e=require("tslib"),t=require("../Maths/math.vector"),r=require("../Misc/logger"),s=require("../Meshes/abstractMesh"),n=require("../Meshes/mesh"),i=require("../Misc/deepCopier"),o=require("./transformNode"),a=require("./buffer");n.Mesh._instancedMeshFactory=function(e,t){var r=new u(e,t);if(t.instancedBuffers)for(var s in r.instancedBuffers={},t.instancedBuffers)r.instancedBuffers[s]=t.instancedBuffers[s];return r};var u=function(s){function n(e,t){var r=s.call(this,e,t.getScene())||this;r._indexInSourceMeshInstanceArray=-1,t.addInstance(r),r._sourceMesh=t,r._unIndexed=t._unIndexed,r.position.copyFrom(t.position),r.rotation.copyFrom(t.rotation),r.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(r.rotationQuaternion=t.rotationQuaternion.clone()),r.animations=t.animations;for(var n=0,i=t.getAnimationRanges();n<i.length;n++){var o=i[n];null!=o&&r.createAnimationRange(o.name,o.from,o.to)}return r.infiniteDistance=t.infiniteDistance,r.setPivotMatrix(t.getPivotMatrix()),r.refreshBoundingInfo(),r._syncSubMeshes(),r}return(0,e.__extends)(n,s),n.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(n.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),n.prototype._resyncLightSources=function(){},n.prototype._resyncLightSource=function(e){},n.prototype._removeLightSource=function(e,t){},Object.defineProperty(n.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&r.Logger.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),n.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},n.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(n.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),n.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},n.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},n.prototype.setVerticesData=function(e,t,r,s){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,r,s),this.sourceMesh},n.prototype.updateVerticesData=function(e,t,r,s){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,r,s),this.sourceMesh},n.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},n.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},n.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(n.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),n.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e),t),this},n.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},n.prototype._activate=function(e,t){if(this._sourceMesh.subMeshes||r.Logger.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>0!=this._getWorldMatrixDeterminant()>0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},n.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},n.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==o.TransformNode.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,t.TmpVectors.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),t.TmpVectors.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(t.TmpVectors.Vector3[7]),this._currentLOD._masterMesh=e,t.TmpVectors.Matrix[0]}return s.prototype.getWorldMatrix.call(this)},Object.defineProperty(n.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},n.prototype._preActivateForIntermediateRendering=function(e){return this.sourceMesh._preActivateForIntermediateRendering(e)},n.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},n.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},n.prototype.clone=function(e,t,r){void 0===t&&(t=null);var s=this._sourceMesh.createInstance(e);if(i.DeepCopier.DeepCopy(this,s,["name","subMeshes","uniqueId","parent"],[]),this.refreshBoundingInfo(),t&&(s.parent=t),!r)for(var n=0;n<this.getScene().meshes.length;n++){var o=this.getScene().meshes[n];o.parent===this&&o.clone(o.name,s)}return s.computeWorldMatrix(!0),s},n.prototype.dispose=function(e,t){void 0===t&&(t=!1),this._sourceMesh.removeInstance(this),s.prototype.dispose.call(this,e,t)},n}(s.AbstractMesh);exports.InstancedMesh=u,n.Mesh.prototype.registerInstancedBuffer=function(e,t){if(this.removeVerticesData(e),!this.instancedBuffers){this.instancedBuffers={};for(var r=0,s=this.instances;r<s.length;r++){s[r].instancedBuffers={}}this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new a.VertexBuffer(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[e]);for(var n=0,i=this.instances;n<i.length;n++){i[n].instancedBuffers[e]=null}},n.Mesh.prototype._processInstancedBuffers=function(e,t){var r=e.length;for(var s in this.instancedBuffers){for(var n=this._userInstancedBuffersStorage.sizes[s],i=this._userInstancedBuffersStorage.strides[s],o=(r+1)*i;n<o;)n*=2;this._userInstancedBuffersStorage.data[s].length!=n&&(this._userInstancedBuffersStorage.data[s]=new Float32Array(n),this._userInstancedBuffersStorage.sizes[s]=n,this._userInstancedBuffersStorage.vertexBuffers[s]&&(this._userInstancedBuffersStorage.vertexBuffers[s].dispose(),this._userInstancedBuffersStorage.vertexBuffers[s]=null));var u=this._userInstancedBuffersStorage.data[s],c=0;if(t)c+=i,(f=this.instancedBuffers[s]).toArray?f.toArray(u,c):f.copyToArray(u,c);for(var h=0;h<r;h++){var f;(f=e[h].instancedBuffers[s]).toArray?f.toArray(u,c):f.copyToArray(u,c),c+=i}this._userInstancedBuffersStorage.vertexBuffers[s]?this._userInstancedBuffersStorage.vertexBuffers[s].updateDirectly(u,0):(this._userInstancedBuffersStorage.vertexBuffers[s]=new a.VertexBuffer(this.getEngine(),this._userInstancedBuffersStorage.data[s],s,!0,!1,i,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[s]))}},n.Mesh.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this.instancedBuffers={}};
},{"tslib":"90Cu","../Maths/math.vector":"61Nx","../Misc/logger":"Yh4i","../Meshes/abstractMesh":"uine","../Meshes/mesh":"58SX","../Misc/deepCopier":"qvOT","./transformNode":"03YA","./buffer":"clDe"}],"hVli":[function(require,module,exports) {
var define;
var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EffectFallbacks=void 0;var n=function(){function e(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return e.prototype.unBindMesh=function(){this._mesh=null},e.prototype.addFallback=function(e,n){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(n)},e.prototype.addCPUSkinningFallback=function(e,n){this._mesh=n,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(e.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),e.prototype.reduce=function(e,n){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),n._bonesComputationForcedToCPU=!0;for(var s=this._mesh.getScene(),t=0;t<s.meshes.length;t++){var i=s.meshes[t];if(i.material){if(i.computeBonesUsingShaders&&0!==i.numBoneInfluencers)if(i.material.getEffect()===n)i.computeBonesUsingShaders=!1;else if(i.subMeshes)for(var r=0,a=i.subMeshes;r<a.length;r++){if(a[r].effect===n){i.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&i.computeBonesUsingShaders&&i.numBoneInfluencers>0&&(i.computeBonesUsingShaders=!1)}}else{var h=this._defines[this._currentRank];if(h)for(t=0;t<h.length;t++)e=e.replace("#define "+h[t],"");this._currentRank++}return e},e}();exports.EffectFallbacks=n;
},{}],"7h8p":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderMaterial=void 0;var t=require("tslib"),r=require("../Misc/decorators"),e=require("../Maths/math.vector"),s=require("../Meshes/buffer"),i=require("../Materials/Textures/texture"),o=require("./materialHelper"),a=require("./material"),n=require("../Misc/typeStore"),h=require("../Maths/math.color"),c=require("./effectFallbacks"),f=function(a){function n(r,s,i,o){void 0===o&&(o={});var n=a.call(this,r,s)||this;return n._textures={},n._textureArrays={},n._floats={},n._ints={},n._floatsArrays={},n._colors3={},n._colors3Arrays={},n._colors4={},n._colors4Arrays={},n._vectors2={},n._vectors3={},n._vectors4={},n._matrices={},n._matrixArrays={},n._matrices3x3={},n._matrices2x2={},n._vectors2Arrays={},n._vectors3Arrays={},n._vectors4Arrays={},n._cachedWorldViewMatrix=new e.Matrix,n._cachedWorldViewProjectionMatrix=new e.Matrix,n._multiview=!1,n._shaderPath=i,n._options=(0,t.__assign)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},o),n}return(0,t.__extends)(n,a),Object.defineProperty(n.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(t){this._shaderPath=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),n.prototype.getClassName=function(){return"ShaderMaterial"},n.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},n.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},n.prototype._checkUniform=function(t){-1===this._options.uniforms.indexOf(t)&&this._options.uniforms.push(t)},n.prototype.setTexture=function(t,r){return-1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._textures[t]=r,this},n.prototype.setTextureArray=function(t,r){return-1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._checkUniform(t),this._textureArrays[t]=r,this},n.prototype.setFloat=function(t,r){return this._checkUniform(t),this._floats[t]=r,this},n.prototype.setInt=function(t,r){return this._checkUniform(t),this._ints[t]=r,this},n.prototype.setFloats=function(t,r){return this._checkUniform(t),this._floatsArrays[t]=r,this},n.prototype.setColor3=function(t,r){return this._checkUniform(t),this._colors3[t]=r,this},n.prototype.setColor3Array=function(t,r){return this._checkUniform(t),this._colors3Arrays[t]=r.reduce(function(t,r){return r.toArray(t,t.length),t},[]),this},n.prototype.setColor4=function(t,r){return this._checkUniform(t),this._colors4[t]=r,this},n.prototype.setColor4Array=function(t,r){return this._checkUniform(t),this._colors4Arrays[t]=r.reduce(function(t,r){return r.toArray(t,t.length),t},[]),this},n.prototype.setVector2=function(t,r){return this._checkUniform(t),this._vectors2[t]=r,this},n.prototype.setVector3=function(t,r){return this._checkUniform(t),this._vectors3[t]=r,this},n.prototype.setVector4=function(t,r){return this._checkUniform(t),this._vectors4[t]=r,this},n.prototype.setMatrix=function(t,r){return this._checkUniform(t),this._matrices[t]=r,this},n.prototype.setMatrices=function(t,r){this._checkUniform(t);for(var e=new Float32Array(16*r.length),s=0;s<r.length;s++){r[s].copyToArray(e,16*s)}return this._matrixArrays[t]=e,this},n.prototype.setMatrix3x3=function(t,r){return this._checkUniform(t),this._matrices3x3[t]=r,this},n.prototype.setMatrix2x2=function(t,r){return this._checkUniform(t),this._matrices2x2[t]=r,this},n.prototype.setArray2=function(t,r){return this._checkUniform(t),this._vectors2Arrays[t]=r,this},n.prototype.setArray3=function(t,r){return this._checkUniform(t),this._vectors3Arrays[t]=r,this},n.prototype.setArray4=function(t,r){return this._checkUniform(t),this._vectors4Arrays[t]=r,this},n.prototype._checkCache=function(t,r){return!t||(!this._effect||-1!==this._effect.defines.indexOf("#define INSTANCES")===r)},n.prototype.isReadyForSubMesh=function(t,r,e){return this.isReady(t,e)},n.prototype.isReady=function(t,r){if(this._effect&&this.isFrozen&&this._effect._wasPreviouslyReady)return!0;var e=this.getScene(),i=e.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===e.getRenderId()&&this._checkCache(t,r))return!0;var a=[],n=[],h=new c.EffectFallbacks;i.getCaps().multiview&&e.activeCamera&&e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,a.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.push("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var f=0;f<this._options.defines.length;f++)a.push(this._options.defines[f]);for(f=0;f<this._options.attributes.length;f++)n.push(this._options.attributes[f]);if(t&&t.isVerticesDataPresent(s.VertexBuffer.ColorKind)&&(n.push(s.VertexBuffer.ColorKind),a.push("#define VERTEXCOLOR")),r&&(a.push("#define INSTANCES"),o.MaterialHelper.PushAttributesForInstances(n)),t&&t.useBones&&t.computeBonesUsingShaders&&t.skeleton){n.push(s.VertexBuffer.MatricesIndicesKind),n.push(s.VertexBuffer.MatricesWeightsKind),t.numBoneInfluencers>4&&(n.push(s.VertexBuffer.MatricesIndicesExtraKind),n.push(s.VertexBuffer.MatricesWeightsExtraKind));var _=t.skeleton;a.push("#define NUM_BONE_INFLUENCERS "+t.numBoneInfluencers),h.addCPUSkinningFallback(0,t),_.isUsingTextureForMatrices?(a.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(a.push("#define BonesPerMesh "+(_.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else a.push("#define NUM_BONE_INFLUENCERS 0");for(var u in this._textures)if(!this._textures[u].isReady())return!1;t&&this._shouldTurnAlphaTestOn(t)&&a.push("#define ALPHATEST");var l=this._effect,p=a.join("\n");return this._effect=i.createEffect(this._shaderPath,{attributes:n,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:p,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError},i),!!this._effect.isReady()&&(l!==this._effect&&e.resetCachedMaterial(),this._renderId=e.getRenderId(),this._effect._wasPreviouslyReady=!0,!0)},n.prototype.bindOnlyWorldMatrix=function(t){var r=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",t),-1!==this._options.uniforms.indexOf("worldView")&&(t.multiplyToRef(r.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(t.multiplyToRef(r.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),this._effect.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},n.prototype.bind=function(t,r){if(this.bindOnlyWorldMatrix(t),this._effect&&this.getScene().getCachedMaterial()!==this){var e;for(e in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&(this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&this._effect.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&this._effect.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),o.MaterialHelper.BindBonesParameters(r,this._effect),this._textures)this._effect.setTexture(e,this._textures[e]);for(e in this._textureArrays)this._effect.setTextureArray(e,this._textureArrays[e]);for(e in this._ints)this._effect.setInt(e,this._ints[e]);for(e in this._floats)this._effect.setFloat(e,this._floats[e]);for(e in this._floatsArrays)this._effect.setArray(e,this._floatsArrays[e]);for(e in this._colors3)this._effect.setColor3(e,this._colors3[e]);for(e in this._colors3Arrays)this._effect.setArray3(e,this._colors3Arrays[e]);for(e in this._colors4){var s=this._colors4[e];this._effect.setFloat4(e,s.r,s.g,s.b,s.a)}for(e in this._colors4Arrays)this._effect.setArray4(e,this._colors4Arrays[e]);for(e in this._vectors2)this._effect.setVector2(e,this._vectors2[e]);for(e in this._vectors3)this._effect.setVector3(e,this._vectors3[e]);for(e in this._vectors4)this._effect.setVector4(e,this._vectors4[e]);for(e in this._matrices)this._effect.setMatrix(e,this._matrices[e]);for(e in this._matrixArrays)this._effect.setMatrices(e,this._matrixArrays[e]);for(e in this._matrices3x3)this._effect.setMatrix3x3(e,this._matrices3x3[e]);for(e in this._matrices2x2)this._effect.setMatrix2x2(e,this._matrices2x2[e]);for(e in this._vectors2Arrays)this._effect.setArray2(e,this._vectors2Arrays[e]);for(e in this._vectors3Arrays)this._effect.setArray3(e,this._vectors3Arrays[e]);for(e in this._vectors4Arrays)this._effect.setArray4(e,this._vectors4Arrays[e])}this._afterBind(r)},n.prototype.getActiveTextures=function(){var t=a.prototype.getActiveTextures.call(this);for(var r in this._textures)t.push(this._textures[r]);for(var r in this._textureArrays)for(var e=this._textureArrays[r],s=0;s<e.length;s++)t.push(e[s]);return t},n.prototype.hasTexture=function(t){if(a.prototype.hasTexture.call(this,t))return!0;for(var r in this._textures)if(this._textures[r]===t)return!0;for(var r in this._textureArrays)for(var e=this._textureArrays[r],s=0;s<e.length;s++)if(e[s]===t)return!0;return!1},n.prototype.clone=function(e){var s=this,i=r.SerializationHelper.Clone(function(){return new n(e,s.getScene(),s._shaderPath,s._options)},this);for(var o in i.name=e,i.id=e,"object"==typeof i._shaderPath&&(i._shaderPath=(0,t.__assign)({},i._shaderPath)),this._options=(0,t.__assign)({},this._options),Object.keys(this._options).forEach(function(t){var r=s._options[t];Array.isArray(r)&&(s._options[t]=r.slice(0))}),this._textures)i.setTexture(o,this._textures[o]);for(var o in this._floats)i.setFloat(o,this._floats[o]);for(var o in this._floatsArrays)i.setFloats(o,this._floatsArrays[o]);for(var o in this._colors3)i.setColor3(o,this._colors3[o]);for(var o in this._colors4)i.setColor4(o,this._colors4[o]);for(var o in this._vectors2)i.setVector2(o,this._vectors2[o]);for(var o in this._vectors3)i.setVector3(o,this._vectors3[o]);for(var o in this._vectors4)i.setVector4(o,this._vectors4[o]);for(var o in this._matrices)i.setMatrix(o,this._matrices[o]);for(var o in this._matrices3x3)i.setMatrix3x3(o,this._matrices3x3[o]);for(var o in this._matrices2x2)i.setMatrix2x2(o,this._matrices2x2[o]);return i},n.prototype.dispose=function(t,r,e){if(r){var s;for(s in this._textures)this._textures[s].dispose();for(s in this._textureArrays)for(var i=this._textureArrays[s],o=0;o<i.length;o++)i[o].dispose()}this._textures={},a.prototype.dispose.call(this,t,r,e)},n.prototype.serialize=function(){var t,e=r.SerializationHelper.Serialize(this);for(t in e.customType="BABYLON.ShaderMaterial",e.options=this._options,e.shaderPath=this._shaderPath,e.textures={},this._textures)e.textures[t]=this._textures[t].serialize();for(t in e.textureArrays={},this._textureArrays){e.textureArrays[t]=[];for(var s=this._textureArrays[t],i=0;i<s.length;i++)e.textureArrays[t].push(s[i].serialize())}for(t in e.floats={},this._floats)e.floats[t]=this._floats[t];for(t in e.FloatArrays={},this._floatsArrays)e.FloatArrays[t]=this._floatsArrays[t];for(t in e.colors3={},this._colors3)e.colors3[t]=this._colors3[t].asArray();for(t in e.colors3Arrays={},this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];for(t in e.colors4={},this._colors4)e.colors4[t]=this._colors4[t].asArray();for(t in e.colors4Arrays={},this._colors4Arrays)e.colors4Arrays[t]=this._colors4Arrays[t];for(t in e.vectors2={},this._vectors2)e.vectors2[t]=this._vectors2[t].asArray();for(t in e.vectors3={},this._vectors3)e.vectors3[t]=this._vectors3[t].asArray();for(t in e.vectors4={},this._vectors4)e.vectors4[t]=this._vectors4[t].asArray();for(t in e.matrices={},this._matrices)e.matrices[t]=this._matrices[t].asArray();for(t in e.matrixArray={},this._matrixArrays)e.matrixArray[t]=this._matrixArrays[t];for(t in e.matrices3x3={},this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];for(t in e.matrices2x2={},this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];for(t in e.vectors2Arrays={},this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in e.vectors3Arrays={},this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];for(t in e.vectors4Arrays={},this._vectors4Arrays)e.vectors4Arrays[t]=this._vectors4Arrays[t];return e},n.Parse=function(t,s,o){var a,c=r.SerializationHelper.Parse(function(){return new n(t.name,s,t.shaderPath,t.options)},t,s,o);for(a in t.textures)c.setTexture(a,i.Texture.Parse(t.textures[a],s,o));for(a in t.textureArrays){for(var f=t.textureArrays[a],_=new Array,u=0;u<f.length;u++)_.push(i.Texture.Parse(f[u],s,o));c.setTextureArray(a,_)}for(a in t.floats)c.setFloat(a,t.floats[a]);for(a in t.floatsArrays)c.setFloats(a,t.floatsArrays[a]);for(a in t.colors3)c.setColor3(a,h.Color3.FromArray(t.colors3[a]));for(a in t.colors3Arrays){var l=t.colors3Arrays[a].reduce(function(t,r,e){return e%3==0?t.push([r]):t[t.length-1].push(r),t},[]).map(function(t){return h.Color3.FromArray(t)});c.setColor3Array(a,l)}for(a in t.colors4)c.setColor4(a,h.Color4.FromArray(t.colors4[a]));for(a in t.colors4Arrays){l=t.colors4Arrays[a].reduce(function(t,r,e){return e%4==0?t.push([r]):t[t.length-1].push(r),t},[]).map(function(t){return h.Color4.FromArray(t)});c.setColor4Array(a,l)}for(a in t.vectors2)c.setVector2(a,e.Vector2.FromArray(t.vectors2[a]));for(a in t.vectors3)c.setVector3(a,e.Vector3.FromArray(t.vectors3[a]));for(a in t.vectors4)c.setVector4(a,e.Vector4.FromArray(t.vectors4[a]));for(a in t.matrices)c.setMatrix(a,e.Matrix.FromArray(t.matrices[a]));for(a in t.matrixArray)c._matrixArrays[a]=new Float32Array(t.matrixArray[a]);for(a in t.matrices3x3)c.setMatrix3x3(a,t.matrices3x3[a]);for(a in t.matrices2x2)c.setMatrix2x2(a,t.matrices2x2[a]);for(a in t.vectors2Arrays)c.setArray2(a,t.vectors2Arrays[a]);for(a in t.vectors3Arrays)c.setArray3(a,t.vectors3Arrays[a]);for(a in t.vectors4Arrays)c.setArray4(a,t.vectors4Arrays[a]);return c},n}(a.Material);exports.ShaderMaterial=f,n._TypeStore.RegisteredTypes["BABYLON.ShaderMaterial"]=f;
},{"tslib":"90Cu","../Misc/decorators":"EVXT","../Maths/math.vector":"61Nx","../Meshes/buffer":"clDe","../Materials/Textures/texture":"tMhK","./materialHelper":"Znij","./material":"zMir","../Misc/typeStore":"sm8f","../Maths/math.color":"q3+m","./effectFallbacks":"hVli"}],"v1qu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.colorPixelShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/clipPlaneFragmentDeclaration"),require("./ShadersInclude/clipPlaneFragment");var r="colorPixelShader",n="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}";e.Effect.ShadersStore[r]=n;var l={name:r,shader:n};exports.colorPixelShader=l;
},{"../Materials/effect":"P0sJ","./ShadersInclude/clipPlaneFragmentDeclaration":"8jHv","./ShadersInclude/clipPlaneFragment":"XNhN"}],"aTh0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bonesDeclaration=void 0;var e=require("../../Materials/effect"),t="bonesDeclaration",n="#if NUM_BONE_INFLUENCERS>0\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifdef BONETEXTURE\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index*4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif";e.Effect.IncludesShadersStore[t]=n;var r={name:t,shader:n};exports.bonesDeclaration=r;
},{"../../Materials/effect":"P0sJ"}],"D/SH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.instancesDeclaration=void 0;var e=require("../../Materials/effect"),t="instancesDeclaration",r="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif";e.Effect.IncludesShadersStore[t]=r;var a={name:t,shader:r};exports.instancesDeclaration=a;
},{"../../Materials/effect":"P0sJ"}],"suJa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.instancesVertex=void 0;var e=require("../../Materials/effect"),r="instancesVertex",t="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif";e.Effect.IncludesShadersStore[r]=t;var s={name:r,shader:t};exports.instancesVertex=s;
},{"../../Materials/effect":"P0sJ"}],"asWS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bonesVertex=void 0;var e=require("../../Materials/effect"),n="bonesVertex",i="#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif";e.Effect.IncludesShadersStore[n]=i;var r={name:n,shader:i};exports.bonesVertex=r;
},{"../../Materials/effect":"P0sJ"}],"qY+K":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.colorVertexShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/bonesDeclaration"),require("./ShadersInclude/clipPlaneVertexDeclaration"),require("./ShadersInclude/instancesDeclaration"),require("./ShadersInclude/instancesVertex"),require("./ShadersInclude/bonesVertex"),require("./ShadersInclude/clipPlaneVertex");var n="colorVertexShader",r="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<clipPlaneVertexDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}";e.Effect.ShadersStore[n]=r;var i={name:n,shader:r};exports.colorVertexShader=i;
},{"../Materials/effect":"P0sJ","./ShadersInclude/bonesDeclaration":"aTh0","./ShadersInclude/clipPlaneVertexDeclaration":"nbz1","./ShadersInclude/instancesDeclaration":"D/SH","./ShadersInclude/instancesVertex":"suJa","./ShadersInclude/bonesVertex":"asWS","./ShadersInclude/clipPlaneVertex":"BIQH"}],"b2me":[function(require,module,exports) {
var define;
var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstancedLinesMesh=exports.LinesMesh=void 0;var r=require("tslib"),t=require("../Maths/math.color"),i=require("../Meshes/buffer"),n=require("../Meshes/mesh"),o=require("../Meshes/instancedMesh"),s=require("../Materials/material"),l=require("../Materials/shaderMaterial"),a=require("../Materials/materialHelper");require("../Shaders/color.fragment"),require("../Shaders/color.vertex");var h=function(e){function n(r,n,o,s,a,h,d){void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null);var p=e.call(this,r,n,o,s,a)||this;p.useVertexColor=h,p.useVertexAlpha=d,p.color=new t.Color3(1,1,1),p.alpha=1,s&&(p.color=s.color.clone(),p.alpha=s.alpha,p.useVertexColor=s.useVertexColor,p.useVertexAlpha=s.useVertexAlpha),p.intersectionThreshold=.1;var c={attributes:[i.VertexBuffer.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===d&&(c.needAlphaBlending=!1),h?(c.defines.push("#define VERTEXCOLOR"),c.attributes.push(i.VertexBuffer.ColorKind)):(c.uniforms.push("color"),p.color4=new t.Color4),p._colorShader=new l.ShaderMaterial("colorShader",p.getScene(),"color",c),p}return(0,r.__extends)(n,e),n.prototype._addClipPlaneDefine=function(e){var r="#define "+e;-1===this._colorShader.options.defines.indexOf(r)&&this._colorShader.options.defines.push(r)},n.prototype._removeClipPlaneDefine=function(e){var r="#define "+e,t=this._colorShader.options.defines.indexOf(r);-1!==t&&this._colorShader.options.defines.splice(t,1)},n.prototype.isReady=function(){var r=this.getScene();return r.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),r.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),r.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),r.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),r.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),r.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady()&&e.prototype.isReady.call(this)},n.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(n.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),n.prototype._bind=function(e,r,t){if(!this._geometry)return this;var i=this._colorShader.getEffect(),n=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._geometry._bind(i,n),!this.useVertexColor){var o=this.color,s=o.r,l=o.g,h=o.b;this.color4.set(s,l,h,this.alpha),this._colorShader.setColor4("color",this.color4)}return a.MaterialHelper.BindClipPlane(i,this.getScene()),this},n.prototype._draw=function(e,r,t){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var i=this.getScene().getEngine();return this._unIndexed?i.drawArraysType(s.Material.LineListDrawMode,e.verticesStart,e.verticesCount,t):i.drawElementsType(s.Material.LineListDrawMode,e.indexStart,e.indexCount,t),this},n.prototype.dispose=function(r){this._colorShader.dispose(!1,!1,!0),e.prototype.dispose.call(this,r)},n.prototype.clone=function(e,r,t){return void 0===r&&(r=null),new n(e,this.getScene(),r,this,t)},n.prototype.createInstance=function(e){return new d(e,this)},n}(n.Mesh);exports.LinesMesh=h;var d=function(e){function t(r,t){var i=e.call(this,r,t)||this;return i.intersectionThreshold=t.intersectionThreshold,i}return(0,r.__extends)(t,e),t.prototype.getClassName=function(){return"InstancedLinesMesh"},t}(o.InstancedMesh);exports.InstancedLinesMesh=d;
},{"tslib":"90Cu","../Maths/math.color":"q3+m","../Meshes/buffer":"clDe","../Meshes/mesh":"58SX","../Meshes/instancedMesh":"dfs9","../Materials/material":"zMir","../Materials/shaderMaterial":"7h8p","../Materials/materialHelper":"Znij","../Shaders/color.fragment":"v1qu","../Shaders/color.vertex":"qY+K"}],"VoGx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LinesBuilder=void 0;var e=require("../../Maths/math.vector"),t=require("../mesh"),r=require("../mesh.vertexData"),a=require("../../Meshes/linesMesh"),n=require("../../Meshes/buffer");r.VertexData.CreateLineSystem=function(e){for(var t=[],a=[],n=e.lines,i=e.colors,s=[],o=0,u=0;u<n.length;u++)for(var l=n[u],h=0;h<l.length;h++){if(a.push(l[h].x,l[h].y,l[h].z),i){var d=i[u];s.push(d[h].r,d[h].g,d[h].b,d[h].a)}h>0&&(t.push(o-1),t.push(o)),o++}var c=new r.VertexData;return c.indices=t,c.positions=a,i&&(c.colors=s),c},r.VertexData.CreateDashedLines=function(t){var a,n,i=t.dashSize||3,s=t.gapSize||1,o=t.dashNb||200,u=t.points,l=new Array,h=new Array,d=e.Vector3.Zero(),c=0,f=0,p=0,v=0,g=0;for(g=0;g<u.length-1;g++)u[g+1].subtractToRef(u[g],d),c+=d.length();for(n=i*(a=c/o)/(i+s),g=0;g<u.length-1;g++){u[g+1].subtractToRef(u[g],d),f=Math.floor(d.length()/a),d.normalize();for(var x=0;x<f;x++)p=a*x,l.push(u[g].x+p*d.x,u[g].y+p*d.y,u[g].z+p*d.z),l.push(u[g].x+(p+n)*d.x,u[g].y+(p+n)*d.y,u[g].z+(p+n)*d.z),h.push(v,v+1),v+=2}var z=new r.VertexData;return z.positions=l,z.indices=h,z},t.Mesh.CreateLines=function(e,t,r,a,n){void 0===r&&(r=null),void 0===a&&(a=!1),void 0===n&&(n=null);var s={points:t,updatable:a,instance:n};return i.CreateLines(e,s,r)},t.Mesh.CreateDashedLines=function(e,t,r,a,n,s,o,u){void 0===s&&(s=null);var l={points:t,dashSize:r,gapSize:a,dashNb:n,updatable:o,instance:u};return i.CreateDashedLines(e,l,s)};var i=function(){function i(){}return i.CreateLineSystem=function(e,t,i){var s=t.instance,o=t.lines,u=t.colors;if(s){var l,h,d=s.getVerticesData(n.VertexBuffer.PositionKind);u&&(l=s.getVerticesData(n.VertexBuffer.ColorKind));for(var c=0,f=0,p=0;p<o.length;p++)for(var v=o[p],g=0;g<v.length;g++)d[c]=v[g].x,d[c+1]=v[g].y,d[c+2]=v[g].z,u&&l&&(h=u[p],l[f]=h[g].r,l[f+1]=h[g].g,l[f+2]=h[g].b,l[f+3]=h[g].a,f+=4),c+=3;return s.updateVerticesData(n.VertexBuffer.PositionKind,d,!1,!1),u&&l&&s.updateVerticesData(n.VertexBuffer.ColorKind,l,!1,!1),s}var x=!!u,z=new a.LinesMesh(e,i,null,void 0,void 0,x,t.useVertexAlpha);return r.VertexData.CreateLineSystem(t).applyToMesh(z,t.updatable),z},i.CreateLines=function(e,t,r){void 0===r&&(r=null);var a=t.colors?[t.colors]:null;return i.CreateLineSystem(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:a,useVertexAlpha:t.useVertexAlpha},r)},i.CreateDashedLines=function(n,i,s){void 0===s&&(s=null);var o=i.points,u=i.instance,l=i.gapSize||1,h=i.dashSize||3;if(u){return u.updateMeshPositions(function(t){var r,a,n=e.Vector3.Zero(),i=t.length/6,s=0,l=0,h=0,d=0,c=0,f=0;for(c=0;c<o.length-1;c++)o[c+1].subtractToRef(o[c],n),s+=n.length();r=s/i;var p=u._creationDataStorage.dashSize;for(a=p*r/(p+u._creationDataStorage.gapSize),c=0;c<o.length-1;c++)for(o[c+1].subtractToRef(o[c],n),l=Math.floor(n.length()/r),n.normalize(),f=0;f<l&&d<t.length;)h=r*f,t[d]=o[c].x+h*n.x,t[d+1]=o[c].y+h*n.y,t[d+2]=o[c].z+h*n.z,t[d+3]=o[c].x+(h+a)*n.x,t[d+4]=o[c].y+(h+a)*n.y,t[d+5]=o[c].z+(h+a)*n.z,d+=6,f++;for(;d<t.length;)t[d]=o[c].x,t[d+1]=o[c].y,t[d+2]=o[c].z,d+=3},!1),u}var d=new a.LinesMesh(n,s,null,void 0,void 0,void 0,i.useVertexAlpha);return r.VertexData.CreateDashedLines(i).applyToMesh(d,i.updatable),d._creationDataStorage=new t._CreationDataStorage,d._creationDataStorage.dashSize=h,d._creationDataStorage.gapSize=l,d},i}();exports.LinesBuilder=i;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","../mesh.vertexData":"1A0K","../../Meshes/linesMesh":"b2me","../../Meshes/buffer":"clDe"}],"od06":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PolygonMeshBuilder=exports.Polygon=void 0;var e=require("tslib"),t=require("../Misc/logger"),n=require("../Maths/math.vector"),s=require("../Meshes/buffer"),i=require("../Meshes/mesh"),r=require("../Meshes/mesh.vertexData"),o=require("../Engines/engine"),h=require("../Maths/math.path"),u=function(t){function n(e,n){var s=t.call(this,e.x,e.y)||this;return s.index=n,s}return(0,e.__extends)(n,t),n}(n.Vector2),a=function(){function e(){this.elements=new Array}return e.prototype.add=function(e){var t=this,n=new Array;return e.forEach(function(e){if(0===n.length||!e.equalsWithEpsilon(n[0])){var s=new u(e,t.elements.length);n.push(s),t.elements.push(s)}}),n},e.prototype.computeBounds=function(){var e=new n.Vector2(this.elements[0].x,this.elements[0].y),t=new n.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(n){n.x<e.x?e.x=n.x:n.x>t.x&&(t.x=n.x),n.y<e.y?e.y=n.y:n.y>t.y&&(t.y=n.y)}),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}},e}(),p=function(){function e(){}return e.Rectangle=function(e,t,s,i){return[new n.Vector2(e,t),new n.Vector2(s,t),new n.Vector2(s,i),new n.Vector2(e,i)]},e.Circle=function(e,t,s,i){void 0===t&&(t=0),void 0===s&&(s=0),void 0===i&&(i=32);for(var r=new Array,o=0,h=2*Math.PI/i,u=0;u<i;u++)r.push(new n.Vector2(t+Math.cos(o)*e,s+Math.sin(o)*e)),o-=h;return r},e.Parse=function(e){var t,s=e.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),i=[];for(t=0;t<(2147483646&s.length);t+=2)i.push(new n.Vector2(s[t],s[t+1]));return i},e.StartingAt=function(e,t){return h.Path2.StartingAt(e,t)},e}();exports.Polygon=p;var c=function(){function e(e,n,s,i){var r;void 0===i&&(i=earcut),this._points=new a,this._outlinepoints=new a,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=i,this._name=e,this._scene=s||o.Engine.LastCreatedScene,r=n instanceof h.Path2?n.getPoints():n,this._addToepoint(r),this._points.add(r),this._outlinepoints.add(r),void 0===this.bjsEarcut&&t.Logger.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(e){for(var t=0,n=e;t<n.length;t++){var s=n[t];this._epoints.push(s.x,s.y)}},e.prototype.addHole=function(e){this._points.add(e);var t=new a;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},e.prototype.build=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=0);var n=new i.Mesh(this._name,this._scene),r=this.buildVertexData(t);return n.setVerticesData(s.VertexBuffer.PositionKind,r.positions,e),n.setVerticesData(s.VertexBuffer.NormalKind,r.normals,e),n.setVerticesData(s.VertexBuffer.UVKind,r.uvs,e),n.setIndices(r.indices),n},e.prototype.buildVertexData=function(e){var t=this;void 0===e&&(e=0);var n=new r.VertexData,s=new Array,i=new Array,o=new Array,h=this._points.computeBounds();this._points.elements.forEach(function(e){s.push(0,1,0),i.push(e.x,0,e.y),o.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});for(var u=new Array,a=this.bjsEarcut(this._epoints,this._eholes,2),p=0;p<a.length;p++)u.push(a[p]);if(e>0){var c=i.length/3;this._points.elements.forEach(function(t){s.push(0,-1,0),i.push(t.x,-e,t.y),o.push(1-(t.x-h.min.x)/h.width,1-(t.y-h.min.y)/h.height)});var l=u.length;for(p=0;p<l;p+=3){var d=u[p+0],y=u[p+1],f=u[p+2];u.push(f+c),u.push(y+c),u.push(d+c)}this.addSide(i,s,o,u,h,this._outlinepoints,e,!1),this._holes.forEach(function(n){t.addSide(i,s,o,u,h,n,e,!0)})}return n.indices=u,n.positions=i,n.normals=s,n.uvs=o,n},e.prototype.addSide=function(e,t,s,i,r,o,h,u){for(var a=e.length/3,p=0,c=0;c<o.elements.length;c++){var l,d=o.elements[c];l=c+1>o.elements.length-1?o.elements[0]:o.elements[c+1],e.push(d.x,0,d.y),e.push(d.x,-h,d.y),e.push(l.x,0,l.y),e.push(l.x,-h,l.y);var y=new n.Vector3(d.x,0,d.y),f=new n.Vector3(l.x,0,l.y).subtract(y),x=new n.Vector3(0,1,0),v=n.Vector3.Cross(f,x);v=v.normalize(),s.push(p/r.width,0),s.push(p/r.width,1),p+=f.length(),s.push(p/r.width,0),s.push(p/r.width,1),u?(t.push(v.x,v.y,v.z),t.push(v.x,v.y,v.z),t.push(v.x,v.y,v.z),t.push(v.x,v.y,v.z),i.push(a),i.push(a+2),i.push(a+1),i.push(a+1),i.push(a+2),i.push(a+3)):(t.push(-v.x,-v.y,-v.z),t.push(-v.x,-v.y,-v.z),t.push(-v.x,-v.y,-v.z),t.push(-v.x,-v.y,-v.z),i.push(a),i.push(a+1),i.push(a+2),i.push(a+1),i.push(a+3),i.push(a+2)),a+=4}},e}();exports.PolygonMeshBuilder=c;
},{"tslib":"90Cu","../Misc/logger":"Yh4i","../Maths/math.vector":"61Nx","../Meshes/buffer":"clDe","../Meshes/mesh":"58SX","../Meshes/mesh.vertexData":"1A0K","../Engines/engine":"L3af","../Maths/math.path":"sSbP"}],"/SZI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PolygonBuilder=void 0;var e=require("../../Maths/math.vector"),r=require("../../Maths/math.color"),t=require("../mesh"),o=require("../mesh.vertexData"),a=require("../polygonMesh"),n=require("../../Meshes/buffer"),i=require("../../Engines/engineStore");o.VertexData.CreatePolygon=function(t,a,i,s,u,l){for(var d=i||new Array(3),h=s,c=[],g=0;g<3;g++)void 0===d[g]&&(d[g]=new e.Vector4(0,0,1,1)),h&&void 0===h[g]&&(h[g]=new r.Color4(1,1,1,1));for(var f=t.getVerticesData(n.VertexBuffer.PositionKind),v=t.getVerticesData(n.VertexBuffer.NormalKind),p=t.getVerticesData(n.VertexBuffer.UVKind),x=t.getIndices(),V=0,y=0,P=0;P<v.length;P+=3)Math.abs(v[P+1])<.001&&(y=1),Math.abs(v[P+1]-1)<.001&&(y=0),Math.abs(v[P+1]+1)<.001&&(y=2),p[2*(V=P/3)]=(1-p[2*V])*d[y].x+p[2*V]*d[y].z,p[2*V+1]=(1-p[2*V+1])*d[y].y+p[2*V+1]*d[y].w,h&&c.push(h[y].r,h[y].g,h[y].b,h[y].a);o.VertexData._ComputeSides(a,f,x,v,p,u,l);var M=new o.VertexData;if(M.indices=x,M.positions=f,M.normals=v,M.uvs=p,h){var b=a===o.VertexData.DOUBLESIDE?c.concat(c):c;M.colors=b}return M},t.Mesh.CreatePolygon=function(e,r,t,o,a,n,i){void 0===i&&(i=earcut);var u={shape:r,holes:o,updatable:a,sideOrientation:n};return s.CreatePolygon(e,u,t,i)},t.Mesh.ExtrudePolygon=function(e,r,t,o,a,n,i,u){void 0===u&&(u=earcut);var l={shape:r,holes:a,depth:t,updatable:n,sideOrientation:i};return s.ExtrudePolygon(e,l,o,u)};var s=function(){function r(){}return r.CreatePolygon=function(r,n,s,u){void 0===s&&(s=null),void 0===u&&(u=earcut),n.sideOrientation=t.Mesh._GetDefaultSideOrientation(n.sideOrientation);for(var l=n.shape,d=n.holes||[],h=n.depth||0,c=[],g=[],f=0;f<l.length;f++)c[f]=new e.Vector2(l[f].x,l[f].z);c[0].equalsWithEpsilon(c[c.length-1],1e-8)&&c.pop();for(var v=new a.PolygonMeshBuilder(r,c,s||i.EngineStore.LastCreatedScene,u),p=0;p<d.length;p++){g=[];for(var x=0;x<d[p].length;x++)g.push(new e.Vector2(d[p][x].x,d[p][x].z));v.addHole(g)}var V=v.build(n.updatable,h);return V._originalBuilderSideOrientation=n.sideOrientation,o.VertexData.CreatePolygon(V,n.sideOrientation,n.faceUV,n.faceColors,n.frontUVs,n.backUVs).applyToMesh(V,n.updatable),V},r.ExtrudePolygon=function(e,t,o,a){return void 0===o&&(o=null),void 0===a&&(a=earcut),r.CreatePolygon(e,t,o,a)},r}();exports.PolygonBuilder=s;
},{"../../Maths/math.vector":"61Nx","../../Maths/math.color":"q3+m","../mesh":"58SX","../mesh.vertexData":"1A0K","../polygonMesh":"od06","../../Meshes/buffer":"clDe","../../Engines/engineStore":"cq+N"}],"EIVm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShapeBuilder=void 0;var e=require("../../Maths/math.vector"),a=require("../mesh"),t=require("./ribbonBuilder"),r=require("../../Maths/math.path");a.Mesh.ExtrudeShape=function(e,t,r,o,i,u,s,l,c,h){void 0===s&&(s=null);var p={shape:t,path:r,scale:o,rotation:i,cap:0===u?0:u||a.Mesh.NO_CAP,sideOrientation:c,instance:h,updatable:l};return n.ExtrudeShape(e,p,s)},a.Mesh.ExtrudeShapeCustom=function(e,t,r,o,i,u,s,l,c,h,p,d){var b={shape:t,path:r,scaleFunction:o,rotationFunction:i,ribbonCloseArray:u,ribbonClosePath:s,cap:0===l?0:l||a.Mesh.NO_CAP,sideOrientation:p,instance:d,updatable:h};return n.ExtrudeShapeCustom(e,b,c)};var n=function(){function n(){}return n.ExtrudeShape=function(e,t,r){void 0===r&&(r=null);var o=t.path,i=t.shape,u=t.scale||1,s=t.rotation||0,l=0===t.cap?0:t.cap||a.Mesh.NO_CAP,c=t.updatable,h=a.Mesh._GetDefaultSideOrientation(t.sideOrientation),p=t.instance||null,d=t.invertUV||!1;return n._ExtrudeShapeGeneric(e,i,o,u,s,null,null,!1,!1,l,!1,r,!!c,h,p,d,t.frontUVs||null,t.backUVs||null)},n.ExtrudeShapeCustom=function(e,t,r){void 0===r&&(r=null);var o=t.path,i=t.shape,u=t.scaleFunction||function(){return 1},s=t.rotationFunction||function(){return 0},l=t.ribbonCloseArray||!1,c=t.ribbonClosePath||!1,h=0===t.cap?0:t.cap||a.Mesh.NO_CAP,p=t.updatable,d=a.Mesh._GetDefaultSideOrientation(t.sideOrientation),b=t.instance,f=t.invertUV||!1;return n._ExtrudeShapeGeneric(e,i,o,null,null,u,s,l,c,h,!0,r,!!p,d,b||null,f,t.frontUVs||null,t.backUVs||null)},n._ExtrudeShapeGeneric=function(n,o,i,u,s,l,c,h,p,d,b,f,v,A,_,C,M,P){var S,x,g=function(t,r,n,o,i,u,s,l,c,h){for(var p=n.getTangents(),d=n.getNormals(),b=n.getBinormals(),f=n.getDistances(),v=0,A=h&&l?l:function(){return null!==u?u:0},_=h&&s?s:function(){return null!==i?i:1},C=c===a.Mesh.NO_CAP||c===a.Mesh.CAP_END?0:2,M=e.TmpVectors.Matrix[0],P=0;P<r.length;P++){for(var S=new Array,x=A(P,f[P]),g=_(P,f[P]),O=0;O<t.length;O++){e.Matrix.RotationAxisToRef(p[P],v,M);var D=p[P].scale(t[O].z).add(d[P].scale(t[O].x)).add(b[P].scale(t[O].y)),V=S[O]?S[O]:e.Vector3.Zero();e.Vector3.TransformCoordinatesToRef(D,M,V),V.scaleInPlace(g).addInPlace(r[P]),S[O]=V}o[C]=S,v+=x,C++}var y=function(a){var t,r=Array(),n=e.Vector3.Zero();for(t=0;t<a.length;t++)n.addInPlace(a[t]);for(n.scaleInPlace(1/a.length),t=0;t<a.length;t++)r.push(n);return r};switch(c){case a.Mesh.NO_CAP:break;case a.Mesh.CAP_START:o[0]=y(o[2]),o[1]=o[2];break;case a.Mesh.CAP_END:o[C]=o[C-1],o[C+1]=y(o[C-1]);break;case a.Mesh.CAP_ALL:o[0]=y(o[2]),o[1]=o[2],o[C]=o[C-1],o[C+1]=y(o[C-1])}return o};if(_){var O=_._creationDataStorage;return S=O.path3D.update(i),x=g(o,i,O.path3D,O.pathArray,u,s,l,c,O.cap,b),_=a.Mesh.CreateRibbon("",x,!1,!1,0,f||void 0,!1,0,_)}x=g(o,i,S=new r.Path3D(i),new Array,u,s,l,c,d=d<0||d>3?0:d,b);var D=t.RibbonBuilder.CreateRibbon(n,{pathArray:x,closeArray:h,closePath:p,updatable:v,sideOrientation:A,invertUV:C,frontUVs:M||void 0,backUVs:P||void 0},f);return D._creationDataStorage.pathArray=x,D._creationDataStorage.path3D=S,D._creationDataStorage.cap=d,D},n}();exports.ShapeBuilder=n;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","./ribbonBuilder":"YiV/","../../Maths/math.path":"sSbP"}],"uwVH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LatheBuilder=void 0;var e=require("../../Maths/math.vector"),t=require("../mesh"),r=require("./ribbonBuilder");t.Mesh.CreateLathe=function(e,t,r,n,s,i,o){var h={shape:t,radius:r,tessellation:n,sideOrientation:o,updatable:i};return a.CreateLathe(e,h,s)};var a=function(){function a(){}return a.CreateLathe=function(a,n,s){void 0===s&&(s=null);var i,o=n.arc?n.arc<=0||n.arc>1?1:n.arc:1,h=void 0===n.closed||n.closed,u=n.shape,c=n.radius||1,l=n.tessellation||64,d=n.clip||0,p=n.updatable,M=t.Mesh._GetDefaultSideOrientation(n.sideOrientation),b=n.cap||t.Mesh.NO_CAP,A=2*Math.PI,v=new Array,V=n.invertUV||!1,f=0,y=0,x=A/l*o,C=new Array;for(f=0;f<=l-d;f++){C=[];for(b!=t.Mesh.CAP_START&&b!=t.Mesh.CAP_ALL||(C.push(new e.Vector3(0,u[0].y,0)),C.push(new e.Vector3(Math.cos(f*x)*u[0].x*c,u[0].y,Math.sin(f*x)*u[0].x*c))),y=0;y<u.length;y++)i=new e.Vector3(Math.cos(f*x)*u[y].x*c,u[y].y,Math.sin(f*x)*u[y].x*c),C.push(i);b!=t.Mesh.CAP_END&&b!=t.Mesh.CAP_ALL||(C.push(new e.Vector3(Math.cos(f*x)*u[u.length-1].x*c,u[u.length-1].y,Math.sin(f*x)*u[u.length-1].x*c)),C.push(new e.Vector3(0,u[u.length-1].y,0))),v.push(C)}return r.RibbonBuilder.CreateRibbon(a,{pathArray:v,closeArray:h,sideOrientation:M,updatable:p,invertUV:V,frontUVs:n.frontUVs,backUVs:n.backUVs},s)},a}();exports.LatheBuilder=a;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","./ribbonBuilder":"YiV/"}],"SjtZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PlaneBuilder=void 0;var e=require("../mesh"),t=require("../mesh.vertexData");t.VertexData.CreatePlane=function(e){var a=[],r=[],i=[],n=[],s=e.width||e.size||1,u=e.height||e.size||1,o=0===e.sideOrientation?0:e.sideOrientation||t.VertexData.DEFAULTSIDE,h=s/2,l=u/2;r.push(-h,-l,0),i.push(0,0,-1),n.push(0,0),r.push(h,-l,0),i.push(0,0,-1),n.push(1,0),r.push(h,l,0),i.push(0,0,-1),n.push(1,1),r.push(-h,l,0),i.push(0,0,-1),n.push(0,1),a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),t.VertexData._ComputeSides(o,r,a,i,n,e.frontUVs,e.backUVs);var p=new t.VertexData;return p.indices=a,p.positions=r,p.normals=i,p.uvs=n,p},e.Mesh.CreatePlane=function(e,t,r,i,n){var s={size:t,width:t,height:t,sideOrientation:n,updatable:i};return a.CreatePlane(e,s,r)};var a=function(){function a(){}return a.CreatePlane=function(a,r,i){void 0===i&&(i=null);var n=new e.Mesh(a,i);return r.sideOrientation=e.Mesh._GetDefaultSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,t.VertexData.CreatePlane(r).applyToMesh(n,r.updatable),r.sourcePlane&&(n.translate(r.sourcePlane.normal,-r.sourcePlane.d),n.setDirection(r.sourcePlane.normal.scale(-1))),n},a}();exports.PlaneBuilder=a;
},{"../mesh":"58SX","../mesh.vertexData":"1A0K"}],"O6ai":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TiledPlaneBuilder=void 0;var e=require("../mesh"),s=require("../mesh.vertexData");s.VertexData.CreateTiledPlane=function(h){var T=h.pattern||e.Mesh.NO_FLIP,_=h.tileWidth||h.tileSize||1,O=h.tileHeight||h.tileSize||1,E=h.alignHorizontal||0,M=h.alignVertical||0,R=h.width||h.size||1,I=Math.floor(R/_),L=R-I*_,a=h.height||h.size||1,t=Math.floor(a/O),u=a-t*O,p=_*I/2,i=O*t/2,r=0,n=0,P=0,o=0,c=0,F=0;if(L>0||u>0){P=-p,o=-i;c=p,F=i;switch(E){case e.Mesh.CENTER:P-=L/=2,c+=L;break;case e.Mesh.LEFT:c+=L,r=-L/2;break;case e.Mesh.RIGHT:P-=L,r=L/2}switch(M){case e.Mesh.CENTER:o-=u/=2,F+=u;break;case e.Mesh.BOTTOM:F+=u,n=-u/2;break;case e.Mesh.TOP:o-=u,n=u/2}}var A=[],W=[],N=[];N[0]=[0,0,1,0,1,1,0,1],N[1]=[0,0,1,0,1,1,0,1],T!==e.Mesh.ROTATE_TILE&&T!==e.Mesh.ROTATE_ROW||(N[1]=[1,1,0,1,0,0,1,0]),T!==e.Mesh.FLIP_TILE&&T!==e.Mesh.FLIP_ROW||(N[1]=[1,0,0,0,0,1,1,1]),T!==e.Mesh.FLIP_N_ROTATE_TILE&&T!==e.Mesh.FLIP_N_ROTATE_ROW||(N[1]=[0,1,1,1,1,0,0,0]);for(var l=[],d=[],f=[],v=0,D=0;D<t;D++)for(var x=0;x<I;x++)A.push(x*_-p+r,D*O-i+n,0),A.push((x+1)*_-p+r,D*O-i+n,0),A.push((x+1)*_-p+r,(D+1)*O-i+n,0),A.push(x*_-p+r,(D+1)*O-i+n,0),f.push(v,v+1,v+3,v+1,v+2,v+3),l=T===e.Mesh.FLIP_TILE||T===e.Mesh.ROTATE_TILE||T===e.Mesh.FLIP_N_ROTATE_TILE?l.concat(N[(x%2+D%2)%2]):T===e.Mesh.FLIP_ROW||T===e.Mesh.ROTATE_ROW||T===e.Mesh.FLIP_N_ROTATE_ROW?l.concat(N[D%2]):l.concat(N[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),v+=4;if(L>0||u>0){var C,V,b,S,B=u>0&&(M===e.Mesh.CENTER||M===e.Mesh.TOP),g=u>0&&(M===e.Mesh.CENTER||M===e.Mesh.BOTTOM),k=L>0&&(E===e.Mesh.CENTER||E===e.Mesh.RIGHT),w=L>0&&(E===e.Mesh.CENTER||E===e.Mesh.LEFT),z=[];if(B&&k&&(A.push(P+r,o+n,0),A.push(-p+r,o+n,0),A.push(-p+r,o+u+n,0),A.push(P+r,o+u+n,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,z=[C=1-L/_,V=1-u/O,b=1,V,b,S=1,C,S],T===e.Mesh.ROTATE_ROW&&(z=[1-C,1-V,1-b,1-V,1-b,1-S,1-C,1-S]),T===e.Mesh.FLIP_ROW&&(z=[1-C,V,1-b,V,1-b,S,1-C,S]),T===e.Mesh.FLIP_N_ROTATE_ROW&&(z=[C,1-V,b,1-V,b,1-S,C,1-S]),l=l.concat(z),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&w&&(A.push(p+r,o+n,0),A.push(c+r,o+n,0),A.push(c+r,o+u+n,0),A.push(p+r,o+u+n,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,z=[C=0,V=1-u/O,b=L/_,V,b,S=1,C,S],(T===e.Mesh.ROTATE_ROW||T===e.Mesh.ROTATE_TILE&&I%2==0)&&(z=[1-C,1-V,1-b,1-V,1-b,1-S,1-C,1-S]),(T===e.Mesh.FLIP_ROW||T===e.Mesh.FLIP_TILE&&I%2==0)&&(z=[1-C,V,1-b,V,1-b,S,1-C,S]),(T===e.Mesh.FLIP_N_ROTATE_ROW||T===e.Mesh.FLIP_N_ROTATE_TILE&&I%2==0)&&(z=[C,1-V,b,1-V,b,1-S,C,1-S]),l=l.concat(z),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&k&&(A.push(P+r,i+n,0),A.push(-p+r,i+n,0),A.push(-p+r,F+n,0),A.push(P+r,F+n,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,z=[C=1-L/_,V=0,b=1,V,b,S=u/O,C,S],(T===e.Mesh.ROTATE_ROW&&t%2==1||T===e.Mesh.ROTATE_TILE&&t%1==0)&&(z=[1-C,1-V,1-b,1-V,1-b,1-S,1-C,1-S]),(T===e.Mesh.FLIP_ROW&&t%2==1||T===e.Mesh.FLIP_TILE&&t%2==0)&&(z=[1-C,V,1-b,V,1-b,S,1-C,S]),(T===e.Mesh.FLIP_N_ROTATE_ROW&&t%2==1||T===e.Mesh.FLIP_N_ROTATE_TILE&&t%2==0)&&(z=[C,1-V,b,1-V,b,1-S,C,1-S]),l=l.concat(z),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&w&&(A.push(p+r,i+n,0),A.push(c+r,i+n,0),A.push(c+r,F+n,0),A.push(p+r,F+n,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,z=[C=0,V=0,b=L/_,V,b,S=u/O,C,S],(T===e.Mesh.ROTATE_ROW&&t%2==1||T===e.Mesh.ROTATE_TILE&&(t+I)%2==1)&&(z=[1-C,1-V,1-b,1-V,1-b,1-S,1-C,1-S]),(T===e.Mesh.FLIP_ROW&&t%2==1||T===e.Mesh.FLIP_TILE&&(t+I)%2==1)&&(z=[1-C,V,1-b,V,1-b,S,1-C,S]),(T===e.Mesh.FLIP_N_ROTATE_ROW&&t%2==1||T===e.Mesh.FLIP_N_ROTATE_TILE&&(t+I)%2==1)&&(z=[C,1-V,b,1-V,b,1-S,C,1-S]),l=l.concat(z),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B){var m=[];C=0,V=1-u/O,b=1,S=1,m[0]=[C,V,b,V,b,S,C,S],m[1]=[C,V,b,V,b,S,C,S],T!==e.Mesh.ROTATE_TILE&&T!==e.Mesh.ROTATE_ROW||(m[1]=[1-C,1-V,1-b,1-V,1-b,1-S,1-C,1-S]),T!==e.Mesh.FLIP_TILE&&T!==e.Mesh.FLIP_ROW||(m[1]=[1-C,V,1-b,V,1-b,S,1-C,S]),T!==e.Mesh.FLIP_N_ROTATE_TILE&&T!==e.Mesh.FLIP_N_ROTATE_ROW||(m[1]=[C,1-V,b,1-V,b,1-S,C,1-S]);for(x=0;x<I;x++)A.push(x*_-p+r,o+n,0),A.push((x+1)*_-p+r,o+n,0),A.push((x+1)*_-p+r,o+u+n,0),A.push(x*_-p+r,o+u+n,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,l=T===e.Mesh.FLIP_TILE||T===e.Mesh.ROTATE_TILE||T===e.Mesh.FLIP_N_ROTATE_TILE?l.concat(m[(x+1)%2]):T===e.Mesh.FLIP_ROW||T===e.Mesh.ROTATE_ROW||T===e.Mesh.FLIP_N_ROTATE_ROW?l.concat(m[1]):l.concat(m[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){var H=[];C=0,V=0,b=1,S=u/O,H[0]=[C,V,b,V,b,S,C,S],H[1]=[C,V,b,V,b,S,C,S],T!==e.Mesh.ROTATE_TILE&&T!==e.Mesh.ROTATE_ROW||(H[1]=[1-C,1-V,1-b,1-V,1-b,1-S,1-C,1-S]),T!==e.Mesh.FLIP_TILE&&T!==e.Mesh.FLIP_ROW||(H[1]=[1-C,V,1-b,V,1-b,S,1-C,S]),T!==e.Mesh.FLIP_N_ROTATE_TILE&&T!==e.Mesh.FLIP_N_ROTATE_ROW||(H[1]=[C,1-V,b,1-V,b,1-S,C,1-S]);for(x=0;x<I;x++)A.push(x*_-p+r,F-u+n,0),A.push((x+1)*_-p+r,F-u+n,0),A.push((x+1)*_-p+r,F+n,0),A.push(x*_-p+r,F+n,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,l=T===e.Mesh.FLIP_TILE||T===e.Mesh.ROTATE_TILE||T===e.Mesh.FLIP_N_ROTATE_TILE?l.concat(H[(x+t)%2]):T===e.Mesh.FLIP_ROW||T===e.Mesh.ROTATE_ROW||T===e.Mesh.FLIP_N_ROTATE_ROW?l.concat(H[t%2]):l.concat(H[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){var U=[];C=1-L/_,V=0,b=1,S=1,U[0]=[C,V,b,V,b,S,C,S],U[1]=[C,V,b,V,b,S,C,S],T!==e.Mesh.ROTATE_TILE&&T!==e.Mesh.ROTATE_ROW||(U[1]=[1-C,1-V,1-b,1-V,1-b,1-S,1-C,1-S]),T!==e.Mesh.FLIP_TILE&&T!==e.Mesh.FLIP_ROW||(U[1]=[1-C,V,1-b,V,1-b,S,1-C,S]),T!==e.Mesh.FLIP_N_ROTATE_TILE&&T!==e.Mesh.FLIP_N_ROTATE_ROW||(U[1]=[C,1-V,b,1-V,b,1-S,C,1-S]);for(D=0;D<t;D++)A.push(P+r,D*O-i+n,0),A.push(P+L+r,D*O-i+n,0),A.push(P+L+r,(D+1)*O-i+n,0),A.push(P+r,(D+1)*O-i+n,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,l=T===e.Mesh.FLIP_TILE||T===e.Mesh.ROTATE_TILE||T===e.Mesh.FLIP_N_ROTATE_TILE?l.concat(U[(D+1)%2]):T===e.Mesh.FLIP_ROW||T===e.Mesh.ROTATE_ROW||T===e.Mesh.FLIP_N_ROTATE_ROW?l.concat(U[D%2]):l.concat(U[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(w){var G=[];C=0,V=0,b=L/O,S=1,G[0]=[C,V,b,V,b,S,C,S],G[1]=[C,V,b,V,b,S,C,S],T!==e.Mesh.ROTATE_TILE&&T!==e.Mesh.ROTATE_ROW||(G[1]=[1-C,1-V,1-b,1-V,1-b,1-S,1-C,1-S]),T!==e.Mesh.FLIP_TILE&&T!==e.Mesh.FLIP_ROW||(G[1]=[1-C,V,1-b,V,1-b,S,1-C,S]),T!==e.Mesh.FLIP_N_ROTATE_TILE&&T!==e.Mesh.FLIP_N_ROTATE_ROW||(G[1]=[C,1-V,b,1-V,b,1-S,C,1-S]);for(D=0;D<t;D++)A.push(c-L+r,D*O-i+n,0),A.push(c+r,D*O-i+n,0),A.push(c+r,(D+1)*O-i+n,0),A.push(c-L+r,(D+1)*O-i+n,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,l=T===e.Mesh.FLIP_TILE||T===e.Mesh.ROTATE_TILE||T===e.Mesh.FLIP_N_ROTATE_TILE?l.concat(G[(D+I)%2]):T===e.Mesh.FLIP_ROW||T===e.Mesh.ROTATE_ROW||T===e.Mesh.FLIP_N_ROTATE_ROW?l.concat(G[D%2]):l.concat(G[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var q=0===h.sideOrientation?0:h.sideOrientation||s.VertexData.DEFAULTSIDE;s.VertexData._ComputeSides(q,A,f,W,l,h.frontUVs,h.backUVs);var y=new s.VertexData;y.indices=f,y.positions=A,y.normals=W,y.uvs=l;var j=q===s.VertexData.DOUBLESIDE?d.concat(d):d;return y.colors=j,y};var h=function(){function h(){}return h.CreateTiledPlane=function(h,T,_){void 0===_&&(_=null);var O=new e.Mesh(h,_);return T.sideOrientation=e.Mesh._GetDefaultSideOrientation(T.sideOrientation),O._originalBuilderSideOrientation=T.sideOrientation,s.VertexData.CreateTiledPlane(T).applyToMesh(O,T.updatable),O},h}();exports.TiledPlaneBuilder=h;
},{"../mesh":"58SX","../mesh.vertexData":"1A0K"}],"bikC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GroundMesh=void 0;var t=require("tslib"),i=require("../Maths/math.vector"),e=require("../Meshes/buffer"),s=require("../Meshes/mesh");s.Mesh._GroundMeshParser=function(t,i){return o.Parse(t,i)};var o=function(s){function o(t,i){var e=s.call(this,t,i)||this;return e.generateOctree=!1,e}return(0,t.__extends)(o,s),o.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(o.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),o.prototype.optimize=function(t,i){void 0===i&&(i=32),this._subdivisionsX=t,this._subdivisionsY=t,this.subdivide(t);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(i)},o.prototype.getHeightAtCoordinates=function(t,e){var s=this.getWorldMatrix(),o=i.TmpVectors.Matrix[5];s.invertToRef(o);var r=i.TmpVectors.Vector3[8];if(i.Vector3.TransformCoordinatesFromFloatsToRef(t,0,e,o,r),t=r.x,e=r.z,t<this._minX||t>this._maxX||e<this._minZ||e>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var n=this._getFacetAt(t,e),h=-(n.x*t+n.z*e+n.w)/n.y;return i.Vector3.TransformCoordinatesFromFloatsToRef(0,h,0,s,r),r.y},o.prototype.getNormalAtCoordinates=function(t,e){var s=new i.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(t,e,s),s},o.prototype.getNormalAtCoordinatesToRef=function(t,e,s){var o=this.getWorldMatrix(),r=i.TmpVectors.Matrix[5];o.invertToRef(r);var n=i.TmpVectors.Vector3[8];if(i.Vector3.TransformCoordinatesFromFloatsToRef(t,0,e,r,n),t=n.x,e=n.z,t<this._minX||t>this._maxX||e<this._minZ||e>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var h=this._getFacetAt(t,e);return i.Vector3.TransformNormalFromFloatsToRef(h.x,h.y,h.z,o,s),this},o.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},o.prototype._getFacetAt=function(t,i){var e=Math.floor((t+this._maxX)*this._subdivisionsX/this._width),s=Math.floor(-(i+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),o=this._heightQuads[s*this._subdivisionsX+e];return i<o.slope.x*t+o.slope.y?o.facet1:o.facet2},o.prototype._initHeightQuads=function(){var t=this._subdivisionsX,e=this._subdivisionsY;this._heightQuads=new Array;for(var s=0;s<e;s++)for(var o=0;o<t;o++){var r={slope:i.Vector2.Zero(),facet1:new i.Vector4(0,0,0,0),facet2:new i.Vector4(0,0,0,0)};this._heightQuads[s*t+o]=r}return this},o.prototype._computeHeightQuads=function(){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return this;for(var s=i.TmpVectors.Vector3[3],o=i.TmpVectors.Vector3[2],r=i.TmpVectors.Vector3[1],n=i.TmpVectors.Vector3[0],h=i.TmpVectors.Vector3[4],a=i.TmpVectors.Vector3[5],u=i.TmpVectors.Vector3[6],c=i.TmpVectors.Vector3[7],d=i.TmpVectors.Vector3[8],m=0,_=0,p=0,f=0,v=0,g=0,b=0,x=this._subdivisionsX,l=this._subdivisionsY,y=0;y<l;y++)for(var V=0;V<x;V++){m=3*V,_=y*(x+1)*3,p=(y+1)*(x+1)*3,s.x=t[_+m],s.y=t[_+m+1],s.z=t[_+m+2],o.x=t[_+m+3],o.y=t[_+m+4],o.z=t[_+m+5],r.x=t[p+m],r.y=t[p+m+1],r.z=t[p+m+2],n.x=t[p+m+3],n.y=t[p+m+4],n.z=t[p+m+5],f=(n.z-s.z)/(n.x-s.x),v=s.z-f*s.x,o.subtractToRef(s,h),r.subtractToRef(s,a),n.subtractToRef(s,u),i.Vector3.CrossToRef(u,a,c),i.Vector3.CrossToRef(h,u,d),c.normalize(),d.normalize(),g=-(c.x*s.x+c.y*s.y+c.z*s.z),b=-(d.x*o.x+d.y*o.y+d.z*o.z);var T=this._heightQuads[y*x+V];T.slope.copyFromFloats(f,v),T.facet1.copyFromFloats(c.x,c.y,c.z,g),T.facet2.copyFromFloats(d.x,d.y,d.z,b)}return this},o.prototype.serialize=function(t){s.prototype.serialize.call(this,t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.minZ=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height},o.Parse=function(t,i){var e=new o(t.name,i);return e._subdivisionsX=t.subdivisionsX||1,e._subdivisionsY=t.subdivisionsY||1,e._minX=t.minX,e._maxX=t.maxX,e._minZ=t.minZ,e._maxZ=t.maxZ,e._width=t.width,e._height=t.height,e},o}(s.Mesh);exports.GroundMesh=o;
},{"tslib":"90Cu","../Maths/math.vector":"61Nx","../Meshes/buffer":"clDe","../Meshes/mesh":"58SX"}],"3QjE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GroundBuilder=void 0;var i=require("../../Maths/math.vector"),e=require("../../Maths/math.color"),r=require("../mesh"),t=require("../mesh.vertexData"),s=require("../groundMesh"),n=require("../../Misc/tools"),a=require("../../Engines/engineStore"),o=require("../../Maths/math.constants"),u=require("../../Misc/canvasGenerator");t.VertexData.CreateGround=function(e){var r,s,n=[],a=[],o=[],u=[],h=e.width||1,d=e.height||1,v=e.subdivisionsX||e.subdivisions||1,m=e.subdivisionsY||e.subdivisions||1;for(r=0;r<=m;r++)for(s=0;s<=v;s++){var p=new i.Vector3(s*h/v-h/2,0,(m-r)*d/m-d/2),l=new i.Vector3(0,1,0);a.push(p.x,p.y,p.z),o.push(l.x,l.y,l.z),u.push(s/v,1-r/m)}for(r=0;r<m;r++)for(s=0;s<v;s++)n.push(s+1+(r+1)*(v+1)),n.push(s+1+r*(v+1)),n.push(s+r*(v+1)),n.push(s+(r+1)*(v+1)),n.push(s+1+(r+1)*(v+1)),n.push(s+r*(v+1));var f=new t.VertexData;return f.indices=n,f.positions=a,f.normals=o,f.uvs=u,f},t.VertexData.CreateTiledGround=function(e){var r,s,n,a,o=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,u=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,h=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,d=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,v=e.subdivisions||{w:1,h:1},m=e.precision||{w:1,h:1},p=new Array,l=new Array,f=new Array,g=new Array;v.h=v.h<1?1:v.h,v.w=v.w<1?1:v.w,m.w=m.w<1?1:m.w,m.h=m.h<1?1:m.h;var x=(h-o)/v.w,b=(d-u)/v.h;function w(e,t,n,a){var o=l.length/3,u=m.w+1;for(r=0;r<m.h;r++)for(s=0;s<m.w;s++){var h=[o+s+r*u,o+(s+1)+r*u,o+(s+1)+(r+1)*u,o+s+(r+1)*u];p.push(h[1]),p.push(h[2]),p.push(h[3]),p.push(h[0]),p.push(h[1]),p.push(h[3])}var d=i.Vector3.Zero(),v=new i.Vector3(0,1,0);for(r=0;r<=m.h;r++)for(d.z=r*(a-t)/m.h+t,s=0;s<=m.w;s++)d.x=s*(n-e)/m.w+e,d.y=0,l.push(d.x,d.y,d.z),f.push(v.x,v.y,v.z),g.push(s/m.w,r/m.h)}for(n=0;n<v.h;n++)for(a=0;a<v.w;a++)w(o+a*x,u+n*b,o+(a+1)*x,u+(n+1)*b);var c=new t.VertexData;return c.indices=p,c.positions=l,c.normals=f,c.uvs=g,c},t.VertexData.CreateGroundFromHeightMap=function(r){var s,n,a=[],u=[],h=[],d=[],v=r.colorFilter||new e.Color3(.3,.59,.11),m=r.alphaFilter||0,p=!1;if(r.minHeight>r.maxHeight){p=!0;var l=r.maxHeight;r.maxHeight=r.minHeight,r.minHeight=l}for(s=0;s<=r.subdivisions;s++)for(n=0;n<=r.subdivisions;n++){var f=new i.Vector3(n*r.width/r.subdivisions-r.width/2,0,(r.subdivisions-s)*r.height/r.subdivisions-r.height/2),g=4*(((f.x+r.width/2)/r.width*(r.bufferWidth-1)|0)+((1-(f.z+r.height/2)/r.height)*(r.bufferHeight-1)|0)*r.bufferWidth),x=r.buffer[g]/255,b=r.buffer[g+1]/255,w=r.buffer[g+2]/255,c=r.buffer[g+3]/255;p&&(x=1-x,b=1-b,w=1-w);var _=x*v.r+b*v.g+w*v.b;f.y=c>=m?r.minHeight+(r.maxHeight-r.minHeight)*_:r.minHeight-o.Epsilon,u.push(f.x,f.y,f.z),h.push(0,0,0),d.push(n/r.subdivisions,1-s/r.subdivisions)}for(s=0;s<r.subdivisions;s++)for(n=0;n<r.subdivisions;n++){var H=n+1+(s+1)*(r.subdivisions+1),C=n+1+s*(r.subdivisions+1),G=n+s*(r.subdivisions+1),M=n+(s+1)*(r.subdivisions+1),y=u[3*H+1]>=r.minHeight,z=u[3*C+1]>=r.minHeight,V=u[3*G+1]>=r.minHeight;y&&z&&V&&(a.push(H),a.push(C),a.push(G)),u[3*M+1]>=r.minHeight&&y&&V&&(a.push(M),a.push(H),a.push(G))}t.VertexData.ComputeNormals(u,a,h);var D=new t.VertexData;return D.indices=a,D.positions=u,D.normals=h,D.uvs=d,D},r.Mesh.CreateGround=function(i,e,r,t,s,n){var a={width:e,height:r,subdivisions:t,updatable:n};return h.CreateGround(i,a,s)},r.Mesh.CreateTiledGround=function(i,e,r,t,s,n,a,o,u){var d={xmin:e,zmin:r,xmax:t,zmax:s,subdivisions:n,precision:a,updatable:u};return h.CreateTiledGround(i,d,o)},r.Mesh.CreateGroundFromHeightMap=function(i,e,r,t,s,n,a,o,u,d,v){var m={width:r,height:t,subdivisions:s,minHeight:n,maxHeight:a,updatable:u,onReady:d,alphaFilter:v};return h.CreateGroundFromHeightMap(i,e,m,o)};var h=function(){function i(){}return i.CreateGround=function(i,e,r){var n=new s.GroundMesh(i,r);return n._setReady(!1),n._subdivisionsX=e.subdivisionsX||e.subdivisions||1,n._subdivisionsY=e.subdivisionsY||e.subdivisions||1,n._width=e.width||1,n._height=e.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ,t.VertexData.CreateGround(e).applyToMesh(n,e.updatable),n._setReady(!0),n},i.CreateTiledGround=function(i,e,s){void 0===s&&(s=null);var n=new r.Mesh(i,s);return t.VertexData.CreateTiledGround(e).applyToMesh(n,e.updatable),n},i.CreateGroundFromHeightMap=function(i,r,o,h){void 0===h&&(h=null);var d=o.width||10,v=o.height||10,m=o.subdivisions||1,p=o.minHeight||0,l=o.maxHeight||1,f=o.colorFilter||new e.Color3(.3,.59,.11),g=o.alphaFilter||0,x=o.updatable,b=o.onReady;h=h||a.EngineStore.LastCreatedScene;var w=new s.GroundMesh(i,h);w._subdivisionsX=m,w._subdivisionsY=m,w._width=d,w._height=v,w._maxX=w._width/2,w._maxZ=w._height/2,w._minX=-w._maxX,w._minZ=-w._maxZ,w._setReady(!1);return n.Tools.LoadImage(r,function(i){var e=i.width,r=i.height,s=u.CanvasGenerator.CreateCanvas(e,r).getContext("2d");if(!s)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!h.isDisposed){s.drawImage(i,0,0);var n=s.getImageData(0,0,e,r).data;t.VertexData.CreateGroundFromHeightMap({width:d,height:v,subdivisions:m,minHeight:p,maxHeight:l,colorFilter:f,buffer:n,bufferWidth:e,bufferHeight:r,alphaFilter:g}).applyToMesh(w,x),b&&b(w),w._setReady(!0)}},function(){},h.offlineProvider),w},i}();exports.GroundBuilder=h;
},{"../../Maths/math.vector":"61Nx","../../Maths/math.color":"q3+m","../mesh":"58SX","../mesh.vertexData":"1A0K","../groundMesh":"bikC","../../Misc/tools":"8xSa","../../Engines/engineStore":"cq+N","../../Maths/math.constants":"tvfX","../../Misc/canvasGenerator":"mx8L"}],"a9cR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TubeBuilder=void 0;var a=require("../../Maths/math.vector"),e=require("../mesh"),r=require("./ribbonBuilder"),t=require("../../Maths/math.path");e.Mesh.CreateTube=function(a,e,r,t,n,o,s,c,u,l){var h={path:e,radius:r,tessellation:t,radiusFunction:n,arc:1,cap:o,updatable:c,sideOrientation:u,instance:l};return i.CreateTube(a,h,s)};var i=function(){function i(){}return i.CreateTube=function(i,n,o){void 0===o&&(o=null);var s=n.path,c=n.instance,u=1;void 0!==n.radius?u=n.radius:c&&(u=c._creationDataStorage.radius);var l=n.tessellation||64,h=n.radiusFunction||null,d=n.cap||e.Mesh.NO_CAP,p=n.invertUV||!1,b=n.updatable,v=e.Mesh._GetDefaultSideOrientation(n.sideOrientation);n.arc=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1;var A,f,_=function(r,t,i,n,o,s,c,u){for(var l,h,d,p,b=t.getTangents(),v=t.getNormals(),A=t.getDistances(),f=2*Math.PI/o*u,_=s||function(){return n},D=a.TmpVectors.Matrix[0],g=c===e.Mesh.NO_CAP||c===e.Mesh.CAP_END?0:2,M=0;M<r.length;M++){h=_(M,A[M]),l=Array(),d=v[M];for(var C=0;C<o;C++)a.Matrix.RotationAxisToRef(b[M],f*C,D),p=l[C]?l[C]:a.Vector3.Zero(),a.Vector3.TransformCoordinatesToRef(d,D,p),p.scaleInPlace(h).addInPlace(r[M]),l[C]=p;i[g]=l,g++}var P=function(a,e){for(var t=Array(),i=0;i<a;i++)t.push(r[e]);return t};switch(c){case e.Mesh.NO_CAP:break;case e.Mesh.CAP_START:i[0]=P(o,0),i[1]=i[2].slice(0);break;case e.Mesh.CAP_END:i[g]=i[g-1].slice(0),i[g+1]=P(o,r.length-1);break;case e.Mesh.CAP_ALL:i[0]=P(o,0),i[1]=i[2].slice(0),i[g]=i[g-1].slice(0),i[g+1]=P(o,r.length-1)}return i};if(c){var D=c._creationDataStorage,g=n.arc||D.arc;return f=_(s,A=D.path3D.update(s),D.pathArray,u,D.tessellation,h,D.cap,g),c=r.RibbonBuilder.CreateRibbon("",{pathArray:f,instance:c}),D.path3D=A,D.pathArray=f,D.arc=g,D.radius=u,c}f=_(s,A=new t.Path3D(s),new Array,u,l,h,d=d<0||d>3?0:d,n.arc);var M=r.RibbonBuilder.CreateRibbon(i,{pathArray:f,closePath:!0,closeArray:!1,updatable:b,sideOrientation:v,invertUV:p,frontUVs:n.frontUVs,backUVs:n.backUVs},o);return M._creationDataStorage.pathArray=f,M._creationDataStorage.path3D=A,M._creationDataStorage.tessellation=l,M._creationDataStorage.cap=d,M._creationDataStorage.arc=n.arc,M._creationDataStorage.radius=u,M},i}();exports.TubeBuilder=i;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","./ribbonBuilder":"YiV/","../../Maths/math.path":"sSbP"}],"zu6S":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PolyhedronBuilder=void 0;var e=require("../../Maths/math.vector"),r=require("../../Maths/math.color"),t=require("../mesh"),a=require("../mesh.vertexData");a.VertexData.CreatePolyhedron=function(t){var o=[];o[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},o[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},o[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},o[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},o[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},o[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},o[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},o[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},o[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},o[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},o[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},o[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},o[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},o[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},o[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var n,i,s,f,c,v,h=t.type&&(t.type<0||t.type>=o.length)?0:t.type||0,u=t.size,x=t.sizeX||u||1,l=t.sizeY||u||1,d=t.sizeZ||u||1,p=t.custom||o[h],y=p.face.length,M=t.faceUV||new Array(y),w=t.faceColors,D=void 0===t.flat||t.flat,V=0===t.sideOrientation?0:t.sideOrientation||a.VertexData.DEFAULTSIDE,m=new Array,C=new Array,P=new Array,A=new Array,O=new Array,g=0,z=0,_=new Array,b=0,q=0;if(D)for(q=0;q<y;q++)w&&void 0===w[q]&&(w[q]=new r.Color4(1,1,1,1)),M&&void 0===M[q]&&(M[q]=new e.Vector4(0,0,1,1));if(D)for(q=0;q<y;q++){var S=p.face[q].length;for(s=2*Math.PI/S,f=.5*Math.tan(s/2),c=.5,b=0;b<S;b++)m.push(p.vertex[p.face[q][b]][0]*x,p.vertex[p.face[q][b]][1]*l,p.vertex[p.face[q][b]][2]*d),_.push(g),g++,n=M[q].x+(M[q].z-M[q].x)*(.5+f),i=M[q].y+(M[q].w-M[q].y)*(c-.5),A.push(n,i),v=f*Math.cos(s)-c*Math.sin(s),c=f*Math.sin(s)+c*Math.cos(s),f=v,w&&O.push(w[q].r,w[q].g,w[q].b,w[q].a);for(b=0;b<S-2;b++)C.push(_[0+z],_[b+2+z],_[b+1+z]);z+=S}else{for(b=0;b<p.vertex.length;b++)m.push(p.vertex[b][0]*x,p.vertex[b][1]*l,p.vertex[b][2]*d),A.push(0,0);for(q=0;q<y;q++)for(b=0;b<p.face[q].length-2;b++)C.push(p.face[q][0],p.face[q][b+2],p.face[q][b+1])}a.VertexData.ComputeNormals(m,C,P),a.VertexData._ComputeSides(V,m,C,P,A,t.frontUVs,t.backUVs);var U=new a.VertexData;return U.positions=m,U.indices=C,U.normals=P,U.uvs=A,w&&D&&(U.colors=O),U},t.Mesh.CreatePolyhedron=function(e,r,t){return o.CreatePolyhedron(e,r,t)};var o=function(){function e(){}return e.CreatePolyhedron=function(e,r,o){void 0===o&&(o=null);var n=new t.Mesh(e,o);return r.sideOrientation=t.Mesh._GetDefaultSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,a.VertexData.CreatePolyhedron(r).applyToMesh(n,r.updatable),n},e}();exports.PolyhedronBuilder=o;
},{"../../Maths/math.vector":"61Nx","../../Maths/math.color":"q3+m","../mesh":"58SX","../mesh.vertexData":"1A0K"}],"haGZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IcoSphereBuilder=void 0;var e=require("../../Maths/math.vector"),r=require("../mesh"),t=require("../mesh.vertexData");t.VertexData.CreateIcoSphere=function(r){var a,o=r.sideOrientation||t.VertexData.DEFAULTSIDE,i=r.radius||1,n=void 0===r.flat||r.flat,s=r.subdivisions||4,c=r.radiusX||i,u=r.radiusY||i,p=r.radiusZ||i,d=(1+Math.sqrt(5))/2,l=[-1,d,-0,1,d,0,-1,-d,0,1,-d,0,0,-1,-d,0,1,-d,0,-1,d,0,1,d,d,0,1,d,0,-1,-d,0,1,-d,0,-1],h=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],v=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],V=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],f=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],y=new Array,x=new Array,S=new Array,m=new Array,L=0,w=new Array(3),D=new Array(3);for(a=0;a<3;a++)w[a]=e.Vector3.Zero(),D[a]=e.Vector2.Zero();for(var I=0;I<20;I++){for(a=0;a<3;a++){var z=h[3*I+a];w[a].copyFromFloats(l[3*v[z]],l[3*v[z]+1],l[3*v[z]+2]),w[a].normalize().scaleInPlace(i),D[a].copyFromFloats(V[2*z]*(138/1024)+60/1024+f[I]*(-40/1024),V[2*z+1]*(239/1024)+26/1024+f[I]*(20/1024))}for(var A=function(r,t,a,o){var i,d=e.Vector3.Lerp(w[0],w[2],t/s),l=e.Vector3.Lerp(w[1],w[2],t/s),h=s===t?w[2]:e.Vector3.Lerp(d,l,r/(s-t));if(h.normalize(),n){var v=e.Vector3.Lerp(w[0],w[2],o/s),V=e.Vector3.Lerp(w[1],w[2],o/s);i=e.Vector3.Lerp(v,V,a/(s-o))}else i=new e.Vector3(h.x,h.y,h.z);i.x/=c,i.y/=u,i.z/=p,i.normalize();var f=e.Vector2.Lerp(D[0],D[2],t/s),I=e.Vector2.Lerp(D[1],D[2],t/s),z=s===t?D[2]:e.Vector2.Lerp(f,I,r/(s-t));x.push(h.x*c,h.y*u,h.z*p),S.push(i.x,i.y,i.z),m.push(z.x,z.y),y.push(L),L++},M=0;M<s;M++)for(var O=0;O+M<s;O++)A(O,M,O+1/3,M+1/3),A(O+1,M,O+1/3,M+1/3),A(O,M+1,O+1/3,M+1/3),O+M+1<s&&(A(O+1,M,O+2/3,M+2/3),A(O+1,M+1,O+2/3,M+2/3),A(O,M+1,O+2/3,M+2/3))}t.VertexData._ComputeSides(o,x,y,S,m,r.frontUVs,r.backUVs);var C=new t.VertexData;return C.indices=y,C.positions=x,C.normals=S,C.uvs=m,C},r.Mesh.CreateIcoSphere=function(e,r,t){return a.CreateIcoSphere(e,r,t)};var a=function(){function e(){}return e.CreateIcoSphere=function(e,a,o){void 0===o&&(o=null);var i=new r.Mesh(e,o);return a.sideOrientation=r.Mesh._GetDefaultSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,t.VertexData.CreateIcoSphere(a).applyToMesh(i,a.updatable),i},e}();exports.IcoSphereBuilder=a;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","../mesh.vertexData":"1A0K"}],"lnKB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DecalBuilder=void 0;var e=require("../../Maths/math.vector"),r=require("../mesh"),t=require("../buffer"),o=require("../mesh.vertexData"),n=require("../../Maths/math.vertexFormat");r.Mesh.CreateDecal=function(e,r,t,o,n,i){var s={position:t,normal:o,size:n,angle:i};return a.CreateDecal(e,r,s)};var a=function(){function a(){}return a.CreateDecal=function(a,i,s){var u=i.getIndices(),c=i.getVerticesData(t.VertexBuffer.PositionKind),l=i.getVerticesData(t.VertexBuffer.NormalKind),p=s.position||e.Vector3.Zero(),h=s.normal||e.Vector3.Up(),V=s.size||e.Vector3.One(),v=s.angle||0;if(!h){var f=new e.Vector3(0,0,1),m=i.getScene().activeCamera,x=e.Vector3.TransformCoordinates(f,m.getWorldMatrix());h=m.globalPosition.subtract(x)}var w=-Math.atan2(h.z,h.x)-Math.PI/2,M=Math.sqrt(h.x*h.x+h.z*h.z),g=Math.atan2(h.y,M),d=e.Matrix.RotationYawPitchRoll(w,g,v).multiply(e.Matrix.Translation(p.x,p.y,p.z)),D=e.Matrix.Invert(d),y=i.getWorldMatrix().multiply(D),b=new o.VertexData;b.indices=[],b.positions=[],b.normals=[],b.uvs=[];for(var C=0,P=function(r){var t=new n.PositionNormalVertex;if(!u||!c||!l)return t;var o=u[r];return t.position=new e.Vector3(c[3*o],c[3*o+1],c[3*o+2]),t.position=e.Vector3.TransformCoordinates(t.position,y),t.normal=new e.Vector3(l[3*o],l[3*o+1],l[3*o+2]),t.normal=e.Vector3.TransformNormal(t.normal,y),t},q=function(r,t){if(0===r.length)return r;for(var o=.5*Math.abs(e.Vector3.Dot(V,t)),a=function(r,a){var i=e.Vector3.GetClipFactor(r.position,a.position,t,o);return new n.PositionNormalVertex(e.Vector3.Lerp(r.position,a.position,i),e.Vector3.Lerp(r.normal,a.normal,i))},i=new Array,s=0;s<r.length;s+=3){var u,c,l,p=null,h=null,v=null,f=null;switch(((u=e.Vector3.Dot(r[s].position,t)-o>0)?1:0)+((c=e.Vector3.Dot(r[s+1].position,t)-o>0)?1:0)+((l=e.Vector3.Dot(r[s+2].position,t)-o>0)?1:0)){case 0:i.push(r[s]),i.push(r[s+1]),i.push(r[s+2]);break;case 1:if(u&&(p=r[s+1],h=r[s+2],v=a(r[s],p),f=a(r[s],h)),c){p=r[s],h=r[s+2],v=a(r[s+1],p),f=a(r[s+1],h),i.push(v),i.push(h.clone()),i.push(p.clone()),i.push(h.clone()),i.push(v.clone()),i.push(f);break}l&&(p=r[s],h=r[s+1],v=a(r[s+2],p),f=a(r[s+2],h)),p&&h&&v&&f&&(i.push(p.clone()),i.push(h.clone()),i.push(v),i.push(f),i.push(v.clone()),i.push(h.clone()));break;case 2:u||(h=a(p=r[s].clone(),r[s+1]),v=a(p,r[s+2]),i.push(p),i.push(h),i.push(v)),c||(h=a(p=r[s+1].clone(),r[s+2]),v=a(p,r[s]),i.push(p),i.push(h),i.push(v)),l||(h=a(p=r[s+2].clone(),r[s]),v=a(p,r[s+1]),i.push(p),i.push(h),i.push(v))}}return i},z=0;z<u.length;z+=3){var T=new Array;if(T.push(P(z)),T.push(P(z+1)),T.push(P(z+2)),T=q(T,new e.Vector3(1,0,0)),T=q(T,new e.Vector3(-1,0,0)),T=q(T,new e.Vector3(0,1,0)),T=q(T,new e.Vector3(0,-1,0)),T=q(T,new e.Vector3(0,0,1)),0!==(T=q(T,new e.Vector3(0,0,-1))).length)for(var A=0;A<T.length;A++){var B=T[A];b.indices.push(C),B.position.toArray(b.positions,3*C),B.normal.toArray(b.normals,3*C),b.uvs.push(.5+B.position.x/V.x),b.uvs.push(.5+B.position.y/V.y),C++}}var N=new r.Mesh(a,i.getScene());return b.applyToMesh(N),N.position=p.clone(),N.rotation=new e.Vector3(g,w,v),N},a}();exports.DecalBuilder=a;
},{"../../Maths/math.vector":"61Nx","../mesh":"58SX","../buffer":"clDe","../mesh.vertexData":"1A0K","../../Maths/math.vertexFormat":"gFNp"}],"wn2s":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshBuilder=void 0;var e=require("./Builders/ribbonBuilder"),r=require("./Builders/discBuilder"),u=require("./Builders/boxBuilder"),i=require("./Builders/tiledBoxBuilder"),n=require("./Builders/sphereBuilder"),l=require("./Builders/cylinderBuilder"),d=require("./Builders/torusBuilder"),t=require("./Builders/torusKnotBuilder"),o=require("./Builders/linesBuilder"),a=require("./Builders/polygonBuilder"),B=require("./Builders/shapeBuilder"),s=require("./Builders/latheBuilder"),C=require("./Builders/planeBuilder"),c=require("./Builders/tiledPlaneBuilder"),h=require("./Builders/groundBuilder"),f=require("./Builders/tubeBuilder"),v=require("./Builders/polyhedronBuilder"),p=require("./Builders/icoSphereBuilder"),q=require("./Builders/decalBuilder"),y=function(){function y(){}return y.CreateBox=function(e,r,i){return void 0===i&&(i=null),u.BoxBuilder.CreateBox(e,r,i)},y.CreateTiledBox=function(e,r,u){return void 0===u&&(u=null),i.TiledBoxBuilder.CreateTiledBox(e,r,u)},y.CreateSphere=function(e,r,u){return void 0===u&&(u=null),n.SphereBuilder.CreateSphere(e,r,u)},y.CreateDisc=function(e,u,i){return void 0===i&&(i=null),r.DiscBuilder.CreateDisc(e,u,i)},y.CreateIcoSphere=function(e,r,u){return void 0===u&&(u=null),p.IcoSphereBuilder.CreateIcoSphere(e,r,u)},y.CreateRibbon=function(r,u,i){return void 0===i&&(i=null),e.RibbonBuilder.CreateRibbon(r,u,i)},y.CreateCylinder=function(e,r,u){return void 0===u&&(u=null),l.CylinderBuilder.CreateCylinder(e,r,u)},y.CreateTorus=function(e,r,u){return void 0===u&&(u=null),d.TorusBuilder.CreateTorus(e,r,u)},y.CreateTorusKnot=function(e,r,u){return void 0===u&&(u=null),t.TorusKnotBuilder.CreateTorusKnot(e,r,u)},y.CreateLineSystem=function(e,r,u){return o.LinesBuilder.CreateLineSystem(e,r,u)},y.CreateLines=function(e,r,u){return void 0===u&&(u=null),o.LinesBuilder.CreateLines(e,r,u)},y.CreateDashedLines=function(e,r,u){return void 0===u&&(u=null),o.LinesBuilder.CreateDashedLines(e,r,u)},y.ExtrudeShape=function(e,r,u){return void 0===u&&(u=null),B.ShapeBuilder.ExtrudeShape(e,r,u)},y.ExtrudeShapeCustom=function(e,r,u){return void 0===u&&(u=null),B.ShapeBuilder.ExtrudeShapeCustom(e,r,u)},y.CreateLathe=function(e,r,u){return void 0===u&&(u=null),s.LatheBuilder.CreateLathe(e,r,u)},y.CreateTiledPlane=function(e,r,u){return void 0===u&&(u=null),c.TiledPlaneBuilder.CreateTiledPlane(e,r,u)},y.CreatePlane=function(e,r,u){return void 0===u&&(u=null),C.PlaneBuilder.CreatePlane(e,r,u)},y.CreateGround=function(e,r,u){return void 0===u&&(u=null),h.GroundBuilder.CreateGround(e,r,u)},y.CreateTiledGround=function(e,r,u){return void 0===u&&(u=null),h.GroundBuilder.CreateTiledGround(e,r,u)},y.CreateGroundFromHeightMap=function(e,r,u,i){return void 0===i&&(i=null),h.GroundBuilder.CreateGroundFromHeightMap(e,r,u,i)},y.CreatePolygon=function(e,r,u,i){return void 0===u&&(u=null),void 0===i&&(i=earcut),a.PolygonBuilder.CreatePolygon(e,r,u,i)},y.ExtrudePolygon=function(e,r,u,i){return void 0===u&&(u=null),void 0===i&&(i=earcut),a.PolygonBuilder.ExtrudePolygon(e,r,u,i)},y.CreateTube=function(e,r,u){return void 0===u&&(u=null),f.TubeBuilder.CreateTube(e,r,u)},y.CreatePolyhedron=function(e,r,u){return void 0===u&&(u=null),v.PolyhedronBuilder.CreatePolyhedron(e,r,u)},y.CreateDecal=function(e,r,u){return q.DecalBuilder.CreateDecal(e,r,u)},y}();exports.MeshBuilder=y;
},{"./Builders/ribbonBuilder":"YiV/","./Builders/discBuilder":"2npO","./Builders/boxBuilder":"FvhN","./Builders/tiledBoxBuilder":"Tf7d","./Builders/sphereBuilder":"vUoe","./Builders/cylinderBuilder":"F7uc","./Builders/torusBuilder":"xveZ","./Builders/torusKnotBuilder":"dSzl","./Builders/linesBuilder":"VoGx","./Builders/polygonBuilder":"/SZI","./Builders/shapeBuilder":"EIVm","./Builders/latheBuilder":"uwVH","./Builders/planeBuilder":"SjtZ","./Builders/tiledPlaneBuilder":"O6ai","./Builders/groundBuilder":"3QjE","./Builders/tubeBuilder":"a9cR","./Builders/polyhedronBuilder":"zu6S","./Builders/icoSphereBuilder":"haGZ","./Builders/decalBuilder":"lnKB"}],"L66z":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PushMaterial=void 0;var t=require("tslib"),e=require("../Maths/math.vector"),r=require("../Materials/material"),i=function(r){function i(t,i){var s=r.call(this,t,i)||this;return s._normalMatrix=new e.Matrix,s.allowShaderHotSwapping=!0,s._storeEffectOnSubMeshes=!0,s}return(0,t.__extends)(i,r),i.prototype.getEffect=function(){return this._activeEffect},i.prototype.isReady=function(t,e){return!!t&&(!t.subMeshes||0===t.subMeshes.length||this.isReadyForSubMesh(t,t.subMeshes[0],e))},i.prototype.bindOnlyWorldMatrix=function(t){this._activeEffect.setMatrix("world",t)},i.prototype.bindOnlyNormalMatrix=function(t){this._activeEffect.setMatrix("normalMatrix",t)},i.prototype.bind=function(t,e){e&&this.bindForSubMesh(t,e,e.subMeshes[0])},i.prototype._afterBind=function(t,e){void 0===e&&(e=null),r.prototype._afterBind.call(this,t),this.getScene()._cachedEffect=e},i.prototype._mustRebind=function(t,e,r){return void 0===r&&(r=1),t.isCachedMaterialInvalid(this,e,r)},i}(r.Material);exports.PushMaterial=i;
},{"tslib":"90Cu","../Maths/math.vector":"61Nx","../Materials/material":"zMir"}],"dnUN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MaterialFlags=void 0;var e=require("../Engines/engine"),t=function(){function t(){}return Object.defineProperty(t,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(t){this._DiffuseTextureEnabled!==t&&(this._DiffuseTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(t){this._AmbientTextureEnabled!==t&&(this._AmbientTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(t){this._OpacityTextureEnabled!==t&&(this._OpacityTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(t){this._ReflectionTextureEnabled!==t&&(this._ReflectionTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(t){this._EmissiveTextureEnabled!==t&&(this._EmissiveTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(t){this._SpecularTextureEnabled!==t&&(this._SpecularTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(t){this._BumpTextureEnabled!==t&&(this._BumpTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(t){this._LightmapTextureEnabled!==t&&(this._LightmapTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(t){this._RefractionTextureEnabled!==t&&(this._RefractionTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(t){this._ColorGradingTextureEnabled!==t&&(this._ColorGradingTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(t){this._FresnelEnabled!==t&&(this._FresnelEnabled=t,e.Engine.MarkAllMaterialsAsDirty(4))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(t){this._ClearCoatTextureEnabled!==t&&(this._ClearCoatTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(t){this._ClearCoatBumpTextureEnabled!==t&&(this._ClearCoatBumpTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(t){this._ClearCoatTintTextureEnabled!==t&&(this._ClearCoatTintTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(t){this._SheenTextureEnabled!==t&&(this._SheenTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(t){this._AnisotropicTextureEnabled!==t&&(this._AnisotropicTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(t){this._ThicknessTextureEnabled!==t&&(this._ThicknessTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),t._DiffuseTextureEnabled=!0,t._AmbientTextureEnabled=!0,t._OpacityTextureEnabled=!0,t._ReflectionTextureEnabled=!0,t._EmissiveTextureEnabled=!0,t._SpecularTextureEnabled=!0,t._BumpTextureEnabled=!0,t._LightmapTextureEnabled=!0,t._RefractionTextureEnabled=!0,t._ColorGradingTextureEnabled=!0,t._FresnelEnabled=!0,t._ClearCoatTextureEnabled=!0,t._ClearCoatBumpTextureEnabled=!0,t._ClearCoatTintTextureEnabled=!0,t._SheenTextureEnabled=!0,t._AnisotropicTextureEnabled=!0,t._ThicknessTextureEnabled=!0,t}();exports.MaterialFlags=t;
},{"../Engines/engine":"L3af"}],"zbKo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultFragmentDeclaration=void 0;var n=require("../../Materials/effect"),e="defaultFragmentDeclaration",f="uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif";n.Effect.IncludesShadersStore[e]=f;var i={name:e,shader:f};exports.defaultFragmentDeclaration=i;
},{"../../Materials/effect":"P0sJ"}],"XSj/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultUboDeclaration=void 0;var e=require("../../Materials/effect"),n="defaultUboDeclaration",t="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nfloat visibility;\nvec4 vDiffuseColor;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};\n";e.Effect.IncludesShadersStore[n]=t;var i={name:n,shader:t};exports.defaultUboDeclaration=i;
},{"../../Materials/effect":"P0sJ"}],"6uVc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lightFragmentDeclaration=void 0;var n=require("../../Materials/effect"),e="lightFragmentDeclaration",i="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif";n.Effect.IncludesShadersStore[e]=i;var r={name:e,shader:i};exports.lightFragmentDeclaration=r;
},{"../../Materials/effect":"P0sJ"}],"y2DC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lightUboDeclaration=void 0;var e=require("../../Materials/effect"),n="lightUboDeclaration",i="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=i;var r={name:n,shader:i};exports.lightUboDeclaration=r;
},{"../../Materials/effect":"P0sJ"}],"igqT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lightsFragmentFunctions=void 0;var e=require("../../Materials/effect"),n="lightsFragmentFunctions",t="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}";e.Effect.IncludesShadersStore[n]=t;var o={name:n,shader:t};exports.lightsFragmentFunctions=o;
},{"../../Materials/effect":"P0sJ"}],"bH4y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shadowsFragmentFunctions=void 0;var e=require("../../Materials/effect"),t="shadowsFragmentFunctions",o="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\n\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\n#ifdef WEBGL2\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nvec3 uvLayer=vec3(uv.x,uv.y,layer);\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\n#endif\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n#define GREATEST_LESS_THAN_ONE 0.99999994\n\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat shadow=texture(shadowSampler,uvDepthLayer);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);\nvec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec4 offset=vec4(poissonSamplers[i],0.);\n\noffset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);\nshadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#endif\n#endif\n";e.Effect.IncludesShadersStore[t]=o;var a={name:t,shader:o};exports.shadowsFragmentFunctions=a;
},{"../../Materials/effect":"P0sJ"}],"86CK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fresnelFunction=void 0;var e=require("../../Materials/effect"),r="fresnelFunction",n="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif";e.Effect.IncludesShadersStore[r]=n;var o={name:r,shader:n};exports.fresnelFunction=o;
},{"../../Materials/effect":"P0sJ"}],"XgcF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.reflectionFunction=void 0;var e=require("../../Materials/effect"),o="reflectionFunction",r="vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\nvec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(1.0-s,t,0);\n}\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=worldPos.xyz-eyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\n\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\n\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*(view*worldPos));\n}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*vec4(positionW,0));\n}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif";e.Effect.IncludesShadersStore[o]=r;var n={name:o,shader:r};exports.reflectionFunction=n;
},{"../../Materials/effect":"P0sJ"}],"JAaM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bumpFragmentFunctions=void 0;var e=require("../../Materials/effect"),n="bumpFragmentFunctions",a="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{\ntextureSample=textureSample*2.0-1.0;\n#ifdef NORMALXYSCALE\ntextureSample=normalize(textureSample*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*textureSample);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n#if defined(BUMP)\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nreturn perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);\n}\n#endif\n#if defined(BUMP) || defined(CLEARCOAT_BUMP)\nvec3 perturbNormal(mat3 cotangentFrame,vec3 color)\n{\nreturn perturbNormal(cotangentFrame,color,vBumpInfos.y);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\nreturn cotangent_frame(normal,p,uv,vTangentSpaceParams);\n}\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif";e.Effect.IncludesShadersStore[n]=a;var t={name:n,shader:a};exports.bumpFragmentFunctions=t;
},{"../../Materials/effect":"P0sJ"}],"ZUnA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.logDepthDeclaration=void 0;var e=require("../../Materials/effect"),t="logDepthDeclaration",r="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif";e.Effect.IncludesShadersStore[t]=r;var a={name:t,shader:r};exports.logDepthDeclaration=a;
},{"../../Materials/effect":"P0sJ"}],"PPC+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fogFragmentDeclaration=void 0;var n=require("../../Materials/effect"),o="fogFragmentDeclaration",e="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif";n.Effect.IncludesShadersStore[o]=e;var f={name:o,shader:e};exports.fogFragmentDeclaration=f;
},{"../../Materials/effect":"P0sJ"}],"DkVf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bumpFragment=void 0;var e=require("../../Materials/effect"),n="bumpFragment",a="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else\nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=a;var f={name:n,shader:a};exports.bumpFragment=f;
},{"../../Materials/effect":"P0sJ"}],"S2Kw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.depthPrePass=void 0;var e=require("../../Materials/effect"),r="depthPrePass",s="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif";e.Effect.IncludesShadersStore[r]=s;var t={name:r,shader:s};exports.depthPrePass=t;
},{"../../Materials/effect":"P0sJ"}],"S2oP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lightFragment=void 0;var i=require("../../Materials/effect"),e="lightFragment",n="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n\n#else\n#ifdef PBR\n\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicTangent,anisotropicBitangent,anisotropy,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\n\npreInfo.roughness=sheenIntensity;\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef CLEARCOAT\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearCoatNormalW,clearCoatAARoughnessFactors.x,clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\n\nabsorption=computeClearCoatLightingAbsorption(clearCoatNdotVRefract,preInfo.L,clearCoatNormalW,clearCoatColor,clearCoatThickness,clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\n\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)\n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {\nindex{X}=i;\nbreak;\n}\n}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];\nfloat diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};\nif (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{\nindex{X}+=1;\nfloat nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else\ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif";i.Effect.IncludesShadersStore[e]=n;var o={name:e,shader:n};exports.lightFragment=o;
},{"../../Materials/effect":"P0sJ"}],"/ees":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.logDepthFragment=void 0;var e=require("../../Materials/effect"),t="logDepthFragment",r="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif";e.Effect.IncludesShadersStore[t]=r;var a={name:t,shader:r};exports.logDepthFragment=a;
},{"../../Materials/effect":"P0sJ"}],"B9mV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fogFragment=void 0;var e=require("../../Materials/effect"),o="fogFragment",r="#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif";e.Effect.IncludesShadersStore[o]=r;var t={name:o,shader:r};exports.fogFragment=t;
},{"../../Materials/effect":"P0sJ"}],"1v2+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultPixelShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/defaultFragmentDeclaration"),require("./ShadersInclude/defaultUboDeclaration"),require("./ShadersInclude/helperFunctions"),require("./ShadersInclude/lightFragmentDeclaration"),require("./ShadersInclude/lightUboDeclaration"),require("./ShadersInclude/lightsFragmentFunctions"),require("./ShadersInclude/shadowsFragmentFunctions"),require("./ShadersInclude/fresnelFunction"),require("./ShadersInclude/reflectionFunction"),require("./ShadersInclude/imageProcessingDeclaration"),require("./ShadersInclude/imageProcessingFunctions"),require("./ShadersInclude/bumpFragmentFunctions"),require("./ShadersInclude/clipPlaneFragmentDeclaration"),require("./ShadersInclude/logDepthDeclaration"),require("./ShadersInclude/fogFragmentDeclaration"),require("./ShadersInclude/clipPlaneFragment"),require("./ShadersInclude/bumpFragment"),require("./ShadersInclude/depthPrePass"),require("./ShadersInclude/lightFragment"),require("./ShadersInclude/logDepthFragment"),require("./ShadersInclude/fogFragment");var n="defaultPixelShader",i="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n";e.Effect.ShadersStore[n]=i;var r={name:n,shader:i};exports.defaultPixelShader=r;
},{"../Materials/effect":"P0sJ","./ShadersInclude/defaultFragmentDeclaration":"zbKo","./ShadersInclude/defaultUboDeclaration":"XSj/","./ShadersInclude/helperFunctions":"diEu","./ShadersInclude/lightFragmentDeclaration":"6uVc","./ShadersInclude/lightUboDeclaration":"y2DC","./ShadersInclude/lightsFragmentFunctions":"igqT","./ShadersInclude/shadowsFragmentFunctions":"bH4y","./ShadersInclude/fresnelFunction":"86CK","./ShadersInclude/reflectionFunction":"XgcF","./ShadersInclude/imageProcessingDeclaration":"bE0f","./ShadersInclude/imageProcessingFunctions":"IFDo","./ShadersInclude/bumpFragmentFunctions":"JAaM","./ShadersInclude/clipPlaneFragmentDeclaration":"8jHv","./ShadersInclude/logDepthDeclaration":"ZUnA","./ShadersInclude/fogFragmentDeclaration":"PPC+","./ShadersInclude/clipPlaneFragment":"XNhN","./ShadersInclude/bumpFragment":"DkVf","./ShadersInclude/depthPrePass":"S2Kw","./ShadersInclude/lightFragment":"S2oP","./ShadersInclude/logDepthFragment":"/ees","./ShadersInclude/fogFragment":"B9mV"}],"QCs5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultVertexDeclaration=void 0;var n=require("../../Materials/effect"),e="defaultVertexDeclaration",i="\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n";n.Effect.IncludesShadersStore[e]=i;var f={name:e,shader:i};exports.defaultVertexDeclaration=f;
},{"../../Materials/effect":"P0sJ"}],"Ovwg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bumpVertexDeclaration=void 0;var e=require("../../Materials/effect"),r="bumpVertexDeclaration",n="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#endif\n";e.Effect.IncludesShadersStore[r]=n;var d={name:r,shader:n};exports.bumpVertexDeclaration=d;
},{"../../Materials/effect":"P0sJ"}],"5Few":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fogVertexDeclaration=void 0;var e=require("../../Materials/effect"),r="fogVertexDeclaration",t="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif";e.Effect.IncludesShadersStore[r]=t;var a={name:r,shader:t};exports.fogVertexDeclaration=a;
},{"../../Materials/effect":"P0sJ"}],"9wcT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.morphTargetsVertexGlobalDeclaration=void 0;var e=require("../../Materials/effect"),r="morphTargetsVertexGlobalDeclaration",a="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif";e.Effect.IncludesShadersStore[r]=a;var t={name:r,shader:a};exports.morphTargetsVertexGlobalDeclaration=t;
},{"../../Materials/effect":"P0sJ"}],"nT36":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.morphTargetsVertexDeclaration=void 0;var e=require("../../Materials/effect"),t="morphTargetsVertexDeclaration",r="#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#endif";e.Effect.IncludesShadersStore[t]=r;var n={name:t,shader:r};exports.morphTargetsVertexDeclaration=n;
},{"../../Materials/effect":"P0sJ"}],"9fNz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.morphTargetsVertex=void 0;var e=require("../../Materials/effect"),n="morphTargetsVertex",r="#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=r;var t={name:n,shader:r};exports.morphTargetsVertex=t;
},{"../../Materials/effect":"P0sJ"}],"bmKw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bumpVertex=void 0;var e=require("../../Materials/effect"),n="bumpVertex",t="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=t;var a={name:n,shader:t};exports.bumpVertex=a;
},{"../../Materials/effect":"P0sJ"}],"S+CQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fogVertex=void 0;var e=require("../../Materials/effect"),r="fogVertex",t="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif";e.Effect.IncludesShadersStore[r]=t;var o={name:r,shader:t};exports.fogVertex=o;
},{"../../Materials/effect":"P0sJ"}],"L6hm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shadowsVertex=void 0;var e=require("../../Materials/effect"),i="shadowsVertex",t="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {\nvPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\nvDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif";e.Effect.IncludesShadersStore[i]=t;var o={name:i,shader:t};exports.shadowsVertex=o;
},{"../../Materials/effect":"P0sJ"}],"uyqC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pointCloudVertex=void 0;var e=require("../../Materials/effect"),t="pointCloudVertex",r="#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif";e.Effect.IncludesShadersStore[t]=r;var o={name:t,shader:r};exports.pointCloudVertex=o;
},{"../../Materials/effect":"P0sJ"}],"qXoF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.logDepthVertex=void 0;var e=require("../../Materials/effect"),t="logDepthVertex",r="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif";e.Effect.IncludesShadersStore[t]=r;var o={name:t,shader:r};exports.logDepthVertex=o;
},{"../../Materials/effect":"P0sJ"}],"SXKG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultVertexShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/defaultVertexDeclaration"),require("./ShadersInclude/defaultUboDeclaration"),require("./ShadersInclude/helperFunctions"),require("./ShadersInclude/bonesDeclaration"),require("./ShadersInclude/instancesDeclaration"),require("./ShadersInclude/bumpVertexDeclaration"),require("./ShadersInclude/clipPlaneVertexDeclaration"),require("./ShadersInclude/fogVertexDeclaration"),require("./ShadersInclude/lightFragmentDeclaration"),require("./ShadersInclude/lightUboDeclaration"),require("./ShadersInclude/morphTargetsVertexGlobalDeclaration"),require("./ShadersInclude/morphTargetsVertexDeclaration"),require("./ShadersInclude/logDepthDeclaration"),require("./ShadersInclude/morphTargetsVertex"),require("./ShadersInclude/instancesVertex"),require("./ShadersInclude/bonesVertex"),require("./ShadersInclude/bumpVertex"),require("./ShadersInclude/clipPlaneVertex"),require("./ShadersInclude/fogVertex"),require("./ShadersInclude/shadowsVertex"),require("./ShadersInclude/pointCloudVertex"),require("./ShadersInclude/logDepthVertex");var n="defaultVertexShader",i="#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";e.Effect.ShadersStore[n]=i;var d={name:n,shader:i};exports.defaultVertexShader=d;
},{"../Materials/effect":"P0sJ","./ShadersInclude/defaultVertexDeclaration":"QCs5","./ShadersInclude/defaultUboDeclaration":"XSj/","./ShadersInclude/helperFunctions":"diEu","./ShadersInclude/bonesDeclaration":"aTh0","./ShadersInclude/instancesDeclaration":"D/SH","./ShadersInclude/bumpVertexDeclaration":"Ovwg","./ShadersInclude/clipPlaneVertexDeclaration":"nbz1","./ShadersInclude/fogVertexDeclaration":"5Few","./ShadersInclude/lightFragmentDeclaration":"6uVc","./ShadersInclude/lightUboDeclaration":"y2DC","./ShadersInclude/morphTargetsVertexGlobalDeclaration":"9wcT","./ShadersInclude/morphTargetsVertexDeclaration":"nT36","./ShadersInclude/logDepthDeclaration":"ZUnA","./ShadersInclude/morphTargetsVertex":"9fNz","./ShadersInclude/instancesVertex":"suJa","./ShadersInclude/bonesVertex":"asWS","./ShadersInclude/bumpVertex":"bmKw","./ShadersInclude/clipPlaneVertex":"BIQH","./ShadersInclude/fogVertex":"S+CQ","./ShadersInclude/shadowsVertex":"L6hm","./ShadersInclude/pointCloudVertex":"uyqC","./ShadersInclude/logDepthVertex":"qXoF"}],"c2/u":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StandardMaterial=exports.StandardMaterialDefines=void 0;var e=require("tslib"),t=require("../Misc/decorators"),r=require("../Misc/smartArray"),i=require("../scene"),a=require("../Maths/math.vector"),s=require("../Maths/math.color"),o=require("../Meshes/buffer"),n=require("./imageProcessingConfiguration"),l=require("../Materials/materialDefines"),u=require("./pushMaterial"),p=require("./materialHelper"),f=require("../Materials/Textures/texture"),d=require("../Misc/typeStore"),c=require("./materialFlags");require("../Shaders/default.fragment"),require("../Shaders/default.vertex");var _=require("./effectFallbacks"),h=function(t){function r(){var e=t.call(this)||this;return e.MAINUV1=!1,e.MAINUV2=!1,e.DIFFUSE=!1,e.DIFFUSEDIRECTUV=0,e.AMBIENT=!1,e.AMBIENTDIRECTUV=0,e.OPACITY=!1,e.OPACITYDIRECTUV=0,e.OPACITYRGB=!1,e.REFLECTION=!1,e.EMISSIVE=!1,e.EMISSIVEDIRECTUV=0,e.SPECULAR=!1,e.SPECULARDIRECTUV=0,e.BUMP=!1,e.BUMPDIRECTUV=0,e.PARALLAX=!1,e.PARALLAXOCCLUSION=!1,e.SPECULAROVERALPHA=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.CLIPPLANE5=!1,e.CLIPPLANE6=!1,e.ALPHATEST=!1,e.DEPTHPREPASS=!1,e.ALPHAFROMDIFFUSE=!1,e.POINTSIZE=!1,e.FOG=!1,e.SPECULARTERM=!1,e.DIFFUSEFRESNEL=!1,e.OPACITYFRESNEL=!1,e.REFLECTIONFRESNEL=!1,e.REFRACTIONFRESNEL=!1,e.EMISSIVEFRESNEL=!1,e.FRESNEL=!1,e.NORMAL=!1,e.UV1=!1,e.UV2=!1,e.VERTEXCOLOR=!1,e.VERTEXALPHA=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.INSTANCES=!1,e.GLOSSINESS=!1,e.ROUGHNESS=!1,e.EMISSIVEASILLUMINATION=!1,e.LINKEMISSIVEWITHDIFFUSE=!1,e.REFLECTIONFRESNELFROMSPECULAR=!1,e.LIGHTMAP=!1,e.LIGHTMAPDIRECTUV=0,e.OBJECTSPACE_NORMALMAP=!1,e.USELIGHTMAPASSHADOWMAP=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.LOGARITHMICDEPTH=!1,e.REFRACTION=!1,e.REFRACTIONMAP_3D=!1,e.REFLECTIONOVERALPHA=!1,e.TWOSIDEDLIGHTING=!1,e.SHADOWFLOAT=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_UV=!1,e.NUM_MORPH_INFLUENCERS=0,e.NONUNIFORMSCALING=!1,e.PREMULTIPLYALPHA=!1,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.MULTIVIEW=!1,e.IS_REFLECTION_LINEAR=!1,e.IS_REFRACTION_LINEAR=!1,e.EXPOSURE=!1,e.rebuild(),e}return(0,e.__extends)(r,t),r.prototype.setReflectionMode=function(e){for(var t=0,r=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<r.length;t++){var i=r[t];this[i]=i===e}},r}(l.MaterialDefines);exports.StandardMaterialDefines=h;var T=function(l){function u(e,t){var i=l.call(this,e,t)||this;return i._diffuseTexture=null,i._ambientTexture=null,i._opacityTexture=null,i._reflectionTexture=null,i._emissiveTexture=null,i._specularTexture=null,i._bumpTexture=null,i._lightmapTexture=null,i._refractionTexture=null,i.ambientColor=new s.Color3(0,0,0),i.diffuseColor=new s.Color3(1,1,1),i.specularColor=new s.Color3(1,1,1),i.emissiveColor=new s.Color3(0,0,0),i.specularPower=64,i._useAlphaFromDiffuseTexture=!1,i._useEmissiveAsIllumination=!1,i._linkEmissiveWithDiffuse=!1,i._useSpecularOverAlpha=!1,i._useReflectionOverAlpha=!1,i._disableLighting=!1,i._useObjectSpaceNormalMap=!1,i._useParallax=!1,i._useParallaxOcclusion=!1,i.parallaxScaleBias=.05,i._roughness=0,i.indexOfRefraction=.98,i.invertRefractionY=!0,i.alphaCutOff=.4,i._useLightmapAsShadowmap=!1,i._useReflectionFresnelFromSpecular=!1,i._useGlossinessFromSpecularMapAlpha=!1,i._maxSimultaneousLights=4,i._invertNormalMapX=!1,i._invertNormalMapY=!1,i._twoSidedLighting=!1,i._renderTargets=new r.SmartArray(16),i._worldViewProjectionMatrix=a.Matrix.Zero(),i._globalAmbientColor=new s.Color3(0,0,0),i._rebuildInParallel=!1,i._attachImageProcessingConfiguration(null),i.getRenderTargetTextures=function(){return i._renderTargets.reset(),u.ReflectionTextureEnabled&&i._reflectionTexture&&i._reflectionTexture.isRenderTarget&&i._renderTargets.push(i._reflectionTexture),u.RefractionTextureEnabled&&i._refractionTexture&&i._refractionTexture.isRenderTarget&&i._renderTargets.push(i._refractionTexture),i._renderTargets},i}return(0,e.__extends)(u,l),Object.defineProperty(u.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),u.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(u.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"hasRenderTargetTextures",{get:function(){return!!(u.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(u.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),u.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(u.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),u.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},u.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},u.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},u.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},u.prototype.isReadyForSubMesh=function(e,t,r){if(void 0===r&&(r=!1),t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new h);var i=this.getScene(),a=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&a._renderId===i.getRenderId())return!0;var s=i.getEngine();if(a._needNormals=p.MaterialHelper.PrepareDefinesForLights(i,e,a,!0,this._maxSimultaneousLights,this._disableLighting),p.MaterialHelper.PrepareDefinesForMultiview(i,a),a._areTexturesDirty){if(a._needUVs=!1,a.MAINUV1=!1,a.MAINUV2=!1,i.texturesEnabled){if(this._diffuseTexture&&u.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;p.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,a,"DIFFUSE")}else a.DIFFUSE=!1;if(this._ambientTexture&&u.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;p.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,a,"AMBIENT")}else a.AMBIENT=!1;if(this._opacityTexture&&u.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;p.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else a.OPACITY=!1;if(this._reflectionTexture&&u.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(a._needNormals=!0,a.REFLECTION=!0,a.ROUGHNESS=this._roughness>0,a.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,a.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===f.Texture.INVCUBIC_MODE,a.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case f.Texture.EXPLICIT_MODE:a.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case f.Texture.PLANAR_MODE:a.setReflectionMode("REFLECTIONMAP_PLANAR");break;case f.Texture.PROJECTION_MODE:a.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case f.Texture.SKYBOX_MODE:a.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case f.Texture.SPHERICAL_MODE:a.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case f.Texture.EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case f.Texture.FIXED_EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case f.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case f.Texture.CUBIC_MODE:case f.Texture.INVCUBIC_MODE:default:a.setReflectionMode("REFLECTIONMAP_CUBIC")}a.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else a.REFLECTION=!1;if(this._emissiveTexture&&u.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;p.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,a,"EMISSIVE")}else a.EMISSIVE=!1;if(this._lightmapTexture&&u.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;p.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else a.LIGHTMAP=!1;if(this._specularTexture&&u.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;p.MaterialHelper.PrepareDefinesForMergedUV(this._specularTexture,a,"SPECULAR"),a.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else a.SPECULAR=!1;if(i.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&u.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;p.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,a,"BUMP"),a.PARALLAX=this._useParallax,a.PARALLAXOCCLUSION=this._useParallaxOcclusion,a.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else a.BUMP=!1;if(this._refractionTexture&&u.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.REFRACTION=!0,a.REFRACTIONMAP_3D=this._refractionTexture.isCube}else a.REFRACTION=!1;a.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else a.DIFFUSE=!1,a.AMBIENT=!1,a.OPACITY=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.LIGHTMAP=!1,a.BUMP=!1,a.REFRACTION=!1;a.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),a.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,a.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,a.SPECULAROVERALPHA=this._useSpecularOverAlpha,a.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode}if(a._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a),a.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,a.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(a._areFresnelDirty&&(u.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(a.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,a.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,a.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,a.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,a.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,a.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,a._needNormals=!0,a.FRESNEL=!0):a.FRESNEL=!1),p.MaterialHelper.PrepareDefinesForMisc(e,i,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),a),p.MaterialHelper.PrepareDefinesForAttributes(e,a,!0,!0,!0),p.MaterialHelper.PrepareDefinesForFrameBoundValues(i,s,a,r),a.isDirty){var l=a._areLightsDisposed;a.markAsProcessed();var d=new _.EffectFallbacks;a.REFLECTION&&d.addFallback(0,"REFLECTION"),a.SPECULAR&&d.addFallback(0,"SPECULAR"),a.BUMP&&d.addFallback(0,"BUMP"),a.PARALLAX&&d.addFallback(1,"PARALLAX"),a.PARALLAXOCCLUSION&&d.addFallback(0,"PARALLAXOCCLUSION"),a.SPECULAROVERALPHA&&d.addFallback(0,"SPECULAROVERALPHA"),a.FOG&&d.addFallback(1,"FOG"),a.POINTSIZE&&d.addFallback(0,"POINTSIZE"),a.LOGARITHMICDEPTH&&d.addFallback(0,"LOGARITHMICDEPTH"),p.MaterialHelper.HandleFallbacksForShadows(a,d,this._maxSimultaneousLights),a.SPECULARTERM&&d.addFallback(0,"SPECULARTERM"),a.DIFFUSEFRESNEL&&d.addFallback(1,"DIFFUSEFRESNEL"),a.OPACITYFRESNEL&&d.addFallback(2,"OPACITYFRESNEL"),a.REFLECTIONFRESNEL&&d.addFallback(3,"REFLECTIONFRESNEL"),a.EMISSIVEFRESNEL&&d.addFallback(4,"EMISSIVEFRESNEL"),a.FRESNEL&&d.addFallback(4,"FRESNEL"),a.MULTIVIEW&&d.addFallback(0,"MULTIVIEW");var c=[o.VertexBuffer.PositionKind];a.NORMAL&&c.push(o.VertexBuffer.NormalKind),a.UV1&&c.push(o.VertexBuffer.UVKind),a.UV2&&c.push(o.VertexBuffer.UV2Kind),a.VERTEXCOLOR&&c.push(o.VertexBuffer.ColorKind),p.MaterialHelper.PrepareAttributesForBones(c,e,a,d),p.MaterialHelper.PrepareAttributesForInstances(c,a),p.MaterialHelper.PrepareAttributesForMorphTargets(c,e,a);var T="default",m=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],E=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],x=["Material","Scene"];n.ImageProcessingConfiguration&&(n.ImageProcessingConfiguration.PrepareUniforms(m,a),n.ImageProcessingConfiguration.PrepareSamplers(E,a)),p.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:m,uniformBuffersNames:x,samplers:E,defines:a,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(T=this.customShaderNameResolve(T,m,x,E,a));var g=a.toString(),P=t.effect,A=i.getEngine().createEffect(T,{attributes:c,uniformsNames:m,uniformBuffersNames:x,samplers:E,defines:g,fallbacks:d,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS}},s);if(A)if(this.allowShaderHotSwapping&&P&&!A.isReady()){if(A=P,this._rebuildInParallel=!0,a.markAsUnprocessed(),l)return a._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,i.resetCachedMaterial(),t.setEffect(A,a),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady())&&(a._renderId=i.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},u.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vDiffuseColor",4),e.create()},u.prototype.unbind=function(){if(this._activeEffect){var e=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),e=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),e=!0),e&&this._markAllSubMeshesAsTexturesDirty()}l.prototype.unbind.call(this)},u.prototype.bindForSubMesh=function(e,t,r){var a=this.getScene(),o=r._materialDefines;if(o){var n=r.effect;if(n){this._activeEffect=n,o.INSTANCES||this.bindOnlyWorldMatrix(e),o.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var l=this._mustRebind(a,n,t.visibility);p.MaterialHelper.BindBonesParameters(t,n);var f=this._uniformBuffer;if(l){if(f.bindToEffect(n,"Material"),this.bindViewProjection(n),!f.useUbo||!this.isFrozen||!f.isSync){if(u.FresnelEnabled&&o.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(f.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),f.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&f.updateColor4("opacityParts",new s.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(f.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),f.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(f.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),f.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(f.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),f.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),a.texturesEnabled){if(this._diffuseTexture&&u.DiffuseTextureEnabled&&(f.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),p.MaterialHelper.BindTextureMatrix(this._diffuseTexture,f,"diffuse"),this._diffuseTexture.hasAlpha&&n.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&u.AmbientTextureEnabled&&(f.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),p.MaterialHelper.BindTextureMatrix(this._ambientTexture,f,"ambient")),this._opacityTexture&&u.OpacityTextureEnabled&&(f.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),p.MaterialHelper.BindTextureMatrix(this._opacityTexture,f,"opacity")),this._reflectionTexture&&u.ReflectionTextureEnabled&&(f.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),f.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var d=this._reflectionTexture;f.updateVector3("vReflectionPosition",d.boundingBoxPosition),f.updateVector3("vReflectionSize",d.boundingBoxSize)}if(this._emissiveTexture&&u.EmissiveTextureEnabled&&(f.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),p.MaterialHelper.BindTextureMatrix(this._emissiveTexture,f,"emissive")),this._lightmapTexture&&u.LightmapTextureEnabled&&(f.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),p.MaterialHelper.BindTextureMatrix(this._lightmapTexture,f,"lightmap")),this._specularTexture&&u.SpecularTextureEnabled&&(f.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),p.MaterialHelper.BindTextureMatrix(this._specularTexture,f,"specular")),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&u.BumpTextureEnabled&&(f.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),p.MaterialHelper.BindTextureMatrix(this._bumpTexture,f,"bump"),a._mirroredCameraPosition?f.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):f.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&u.RefractionTextureEnabled){var c=1;this._refractionTexture.isCube||(f.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(c=this._refractionTexture.depth)),f.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,c,this.invertRefractionY?-1:1)}}this.pointsCloud&&f.updateFloat("pointSize",this.pointSize),o.SPECULARTERM&&f.updateColor4("vSpecularColor",this.specularColor,this.specularPower),f.updateColor3("vEmissiveColor",u.EmissiveTextureEnabled?this.emissiveColor:s.Color3.BlackReadOnly),f.updateFloat("visibility",t.visibility),f.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}if(a.texturesEnabled&&(this._diffuseTexture&&u.DiffuseTextureEnabled&&n.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&u.AmbientTextureEnabled&&n.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&u.OpacityTextureEnabled&&n.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&u.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?n.setTexture("reflectionCubeSampler",this._reflectionTexture):n.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&u.EmissiveTextureEnabled&&n.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&u.LightmapTextureEnabled&&n.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&u.SpecularTextureEnabled&&n.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&u.BumpTextureEnabled&&n.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&u.RefractionTextureEnabled)){c=1;this._refractionTexture.isCube?n.setTexture("refractionCubeSampler",this._refractionTexture):n.setTexture("refraction2DSampler",this._refractionTexture)}p.MaterialHelper.BindClipPlane(n,a),a.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),p.MaterialHelper.BindEyePosition(n,a),n.setColor3("vAmbientColor",this._globalAmbientColor)}!l&&this.isFrozen||(a.lightsEnabled&&!this._disableLighting&&p.MaterialHelper.BindLights(a,t,n,o,this._maxSimultaneousLights,this._rebuildInParallel),(a.fogEnabled&&t.applyFog&&a.fogMode!==i.Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(n),p.MaterialHelper.BindFogParameters(a,t,n),o.NUM_MORPH_INFLUENCERS&&p.MaterialHelper.BindMorphTargetParameters(t,n),this.useLogarithmicDepth&&p.MaterialHelper.BindLogDepth(o,n,a),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),f.update(),this._afterBind(t,this._activeEffect)}}},u.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},u.prototype.getActiveTextures=function(){var e=l.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},u.prototype.hasTexture=function(e){return!!l.prototype.hasTexture.call(this,e)||(this._diffuseTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._specularTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e))))))))},u.prototype.dispose=function(e,t){t&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),l.prototype.dispose.call(this,e,t)},u.prototype.clone=function(e){var r=this,i=t.SerializationHelper.Clone(function(){return new u(e,r.getScene())},this);return i.name=e,i.id=e,i},u.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},u.Parse=function(e,r,i){return t.SerializationHelper.Parse(function(){return new u(e.name,r)},e,r,i)},Object.defineProperty(u,"DiffuseTextureEnabled",{get:function(){return c.MaterialFlags.DiffuseTextureEnabled},set:function(e){c.MaterialFlags.DiffuseTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"AmbientTextureEnabled",{get:function(){return c.MaterialFlags.AmbientTextureEnabled},set:function(e){c.MaterialFlags.AmbientTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"OpacityTextureEnabled",{get:function(){return c.MaterialFlags.OpacityTextureEnabled},set:function(e){c.MaterialFlags.OpacityTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"ReflectionTextureEnabled",{get:function(){return c.MaterialFlags.ReflectionTextureEnabled},set:function(e){c.MaterialFlags.ReflectionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"EmissiveTextureEnabled",{get:function(){return c.MaterialFlags.EmissiveTextureEnabled},set:function(e){c.MaterialFlags.EmissiveTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"SpecularTextureEnabled",{get:function(){return c.MaterialFlags.SpecularTextureEnabled},set:function(e){c.MaterialFlags.SpecularTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"BumpTextureEnabled",{get:function(){return c.MaterialFlags.BumpTextureEnabled},set:function(e){c.MaterialFlags.BumpTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"LightmapTextureEnabled",{get:function(){return c.MaterialFlags.LightmapTextureEnabled},set:function(e){c.MaterialFlags.LightmapTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"RefractionTextureEnabled",{get:function(){return c.MaterialFlags.RefractionTextureEnabled},set:function(e){c.MaterialFlags.RefractionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"ColorGradingTextureEnabled",{get:function(){return c.MaterialFlags.ColorGradingTextureEnabled},set:function(e){c.MaterialFlags.ColorGradingTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"FresnelEnabled",{get:function(){return c.MaterialFlags.FresnelEnabled},set:function(e){c.MaterialFlags.FresnelEnabled=e},enumerable:!0,configurable:!0}),(0,e.__decorate)([(0,t.serializeAsTexture)("diffuseTexture")],u.prototype,"_diffuseTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"diffuseTexture",void 0),(0,e.__decorate)([(0,t.serializeAsTexture)("ambientTexture")],u.prototype,"_ambientTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientTexture",void 0),(0,e.__decorate)([(0,t.serializeAsTexture)("opacityTexture")],u.prototype,"_opacityTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"opacityTexture",void 0),(0,e.__decorate)([(0,t.serializeAsTexture)("reflectionTexture")],u.prototype,"_reflectionTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectionTexture",void 0),(0,e.__decorate)([(0,t.serializeAsTexture)("emissiveTexture")],u.prototype,"_emissiveTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"emissiveTexture",void 0),(0,e.__decorate)([(0,t.serializeAsTexture)("specularTexture")],u.prototype,"_specularTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"specularTexture",void 0),(0,e.__decorate)([(0,t.serializeAsTexture)("bumpTexture")],u.prototype,"_bumpTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"bumpTexture",void 0),(0,e.__decorate)([(0,t.serializeAsTexture)("lightmapTexture")],u.prototype,"_lightmapTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"lightmapTexture",void 0),(0,e.__decorate)([(0,t.serializeAsTexture)("refractionTexture")],u.prototype,"_refractionTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"refractionTexture",void 0),(0,e.__decorate)([(0,t.serializeAsColor3)("ambient")],u.prototype,"ambientColor",void 0),(0,e.__decorate)([(0,t.serializeAsColor3)("diffuse")],u.prototype,"diffuseColor",void 0),(0,e.__decorate)([(0,t.serializeAsColor3)("specular")],u.prototype,"specularColor",void 0),(0,e.__decorate)([(0,t.serializeAsColor3)("emissive")],u.prototype,"emissiveColor",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"specularPower",void 0),(0,e.__decorate)([(0,t.serialize)("useAlphaFromDiffuseTexture")],u.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useAlphaFromDiffuseTexture",void 0),(0,e.__decorate)([(0,t.serialize)("useEmissiveAsIllumination")],u.prototype,"_useEmissiveAsIllumination",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useEmissiveAsIllumination",void 0),(0,e.__decorate)([(0,t.serialize)("linkEmissiveWithDiffuse")],u.prototype,"_linkEmissiveWithDiffuse",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"linkEmissiveWithDiffuse",void 0),(0,e.__decorate)([(0,t.serialize)("useSpecularOverAlpha")],u.prototype,"_useSpecularOverAlpha",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useSpecularOverAlpha",void 0),(0,e.__decorate)([(0,t.serialize)("useReflectionOverAlpha")],u.prototype,"_useReflectionOverAlpha",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useReflectionOverAlpha",void 0),(0,e.__decorate)([(0,t.serialize)("disableLighting")],u.prototype,"_disableLighting",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsLightsDirty")],u.prototype,"disableLighting",void 0),(0,e.__decorate)([(0,t.serialize)("useObjectSpaceNormalMap")],u.prototype,"_useObjectSpaceNormalMap",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useObjectSpaceNormalMap",void 0),(0,e.__decorate)([(0,t.serialize)("useParallax")],u.prototype,"_useParallax",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useParallax",void 0),(0,e.__decorate)([(0,t.serialize)("useParallaxOcclusion")],u.prototype,"_useParallaxOcclusion",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useParallaxOcclusion",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"parallaxScaleBias",void 0),(0,e.__decorate)([(0,t.serialize)("roughness")],u.prototype,"_roughness",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"roughness",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"indexOfRefraction",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"invertRefractionY",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"alphaCutOff",void 0),(0,e.__decorate)([(0,t.serialize)("useLightmapAsShadowmap")],u.prototype,"_useLightmapAsShadowmap",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useLightmapAsShadowmap",void 0),(0,e.__decorate)([(0,t.serializeAsFresnelParameters)("diffuseFresnelParameters")],u.prototype,"_diffuseFresnelParameters",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"diffuseFresnelParameters",void 0),(0,e.__decorate)([(0,t.serializeAsFresnelParameters)("opacityFresnelParameters")],u.prototype,"_opacityFresnelParameters",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsFresnelAndMiscDirty")],u.prototype,"opacityFresnelParameters",void 0),(0,e.__decorate)([(0,t.serializeAsFresnelParameters)("reflectionFresnelParameters")],u.prototype,"_reflectionFresnelParameters",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"reflectionFresnelParameters",void 0),(0,e.__decorate)([(0,t.serializeAsFresnelParameters)("refractionFresnelParameters")],u.prototype,"_refractionFresnelParameters",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"refractionFresnelParameters",void 0),(0,e.__decorate)([(0,t.serializeAsFresnelParameters)("emissiveFresnelParameters")],u.prototype,"_emissiveFresnelParameters",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"emissiveFresnelParameters",void 0),(0,e.__decorate)([(0,t.serialize)("useReflectionFresnelFromSpecular")],u.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"useReflectionFresnelFromSpecular",void 0),(0,e.__decorate)([(0,t.serialize)("useGlossinessFromSpecularMapAlpha")],u.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,e.__decorate)([(0,t.serialize)("maxSimultaneousLights")],u.prototype,"_maxSimultaneousLights",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsLightsDirty")],u.prototype,"maxSimultaneousLights",void 0),(0,e.__decorate)([(0,t.serialize)("invertNormalMapX")],u.prototype,"_invertNormalMapX",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"invertNormalMapX",void 0),(0,e.__decorate)([(0,t.serialize)("invertNormalMapY")],u.prototype,"_invertNormalMapY",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"invertNormalMapY",void 0),(0,e.__decorate)([(0,t.serialize)("twoSidedLighting")],u.prototype,"_twoSidedLighting",void 0),(0,e.__decorate)([(0,t.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"twoSidedLighting",void 0),(0,e.__decorate)([(0,t.serialize)()],u.prototype,"useLogarithmicDepth",null),u}(u.PushMaterial);exports.StandardMaterial=T,d._TypeStore.RegisteredTypes["BABYLON.StandardMaterial"]=T,i.Scene.DefaultMaterialFactory=function(e){return new T("default material",e)};
},{"tslib":"90Cu","../Misc/decorators":"EVXT","../Misc/smartArray":"Hnz9","../scene":"TiFm","../Maths/math.vector":"61Nx","../Maths/math.color":"q3+m","../Meshes/buffer":"clDe","./imageProcessingConfiguration":"h2+3","../Materials/materialDefines":"y4W7","./pushMaterial":"L66z","./materialHelper":"Znij","../Materials/Textures/texture":"tMhK","../Misc/typeStore":"sm8f","./materialFlags":"dnUN","../Shaders/default.fragment":"1v2+","../Shaders/default.vertex":"SXKG","./effectFallbacks":"hVli"}],"/9L/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GradientEnvironment=void 0;var o=require("@babylonjs/core/Maths/math"),t=require("@babylonjs/core/Meshes/mesh");require("@babylonjs/core/Meshes/meshBuilder");var e=require("@babylonjs/core/Materials/effect"),r=require("@babylonjs/core/Materials/shaderMaterial");require("@babylonjs/core/Materials/standardMaterial");var a=function(){function a(o){this.skySize=200,this.system=o,this.setSky()}return a.prototype.setSky=function(){this.skyBox=t.Mesh.CreateSphere("skyBox",10,this.skySize,this.system.scene),this.skyBox.freezeWorldMatrix(),this.skyBox.convertToUnIndexedMesh(),this.skyBox.doNotSyncBoundingInfo=!0;var o="precision mediump float;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform mat4 worldViewProjection;varying vec4 vPosition;varying vec3 vNormal;void main(){vec4 p = vec4(position,1.0);vPosition = p;vNormal = normal;gl_Position = worldViewProjection * p;}",r="precision mediump float;uniform mat4 worldView;varying vec4 vPosition;varying vec3 vNormal;uniform vec4 topColor;uniform vec4 bottomColor; void main(void){float ba = bottomColor.a; vec4 vecba = vec4(ba, ba, ba, ba);float ta = topColor.a; vec4 vecta = vec4(ta, ta, ta, ta);";e.Effect.ShadersStore.verticalVertexShader=o,e.Effect.ShadersStore.verticalPixelShader=r+"float h = normalize(vPosition).y + 0.5;float maxh = max(h,0.0); gl_FragColor = mix(bottomColor*vecba,topColor*vecta,maxh);}",e.Effect.ShadersStore.horizontalVertexShader=o,e.Effect.ShadersStore.horizontalPixelShader=r+"float h = normalize(vPosition).x + 0.5;float maxh = max(h,0.0); gl_FragColor = mix(bottomColor*vecba,topColor*vecta,maxh);}",e.Effect.ShadersStore.radialVertexShader=o,e.Effect.ShadersStore.radialPixelShader=r+"float h = normalize(vPosition).z - 0.5;float maxh = max(2.0*h,0.0); gl_FragColor = mix(bottomColor*vecba,topColor*vecta,maxh);}"},a.prototype.setSkyGradient=function(o){this.gradient=o,this.sky&&this.sky.dispose(),this.sky=new r.ShaderMaterial("gradient",this.system.scene,o,{}),this.sky.backFaceCulling=!1,this.colorStart&&this.setBackStart(this.colorStart),this.colorEnd&&this.setBackStop(this.colorEnd),this.skyBox.material=this.sky},a.prototype.setBackStart=function(t){this.colorStart=t,this.sky&&(this.sky.unfreeze(),this.sky.setColor4("topColor",o.Color4.FromInts(t[0],t[1],t[2],255*t[3])),this.sky.freeze())},a.prototype.setBackStop=function(t){this.colorEnd=t,this.sky&&(this.sky.unfreeze(),this.sky.setColor4("bottomColor",o.Color4.FromInts(t[0],t[1],t[2],255*t[3])),this.sky.freeze())},a}();exports.GradientEnvironment=a;
},{"@babylonjs/core/Maths/math":"iyC1","@babylonjs/core/Meshes/mesh":"58SX","@babylonjs/core/Meshes/meshBuilder":"wn2s","@babylonjs/core/Materials/effect":"P0sJ","@babylonjs/core/Materials/shaderMaterial":"7h8p","@babylonjs/core/Materials/standardMaterial":"c2/u"}],"QyAc":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();exports.__esModule=!0;var e=require("@naker/services/System/gradientEnvironment"),i=require("@babylonjs/core/Maths/math"),n=function(e){function n(t,n,r){var s=e.call(this,t)||this;return s.camera=s.system.camera,s.setEvents(n),s.setCameraRotation(i.Vector2.Zero()),r.gradient||(r.gradient="vertical"),s.setOptions(r),s}return t(n,e),n.prototype.setEvents=function(t){var e=this;t.addListener(function(t){if(0!=e.sensitivity){var n=new i.Vector2(t.y/5,t.x/5);e.setCameraRotation(n)}})},n.prototype.setOptions=function(t){void 0!==t.sensitivity&&this.setSensitivity(t.sensitivity),void 0!==t.gradient&&this.setSkyGradient(t.gradient),void 0!==t.colorStart&&this.setBackStart(t.colorStart),void 0!==t.colorEnd&&this.setBackStop(t.colorEnd),this.setCameraRotation(i.Vector2.Zero())},n.prototype.getOptions=function(){return{gradient:this.gradient,sensitivity:this.sensitivity,colorStart:this.colorStart,colorEnd:this.colorEnd}},n.prototype.setSensitivity=function(t){this.sensitivity=t},n.prototype.setCameraRotation=function(t){var e=this.system.engine.getRenderWidth(),i=this.system.engine.getRenderHeight(),n=5e5/Math.max(e,i),r=30+t.x*-t.y*this.sensitivity*n;this.camera.radius=Math.min(Math.max(1,r),this.skySize/3),this.camera.alpha=3*t.y*this.sensitivity-Math.PI/2,this.camera.beta=3*t.x*this.sensitivity+Math.PI/2},n}(e.GradientEnvironment);exports.Environment=n;
},{"@naker/services/System/gradientEnvironment":"/9L/","@babylonjs/core/Maths/math":"iyC1"}],"oU1t":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AutoRotationBehavior=void 0;var t=require("../../Events/pointerEvents"),e=require("../../Misc/precisionDate"),i=function(){function i(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(i.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(t){this._idleRotationSpeed=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(t){this._idleRotationWaitTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(t){this._idleRotationSpinupTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(i){var a=this;this._attachedCamera=i;var n=this._attachedCamera.getScene();this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(e){e.type!==t.PointerEventTypes.POINTERDOWN?e.type===t.PointerEventTypes.POINTERUP&&(a._isPointerDown=!1):a._isPointerDown=!0}),this._onAfterCheckInputsObserver=i.onAfterCheckInputsObservable.add(function(){var t=e.PrecisionDate.Now,i=0;null!=a._lastFrameTime&&(i=t-a._lastFrameTime),a._lastFrameTime=t,a._applyUserInteraction();var n=t-a._lastInteractionTime-a._idleRotationWaitTime,o=Math.max(Math.min(n/a._idleRotationSpinupTime,1),0);a._cameraRotationSpeed=a._idleRotationSpeed*o,a._attachedCamera&&(a._attachedCamera.alpha-=a._cameraRotationSpeed*(i/1e3))})},i.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},i.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},i.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()},i.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=e.PrecisionDate.Now)},i.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},i}();exports.AutoRotationBehavior=i;
},{"../../Events/pointerEvents":"z5YY","../../Misc/precisionDate":"G7Te"}],"FtKN":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnimationKeyInterpolation=void 0,exports.AnimationKeyInterpolation=e,function(e){e[e.STEP=1]="STEP"}(e||(exports.AnimationKeyInterpolation=e={}));
},{}],"DYDh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnimationRange=void 0;var t=function(){function t(t,e,n){this.name=t,this.from=e,this.to=n}return t.prototype.clone=function(){return new t(this.name,this.from,this.to)},t}();exports.AnimationRange=t;
},{}],"hdK0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Animation=exports._IAnimationState=void 0;var e=require("../Maths/math.vector"),t=require("../Maths/math.color"),n=require("../Maths/math.scalar"),r=require("../Misc/decorators"),a=require("../Misc/typeStore"),o=require("./animationKey"),i=require("./animationRange"),s=require("../node"),u=require("../Maths/math.size"),l=function(){return function(){}}();exports._IAnimationState=l;var c=function(){function a(e,t,n,r,o,i){this.name=e,this.targetProperty=t,this.framePerSecond=n,this.dataType=r,this.loopMode=o,this.enableBlending=i,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=r,this.loopMode=void 0===o?a.ANIMATIONLOOPMODE_CYCLE:o}return a._PrepareAnimation=function(n,r,o,i,s,l,c,A){var O=void 0;if(!isNaN(parseFloat(s))&&isFinite(s)?O=a.ANIMATIONTYPE_FLOAT:s instanceof e.Quaternion?O=a.ANIMATIONTYPE_QUATERNION:s instanceof e.Vector3?O=a.ANIMATIONTYPE_VECTOR3:s instanceof e.Vector2?O=a.ANIMATIONTYPE_VECTOR2:s instanceof t.Color3?O=a.ANIMATIONTYPE_COLOR3:s instanceof t.Color4?O=a.ANIMATIONTYPE_COLOR4:s instanceof u.Size&&(O=a.ANIMATIONTYPE_SIZE),null==O)return null;var p=new a(n,r,o,O,c),T=[{frame:0,value:s},{frame:i,value:l}];return p.setKeys(T),void 0!==A&&p.setEasingFunction(A),p},a.CreateAnimation=function(e,t,n,r){var o=new a(e+"Animation",e,n,t,a.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(r),o},a.CreateAndStartAnimation=function(e,t,n,r,o,i,s,u,l,c){var A=a._PrepareAnimation(e,n,r,o,i,s,u,l);return A?t.getScene().beginDirectAnimation(t,[A],0,o,1===A.loopMode,1,c):null},a.CreateAndStartHierarchyAnimation=function(e,t,n,r,o,i,s,u,l,c,A){var O=a._PrepareAnimation(e,r,o,i,s,u,l,c);return O?t.getScene().beginDirectHierarchyAnimation(t,n,[O],0,i,1===O.loopMode,1,A):null},a.CreateMergeAndStartAnimation=function(e,t,n,r,o,i,s,u,l,c){var A=a._PrepareAnimation(e,n,r,o,i,s,u,l);return A?(t.animations.push(A),t.getScene().beginAnimation(t,0,o,1===A.loopMode,1,c)):null},a.TransitionTo=function(e,t,n,r,a,o,i,s){if(void 0===s&&(s=null),i<=0)return n[e]=t,s&&s(),null;var u=a*(i/1e3);o.setKeys([{frame:0,value:n[e].clone?n[e].clone():n[e]},{frame:u,value:t}]),n.animations||(n.animations=[]),n.animations.push(o);var l=r.beginAnimation(n,0,u,!1);return l.onAnimationEnd=s,l},Object.defineProperty(a.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++){if(!t[e].isStopped)return!0}return!1},enumerable:!0,configurable:!0}),a.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(t+=", ",n=!1),t+=r;t+="}"}return t},a.prototype.addEvent=function(e){this._events.push(e)},a.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},a.prototype.getEvents=function(){return this._events},a.prototype.createRange=function(e,t,n){this._ranges[e]||(this._ranges[e]=new i.AnimationRange(e,t,n))},a.prototype.deleteRange=function(e,t){void 0===t&&(t=!0);var n=this._ranges[e];if(n){if(t)for(var r=n.from,a=n.to,o=this._keys.length-1;o>=0;o--)this._keys[o].frame>=r&&this._keys[o].frame<=a&&this._keys.splice(o,1);this._ranges[e]=null}},a.prototype.getRange=function(e){return this._ranges[e]},a.prototype.getKeys=function(){return this._keys},a.prototype.getHighestFrame=function(){for(var e=0,t=0,n=this._keys.length;t<n;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},a.prototype.getEasingFunction=function(){return this._easingFunction},a.prototype.setEasingFunction=function(e){this._easingFunction=e},a.prototype.floatInterpolateFunction=function(e,t,r){return n.Scalar.Lerp(e,t,r)},a.prototype.floatInterpolateFunctionWithTangents=function(e,t,r,a,o){return n.Scalar.Hermite(e,t,r,a,o)},a.prototype.quaternionInterpolateFunction=function(t,n,r){return e.Quaternion.Slerp(t,n,r)},a.prototype.quaternionInterpolateFunctionWithTangents=function(t,n,r,a,o){return e.Quaternion.Hermite(t,n,r,a,o).normalize()},a.prototype.vector3InterpolateFunction=function(t,n,r){return e.Vector3.Lerp(t,n,r)},a.prototype.vector3InterpolateFunctionWithTangents=function(t,n,r,a,o){return e.Vector3.Hermite(t,n,r,a,o)},a.prototype.vector2InterpolateFunction=function(t,n,r){return e.Vector2.Lerp(t,n,r)},a.prototype.vector2InterpolateFunctionWithTangents=function(t,n,r,a,o){return e.Vector2.Hermite(t,n,r,a,o)},a.prototype.sizeInterpolateFunction=function(e,t,n){return u.Size.Lerp(e,t,n)},a.prototype.color3InterpolateFunction=function(e,n,r){return t.Color3.Lerp(e,n,r)},a.prototype.color4InterpolateFunction=function(e,n,r){return t.Color4.Lerp(e,n,r)},a.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},a.prototype._interpolate=function(e,t){if(t.loopMode===a.ANIMATIONLOOPMODE_CONSTANT&&t.repeatCount>0)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;var n=this._keys;if(1===n.length)return this._getKeyValue(n[0].value);var r=t.key;if(n[r].frame>=e)for(;r-1>=0&&n[r].frame>=e;)r--;for(var i=r;i<n.length;i++){var s=n[i+1];if(s.frame>=e){t.key=i;var u=n[i],l=this._getKeyValue(u.value);if(u.interpolation===o.AnimationKeyInterpolation.STEP)return l;var c=this._getKeyValue(s.value),A=void 0!==u.outTangent&&void 0!==s.inTangent,O=s.frame-u.frame,p=(e-u.frame)/O,T=this.getEasingFunction();switch(null!=T&&(p=T.ease(p)),this.dataType){case a.ANIMATIONTYPE_FLOAT:var I=A?this.floatInterpolateFunctionWithTangents(l,u.outTangent*O,c,s.inTangent*O,p):this.floatInterpolateFunction(l,c,p);switch(t.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:return I;case a.ANIMATIONLOOPMODE_RELATIVE:return t.offsetValue*t.repeatCount+I}break;case a.ANIMATIONTYPE_QUATERNION:var N=A?this.quaternionInterpolateFunctionWithTangents(l,u.outTangent.scale(O),c,s.inTangent.scale(O),p):this.quaternionInterpolateFunction(l,c,p);switch(t.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:return N;case a.ANIMATIONLOOPMODE_RELATIVE:return N.addInPlace(t.offsetValue.scale(t.repeatCount))}return N;case a.ANIMATIONTYPE_VECTOR3:var h=A?this.vector3InterpolateFunctionWithTangents(l,u.outTangent.scale(O),c,s.inTangent.scale(O),p):this.vector3InterpolateFunction(l,c,p);switch(t.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:return h;case a.ANIMATIONLOOPMODE_RELATIVE:return h.add(t.offsetValue.scale(t.repeatCount))}case a.ANIMATIONTYPE_VECTOR2:var f=A?this.vector2InterpolateFunctionWithTangents(l,u.outTangent.scale(O),c,s.inTangent.scale(O),p):this.vector2InterpolateFunction(l,c,p);switch(t.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:return f;case a.ANIMATIONLOOPMODE_RELATIVE:return f.add(t.offsetValue.scale(t.repeatCount))}case a.ANIMATIONTYPE_SIZE:switch(t.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(l,c,p);case a.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(l,c,p).add(t.offsetValue.scale(t.repeatCount))}case a.ANIMATIONTYPE_COLOR3:switch(t.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(l,c,p);case a.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(l,c,p).add(t.offsetValue.scale(t.repeatCount))}case a.ANIMATIONTYPE_COLOR4:switch(t.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(l,c,p);case a.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(l,c,p).add(t.offsetValue.scale(t.repeatCount))}case a.ANIMATIONTYPE_MATRIX:switch(t.loopMode){case a.ANIMATIONLOOPMODE_CYCLE:case a.ANIMATIONLOOPMODE_CONSTANT:if(a.AllowMatricesInterpolation)return this.matrixInterpolateFunction(l,c,p,t.workValue);case a.ANIMATIONLOOPMODE_RELATIVE:return l}}break}}return this._getKeyValue(n[n.length-1].value)},a.prototype.matrixInterpolateFunction=function(t,n,r,o){return a.AllowMatrixDecomposeForInterpolation?o?(e.Matrix.DecomposeLerpToRef(t,n,r,o),o):e.Matrix.DecomposeLerp(t,n,r):o?(e.Matrix.LerpToRef(t,n,r,o),o):e.Matrix.Lerp(t,n,r)},a.prototype.clone=function(){var e=new a(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges)for(var t in e._ranges={},this._ranges){var n=this._ranges[t];n&&(e._ranges[t]=n.clone())}return e},a.prototype.setKeys=function(e){this._keys=e.slice(0)},a.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;var t=this.dataType;e.keys=[];for(var n=this.getKeys(),r=0;r<n.length;r++){var o=n[r],i={};switch(i.frame=o.frame,t){case a.ANIMATIONTYPE_FLOAT:i.values=[o.value];break;case a.ANIMATIONTYPE_QUATERNION:case a.ANIMATIONTYPE_MATRIX:case a.ANIMATIONTYPE_VECTOR3:case a.ANIMATIONTYPE_COLOR3:case a.ANIMATIONTYPE_COLOR4:i.values=o.value.asArray()}e.keys.push(i)}for(var s in e.ranges=[],this._ranges){var u=this._ranges[s];if(u){var l={};l.name=s,l.from=u.from,l.to=u.to,e.ranges.push(l)}}return e},a._UniversalLerp=function(e,t,n){var r=e.constructor;return r.Lerp?r.Lerp(e,t,n):r.Slerp?r.Slerp(e,t,n):e.toFixed?e*(1-n)+n*t:t},a.Parse=function(n){var r,o,i=new a(n.name,n.property,n.framePerSecond,n.dataType,n.loopBehavior),s=n.dataType,u=[];for(n.enableBlending&&(i.enableBlending=n.enableBlending),n.blendingSpeed&&(i.blendingSpeed=n.blendingSpeed),o=0;o<n.keys.length;o++){var l,c,A=n.keys[o];switch(s){case a.ANIMATIONTYPE_FLOAT:r=A.values[0],A.values.length>=1&&(l=A.values[1]),A.values.length>=2&&(c=A.values[2]);break;case a.ANIMATIONTYPE_QUATERNION:if(r=e.Quaternion.FromArray(A.values),A.values.length>=8){var O=e.Quaternion.FromArray(A.values.slice(4,8));O.equals(e.Quaternion.Zero())||(l=O)}if(A.values.length>=12){var p=e.Quaternion.FromArray(A.values.slice(8,12));p.equals(e.Quaternion.Zero())||(c=p)}break;case a.ANIMATIONTYPE_MATRIX:r=e.Matrix.FromArray(A.values);break;case a.ANIMATIONTYPE_COLOR3:r=t.Color3.FromArray(A.values);break;case a.ANIMATIONTYPE_COLOR4:r=t.Color4.FromArray(A.values);break;case a.ANIMATIONTYPE_VECTOR3:default:r=e.Vector3.FromArray(A.values)}var T={};T.frame=A.frame,T.value=r,null!=l&&(T.inTangent=l),null!=c&&(T.outTangent=c),u.push(T)}if(i.setKeys(u),n.ranges)for(o=0;o<n.ranges.length;o++)r=n.ranges[o],i.createRange(r.name,r.from,r.to);return i},a.AppendSerializedAnimations=function(e,t){r.SerializationHelper.AppendSerializedAnimations(e,t)},a.AllowMatricesInterpolation=!1,a.AllowMatrixDecomposeForInterpolation=!0,a.ANIMATIONTYPE_FLOAT=0,a.ANIMATIONTYPE_VECTOR3=1,a.ANIMATIONTYPE_QUATERNION=2,a.ANIMATIONTYPE_MATRIX=3,a.ANIMATIONTYPE_COLOR3=4,a.ANIMATIONTYPE_COLOR4=7,a.ANIMATIONTYPE_VECTOR2=5,a.ANIMATIONTYPE_SIZE=6,a.ANIMATIONLOOPMODE_RELATIVE=0,a.ANIMATIONLOOPMODE_CYCLE=1,a.ANIMATIONLOOPMODE_CONSTANT=2,a}();exports.Animation=c,a._TypeStore.RegisteredTypes["BABYLON.Animation"]=c,s.Node._AnimationRangeFactory=function(e,t,n){return new i.AnimationRange(e,t,n)};
},{"../Maths/math.vector":"61Nx","../Maths/math.color":"q3+m","../Maths/math.scalar":"TAUa","../Misc/decorators":"EVXT","../Misc/typeStore":"sm8f","./animationKey":"FtKN","./animationRange":"DYDh","../node":"mlkt","../Maths/math.size":"j04N"}],"SvU7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BouncingBehavior=void 0;var a=require("../../Animations/easing"),t=require("../../Animations/animation"),i=function(){function i(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(i.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(a){var t=this;if(this._autoTransitionRange!==a){this._autoTransitionRange=a;var i=this._attachedCamera;i&&(a?this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add(function(a){if(a){a.computeWorldMatrix(!0);var i=a.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=.05*i,t.upperRadiusTransitionRange=.05*i}}):this._onMeshTargetChangedObserver&&i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(a){var t=this;this._attachedCamera=a,this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add(function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))})},i.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},i.prototype._isRadiusAtLimit=function(a){return!!this._attachedCamera&&(this._attachedCamera.radius===a&&!this._radiusIsAnimating)},i.prototype._applyBoundRadiusAnimation=function(a){var e=this;if(this._attachedCamera){this._radiusBounceTransition||(i.EasingFunction.setEasingMode(i.EasingMode),this._radiusBounceTransition=t.Animation.CreateAnimation("radius",t.Animation.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var n=t.Animation.TransitionTo("radius",this._attachedCamera.radius+a,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return e._clearAnimationLocks()});n&&this._animatables.push(n)}},i.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},i.EasingFunction=new a.BackEase(.3),i.EasingMode=a.EasingFunction.EASINGMODE_EASEOUT,i}();exports.BouncingBehavior=i;
},{"../../Animations/easing":"sYD4","../../Animations/animation":"hdK0"}],"LUjy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FramingBehavior=void 0;var t=require("../../Animations/easing"),e=require("../../Events/pointerEvents"),i=require("../../Misc/precisionDate"),a=require("../../Maths/math.vector"),n=require("../../Animations/animation"),r=function(){function r(){this._mode=r.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(r.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(t){this._radiusScale=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positionScale",{get:function(){return this._positionScale},set:function(t){this._positionScale=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(t){this._defaultElevation=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(t){this._elevationReturnTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(t){this._elevationReturnWaitTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"framingTime",{get:function(){return this._framingTime},set:function(t){this._framingTime=t},enumerable:!0,configurable:!0}),r.prototype.init=function(){},r.prototype.attach=function(t){var i=this;this._attachedCamera=t;var a=this._attachedCamera.getScene();r.EasingFunction.setEasingMode(r.EasingMode),this._onPrePointerObservableObserver=a.onPrePointerObservable.add(function(t){t.type!==e.PointerEventTypes.POINTERDOWN?t.type===e.PointerEventTypes.POINTERUP&&(i._isPointerDown=!1):i._isPointerDown=!0}),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(t){t&&i.zoomOnMesh(t)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){i._applyUserInteraction(),i._maintainCameraAboveGround()})},r.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},r.prototype.zoomOnMesh=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=null),t.computeWorldMatrix(!0);var a=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(a.minimumWorld,a.maximumWorld,e,i)},r.prototype.zoomOnMeshHierarchy=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=null),t.computeWorldMatrix(!0);var a=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(a.min,a.max,e,i)},r.prototype.zoomOnMeshesHierarchy=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=null);for(var n=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new a.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=0;o<t.length;o++){var s=t[o].getHierarchyBoundingVectors(!0);a.Vector3.CheckExtends(s.min,n,r),a.Vector3.CheckExtends(s.max,n,r)}this.zoomOnBoundingInfo(n,r,e,i)},r.prototype.zoomOnBoundingInfo=function(t,e,i,o){var s,h=this;if(void 0===i&&(i=!1),void 0===o&&(o=null),this._attachedCamera){var m=t.y,u=m+(e.y-m)*this._positionScale,c=e.subtract(t).scale(.5);if(i)s=new a.Vector3(0,u,0);else{var d=t.add(c);s=new a.Vector3(d.x,u,d.z)}this._vectorTransition||(this._vectorTransition=n.Animation.CreateAnimation("target",n.Animation.ANIMATIONTYPE_VECTOR3,60,r.EasingFunction)),this._betaIsAnimating=!0;var l=n.Animation.TransitionTo("target",s,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);l&&this._animatables.push(l);var _=0;if(this._mode===r.FitFrustumSidesMode){var p=this._calculateLowerRadiusFromModelBoundingSphere(t,e);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=c.length()+this._attachedCamera.minZ),_=p}else this._mode===r.IgnoreBoundsSizeMode&&(_=this._calculateLowerRadiusFromModelBoundingSphere(t,e),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var f=e.subtract(t).length();this._attachedCamera.panningSensibility=5e3/f,this._attachedCamera.wheelPrecision=100/_}this._radiusTransition||(this._radiusTransition=n.Animation.CreateAnimation("radius",n.Animation.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),(l=n.Animation.TransitionTo("radius",_,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){h.stopAllAnimations(),o&&o(),h._attachedCamera&&h._attachedCamera.useInputToRestoreState&&h._attachedCamera.storeState()}))&&this._animatables.push(l)}},r.prototype._calculateLowerRadiusFromModelBoundingSphere=function(t,e){var i=e.subtract(t).length(),a=this._getFrustumSlope(),n=.5*i*this._radiusScale,o=n*Math.sqrt(1+1/(a.x*a.x)),s=n*Math.sqrt(1+1/(a.y*a.y)),h=Math.max(o,s),m=this._attachedCamera;return m?(m.lowerRadiusLimit&&this._mode===r.IgnoreBoundsSizeMode&&(h=h<m.lowerRadiusLimit?m.lowerRadiusLimit:h),m.upperRadiusLimit&&(h=h>m.upperRadiusLimit?m.upperRadiusLimit:h),h):0},r.prototype._maintainCameraAboveGround=function(){var t=this;if(!(this._elevationReturnTime<0)){var e=i.PrecisionDate.Now-this._lastInteractionTime,a=.5*Math.PI-this._defaultElevation,o=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>o&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=n.Animation.CreateAnimation("beta",n.Animation.ANIMATIONTYPE_FLOAT,60,r.EasingFunction));var s=n.Animation.TransitionTo("beta",a,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){t._clearAnimationLocks(),t.stopAllAnimations()});s&&this._animatables.push(s)}}},r.prototype._getFrustumSlope=function(){var t=this._attachedCamera;if(!t)return a.Vector2.Zero();var e=t.getScene().getEngine().getAspectRatio(t),i=Math.tan(t.fov/2),n=i*e;return new a.Vector2(n,i)},r.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},r.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=i.PrecisionDate.Now,this.stopAllAnimations(),this._clearAnimationLocks())},r.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(r.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),r.EasingFunction=new t.ExponentialEase,r.EasingMode=t.EasingFunction.EASINGMODE_EASEINOUT,r.IgnoreBoundsSizeMode=0,r.FitFrustumSidesMode=1,r}();exports.FramingBehavior=r;
},{"../../Animations/easing":"sYD4","../../Events/pointerEvents":"z5YY","../../Misc/precisionDate":"G7Te","../../Maths/math.vector":"61Nx","../../Animations/animation":"hdK0"}],"1sRG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TargetCamera=void 0;var t=require("tslib"),o=require("../Misc/decorators"),i=require("./camera"),a=require("../Maths/math.vector"),e=require("../Maths/math.constants"),r=require("../Maths/math.axis"),n=function(n){function s(t,o,i,e){void 0===e&&(e=!0);var r=n.call(this,t,o,i,e)||this;return r.cameraDirection=new a.Vector3(0,0,0),r.cameraRotation=new a.Vector2(0,0),r.updateUpVectorFromRotation=!1,r._tmpQuaternion=new a.Quaternion,r.rotation=new a.Vector3(0,0,0),r.speed=2,r.noRotationConstraint=!1,r.lockedTarget=null,r._currentTarget=a.Vector3.Zero(),r._initialFocalDistance=1,r._viewMatrix=a.Matrix.Zero(),r._camMatrix=a.Matrix.Zero(),r._cameraTransformMatrix=a.Matrix.Zero(),r._cameraRotationMatrix=a.Matrix.Zero(),r._referencePoint=new a.Vector3(0,0,1),r._transformedReferencePoint=a.Vector3.Zero(),r._globalCurrentTarget=a.Vector3.Zero(),r._globalCurrentUpVector=a.Vector3.Zero(),r._defaultUp=a.Vector3.Up(),r._cachedRotationZ=0,r._cachedQuaternionRotationZ=0,r}return(0,t.__extends)(s,n),s.prototype.getFrontPosition=function(t){this.getWorldMatrix();var o=this.getTarget().subtract(this.position);return o.normalize(),o.scaleInPlace(t),this.globalPosition.add(o)},s.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},s.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),n.prototype.storeState.call(this)},s.prototype._restoreStateValues=function(){return!!n.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},s.prototype._initCache=function(){n.prototype._initCache.call(this),this._cache.lockedTarget=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new a.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},s.prototype._updateCache=function(t){t||n.prototype._updateCache.call(this);var o=this._getLockedTargetPosition();o?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(o):this._cache.lockedTarget=o.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},s.prototype._isSynchronizedViewMatrix=function(){if(!n.prototype._isSynchronizedViewMatrix.call(this))return!1;var t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},s.prototype._computeLocalCameraSpeed=function(){var t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))},s.prototype.setTarget=function(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=e.Epsilon),a.Matrix.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var o=t.subtract(this.position);o.x>=0?this.rotation.y=-Math.atan(o.z/o.x)+Math.PI/2:this.rotation.y=-Math.atan(o.z/o.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&a.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},s.prototype.getTarget=function(){return this._currentTarget},s.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},s.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(a.TmpVectors.Matrix[0]),a.Vector3.TransformNormalToRef(this.cameraDirection,a.TmpVectors.Matrix[0],a.TmpVectors.Vector3[0]),void this.position.addInPlace(a.TmpVectors.Vector3[0]);this.position.addInPlace(this.cameraDirection)},s.prototype._checkInputs=function(){var t=this._decideIfNeedsToMove(),o=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(t&&this._updatePosition(),o){if(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion)this.rotation.lengthSquared()&&a.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion);if(!this.noRotationConstraint){this.rotation.x>1.570796&&(this.rotation.x=1.570796),this.rotation.x<-1.570796&&(this.rotation.x=-1.570796)}}t&&(Math.abs(this.cameraDirection.x)<this.speed*e.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*e.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*e.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),o&&(Math.abs(this.cameraRotation.x)<this.speed*e.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*e.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),n.prototype._checkInputs.call(this)},s.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):a.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},s.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return a.Vector3.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},s.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),a.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?r.Axis.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(a.Quaternion.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),r.Axis.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},s.prototype._computeViewMatrix=function(t,o,i){if(this.parent){var e=this.parent.getWorldMatrix();a.Vector3.TransformCoordinatesToRef(t,e,this._globalPosition),a.Vector3.TransformCoordinatesToRef(o,e,this._globalCurrentTarget),a.Vector3.TransformNormalToRef(i,e,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._globalCurrentTarget.copyFrom(o),this._globalCurrentUpVector.copyFrom(i);this.getScene().useRightHandedSystem?a.Matrix.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):a.Matrix.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},s.prototype.createRigCamera=function(t,o){if(this.cameraRigMode!==i.Camera.RIG_MODE_NONE){var e=new s(t,this.position.clone(),this.getScene());return e.isRigCamera=!0,e.rigParent=this,this.cameraRigMode!==i.Camera.RIG_MODE_VR&&this.cameraRigMode!==i.Camera.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new a.Quaternion),e._cameraRigParams={},e.rotationQuaternion=new a.Quaternion),e}return null},s.prototype._updateRigCameras=function(){var t=this._rigCameras[0],o=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case i.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case i.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case i.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case i.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case i.Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:var a=this.cameraRigMode===i.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,e=this.cameraRigMode===i.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*a,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*e,o);break;case i.Camera.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),o.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),o.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),o.position.copyFrom(this.position)}n.prototype._updateRigCameras.call(this)},s.prototype._getRigCamPositionAndTarget=function(t,o){this.getTarget().subtractToRef(this.position,s._TargetFocalPoint),s._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var i=s._TargetFocalPoint.addInPlace(this.position);a.Matrix.TranslationToRef(-i.x,-i.y,-i.z,s._TargetTransformMatrix),s._TargetTransformMatrix.multiplyToRef(a.Matrix.RotationY(t),s._RigCamTransformMatrix),a.Matrix.TranslationToRef(i.x,i.y,i.z,s._TargetTransformMatrix),s._RigCamTransformMatrix.multiplyToRef(s._TargetTransformMatrix,s._RigCamTransformMatrix),a.Vector3.TransformCoordinatesToRef(this.position,s._RigCamTransformMatrix,o.position),o.setTarget(i)},s.prototype.getClassName=function(){return"TargetCamera"},s._RigCamTransformMatrix=new a.Matrix,s._TargetTransformMatrix=new a.Matrix,s._TargetFocalPoint=new a.Vector3,(0,t.__decorate)([(0,o.serializeAsVector3)()],s.prototype,"rotation",void 0),(0,t.__decorate)([(0,o.serialize)()],s.prototype,"speed",void 0),(0,t.__decorate)([(0,o.serializeAsMeshReference)("lockedTargetId")],s.prototype,"lockedTarget",void 0),s}(i.Camera);exports.TargetCamera=n;
},{"tslib":"90Cu","../Misc/decorators":"EVXT","./camera":"AhwZ","../Maths/math.vector":"61Nx","../Maths/math.constants":"tvfX","../Maths/math.axis":"LzVa"}],"9qNo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CameraInputsManager=exports.CameraInputTypes=void 0;var t=require("../Misc/logger"),e=require("../Misc/decorators"),a=require("./camera"),n={};exports.CameraInputTypes=n;var i=function(){function i(t){this.attached={},this.camera=t,this.checkInputs=function(){}}return i.prototype.add=function(e){var a=e.getSimpleName();this.attached[a]?t.Logger.Warn("camera input of type "+a+" already exists on camera"):(this.attached[a]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedElement&&e.attachControl(this.attachedElement))},i.prototype.remove=function(t){for(var e in this.attached){var a=this.attached[e];a===t&&(a.detachControl(this.attachedElement),a.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype.removeByType=function(t){for(var e in this.attached){var a=this.attached[e];a.getClassName()===t&&(a.detachControl(this.attachedElement),a.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype._addCheckInputs=function(t){var e=this.checkInputs;return function(){e(),t()}},i.prototype.attachInput=function(t){this.attachedElement&&t.attachControl(this.attachedElement,this.noPreventDefault)},i.prototype.attachElement=function(t,e){if(void 0===e&&(e=!1),!this.attachedElement)for(var n in e=!a.Camera.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedElement=t,this.noPreventDefault=e,this.attached)this.attached[n].attachControl(t,e)},i.prototype.detachElement=function(t,e){if(void 0===e&&(e=!1),this.attachedElement===t){for(var a in this.attached)this.attached[a].detachControl(t),e&&(this.attached[a].camera=null);this.attachedElement=null}},i.prototype.rebuildInputCheck=function(){for(var t in this.checkInputs=function(){},this.attached){var e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}},i.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},i.prototype.serialize=function(t){var a={};for(var n in this.attached){var i=this.attached[n],h=e.SerializationHelper.Serialize(i);a[i.getClassName()]=h}t.inputsmgr=a},i.prototype.parse=function(t){var a=t.inputsmgr;if(a)for(var i in this.clear(),a){if(c=n[i]){var h=a[i],r=e.SerializationHelper.Parse(function(){return new c},h,null);this.add(r)}}else for(var i in this.attached){var c;if(c=n[this.attached[i].getClassName()]){r=e.SerializationHelper.Parse(function(){return new c},t,null);this.remove(this.attached[i]),this.add(r)}}},i}();exports.CameraInputsManager=i;
},{"../Misc/logger":"Yh4i","../Misc/decorators":"EVXT","./camera":"AhwZ"}],"WtDZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseCameraPointersInput=void 0;var t=require("tslib"),e=require("../../Misc/decorators"),n=require("../../Misc/tools"),o=require("../../Events/pointerEvents"),i=function(){function i(){this.buttons=[0,1,2]}return i.prototype.attachControl=function(t,e){var i=this,p=this.camera.getEngine(),r=0,s=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(n,u){var l=n.event,c="touch"===l.pointerType;if(!p.isInVRExclusivePointerMode&&(n.type===o.PointerEventTypes.POINTERMOVE||-1!==i.buttons.indexOf(l.button))){var a=l.srcElement||l.target;if(i._altKey=l.altKey,i._ctrlKey=l.ctrlKey,i._metaKey=l.metaKey,i._shiftKey=l.shiftKey,i._buttonsPressed=l.buttons,p.isPointerLock){var y=l.movementX||l.mozMovementX||l.webkitMovementX||l.msMovementX||0,h=l.movementY||l.mozMovementY||l.webkitMovementY||l.msMovementY||0;i.onTouch(null,y,h),i.pointA=null,i.pointB=null}else if(n.type===o.PointerEventTypes.POINTERDOWN&&a){try{a.setPointerCapture(l.pointerId)}catch(P){}null===i.pointA?i.pointA={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}:null===i.pointB&&(i.pointB={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}),i.onButtonDown(l),e||(l.preventDefault(),t.focus())}else if(n.type===o.PointerEventTypes.POINTERDOUBLETAP)i.onDoubleTap(l.pointerType);else if(n.type===o.PointerEventTypes.POINTERUP&&a){try{a.releasePointerCapture(l.pointerId)}catch(P){}c||(i.pointB=null),p._badOS?i.pointA=i.pointB=null:i.pointB&&i.pointA&&i.pointA.pointerId==l.pointerId?(i.pointA=i.pointB,i.pointB=null):i.pointA&&i.pointB&&i.pointB.pointerId==l.pointerId?i.pointB=null:i.pointA=i.pointB=null,(0!==r||s)&&(i.onMultiTouch(i.pointA,i.pointB,r,0,s,null),r=0,s=null),i.onButtonUp(l),e||l.preventDefault()}else if(n.type===o.PointerEventTypes.POINTERMOVE)if(e||l.preventDefault(),i.pointA&&null===i.pointB){y=l.clientX-i.pointA.x,h=l.clientY-i.pointA.y;i.onTouch(i.pointA,y,h),i.pointA.x=l.clientX,i.pointA.y=l.clientY}else if(i.pointA&&i.pointB){var v=i.pointA.pointerId===l.pointerId?i.pointA:i.pointB;v.x=l.clientX,v.y=l.clientY;var d=i.pointA.x-i.pointB.x,m=i.pointA.y-i.pointB.y,f=d*d+m*m,T={x:(i.pointA.x+i.pointB.x)/2,y:(i.pointA.y+i.pointB.y)/2,pointerId:l.pointerId,type:n.type};i.onMultiTouch(i.pointA,i.pointB,r,f,s,T),s=T,r=f}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,o.PointerEventTypes.POINTERDOWN|o.PointerEventTypes.POINTERUP|o.PointerEventTypes.POINTERMOVE),this._onLostFocus=function(){i.pointA=i.pointB=null,r=0,s=null,i.onLostFocus()},t.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var u=this.camera.getScene().getEngine().getHostWindow();u&&n.Tools.RegisterTopRootEvents(u,[{name:"blur",handler:this._onLostFocus}])},i.prototype.detachControl=function(t){if(this._onLostFocus){var e=this.camera.getScene().getEngine().getHostWindow();e&&n.Tools.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}t&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu&&t.removeEventListener("contextmenu",this.onContextMenu),this._onLostFocus=null),this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},i.prototype.getClassName=function(){return"BaseCameraPointersInput"},i.prototype.getSimpleName=function(){return"pointers"},i.prototype.onDoubleTap=function(t){},i.prototype.onTouch=function(t,e,n){},i.prototype.onMultiTouch=function(t,e,n,o,i,p){},i.prototype.onContextMenu=function(t){t.preventDefault()},i.prototype.onButtonDown=function(t){},i.prototype.onButtonUp=function(t){},i.prototype.onLostFocus=function(){},(0,t.__decorate)([(0,e.serialize)()],i.prototype,"buttons",void 0),i}();exports.BaseCameraPointersInput=i;
},{"tslib":"90Cu","../../Misc/decorators":"EVXT","../../Misc/tools":"8xSa","../../Events/pointerEvents":"z5YY"}],"SPfO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCameraPointersInput=void 0;var i=require("tslib"),t=require("../../Misc/decorators"),n=require("../../Cameras/cameraInputsManager"),e=require("../../Cameras/Inputs/BaseCameraPointersInput"),a=function(n){function e(){var i=null!==n&&n.apply(this,arguments)||this;return i.buttons=[0,1,2],i.angularSensibilityX=1e3,i.angularSensibilityY=1e3,i.pinchPrecision=12,i.pinchDeltaPercentage=0,i.useNaturalPinchZoom=!1,i.panningSensibility=1e3,i.multiTouchPanning=!0,i.multiTouchPanAndZoom=!0,i.pinchInwards=!0,i._isPanClick=!1,i._twoFingerActivityCount=0,i._isPinching=!1,i}return(0,i.__extends)(e,n),e.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},e.prototype.onTouch=function(i,t,n){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)},e.prototype.onDoubleTap=function(i){this.camera.useInputToRestoreState&&this.camera.restoreState()},e.prototype.onMultiTouch=function(i,t,n,e,a,s){if(!(0===n&&null===a||0===e&&null===s)){var r=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(n)/Math.sqrt(e):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(e-n)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(e-n)/(this.pinchPrecision*r*(this.angularSensibilityX+this.angularSensibilityY)/2),0!==this.panningSensibility&&a&&s){var o=s.x-a.x,c=s.y-a.y;this.camera.inertialPanningX+=-o/this.panningSensibility,this.camera.inertialPanningY+=c/this.panningSensibility}}else{this._twoFingerActivityCount++;var h=Math.sqrt(n),l=Math.sqrt(e);if(this._isPinching||this._twoFingerActivityCount<20&&Math.abs(l-h)>this.camera.pinchToPanMaxDistance)this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(e-n)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(e-n)/(this.pinchPrecision*r*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0;else if(0!==this.panningSensibility&&this.multiTouchPanning&&s&&a){o=s.x-a.x,c=s.y-a.y;this.camera.inertialPanningX+=-o/this.panningSensibility,this.camera.inertialPanningY+=c/this.panningSensibility}}}},e.prototype.onButtonDown=function(i){this._isPanClick=i.button===this.camera._panningMouseButton},e.prototype.onButtonUp=function(i){this._twoFingerActivityCount=0,this._isPinching=!1},e.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},(0,i.__decorate)([(0,t.serialize)()],e.prototype,"buttons",void 0),(0,i.__decorate)([(0,t.serialize)()],e.prototype,"angularSensibilityX",void 0),(0,i.__decorate)([(0,t.serialize)()],e.prototype,"angularSensibilityY",void 0),(0,i.__decorate)([(0,t.serialize)()],e.prototype,"pinchPrecision",void 0),(0,i.__decorate)([(0,t.serialize)()],e.prototype,"pinchDeltaPercentage",void 0),(0,i.__decorate)([(0,t.serialize)()],e.prototype,"useNaturalPinchZoom",void 0),(0,i.__decorate)([(0,t.serialize)()],e.prototype,"panningSensibility",void 0),(0,i.__decorate)([(0,t.serialize)()],e.prototype,"multiTouchPanning",void 0),(0,i.__decorate)([(0,t.serialize)()],e.prototype,"multiTouchPanAndZoom",void 0),e}(e.BaseCameraPointersInput);exports.ArcRotateCameraPointersInput=a,n.CameraInputTypes.ArcRotateCameraPointersInput=a;
},{"tslib":"90Cu","../../Misc/decorators":"EVXT","../../Cameras/cameraInputsManager":"9qNo","../../Cameras/Inputs/BaseCameraPointersInput":"WtDZ"}],"D5wI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCameraKeyboardMoveInput=void 0;var e=require("tslib"),t=require("../../Misc/decorators"),i=require("../../Cameras/cameraInputsManager"),s=require("../../Events/keyboardEvents"),n=function(){function i(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return i.prototype.attachControl=function(e,t){var i=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){i._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var n,r=e.event;r.metaKey||(e.type===s.KeyboardEventTypes.KEYDOWN?(i._ctrlPressed=r.ctrlKey,i._altPressed=r.altKey,(-1!==i.keysUp.indexOf(r.keyCode)||-1!==i.keysDown.indexOf(r.keyCode)||-1!==i.keysLeft.indexOf(r.keyCode)||-1!==i.keysRight.indexOf(r.keyCode)||-1!==i.keysReset.indexOf(r.keyCode))&&(-1===(n=i._keys.indexOf(r.keyCode))&&i._keys.push(r.keyCode),r.preventDefault&&(t||r.preventDefault()))):-1===i.keysUp.indexOf(r.keyCode)&&-1===i.keysDown.indexOf(r.keyCode)&&-1===i.keysLeft.indexOf(r.keyCode)&&-1===i.keysRight.indexOf(r.keyCode)&&-1===i.keysReset.indexOf(r.keyCode)||((n=i._keys.indexOf(r.keyCode))>=0&&i._keys.splice(n,1),r.preventDefault&&(t||r.preventDefault())))}))},i.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&e.useInputToRestoreState&&e.restoreState()}},i.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},i.prototype.getSimpleName=function(){return"keyboard"},(0,e.__decorate)([(0,t.serialize)()],i.prototype,"keysUp",void 0),(0,e.__decorate)([(0,t.serialize)()],i.prototype,"keysDown",void 0),(0,e.__decorate)([(0,t.serialize)()],i.prototype,"keysLeft",void 0),(0,e.__decorate)([(0,t.serialize)()],i.prototype,"keysRight",void 0),(0,e.__decorate)([(0,t.serialize)()],i.prototype,"keysReset",void 0),(0,e.__decorate)([(0,t.serialize)()],i.prototype,"panningSensibility",void 0),(0,e.__decorate)([(0,t.serialize)()],i.prototype,"zoomingSensibility",void 0),(0,e.__decorate)([(0,t.serialize)()],i.prototype,"useAltToZoom",void 0),(0,e.__decorate)([(0,t.serialize)()],i.prototype,"angularSpeed",void 0),i}();exports.ArcRotateCameraKeyboardMoveInput=n,i.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=n;
},{"tslib":"90Cu","../../Misc/decorators":"EVXT","../../Cameras/cameraInputsManager":"9qNo","../../Events/keyboardEvents":"HUG+"}],"lY+i":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCameraMouseWheelInput=void 0;var e=require("tslib"),t=require("../../Misc/decorators"),r=require("../../Cameras/cameraInputsManager"),a=require("../../Events/pointerEvents"),o=require("../../Maths/math.scalar"),i=function(){function r(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return r.prototype.computeDeltaFromMouseWheelLegacyEvent=function(e,t){var r=.01*e*this.wheelDeltaPercentage*t;return e>0?r/(1+this.wheelDeltaPercentage):r*(1+this.wheelDeltaPercentage)},r.prototype.attachControl=function(e,t){var r=this;this._wheel=function(e,i){if(e.type===a.PointerEventTypes.POINTERWHEEL){var n=e.event,s=0,l=n,c=0;if(c=l.wheelDelta?l.wheelDelta:60*-(n.deltaY||n.detail),r.wheelDeltaPercentage){if((s=r.computeDeltaFromMouseWheelLegacyEvent(c,r.camera.radius))>0){for(var u=r.camera.radius,h=r.camera.inertialRadiusOffset+s,p=0;p<20&&Math.abs(h)>.001;p++)u-=h,h*=r.camera.inertia;u=o.Scalar.Clamp(u,0,Number.MAX_VALUE),s=r.computeDeltaFromMouseWheelLegacyEvent(c,u)}}else s=c/(40*r.wheelPrecision);s&&(r.camera.inertialRadiusOffset+=s),n.preventDefault&&(t||n.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,a.PointerEventTypes.POINTERWHEEL)},r.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},r.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},r.prototype.getSimpleName=function(){return"mousewheel"},(0,e.__decorate)([(0,t.serialize)()],r.prototype,"wheelPrecision",void 0),(0,e.__decorate)([(0,t.serialize)()],r.prototype,"wheelDeltaPercentage",void 0),r}();exports.ArcRotateCameraMouseWheelInput=i,r.CameraInputTypes.ArcRotateCameraMouseWheelInput=i;
},{"tslib":"90Cu","../../Misc/decorators":"EVXT","../../Cameras/cameraInputsManager":"9qNo","../../Events/pointerEvents":"z5YY","../../Maths/math.scalar":"TAUa"}],"FDqR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCameraInputsManager=void 0;var e=require("tslib"),t=require("../Cameras/Inputs/arcRotateCameraPointersInput"),r=require("../Cameras/Inputs/arcRotateCameraKeyboardMoveInput"),a=require("../Cameras/Inputs/arcRotateCameraMouseWheelInput"),n=require("../Cameras/cameraInputsManager"),o=function(n){function o(e){return n.call(this,e)||this}return(0,e.__extends)(o,n),o.prototype.addMouseWheel=function(){return this.add(new a.ArcRotateCameraMouseWheelInput),this},o.prototype.addPointers=function(){return this.add(new t.ArcRotateCameraPointersInput),this},o.prototype.addKeyboard=function(){return this.add(new r.ArcRotateCameraKeyboardMoveInput),this},o}(n.CameraInputsManager);exports.ArcRotateCameraInputsManager=o;
},{"tslib":"90Cu","../Cameras/Inputs/arcRotateCameraPointersInput":"SPfO","../Cameras/Inputs/arcRotateCameraKeyboardMoveInput":"D5wI","../Cameras/Inputs/arcRotateCameraMouseWheelInput":"lY+i","../Cameras/cameraInputsManager":"9qNo"}],"raAw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCamera=void 0;var t=require("tslib"),e=require("../Misc/decorators"),i=require("../Misc/observable"),a=require("../Maths/math.vector"),r=require("../node"),o=require("../Meshes/mesh"),s=require("../Behaviors/Cameras/autoRotationBehavior"),n=require("../Behaviors/Cameras/bouncingBehavior"),h=require("../Behaviors/Cameras/framingBehavior"),c=require("./camera"),p=require("./targetCamera"),l=require("../Cameras/arcRotateCameraInputsManager"),u=require("../Maths/math.constants");r.Node.AddNodeConstructor("ArcRotateCamera",function(t,e){return function(){return new _(t,0,0,1,a.Vector3.Zero(),e)}});var _=function(r){function p(t,e,o,s,n,h,c){void 0===c&&(c=!0);var p=r.call(this,t,a.Vector3.Zero(),h,c)||this;return p._upVector=a.Vector3.Up(),p.inertialAlphaOffset=0,p.inertialBetaOffset=0,p.inertialRadiusOffset=0,p.lowerAlphaLimit=null,p.upperAlphaLimit=null,p.lowerBetaLimit=.01,p.upperBetaLimit=Math.PI-.01,p.lowerRadiusLimit=null,p.upperRadiusLimit=null,p.inertialPanningX=0,p.inertialPanningY=0,p.pinchToPanMaxDistance=20,p.panningDistanceLimit=null,p.panningOriginTarget=a.Vector3.Zero(),p.panningInertia=.9,p.zoomOnFactor=1,p.targetScreenOffset=a.Vector2.Zero(),p.allowUpsideDown=!0,p.useInputToRestoreState=!0,p._viewMatrix=new a.Matrix,p.panningAxis=new a.Vector3(1,1,0),p.onMeshTargetChangedObservable=new i.Observable,p.checkCollisions=!1,p.collisionRadius=new a.Vector3(.5,.5,.5),p._previousPosition=a.Vector3.Zero(),p._collisionVelocity=a.Vector3.Zero(),p._newPosition=a.Vector3.Zero(),p._computationVector=a.Vector3.Zero(),p._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null),i?(p.setPosition(e),p.onCollide&&p.onCollide(i)):p._previousPosition.copyFrom(p._position);var a=Math.cos(p.alpha),r=Math.sin(p.alpha),o=Math.cos(p.beta),s=Math.sin(p.beta);0===s&&(s=1e-4);var n=p._getTargetPosition();p._computationVector.copyFromFloats(p.radius*a*s,p.radius*o,p.radius*r*s),n.addToRef(p._computationVector,p._newPosition),p._position.copyFrom(p._newPosition);var h=p.upVector;p.allowUpsideDown&&p.beta<0&&(h=(h=h.clone()).negate()),p._computeViewMatrix(p._position,n,h),p._viewMatrix.addAtIndex(12,p.targetScreenOffset.x),p._viewMatrix.addAtIndex(13,p.targetScreenOffset.y),p._collisionTriggered=!1},p._target=a.Vector3.Zero(),n&&p.setTarget(n),p.alpha=e,p.beta=o,p.radius=s,p.getViewMatrix(),p.inputs=new l.ArcRotateCameraInputsManager(p),p.inputs.addKeyboard().addMouseWheel().addPointers(),p}return(0,t.__extends)(p,r),Object.defineProperty(p.prototype,"target",{get:function(){return this._target},set:function(t){this.setTarget(t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"position",{get:function(){return this._position},set:function(t){this.setPosition(t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"upVector",{get:function(){return this._upVector},set:function(t){this._upToYMatrix||(this._YToUpMatrix=new a.Matrix,this._upToYMatrix=new a.Matrix,this._upVector=a.Vector3.Zero()),t.normalize(),this._upVector.copyFrom(t),this.setMatUp()},enumerable:!0,configurable:!0}),p.prototype.setMatUp=function(){a.Matrix.RotationAlignToRef(a.Vector3.UpReadOnly,this._upVector,this._YToUpMatrix),a.Matrix.RotationAlignToRef(this._upVector,a.Vector3.UpReadOnly,this._upToYMatrix)},Object.defineProperty(p.prototype,"angularSensibilityX",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.angularSensibilityX=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"angularSensibilityY",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.angularSensibilityY=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"pinchPrecision",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchPrecision:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.pinchPrecision=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"pinchDeltaPercentage",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.pinchDeltaPercentage=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useNaturalPinchZoom",{get:function(){var t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom},set:function(t){var e=this.inputs.attached.pointers;e&&(e.useNaturalPinchZoom=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"panningSensibility",{get:function(){var t=this.inputs.attached.pointers;return t?t.panningSensibility:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.panningSensibility=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"keysUp",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUp:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysUp=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"keysDown",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDown:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysDown=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"keysLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysLeft:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"keysRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRight:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRight=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"wheelPrecision",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0},set:function(t){var e=this.inputs.attached.mousewheel;e&&(e.wheelPrecision=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"wheelDeltaPercentage",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0},set:function(t){var e=this.inputs.attached.mousewheel;e&&(e.wheelDeltaPercentage=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new n.BouncingBehavior,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new h.FramingBehavior,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new s.AutoRotationBehavior,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),p.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache._target=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=a.Vector2.Zero()},p.prototype._updateCache=function(t){t||r.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},p.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var t=this._targetHost.absolutePosition;this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}var e=this._getLockedTargetPosition();return e||this._target},p.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),r.prototype.storeState.call(this)},p.prototype._restoreStateValues=function(){return!!r.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},p.prototype._isSynchronizedViewMatrix=function(){return!!r.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},p.prototype.attachControl=function(t,e,i,a){var r=this;void 0===i&&(i=!0),void 0===a&&(a=2),this._useCtrlForPanning=i,this._panningMouseButton=a,this.inputs.attachElement(t,e),this._reset=function(){r.inertialAlphaOffset=0,r.inertialBetaOffset=0,r.inertialRadiusOffset=0,r.inertialPanningX=0,r.inertialPanningY=0}},p.prototype.detachControl=function(t){this.inputs.detachElement(t),this._reset&&this._reset()},p.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var t=this.inertialAlphaOffset;this.beta<=0&&(t*=-1),this.getScene().useRightHandedSystem&&(t*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(t*=-1),this.alpha+=t,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<u.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<u.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*u.Epsilon&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){if(this._localDirection||(this._localDirection=a.Vector3.Zero(),this._transformedDirection=a.Vector3.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),a.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),a.Vector3.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*u.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*u.Epsilon&&(this.inertialPanningY=0)}this._checkLimits(),r.prototype._checkInputs.call(this)}},p.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},p.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||a.Vector3.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4),0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},p.prototype.setPosition=function(t){this._position.equals(t)||(this._position.copyFrom(t),this.rebuildAnglesAndRadius())},p.prototype.setTarget=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),t.getBoundingInfo)this._targetBoundingCenter=e?t.getBoundingInfo().boundingBox.centerWorld.clone():null,t.computeWorldMatrix(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var a=t,r=this._getTargetPosition();if(r&&!i&&r.equals(a))return;this._targetHost=null,this._target=a,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},p.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),e=Math.sin(this.alpha),i=Math.cos(this.beta),r=Math.sin(this.beta);0===r&&(r=1e-4);var o=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*r,this.radius*i,this.radius*e*r),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||a.Vector3.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),o.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var s=this.getScene().collisionCoordinator;this._collider||(this._collider=s.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,s.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var n=this.upVector;this.allowUpsideDown&&r<0&&(n=n.negate()),this._computeViewMatrix(this._position,o,n),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=o,this._viewMatrix},p.prototype.zoomOn=function(t,e){void 0===e&&(e=!1),t=t||this.getScene().meshes;var i=o.Mesh.MinMax(t),r=a.Vector3.Distance(i.min,i.max);this.radius=r*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:r},e)},p.prototype.focusOn=function(t,e){var i,r;if(void 0===e&&(e=!1),void 0===t.min){var s=t||this.getScene().meshes;i=o.Mesh.MinMax(s),r=a.Vector3.Distance(i.min,i.max)}else{i=t,r=t.distance}this._target=o.Mesh.Center(i),e||(this.maxZ=2*r)},p.prototype.createRigCamera=function(t,e){var i=0;switch(this.cameraRigMode){case c.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.Camera.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===e?1:-1);break;case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===e?-1:1)}var a=new p(t,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return a._cameraRigParams={},a.isRigCamera=!0,a.rigParent=this,a},p.prototype._updateRigCameras=function(){var t=this._rigCameras[0],e=this._rigCameras[1];switch(t.beta=e.beta=this.beta,this.cameraRigMode){case c.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.Camera.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}r.prototype._updateRigCameras.call(this)},p.prototype.dispose=function(){this.inputs.clear(),r.prototype.dispose.call(this)},p.prototype.getClassName=function(){return"ArcRotateCamera"},(0,t.__decorate)([(0,e.serialize)()],p.prototype,"alpha",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"beta",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"radius",void 0),(0,t.__decorate)([(0,e.serializeAsVector3)("target")],p.prototype,"_target",void 0),(0,t.__decorate)([(0,e.serializeAsVector3)("upVector")],p.prototype,"_upVector",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"inertialAlphaOffset",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"inertialBetaOffset",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"inertialRadiusOffset",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"lowerAlphaLimit",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"upperAlphaLimit",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"lowerBetaLimit",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"upperBetaLimit",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"lowerRadiusLimit",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"upperRadiusLimit",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"inertialPanningX",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"inertialPanningY",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"pinchToPanMaxDistance",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"panningDistanceLimit",void 0),(0,t.__decorate)([(0,e.serializeAsVector3)()],p.prototype,"panningOriginTarget",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"panningInertia",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"zoomOnFactor",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"targetScreenOffset",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"allowUpsideDown",void 0),(0,t.__decorate)([(0,e.serialize)()],p.prototype,"useInputToRestoreState",void 0),p}(p.TargetCamera);exports.ArcRotateCamera=_;
},{"tslib":"90Cu","../Misc/decorators":"EVXT","../Misc/observable":"vY1+","../Maths/math.vector":"61Nx","../node":"mlkt","../Meshes/mesh":"58SX","../Behaviors/Cameras/autoRotationBehavior":"oU1t","../Behaviors/Cameras/bouncingBehavior":"SvU7","../Behaviors/Cameras/framingBehavior":"LUjy","./camera":"AhwZ","./targetCamera":"1sRG","../Cameras/arcRotateCameraInputsManager":"FDqR","../Maths/math.constants":"tvfX"}],"rMvI":[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();exports.__esModule=!0;var t=require("@naker/services/System/systemAnimation"),r=require("@babylonjs/core/Maths/math"),n=require("@babylonjs/core/Cameras/arcRotateCamera"),a=function(t){function a(e){var a=t.call(this,e)||this;return a.camera=new n.ArcRotateCamera("main_camera",Math.PI/2,Math.PI/2,10,new r.Vector3(0,0,0),a.scene),a.camera.setTarget(new r.Vector3(0,0,0)),a.camera.minZ=0,a.optimize(),a.scene.blockMaterialDirtyMechanism=!0,a}return e(a,t),a}(t.SystemAnimation);exports.coreSystem=a;
},{"@naker/services/System/systemAnimation":"4k//","@babylonjs/core/Maths/math":"iyC1","@babylonjs/core/Cameras/arcRotateCamera":"raAw"}],"sVYZ":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("@naker/services/Catchers/mouseCatcher"),s=require("@naker/services/Catchers/responsiveCatcher"),t=require("@naker/services/Catchers/touchCatcher"),r=require("./particle"),i=require("./environment"),n=require("./system");exports.start=function(e){return new c(e)};var c=function(){return function(c,h){this.system=h||new n.coreSystem(c.canvas),this.system.setLimitFPS(!0),this.system.setNeedProcess(!1),this.touchCatcher=new t.TouchCatcher(window),this.mouseCatcher=new e.MouseCatcher(this.system,this.touchCatcher),this.responsiveCatcher=new s.ResponsiveCatcher(this.system),this.particle=new r.Particle(this.system,c.particle),this.environment=new i.Environment(this.system,this.mouseCatcher,c.environment),this.system.launchRender()}}();exports.BackEngine=c;
},{"@naker/services/Catchers/mouseCatcher":"Sez+","@naker/services/Catchers/responsiveCatcher":"ifCa","@naker/services/Catchers/touchCatcher":"Jlz2","./particle":"9mLv","./environment":"QyAc","./system":"rMvI"}],"0ZXZ":[function(require,module,exports) {
"use strict";var r=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e])})(t,e)};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();exports.__esModule=!0;var t=require("@naker/services/Viewer/worker"),e=require("./viewer/back"),n=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype.buildProject=function(r){return r.canvas=this.canvas,new e.BackEngine(r)},n}(t.NakerWorker);exports.back=new n;
},{"@naker/services/Viewer/worker":"gbIo","./viewer/back":"sVYZ"}]},{},["0ZXZ"], null)
//# sourceMappingURL=/worker.js.map